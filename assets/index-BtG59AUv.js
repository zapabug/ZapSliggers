var Yf=Object.defineProperty;var Qf=(n,t,e)=>t in n?Yf(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var pe=(n,t,e)=>Qf(n,typeof t!="symbol"?t+"":t,e);function _mergeNamespaces(n,t){for(var e=0;e<t.length;e++){const s=t[e];if(typeof s!="string"&&!Array.isArray(s)){for(const a in s)if(a!=="default"&&!(a in n)){const o=Object.getOwnPropertyDescriptor(s,a);o&&Object.defineProperty(n,a,o.get?o:{enumerable:!0,get:()=>s[a]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const f of o.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&s(f)}).observe(document,{childList:!0,subtree:!0});function e(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=e(a);fetch(a.href,o)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReact_production_min;function requireReact_production_min(){if(hasRequiredReact_production_min)return react_production_min;hasRequiredReact_production_min=1;var n=Symbol.for("react.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),f=Symbol.for("react.context"),p=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),g=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),E=Symbol.iterator;function A(X){return X===null||typeof X!="object"?null:(X=E&&X[E]||X["@@iterator"],typeof X=="function"?X:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},I=Object.assign,_={};function R(X,ae,te){this.props=X,this.context=ae,this.refs=_,this.updater=te||S}R.prototype.isReactComponent={},R.prototype.setState=function(X,ae){if(typeof X!="object"&&typeof X!="function"&&X!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,X,ae,"setState")},R.prototype.forceUpdate=function(X){this.updater.enqueueForceUpdate(this,X,"forceUpdate")};function N(){}N.prototype=R.prototype;function D(X,ae,te){this.props=X,this.context=ae,this.refs=_,this.updater=te||S}var M=D.prototype=new N;M.constructor=D,I(M,R.prototype),M.isPureReactComponent=!0;var W=Array.isArray,B=Object.prototype.hasOwnProperty,U={current:null},P={key:!0,ref:!0,__self:!0,__source:!0};function F(X,ae,te){var ce,xe={},me=null,Se=null;if(ae!=null)for(ce in ae.ref!==void 0&&(Se=ae.ref),ae.key!==void 0&&(me=""+ae.key),ae)B.call(ae,ce)&&!P.hasOwnProperty(ce)&&(xe[ce]=ae[ce]);var be=arguments.length-2;if(be===1)xe.children=te;else if(1<be){for(var Me=Array(be),Oe=0;Oe<be;Oe++)Me[Oe]=arguments[Oe+2];xe.children=Me}if(X&&X.defaultProps)for(ce in be=X.defaultProps,be)xe[ce]===void 0&&(xe[ce]=be[ce]);return{$$typeof:n,type:X,key:me,ref:Se,props:xe,_owner:U.current}}function j(X,ae){return{$$typeof:n,type:X.type,key:ae,ref:X.ref,props:X.props,_owner:X._owner}}function Q(X){return typeof X=="object"&&X!==null&&X.$$typeof===n}function $(X){var ae={"=":"=0",":":"=2"};return"$"+X.replace(/[=:]/g,function(te){return ae[te]})}var V=/\/+/g;function G(X,ae){return typeof X=="object"&&X!==null&&X.key!=null?$(""+X.key):ae.toString(36)}function se(X,ae,te,ce,xe){var me=typeof X;(me==="undefined"||me==="boolean")&&(X=null);var Se=!1;if(X===null)Se=!0;else switch(me){case"string":case"number":Se=!0;break;case"object":switch(X.$$typeof){case n:case t:Se=!0}}if(Se)return Se=X,xe=xe(Se),X=ce===""?"."+G(Se,0):ce,W(xe)?(te="",X!=null&&(te=X.replace(V,"$&/")+"/"),se(xe,ae,te,"",function(Oe){return Oe})):xe!=null&&(Q(xe)&&(xe=j(xe,te+(!xe.key||Se&&Se.key===xe.key?"":(""+xe.key).replace(V,"$&/")+"/")+X)),ae.push(xe)),1;if(Se=0,ce=ce===""?".":ce+":",W(X))for(var be=0;be<X.length;be++){me=X[be];var Me=ce+G(me,be);Se+=se(me,ae,te,Me,xe)}else if(Me=A(X),typeof Me=="function")for(X=Me.call(X),be=0;!(me=X.next()).done;)me=me.value,Me=ce+G(me,be++),Se+=se(me,ae,te,Me,xe);else if(me==="object")throw ae=String(X),Error("Objects are not valid as a React child (found: "+(ae==="[object Object]"?"object with keys {"+Object.keys(X).join(", ")+"}":ae)+"). If you meant to render a collection of children, use an array instead.");return Se}function H(X,ae,te){if(X==null)return X;var ce=[],xe=0;return se(X,ce,"","",function(me){return ae.call(te,me,xe++)}),ce}function J(X){if(X._status===-1){var ae=X._result;ae=ae(),ae.then(function(te){(X._status===0||X._status===-1)&&(X._status=1,X._result=te)},function(te){(X._status===0||X._status===-1)&&(X._status=2,X._result=te)}),X._status===-1&&(X._status=0,X._result=ae)}if(X._status===1)return X._result.default;throw X._result}var K={current:null},ie={transition:null},ne={ReactCurrentDispatcher:K,ReactCurrentBatchConfig:ie,ReactCurrentOwner:U};function re(){throw Error("act(...) is not supported in production builds of React.")}return react_production_min.Children={map:H,forEach:function(X,ae,te){H(X,function(){ae.apply(this,arguments)},te)},count:function(X){var ae=0;return H(X,function(){ae++}),ae},toArray:function(X){return H(X,function(ae){return ae})||[]},only:function(X){if(!Q(X))throw Error("React.Children.only expected to receive a single React element child.");return X}},react_production_min.Component=R,react_production_min.Fragment=e,react_production_min.Profiler=a,react_production_min.PureComponent=D,react_production_min.StrictMode=s,react_production_min.Suspense=y,react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ne,react_production_min.act=re,react_production_min.cloneElement=function(X,ae,te){if(X==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+X+".");var ce=I({},X.props),xe=X.key,me=X.ref,Se=X._owner;if(ae!=null){if(ae.ref!==void 0&&(me=ae.ref,Se=U.current),ae.key!==void 0&&(xe=""+ae.key),X.type&&X.type.defaultProps)var be=X.type.defaultProps;for(Me in ae)B.call(ae,Me)&&!P.hasOwnProperty(Me)&&(ce[Me]=ae[Me]===void 0&&be!==void 0?be[Me]:ae[Me])}var Me=arguments.length-2;if(Me===1)ce.children=te;else if(1<Me){be=Array(Me);for(var Oe=0;Oe<Me;Oe++)be[Oe]=arguments[Oe+2];ce.children=be}return{$$typeof:n,type:X.type,key:xe,ref:me,props:ce,_owner:Se}},react_production_min.createContext=function(X){return X={$$typeof:f,_currentValue:X,_currentValue2:X,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},X.Provider={$$typeof:o,_context:X},X.Consumer=X},react_production_min.createElement=F,react_production_min.createFactory=function(X){var ae=F.bind(null,X);return ae.type=X,ae},react_production_min.createRef=function(){return{current:null}},react_production_min.forwardRef=function(X){return{$$typeof:p,render:X}},react_production_min.isValidElement=Q,react_production_min.lazy=function(X){return{$$typeof:x,_payload:{_status:-1,_result:X},_init:J}},react_production_min.memo=function(X,ae){return{$$typeof:g,type:X,compare:ae===void 0?null:ae}},react_production_min.startTransition=function(X){var ae=ie.transition;ie.transition={};try{X()}finally{ie.transition=ae}},react_production_min.unstable_act=re,react_production_min.useCallback=function(X,ae){return K.current.useCallback(X,ae)},react_production_min.useContext=function(X){return K.current.useContext(X)},react_production_min.useDebugValue=function(){},react_production_min.useDeferredValue=function(X){return K.current.useDeferredValue(X)},react_production_min.useEffect=function(X,ae){return K.current.useEffect(X,ae)},react_production_min.useId=function(){return K.current.useId()},react_production_min.useImperativeHandle=function(X,ae,te){return K.current.useImperativeHandle(X,ae,te)},react_production_min.useInsertionEffect=function(X,ae){return K.current.useInsertionEffect(X,ae)},react_production_min.useLayoutEffect=function(X,ae){return K.current.useLayoutEffect(X,ae)},react_production_min.useMemo=function(X,ae){return K.current.useMemo(X,ae)},react_production_min.useReducer=function(X,ae,te){return K.current.useReducer(X,ae,te)},react_production_min.useRef=function(X){return K.current.useRef(X)},react_production_min.useState=function(X){return K.current.useState(X)},react_production_min.useSyncExternalStore=function(X,ae,te){return K.current.useSyncExternalStore(X,ae,te)},react_production_min.useTransition=function(){return K.current.useTransition()},react_production_min.version="18.3.1",react_production_min}var hasRequiredReact;function requireReact(){return hasRequiredReact||(hasRequiredReact=1,react.exports=requireReact_production_min()),react.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactJsxRuntime_production_min;function requireReactJsxRuntime_production_min(){if(hasRequiredReactJsxRuntime_production_min)return reactJsxRuntime_production_min;hasRequiredReactJsxRuntime_production_min=1;var n=requireReact(),t=Symbol.for("react.element"),e=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function f(p,y,g){var x,E={},A=null,S=null;g!==void 0&&(A=""+g),y.key!==void 0&&(A=""+y.key),y.ref!==void 0&&(S=y.ref);for(x in y)s.call(y,x)&&!o.hasOwnProperty(x)&&(E[x]=y[x]);if(p&&p.defaultProps)for(x in y=p.defaultProps,y)E[x]===void 0&&(E[x]=y[x]);return{$$typeof:t,type:p,key:A,ref:S,props:E,_owner:a.current}}return reactJsxRuntime_production_min.Fragment=e,reactJsxRuntime_production_min.jsx=f,reactJsxRuntime_production_min.jsxs=f,reactJsxRuntime_production_min}var hasRequiredJsxRuntime;function requireJsxRuntime(){return hasRequiredJsxRuntime||(hasRequiredJsxRuntime=1,jsxRuntime.exports=requireReactJsxRuntime_production_min()),jsxRuntime.exports}var jsxRuntimeExports=requireJsxRuntime(),reactExports=requireReact();const React=getDefaultExportFromCjs(reactExports);var client$1={},reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredScheduler_production_min;function requireScheduler_production_min(){return hasRequiredScheduler_production_min||(hasRequiredScheduler_production_min=1,function(n){function t(ie,ne){var re=ie.length;ie.push(ne);e:for(;0<re;){var X=re-1>>>1,ae=ie[X];if(0<a(ae,ne))ie[X]=ne,ie[re]=ae,re=X;else break e}}function e(ie){return ie.length===0?null:ie[0]}function s(ie){if(ie.length===0)return null;var ne=ie[0],re=ie.pop();if(re!==ne){ie[0]=re;e:for(var X=0,ae=ie.length,te=ae>>>1;X<te;){var ce=2*(X+1)-1,xe=ie[ce],me=ce+1,Se=ie[me];if(0>a(xe,re))me<ae&&0>a(Se,xe)?(ie[X]=Se,ie[me]=re,X=me):(ie[X]=xe,ie[ce]=re,X=ce);else if(me<ae&&0>a(Se,re))ie[X]=Se,ie[me]=re,X=me;else break e}}return ne}function a(ie,ne){var re=ie.sortIndex-ne.sortIndex;return re!==0?re:ie.id-ne.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var f=Date,p=f.now();n.unstable_now=function(){return f.now()-p}}var y=[],g=[],x=1,E=null,A=3,S=!1,I=!1,_=!1,R=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,D=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function M(ie){for(var ne=e(g);ne!==null;){if(ne.callback===null)s(g);else if(ne.startTime<=ie)s(g),ne.sortIndex=ne.expirationTime,t(y,ne);else break;ne=e(g)}}function W(ie){if(_=!1,M(ie),!I)if(e(y)!==null)I=!0,J(B);else{var ne=e(g);ne!==null&&K(W,ne.startTime-ie)}}function B(ie,ne){I=!1,_&&(_=!1,N(F),F=-1),S=!0;var re=A;try{for(M(ne),E=e(y);E!==null&&(!(E.expirationTime>ne)||ie&&!$());){var X=E.callback;if(typeof X=="function"){E.callback=null,A=E.priorityLevel;var ae=X(E.expirationTime<=ne);ne=n.unstable_now(),typeof ae=="function"?E.callback=ae:E===e(y)&&s(y),M(ne)}else s(y);E=e(y)}if(E!==null)var te=!0;else{var ce=e(g);ce!==null&&K(W,ce.startTime-ne),te=!1}return te}finally{E=null,A=re,S=!1}}var U=!1,P=null,F=-1,j=5,Q=-1;function $(){return!(n.unstable_now()-Q<j)}function V(){if(P!==null){var ie=n.unstable_now();Q=ie;var ne=!0;try{ne=P(!0,ie)}finally{ne?G():(U=!1,P=null)}}else U=!1}var G;if(typeof D=="function")G=function(){D(V)};else if(typeof MessageChannel<"u"){var se=new MessageChannel,H=se.port2;se.port1.onmessage=V,G=function(){H.postMessage(null)}}else G=function(){R(V,0)};function J(ie){P=ie,U||(U=!0,G())}function K(ie,ne){F=R(function(){ie(n.unstable_now())},ne)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(ie){ie.callback=null},n.unstable_continueExecution=function(){I||S||(I=!0,J(B))},n.unstable_forceFrameRate=function(ie){0>ie||125<ie?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<ie?Math.floor(1e3/ie):5},n.unstable_getCurrentPriorityLevel=function(){return A},n.unstable_getFirstCallbackNode=function(){return e(y)},n.unstable_next=function(ie){switch(A){case 1:case 2:case 3:var ne=3;break;default:ne=A}var re=A;A=ne;try{return ie()}finally{A=re}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(ie,ne){switch(ie){case 1:case 2:case 3:case 4:case 5:break;default:ie=3}var re=A;A=ie;try{return ne()}finally{A=re}},n.unstable_scheduleCallback=function(ie,ne,re){var X=n.unstable_now();switch(typeof re=="object"&&re!==null?(re=re.delay,re=typeof re=="number"&&0<re?X+re:X):re=X,ie){case 1:var ae=-1;break;case 2:ae=250;break;case 5:ae=1073741823;break;case 4:ae=1e4;break;default:ae=5e3}return ae=re+ae,ie={id:x++,callback:ne,priorityLevel:ie,startTime:re,expirationTime:ae,sortIndex:-1},re>X?(ie.sortIndex=re,t(g,ie),e(y)===null&&ie===e(g)&&(_?(N(F),F=-1):_=!0,K(W,re-X))):(ie.sortIndex=ae,t(y,ie),I||S||(I=!0,J(B))),ie},n.unstable_shouldYield=$,n.unstable_wrapCallback=function(ie){var ne=A;return function(){var re=A;A=ne;try{return ie.apply(this,arguments)}finally{A=re}}}}(scheduler_production_min)),scheduler_production_min}var hasRequiredScheduler;function requireScheduler(){return hasRequiredScheduler||(hasRequiredScheduler=1,scheduler.exports=requireScheduler_production_min()),scheduler.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredReactDom_production_min;function requireReactDom_production_min(){if(hasRequiredReactDom_production_min)return reactDom_production_min;hasRequiredReactDom_production_min=1;var n=requireReact(),t=requireScheduler();function e(l){for(var h="https://reactjs.org/docs/error-decoder.html?invariant="+l,b=1;b<arguments.length;b++)h+="&args[]="+encodeURIComponent(arguments[b]);return"Minified React error #"+l+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,a={};function o(l,h){f(l,h),f(l+"Capture",h)}function f(l,h){for(a[l]=h,l=0;l<h.length;l++)s.add(h[l])}var p=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),y=Object.prototype.hasOwnProperty,g=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,x={},E={};function A(l){return y.call(E,l)?!0:y.call(x,l)?!1:g.test(l)?E[l]=!0:(x[l]=!0,!1)}function S(l,h,b,T){if(b!==null&&b.type===0)return!1;switch(typeof h){case"function":case"symbol":return!0;case"boolean":return T?!1:b!==null?!b.acceptsBooleans:(l=l.toLowerCase().slice(0,5),l!=="data-"&&l!=="aria-");default:return!1}}function I(l,h,b,T){if(h===null||typeof h>"u"||S(l,h,b,T))return!0;if(T)return!1;if(b!==null)switch(b.type){case 3:return!h;case 4:return h===!1;case 5:return isNaN(h);case 6:return isNaN(h)||1>h}return!1}function _(l,h,b,T,L,q,ue){this.acceptsBooleans=h===2||h===3||h===4,this.attributeName=T,this.attributeNamespace=L,this.mustUseProperty=b,this.propertyName=l,this.type=h,this.sanitizeURL=q,this.removeEmptyString=ue}var R={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(l){R[l]=new _(l,0,!1,l,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(l){var h=l[0];R[h]=new _(h,1,!1,l[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(l){R[l]=new _(l,2,!1,l.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(l){R[l]=new _(l,2,!1,l,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(l){R[l]=new _(l,3,!1,l.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(l){R[l]=new _(l,3,!0,l,null,!1,!1)}),["capture","download"].forEach(function(l){R[l]=new _(l,4,!1,l,null,!1,!1)}),["cols","rows","size","span"].forEach(function(l){R[l]=new _(l,6,!1,l,null,!1,!1)}),["rowSpan","start"].forEach(function(l){R[l]=new _(l,5,!1,l.toLowerCase(),null,!1,!1)});var N=/[\-:]([a-z])/g;function D(l){return l[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(l){var h=l.replace(N,D);R[h]=new _(h,1,!1,l,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(l){var h=l.replace(N,D);R[h]=new _(h,1,!1,l,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(l){var h=l.replace(N,D);R[h]=new _(h,1,!1,l,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(l){R[l]=new _(l,1,!1,l.toLowerCase(),null,!1,!1)}),R.xlinkHref=new _("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(l){R[l]=new _(l,1,!1,l.toLowerCase(),null,!0,!0)});function M(l,h,b,T){var L=R.hasOwnProperty(h)?R[h]:null;(L!==null?L.type!==0:T||!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(I(h,b,L,T)&&(b=null),T||L===null?A(h)&&(b===null?l.removeAttribute(h):l.setAttribute(h,""+b)):L.mustUseProperty?l[L.propertyName]=b===null?L.type===3?!1:"":b:(h=L.attributeName,T=L.attributeNamespace,b===null?l.removeAttribute(h):(L=L.type,b=L===3||L===4&&b===!0?"":""+b,T?l.setAttributeNS(T,h,b):l.setAttribute(h,b))))}var W=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,B=Symbol.for("react.element"),U=Symbol.for("react.portal"),P=Symbol.for("react.fragment"),F=Symbol.for("react.strict_mode"),j=Symbol.for("react.profiler"),Q=Symbol.for("react.provider"),$=Symbol.for("react.context"),V=Symbol.for("react.forward_ref"),G=Symbol.for("react.suspense"),se=Symbol.for("react.suspense_list"),H=Symbol.for("react.memo"),J=Symbol.for("react.lazy"),K=Symbol.for("react.offscreen"),ie=Symbol.iterator;function ne(l){return l===null||typeof l!="object"?null:(l=ie&&l[ie]||l["@@iterator"],typeof l=="function"?l:null)}var re=Object.assign,X;function ae(l){if(X===void 0)try{throw Error()}catch(b){var h=b.stack.trim().match(/\n( *(at )?)/);X=h&&h[1]||""}return`
`+X+l}var te=!1;function ce(l,h){if(!l||te)return"";te=!0;var b=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(h)if(h=function(){throw Error()},Object.defineProperty(h.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(h,[])}catch($e){var T=$e}Reflect.construct(l,[],h)}else{try{h.call()}catch($e){T=$e}l.call(h.prototype)}else{try{throw Error()}catch($e){T=$e}l()}}catch($e){if($e&&T&&typeof $e.stack=="string"){for(var L=$e.stack.split(`
`),q=T.stack.split(`
`),ue=L.length-1,ve=q.length-1;1<=ue&&0<=ve&&L[ue]!==q[ve];)ve--;for(;1<=ue&&0<=ve;ue--,ve--)if(L[ue]!==q[ve]){if(ue!==1||ve!==1)do if(ue--,ve--,0>ve||L[ue]!==q[ve]){var _e=`
`+L[ue].replace(" at new "," at ");return l.displayName&&_e.includes("<anonymous>")&&(_e=_e.replace("<anonymous>",l.displayName)),_e}while(1<=ue&&0<=ve);break}}}finally{te=!1,Error.prepareStackTrace=b}return(l=l?l.displayName||l.name:"")?ae(l):""}function xe(l){switch(l.tag){case 5:return ae(l.type);case 16:return ae("Lazy");case 13:return ae("Suspense");case 19:return ae("SuspenseList");case 0:case 2:case 15:return l=ce(l.type,!1),l;case 11:return l=ce(l.type.render,!1),l;case 1:return l=ce(l.type,!0),l;default:return""}}function me(l){if(l==null)return null;if(typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case P:return"Fragment";case U:return"Portal";case j:return"Profiler";case F:return"StrictMode";case G:return"Suspense";case se:return"SuspenseList"}if(typeof l=="object")switch(l.$$typeof){case $:return(l.displayName||"Context")+".Consumer";case Q:return(l._context.displayName||"Context")+".Provider";case V:var h=l.render;return l=l.displayName,l||(l=h.displayName||h.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case H:return h=l.displayName||null,h!==null?h:me(l.type)||"Memo";case J:h=l._payload,l=l._init;try{return me(l(h))}catch{}}return null}function Se(l){var h=l.type;switch(l.tag){case 24:return"Cache";case 9:return(h.displayName||"Context")+".Consumer";case 10:return(h._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return l=h.render,l=l.displayName||l.name||"",h.displayName||(l!==""?"ForwardRef("+l+")":"ForwardRef");case 7:return"Fragment";case 5:return h;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return me(h);case 8:return h===F?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h}return null}function be(l){switch(typeof l){case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function Me(l){var h=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function Oe(l){var h=Me(l)?"checked":"value",b=Object.getOwnPropertyDescriptor(l.constructor.prototype,h),T=""+l[h];if(!l.hasOwnProperty(h)&&typeof b<"u"&&typeof b.get=="function"&&typeof b.set=="function"){var L=b.get,q=b.set;return Object.defineProperty(l,h,{configurable:!0,get:function(){return L.call(this)},set:function(ue){T=""+ue,q.call(this,ue)}}),Object.defineProperty(l,h,{enumerable:b.enumerable}),{getValue:function(){return T},setValue:function(ue){T=""+ue},stopTracking:function(){l._valueTracker=null,delete l[h]}}}}function Ue(l){l._valueTracker||(l._valueTracker=Oe(l))}function je(l){if(!l)return!1;var h=l._valueTracker;if(!h)return!0;var b=h.getValue(),T="";return l&&(T=Me(l)?l.checked?"true":"false":l.value),l=T,l!==b?(h.setValue(l),!0):!1}function Pe(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}function We(l,h){var b=h.checked;return re({},h,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:b??l._wrapperState.initialChecked})}function Ze(l,h){var b=h.defaultValue==null?"":h.defaultValue,T=h.checked!=null?h.checked:h.defaultChecked;b=be(h.value!=null?h.value:b),l._wrapperState={initialChecked:T,initialValue:b,controlled:h.type==="checkbox"||h.type==="radio"?h.checked!=null:h.value!=null}}function ot(l,h){h=h.checked,h!=null&&M(l,"checked",h,!1)}function st(l,h){ot(l,h);var b=be(h.value),T=h.type;if(b!=null)T==="number"?(b===0&&l.value===""||l.value!=b)&&(l.value=""+b):l.value!==""+b&&(l.value=""+b);else if(T==="submit"||T==="reset"){l.removeAttribute("value");return}h.hasOwnProperty("value")?tt(l,h.type,b):h.hasOwnProperty("defaultValue")&&tt(l,h.type,be(h.defaultValue)),h.checked==null&&h.defaultChecked!=null&&(l.defaultChecked=!!h.defaultChecked)}function nt(l,h,b){if(h.hasOwnProperty("value")||h.hasOwnProperty("defaultValue")){var T=h.type;if(!(T!=="submit"&&T!=="reset"||h.value!==void 0&&h.value!==null))return;h=""+l._wrapperState.initialValue,b||h===l.value||(l.value=h),l.defaultValue=h}b=l.name,b!==""&&(l.name=""),l.defaultChecked=!!l._wrapperState.initialChecked,b!==""&&(l.name=b)}function tt(l,h,b){(h!=="number"||Pe(l.ownerDocument)!==l)&&(b==null?l.defaultValue=""+l._wrapperState.initialValue:l.defaultValue!==""+b&&(l.defaultValue=""+b))}var bt=Array.isArray;function qe(l,h,b,T){if(l=l.options,h){h={};for(var L=0;L<b.length;L++)h["$"+b[L]]=!0;for(b=0;b<l.length;b++)L=h.hasOwnProperty("$"+l[b].value),l[b].selected!==L&&(l[b].selected=L),L&&T&&(l[b].defaultSelected=!0)}else{for(b=""+be(b),h=null,L=0;L<l.length;L++){if(l[L].value===b){l[L].selected=!0,T&&(l[L].defaultSelected=!0);return}h!==null||l[L].disabled||(h=l[L])}h!==null&&(h.selected=!0)}}function Et(l,h){if(h.dangerouslySetInnerHTML!=null)throw Error(e(91));return re({},h,{value:void 0,defaultValue:void 0,children:""+l._wrapperState.initialValue})}function $t(l,h){var b=h.value;if(b==null){if(b=h.children,h=h.defaultValue,b!=null){if(h!=null)throw Error(e(92));if(bt(b)){if(1<b.length)throw Error(e(93));b=b[0]}h=b}h==null&&(h=""),b=h}l._wrapperState={initialValue:be(b)}}function Vt(l,h){var b=be(h.value),T=be(h.defaultValue);b!=null&&(b=""+b,b!==l.value&&(l.value=b),h.defaultValue==null&&l.defaultValue!==b&&(l.defaultValue=b)),T!=null&&(l.defaultValue=""+T)}function Dt(l){var h=l.textContent;h===l._wrapperState.initialValue&&h!==""&&h!==null&&(l.value=h)}function Lt(l){switch(l){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function de(l,h){return l==null||l==="http://www.w3.org/1999/xhtml"?Lt(h):l==="http://www.w3.org/2000/svg"&&h==="foreignObject"?"http://www.w3.org/1999/xhtml":l}var z,Y=function(l){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(h,b,T,L){MSApp.execUnsafeLocalFunction(function(){return l(h,b,T,L)})}:l}(function(l,h){if(l.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in l)l.innerHTML=h;else{for(z=z||document.createElement("div"),z.innerHTML="<svg>"+h.valueOf().toString()+"</svg>",h=z.firstChild;l.firstChild;)l.removeChild(l.firstChild);for(;h.firstChild;)l.appendChild(h.firstChild)}});function ye(l,h){if(h){var b=l.firstChild;if(b&&b===l.lastChild&&b.nodeType===3){b.nodeValue=h;return}}l.textContent=h}var Ae={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Be=["Webkit","ms","Moz","O"];Object.keys(Ae).forEach(function(l){Be.forEach(function(h){h=h+l.charAt(0).toUpperCase()+l.substring(1),Ae[h]=Ae[l]})});function Le(l,h,b){return h==null||typeof h=="boolean"||h===""?"":b||typeof h!="number"||h===0||Ae.hasOwnProperty(l)&&Ae[l]?(""+h).trim():h+"px"}function Ve(l,h){l=l.style;for(var b in h)if(h.hasOwnProperty(b)){var T=b.indexOf("--")===0,L=Le(b,h[b],T);b==="float"&&(b="cssFloat"),T?l.setProperty(b,L):l[b]=L}}var vt=re({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ft(l,h){if(h){if(vt[l]&&(h.children!=null||h.dangerouslySetInnerHTML!=null))throw Error(e(137,l));if(h.dangerouslySetInnerHTML!=null){if(h.children!=null)throw Error(e(60));if(typeof h.dangerouslySetInnerHTML!="object"||!("__html"in h.dangerouslySetInnerHTML))throw Error(e(61))}if(h.style!=null&&typeof h.style!="object")throw Error(e(62))}}function gt(l,h){if(l.indexOf("-")===-1)return typeof h.is=="string";switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Rt=null;function Ui(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var ps=null,kt=null,Gn=null;function js(l){if(l=po(l)){if(typeof ps!="function")throw Error(e(280));var h=l.stateNode;h&&(h=Ko(h),ps(l.stateNode,l.type,h))}}function Vs(l){kt?Gn?Gn.push(l):Gn=[l]:kt=l}function Yn(){if(kt){var l=kt,h=Gn;if(Gn=kt=null,js(l),h)for(l=0;l<h.length;l++)js(h[l])}}function gs(l,h){return l(h)}function wn(){}var Mr=!1;function Fi(l,h,b){if(Mr)return l(h,b);Mr=!0;try{return gs(l,h,b)}finally{Mr=!1,(kt!==null||Gn!==null)&&(wn(),Yn())}}function On(l,h){var b=l.stateNode;if(b===null)return null;var T=Ko(b);if(T===null)return null;b=T[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(T=!T.disabled)||(l=l.type,T=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!T;break e;default:l=!1}if(l)return null;if(b&&typeof b!="function")throw Error(e(231,h,typeof b));return b}var zs=!1;if(p)try{var tr={};Object.defineProperty(tr,"passive",{get:function(){zs=!0}}),window.addEventListener("test",tr,tr),window.removeEventListener("test",tr,tr)}catch{zs=!1}function Ws(l,h,b,T,L,q,ue,ve,_e){var $e=Array.prototype.slice.call(arguments,3);try{h.apply(b,$e)}catch(Qe){this.onError(Qe)}}var mn=!1,fr=null,Nn=!1,rt=null,ti={onError:function(l){mn=!0,fr=l}};function qs(l,h,b,T,L,q,ue,ve,_e){mn=!1,fr=null,Ws.apply(ti,arguments)}function Ln(l,h,b,T,L,q,ue,ve,_e){if(qs.apply(this,arguments),mn){if(mn){var $e=fr;mn=!1,fr=null}else throw Error(e(198));Nn||(Nn=!0,rt=$e)}}function Qn(l){var h=l,b=l;if(l.alternate)for(;h.return;)h=h.return;else{l=h;do h=l,(h.flags&4098)!==0&&(b=h.return),l=h.return;while(l)}return h.tag===3?b:null}function Hi(l){if(l.tag===13){var h=l.memoizedState;if(h===null&&(l=l.alternate,l!==null&&(h=l.memoizedState)),h!==null)return h.dehydrated}return null}function $i(l){if(Qn(l)!==l)throw Error(e(188))}function dr(l){var h=l.alternate;if(!h){if(h=Qn(l),h===null)throw Error(e(188));return h!==l?null:l}for(var b=l,T=h;;){var L=b.return;if(L===null)break;var q=L.alternate;if(q===null){if(T=L.return,T!==null){b=T;continue}break}if(L.child===q.child){for(q=L.child;q;){if(q===b)return $i(L),l;if(q===T)return $i(L),h;q=q.sibling}throw Error(e(188))}if(b.return!==T.return)b=L,T=q;else{for(var ue=!1,ve=L.child;ve;){if(ve===b){ue=!0,b=L,T=q;break}if(ve===T){ue=!0,T=L,b=q;break}ve=ve.sibling}if(!ue){for(ve=q.child;ve;){if(ve===b){ue=!0,b=q,T=L;break}if(ve===T){ue=!0,T=q,b=L;break}ve=ve.sibling}if(!ue)throw Error(e(189))}}if(b.alternate!==T)throw Error(e(190))}if(b.tag!==3)throw Error(e(188));return b.stateNode.current===b?l:h}function Ro(l){return l=dr(l),l!==null?No(l):null}function No(l){if(l.tag===5||l.tag===6)return l;for(l=l.child;l!==null;){var h=No(l);if(h!==null)return h;l=l.sibling}return null}var nr=t.unstable_scheduleCallback,Cn=t.unstable_cancelCallback,Kt=t.unstable_shouldYield,ko=t.unstable_requestPaint,zt=t.unstable_now,Gs=t.unstable_getCurrentPriorityLevel,ze=t.unstable_ImmediatePriority,Mo=t.unstable_UserBlockingPriority,Yt=t.unstable_NormalPriority,ni=t.unstable_LowPriority,Bo=t.unstable_IdlePriority,Ot=null,It=null;function Mt(l){if(It&&typeof It.onCommitFiberRoot=="function")try{It.onCommitFiberRoot(Ot,l,void 0,(l.current.flags&128)===128)}catch{}}var zn=Math.clz32?Math.clz32:dn,Ys=Math.log,Qs=Math.LN2;function dn(l){return l>>>=0,l===0?32:31-(Ys(l)/Qs|0)|0}var rr=64,ys=4194304;function Qt(l){switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return l&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return l}}function ir(l,h){var b=l.pendingLanes;if(b===0)return 0;var T=0,L=l.suspendedLanes,q=l.pingedLanes,ue=b&268435455;if(ue!==0){var ve=ue&~L;ve!==0?T=Qt(ve):(q&=ue,q!==0&&(T=Qt(q)))}else ue=b&~L,ue!==0?T=Qt(ue):q!==0&&(T=Qt(q));if(T===0)return 0;if(h!==0&&h!==T&&(h&L)===0&&(L=T&-T,q=h&-h,L>=q||L===16&&(q&4194240)!==0))return h;if((T&4)!==0&&(T|=b&16),h=l.entangledLanes,h!==0)for(l=l.entanglements,h&=T;0<h;)b=31-zn(h),L=1<<b,T|=l[b],h&=~L;return T}function La(l,h){switch(l){case 1:case 2:case 4:return h+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ri(l,h){for(var b=l.suspendedLanes,T=l.pingedLanes,L=l.expirationTimes,q=l.pendingLanes;0<q;){var ue=31-zn(q),ve=1<<ue,_e=L[ue];_e===-1?((ve&b)===0||(ve&T)!==0)&&(L[ue]=La(ve,h)):_e<=h&&(l.expiredLanes|=ve),q&=~ve}}function Wt(l){return l=l.pendingLanes&-1073741825,l!==0?l:l&1073741824?1073741824:0}function xn(){var l=rr;return rr<<=1,(rr&4194240)===0&&(rr=64),l}function Ne(l){for(var h=[],b=0;31>b;b++)h.push(l);return h}function we(l,h,b){l.pendingLanes|=h,h!==536870912&&(l.suspendedLanes=0,l.pingedLanes=0),l=l.eventTimes,h=31-zn(h),l[h]=b}function ht(l,h){var b=l.pendingLanes&~h;l.pendingLanes=h,l.suspendedLanes=0,l.pingedLanes=0,l.expiredLanes&=h,l.mutableReadLanes&=h,l.entangledLanes&=h,h=l.entanglements;var T=l.eventTimes;for(l=l.expirationTimes;0<b;){var L=31-zn(b),q=1<<L;h[L]=0,T[L]=-1,l[L]=-1,b&=~q}}function ln(l,h){var b=l.entangledLanes|=h;for(l=l.entanglements;b;){var T=31-zn(b),L=1<<T;L&h|l[T]&h&&(l[T]|=h),b&=~L}}var Tt=0;function Po(l){return l&=-l,1<l?4<l?(l&268435455)!==0?16:536870912:4:1}var ws,Un,pt,Xt,Ks,Xs=!1,ii=[],sr=null,hr=null,Br=null,nn=new Map,br=new Map,kn=[],xt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Do(l,h){switch(l){case"focusin":case"focusout":sr=null;break;case"dragenter":case"dragleave":hr=null;break;case"mouseover":case"mouseout":Br=null;break;case"pointerover":case"pointerout":nn.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":br.delete(h.pointerId)}}function At(l,h,b,T,L,q){return l===null||l.nativeEvent!==q?(l={blockedOn:h,domEventName:b,eventSystemFlags:T,nativeEvent:q,targetContainers:[L]},h!==null&&(h=po(h),h!==null&&Un(h)),l):(l.eventSystemFlags|=T,h=l.targetContainers,L!==null&&h.indexOf(L)===-1&&h.push(L),l)}function En(l,h,b,T,L){switch(h){case"focusin":return sr=At(sr,l,h,b,T,L),!0;case"dragenter":return hr=At(hr,l,h,b,T,L),!0;case"mouseover":return Br=At(Br,l,h,b,T,L),!0;case"pointerover":var q=L.pointerId;return nn.set(q,At(nn.get(q)||null,l,h,b,T,L)),!0;case"gotpointercapture":return q=L.pointerId,br.set(q,At(br.get(q)||null,l,h,b,T,L)),!0}return!1}function Oo(l){var h=Xi(l.target);if(h!==null){var b=Qn(h);if(b!==null){if(h=b.tag,h===13){if(h=Hi(b),h!==null){l.blockedOn=h,Ks(l.priority,function(){pt(b)});return}}else if(h===3&&b.stateNode.current.memoizedState.isDehydrated){l.blockedOn=b.tag===3?b.stateNode.containerInfo:null;return}}}l.blockedOn=null}function si(l){if(l.blockedOn!==null)return!1;for(var h=l.targetContainers;0<h.length;){var b=xs(l.domEventName,l.eventSystemFlags,h[0],l.nativeEvent);if(b===null){b=l.nativeEvent;var T=new b.constructor(b.type,b);Rt=T,b.target.dispatchEvent(T),Rt=null}else return h=po(b),h!==null&&Un(h),l.blockedOn=b,!1;h.shift()}return!0}function Zs(l,h,b){si(l)&&b.delete(h)}function Hr(){Xs=!1,sr!==null&&si(sr)&&(sr=null),hr!==null&&si(hr)&&(hr=null),Br!==null&&si(Br)&&(Br=null),nn.forEach(Zs),br.forEach(Zs)}function ji(l,h){l.blockedOn===h&&(l.blockedOn=null,Xs||(Xs=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Hr)))}function Sr(l){function h(L){return ji(L,l)}if(0<ii.length){ji(ii[0],l);for(var b=1;b<ii.length;b++){var T=ii[b];T.blockedOn===l&&(T.blockedOn=null)}}for(sr!==null&&ji(sr,l),hr!==null&&ji(hr,l),Br!==null&&ji(Br,l),nn.forEach(h),br.forEach(h),b=0;b<kn.length;b++)T=kn[b],T.blockedOn===l&&(T.blockedOn=null);for(;0<kn.length&&(b=kn[0],b.blockedOn===null);)Oo(b),b.blockedOn===null&&kn.shift()}var pr=W.ReactCurrentBatchConfig,Pr=!0;function Lo(l,h,b,T){var L=Tt,q=pr.transition;pr.transition=null;try{Tt=1,$r(l,h,b,T)}finally{Tt=L,pr.transition=q}}function Vi(l,h,b,T){var L=Tt,q=pr.transition;pr.transition=null;try{Tt=4,$r(l,h,b,T)}finally{Tt=L,pr.transition=q}}function $r(l,h,b,T){if(Pr){var L=xs(l,h,b,T);if(L===null)Ga(l,h,T,vn,b),Do(l,T);else if(En(L,l,h,b,T))T.stopPropagation();else if(Do(l,T),h&4&&-1<xt.indexOf(l)){for(;L!==null;){var q=po(L);if(q!==null&&ws(q),q=xs(l,h,b,T),q===null&&Ga(l,h,T,vn,b),q===L)break;L=q}L!==null&&T.stopPropagation()}else Ga(l,h,T,null,b)}}var vn=null;function xs(l,h,b,T){if(vn=null,l=Ui(T),l=Xi(l),l!==null)if(h=Qn(l),h===null)l=null;else if(b=h.tag,b===13){if(l=Hi(h),l!==null)return l;l=null}else if(b===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;l=null}else h!==l&&(l=null);return vn=l,null}function Js(l){switch(l){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Gs()){case ze:return 1;case Mo:return 4;case Yt:case ni:return 16;case Bo:return 536870912;default:return 16}default:return 16}}var Ar=null,eo=null,Es=null;function Uo(){if(Es)return Es;var l,h=eo,b=h.length,T,L="value"in Ar?Ar.value:Ar.textContent,q=L.length;for(l=0;l<b&&h[l]===L[l];l++);var ue=b-l;for(T=1;T<=ue&&h[b-T]===L[q-T];T++);return Es=L.slice(l,1<T?1-T:void 0)}function Ut(l){var h=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&h===13&&(l=13)):l=h,l===10&&(l=13),32<=l||l===13?l:0}function zi(){return!0}function Wi(){return!1}function cn(l){function h(b,T,L,q,ue){this._reactName=b,this._targetInst=L,this.type=T,this.nativeEvent=q,this.target=ue,this.currentTarget=null;for(var ve in l)l.hasOwnProperty(ve)&&(b=l[ve],this[ve]=b?b(q):q[ve]);return this.isDefaultPrevented=(q.defaultPrevented!=null?q.defaultPrevented:q.returnValue===!1)?zi:Wi,this.isPropagationStopped=Wi,this}return re(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var b=this.nativeEvent;b&&(b.preventDefault?b.preventDefault():typeof b.returnValue!="unknown"&&(b.returnValue=!1),this.isDefaultPrevented=zi)},stopPropagation:function(){var b=this.nativeEvent;b&&(b.stopPropagation?b.stopPropagation():typeof b.cancelBubble!="unknown"&&(b.cancelBubble=!0),this.isPropagationStopped=zi)},persist:function(){},isPersistent:zi}),h}var oi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},He=cn(oi),_t=re({},oi,{view:0,detail:0}),bn=cn(_t),ai,vs,qi,bs=re({},_t,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Gi,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==qi&&(qi&&l.type==="mousemove"?(ai=l.screenX-qi.screenX,vs=l.screenY-qi.screenY):vs=ai=0,qi=l),ai)},movementY:function(l){return"movementY"in l?l.movementY:vs}}),Fo=cn(bs),to=re({},bs,{dataTransfer:0}),hn=cn(to),no=re({},_t,{relatedTarget:0}),Zt=cn(no),Ss=re({},oi,{animationName:0,elapsedTime:0,pseudoElement:0}),jr=cn(Ss),qt=re({},oi,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),mt=cn(qt),Ua=re({},oi,{data:0}),Gt=cn(Ua),Vr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},li={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Fa={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gr(l){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(l):(l=Fa[l])?!!h[l]:!1}function Gi(){return gr}var Ho=re({},_t,{key:function(l){if(l.key){var h=Vr[l.key]||l.key;if(h!=="Unidentified")return h}return l.type==="keypress"?(l=Ut(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?li[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Gi,charCode:function(l){return l.type==="keypress"?Ut(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?Ut(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),ro=cn(Ho),$o=re({},bs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),io=cn($o),Ha=re({},_t,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Gi}),ci=cn(Ha),so=re({},oi,{propertyName:0,elapsedTime:0,pseudoElement:0}),$a=cn(so),Yi=re({},bs,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),ja=cn(Yi),Dr=[9,13,27,32],ui=p&&"CompositionEvent"in window,_n=null;p&&"documentMode"in document&&(_n=document.documentMode);var jo=p&&"TextEvent"in window&&!_n,or=p&&(!ui||_n&&8<_n&&11>=_n),Vo=" ",As=!1;function zo(l,h){switch(l){case"keyup":return Dr.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function oo(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var Mn=!1;function Va(l,h){switch(l){case"compositionend":return oo(h);case"keypress":return h.which!==32?null:(As=!0,Vo);case"textInput":return l=h.data,l===Vo&&As?null:l;default:return null}}function ao(l,h){if(Mn)return l==="compositionend"||!ui&&zo(l,h)?(l=Uo(),Es=eo=Ar=null,Mn=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return or&&h.locale!=="ko"?null:h.data;default:return null}}var Qi={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Pt(l){var h=l&&l.nodeName&&l.nodeName.toLowerCase();return h==="input"?!!Qi[l.type]:h==="textarea"}function Ki(l,h,b,T){Vs(T),h=Go(h,"onChange"),0<h.length&&(b=new He("onChange","change",null,b,T),l.push({event:b,listeners:h}))}var oe=null,r=null;function c(l){dc(l,0)}function u(l){var h=Is(l);if(je(h))return l}function m(l,h){if(l==="change")return h}var w=!1;if(p){var v;if(p){var C="oninput"in document;if(!C){var k=document.createElement("div");k.setAttribute("oninput","return;"),C=typeof k.oninput=="function"}v=C}else v=!1;w=v&&(!document.documentMode||9<document.documentMode)}function O(){oe&&(oe.detachEvent("onpropertychange",Z),r=oe=null)}function Z(l){if(l.propertyName==="value"&&u(r)){var h=[];Ki(h,r,l,Ui(l)),Fi(c,h)}}function le(l,h,b){l==="focusin"?(O(),oe=h,r=b,oe.attachEvent("onpropertychange",Z)):l==="focusout"&&O()}function he(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return u(r)}function Ee(l,h){if(l==="click")return u(h)}function Ce(l,h){if(l==="input"||l==="change")return u(h)}function Ie(l,h){return l===h&&(l!==0||1/l===1/h)||l!==l&&h!==h}var Re=typeof Object.is=="function"?Object.is:Ie;function Fe(l,h){if(Re(l,h))return!0;if(typeof l!="object"||l===null||typeof h!="object"||h===null)return!1;var b=Object.keys(l),T=Object.keys(h);if(b.length!==T.length)return!1;for(T=0;T<b.length;T++){var L=b[T];if(!y.call(h,L)||!Re(l[L],h[L]))return!1}return!0}function Xe(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function Je(l,h){var b=Xe(l);l=0;for(var T;b;){if(b.nodeType===3){if(T=l+b.textContent.length,l<=h&&T>=h)return{node:b,offset:h-l};l=T}e:{for(;b;){if(b.nextSibling){b=b.nextSibling;break e}b=b.parentNode}b=void 0}b=Xe(b)}}function Ye(l,h){return l&&h?l===h?!0:l&&l.nodeType===3?!1:h&&h.nodeType===3?Ye(l,h.parentNode):"contains"in l?l.contains(h):l.compareDocumentPosition?!!(l.compareDocumentPosition(h)&16):!1:!1}function Nt(){for(var l=window,h=Pe();h instanceof l.HTMLIFrameElement;){try{var b=typeof h.contentWindow.location.href=="string"}catch{b=!1}if(b)l=h.contentWindow;else break;h=Pe(l.document)}return h}function Ct(l){var h=l&&l.nodeName&&l.nodeName.toLowerCase();return h&&(h==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||h==="textarea"||l.contentEditable==="true")}function Fn(l){var h=Nt(),b=l.focusedElem,T=l.selectionRange;if(h!==b&&b&&b.ownerDocument&&Ye(b.ownerDocument.documentElement,b)){if(T!==null&&Ct(b)){if(h=T.start,l=T.end,l===void 0&&(l=h),"selectionStart"in b)b.selectionStart=h,b.selectionEnd=Math.min(l,b.value.length);else if(l=(h=b.ownerDocument||document)&&h.defaultView||window,l.getSelection){l=l.getSelection();var L=b.textContent.length,q=Math.min(T.start,L);T=T.end===void 0?q:Math.min(T.end,L),!l.extend&&q>T&&(L=T,T=q,q=L),L=Je(b,q);var ue=Je(b,T);L&&ue&&(l.rangeCount!==1||l.anchorNode!==L.node||l.anchorOffset!==L.offset||l.focusNode!==ue.node||l.focusOffset!==ue.offset)&&(h=h.createRange(),h.setStart(L.node,L.offset),l.removeAllRanges(),q>T?(l.addRange(h),l.extend(ue.node,ue.offset)):(h.setEnd(ue.node,ue.offset),l.addRange(h)))}}for(h=[],l=b;l=l.parentNode;)l.nodeType===1&&h.push({element:l,left:l.scrollLeft,top:l.scrollTop});for(typeof b.focus=="function"&&b.focus(),b=0;b<h.length;b++)l=h[b],l.element.scrollLeft=l.left,l.element.scrollTop=l.top}}var ar=p&&"documentMode"in document&&11>=document.documentMode,pn=null,jt=null,sn=null,Bn=!1;function zr(l,h,b){var T=b.window===b?b.document:b.nodeType===9?b:b.ownerDocument;Bn||pn==null||pn!==Pe(T)||(T=pn,"selectionStart"in T&&Ct(T)?T={start:T.selectionStart,end:T.selectionEnd}:(T=(T.ownerDocument&&T.ownerDocument.defaultView||window).getSelection(),T={anchorNode:T.anchorNode,anchorOffset:T.anchorOffset,focusNode:T.focusNode,focusOffset:T.focusOffset}),sn&&Fe(sn,T)||(sn=T,T=Go(jt,"onSelect"),0<T.length&&(h=new He("onSelect","select",null,h,b),l.push({event:h,listeners:T}),h.target=pn)))}function Cr(l,h){var b={};return b[l.toLowerCase()]=h.toLowerCase(),b["Webkit"+l]="webkit"+h,b["Moz"+l]="moz"+h,b}var fi={animationend:Cr("Animation","AnimationEnd"),animationiteration:Cr("Animation","AnimationIteration"),animationstart:Cr("Animation","AnimationStart"),transitionend:Cr("Transition","TransitionEnd")},lo={},ic={};p&&(ic=document.createElement("div").style,"AnimationEvent"in window||(delete fi.animationend.animation,delete fi.animationiteration.animation,delete fi.animationstart.animation),"TransitionEvent"in window||delete fi.transitionend.transition);function Wo(l){if(lo[l])return lo[l];if(!fi[l])return l;var h=fi[l],b;for(b in h)if(h.hasOwnProperty(b)&&b in ic)return lo[l]=h[b];return l}var sc=Wo("animationend"),oc=Wo("animationiteration"),ac=Wo("animationstart"),lc=Wo("transitionend"),cc=new Map,uc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function di(l,h){cc.set(l,h),o(h,[l])}for(var za=0;za<uc.length;za++){var Wa=uc[za],nf=Wa.toLowerCase(),rf=Wa[0].toUpperCase()+Wa.slice(1);di(nf,"on"+rf)}di(sc,"onAnimationEnd"),di(oc,"onAnimationIteration"),di(ac,"onAnimationStart"),di("dblclick","onDoubleClick"),di("focusin","onFocus"),di("focusout","onBlur"),di(lc,"onTransitionEnd"),f("onMouseEnter",["mouseout","mouseover"]),f("onMouseLeave",["mouseout","mouseover"]),f("onPointerEnter",["pointerout","pointerover"]),f("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var co="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),sf=new Set("cancel close invalid load scroll toggle".split(" ").concat(co));function fc(l,h,b){var T=l.type||"unknown-event";l.currentTarget=b,Ln(T,h,void 0,l),l.currentTarget=null}function dc(l,h){h=(h&4)!==0;for(var b=0;b<l.length;b++){var T=l[b],L=T.event;T=T.listeners;e:{var q=void 0;if(h)for(var ue=T.length-1;0<=ue;ue--){var ve=T[ue],_e=ve.instance,$e=ve.currentTarget;if(ve=ve.listener,_e!==q&&L.isPropagationStopped())break e;fc(L,ve,$e),q=_e}else for(ue=0;ue<T.length;ue++){if(ve=T[ue],_e=ve.instance,$e=ve.currentTarget,ve=ve.listener,_e!==q&&L.isPropagationStopped())break e;fc(L,ve,$e),q=_e}}}if(Nn)throw l=rt,Nn=!1,rt=null,l}function en(l,h){var b=h[Ja];b===void 0&&(b=h[Ja]=new Set);var T=l+"__bubble";b.has(T)||(hc(h,l,2,!1),b.add(T))}function qa(l,h,b){var T=0;h&&(T|=4),hc(b,l,T,h)}var qo="_reactListening"+Math.random().toString(36).slice(2);function uo(l){if(!l[qo]){l[qo]=!0,s.forEach(function(b){b!=="selectionchange"&&(sf.has(b)||qa(b,!1,l),qa(b,!0,l))});var h=l.nodeType===9?l:l.ownerDocument;h===null||h[qo]||(h[qo]=!0,qa("selectionchange",!1,h))}}function hc(l,h,b,T){switch(Js(h)){case 1:var L=Lo;break;case 4:L=Vi;break;default:L=$r}b=L.bind(null,h,b,l),L=void 0,!zs||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(L=!0),T?L!==void 0?l.addEventListener(h,b,{capture:!0,passive:L}):l.addEventListener(h,b,!0):L!==void 0?l.addEventListener(h,b,{passive:L}):l.addEventListener(h,b,!1)}function Ga(l,h,b,T,L){var q=T;if((h&1)===0&&(h&2)===0&&T!==null)e:for(;;){if(T===null)return;var ue=T.tag;if(ue===3||ue===4){var ve=T.stateNode.containerInfo;if(ve===L||ve.nodeType===8&&ve.parentNode===L)break;if(ue===4)for(ue=T.return;ue!==null;){var _e=ue.tag;if((_e===3||_e===4)&&(_e=ue.stateNode.containerInfo,_e===L||_e.nodeType===8&&_e.parentNode===L))return;ue=ue.return}for(;ve!==null;){if(ue=Xi(ve),ue===null)return;if(_e=ue.tag,_e===5||_e===6){T=q=ue;continue e}ve=ve.parentNode}}T=T.return}Fi(function(){var $e=q,Qe=Ui(b),Ke=[];e:{var Ge=cc.get(l);if(Ge!==void 0){var it=He,lt=l;switch(l){case"keypress":if(Ut(b)===0)break e;case"keydown":case"keyup":it=ro;break;case"focusin":lt="focus",it=Zt;break;case"focusout":lt="blur",it=Zt;break;case"beforeblur":case"afterblur":it=Zt;break;case"click":if(b.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":it=Fo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":it=hn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":it=ci;break;case sc:case oc:case ac:it=jr;break;case lc:it=$a;break;case"scroll":it=bn;break;case"wheel":it=ja;break;case"copy":case"cut":case"paste":it=mt;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":it=io}var ct=(h&4)!==0,gn=!ct&&l==="scroll",ke=ct?Ge!==null?Ge+"Capture":null:Ge;ct=[];for(var Te=$e,De;Te!==null;){De=Te;var et=De.stateNode;if(De.tag===5&&et!==null&&(De=et,ke!==null&&(et=On(Te,ke),et!=null&&ct.push(fo(Te,et,De)))),gn)break;Te=Te.return}0<ct.length&&(Ge=new it(Ge,lt,null,b,Qe),Ke.push({event:Ge,listeners:ct}))}}if((h&7)===0){e:{if(Ge=l==="mouseover"||l==="pointerover",it=l==="mouseout"||l==="pointerout",Ge&&b!==Rt&&(lt=b.relatedTarget||b.fromElement)&&(Xi(lt)||lt[Wr]))break e;if((it||Ge)&&(Ge=Qe.window===Qe?Qe:(Ge=Qe.ownerDocument)?Ge.defaultView||Ge.parentWindow:window,it?(lt=b.relatedTarget||b.toElement,it=$e,lt=lt?Xi(lt):null,lt!==null&&(gn=Qn(lt),lt!==gn||lt.tag!==5&&lt.tag!==6)&&(lt=null)):(it=null,lt=$e),it!==lt)){if(ct=Fo,et="onMouseLeave",ke="onMouseEnter",Te="mouse",(l==="pointerout"||l==="pointerover")&&(ct=io,et="onPointerLeave",ke="onPointerEnter",Te="pointer"),gn=it==null?Ge:Is(it),De=lt==null?Ge:Is(lt),Ge=new ct(et,Te+"leave",it,b,Qe),Ge.target=gn,Ge.relatedTarget=De,et=null,Xi(Qe)===$e&&(ct=new ct(ke,Te+"enter",lt,b,Qe),ct.target=De,ct.relatedTarget=gn,et=ct),gn=et,it&&lt)t:{for(ct=it,ke=lt,Te=0,De=ct;De;De=Cs(De))Te++;for(De=0,et=ke;et;et=Cs(et))De++;for(;0<Te-De;)ct=Cs(ct),Te--;for(;0<De-Te;)ke=Cs(ke),De--;for(;Te--;){if(ct===ke||ke!==null&&ct===ke.alternate)break t;ct=Cs(ct),ke=Cs(ke)}ct=null}else ct=null;it!==null&&pc(Ke,Ge,it,ct,!1),lt!==null&&gn!==null&&pc(Ke,gn,lt,ct,!0)}}e:{if(Ge=$e?Is($e):window,it=Ge.nodeName&&Ge.nodeName.toLowerCase(),it==="select"||it==="input"&&Ge.type==="file")var dt=m;else if(Pt(Ge))if(w)dt=Ce;else{dt=he;var yt=le}else(it=Ge.nodeName)&&it.toLowerCase()==="input"&&(Ge.type==="checkbox"||Ge.type==="radio")&&(dt=Ee);if(dt&&(dt=dt(l,$e))){Ki(Ke,dt,b,Qe);break e}yt&&yt(l,Ge,$e),l==="focusout"&&(yt=Ge._wrapperState)&&yt.controlled&&Ge.type==="number"&&tt(Ge,"number",Ge.value)}switch(yt=$e?Is($e):window,l){case"focusin":(Pt(yt)||yt.contentEditable==="true")&&(pn=yt,jt=$e,sn=null);break;case"focusout":sn=jt=pn=null;break;case"mousedown":Bn=!0;break;case"contextmenu":case"mouseup":case"dragend":Bn=!1,zr(Ke,b,Qe);break;case"selectionchange":if(ar)break;case"keydown":case"keyup":zr(Ke,b,Qe)}var wt;if(ui)e:{switch(l){case"compositionstart":var St="onCompositionStart";break e;case"compositionend":St="onCompositionEnd";break e;case"compositionupdate":St="onCompositionUpdate";break e}St=void 0}else Mn?zo(l,b)&&(St="onCompositionEnd"):l==="keydown"&&b.keyCode===229&&(St="onCompositionStart");St&&(or&&b.locale!=="ko"&&(Mn||St!=="onCompositionStart"?St==="onCompositionEnd"&&Mn&&(wt=Uo()):(Ar=Qe,eo="value"in Ar?Ar.value:Ar.textContent,Mn=!0)),yt=Go($e,St),0<yt.length&&(St=new Gt(St,l,null,b,Qe),Ke.push({event:St,listeners:yt}),wt?St.data=wt:(wt=oo(b),wt!==null&&(St.data=wt)))),(wt=jo?Va(l,b):ao(l,b))&&($e=Go($e,"onBeforeInput"),0<$e.length&&(Qe=new Gt("onBeforeInput","beforeinput",null,b,Qe),Ke.push({event:Qe,listeners:$e}),Qe.data=wt))}dc(Ke,h)})}function fo(l,h,b){return{instance:l,listener:h,currentTarget:b}}function Go(l,h){for(var b=h+"Capture",T=[];l!==null;){var L=l,q=L.stateNode;L.tag===5&&q!==null&&(L=q,q=On(l,b),q!=null&&T.unshift(fo(l,q,L)),q=On(l,h),q!=null&&T.push(fo(l,q,L))),l=l.return}return T}function Cs(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5);return l||null}function pc(l,h,b,T,L){for(var q=h._reactName,ue=[];b!==null&&b!==T;){var ve=b,_e=ve.alternate,$e=ve.stateNode;if(_e!==null&&_e===T)break;ve.tag===5&&$e!==null&&(ve=$e,L?(_e=On(b,q),_e!=null&&ue.unshift(fo(b,_e,ve))):L||(_e=On(b,q),_e!=null&&ue.push(fo(b,_e,ve)))),b=b.return}ue.length!==0&&l.push({event:h,listeners:ue})}var of=/\r\n?/g,af=/\u0000|\uFFFD/g;function gc(l){return(typeof l=="string"?l:""+l).replace(of,`
`).replace(af,"")}function Yo(l,h,b){if(h=gc(h),gc(l)!==h&&b)throw Error(e(425))}function Qo(){}var Ya=null,Qa=null;function Ka(l,h){return l==="textarea"||l==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var Xa=typeof setTimeout=="function"?setTimeout:void 0,lf=typeof clearTimeout=="function"?clearTimeout:void 0,mc=typeof Promise=="function"?Promise:void 0,cf=typeof queueMicrotask=="function"?queueMicrotask:typeof mc<"u"?function(l){return mc.resolve(null).then(l).catch(uf)}:Xa;function uf(l){setTimeout(function(){throw l})}function Za(l,h){var b=h,T=0;do{var L=b.nextSibling;if(l.removeChild(b),L&&L.nodeType===8)if(b=L.data,b==="/$"){if(T===0){l.removeChild(L),Sr(h);return}T--}else b!=="$"&&b!=="$?"&&b!=="$!"||T++;b=L}while(b);Sr(h)}function hi(l){for(;l!=null;l=l.nextSibling){var h=l.nodeType;if(h===1||h===3)break;if(h===8){if(h=l.data,h==="$"||h==="$!"||h==="$?")break;if(h==="/$")return null}}return l}function yc(l){l=l.previousSibling;for(var h=0;l;){if(l.nodeType===8){var b=l.data;if(b==="$"||b==="$!"||b==="$?"){if(h===0)return l;h--}else b==="/$"&&h++}l=l.previousSibling}return null}var _s=Math.random().toString(36).slice(2),Or="__reactFiber$"+_s,ho="__reactProps$"+_s,Wr="__reactContainer$"+_s,Ja="__reactEvents$"+_s,ff="__reactListeners$"+_s,df="__reactHandles$"+_s;function Xi(l){var h=l[Or];if(h)return h;for(var b=l.parentNode;b;){if(h=b[Wr]||b[Or]){if(b=h.alternate,h.child!==null||b!==null&&b.child!==null)for(l=yc(l);l!==null;){if(b=l[Or])return b;l=yc(l)}return h}l=b,b=l.parentNode}return null}function po(l){return l=l[Or]||l[Wr],!l||l.tag!==5&&l.tag!==6&&l.tag!==13&&l.tag!==3?null:l}function Is(l){if(l.tag===5||l.tag===6)return l.stateNode;throw Error(e(33))}function Ko(l){return l[ho]||null}var el=[],Ts=-1;function pi(l){return{current:l}}function tn(l){0>Ts||(l.current=el[Ts],el[Ts]=null,Ts--)}function Jt(l,h){Ts++,el[Ts]=l.current,l.current=h}var gi={},Hn=pi(gi),Kn=pi(!1),Zi=gi;function Rs(l,h){var b=l.type.contextTypes;if(!b)return gi;var T=l.stateNode;if(T&&T.__reactInternalMemoizedUnmaskedChildContext===h)return T.__reactInternalMemoizedMaskedChildContext;var L={},q;for(q in b)L[q]=h[q];return T&&(l=l.stateNode,l.__reactInternalMemoizedUnmaskedChildContext=h,l.__reactInternalMemoizedMaskedChildContext=L),L}function Xn(l){return l=l.childContextTypes,l!=null}function Xo(){tn(Kn),tn(Hn)}function wc(l,h,b){if(Hn.current!==gi)throw Error(e(168));Jt(Hn,h),Jt(Kn,b)}function xc(l,h,b){var T=l.stateNode;if(h=h.childContextTypes,typeof T.getChildContext!="function")return b;T=T.getChildContext();for(var L in T)if(!(L in h))throw Error(e(108,Se(l)||"Unknown",L));return re({},b,T)}function Zo(l){return l=(l=l.stateNode)&&l.__reactInternalMemoizedMergedChildContext||gi,Zi=Hn.current,Jt(Hn,l),Jt(Kn,Kn.current),!0}function Ec(l,h,b){var T=l.stateNode;if(!T)throw Error(e(169));b?(l=xc(l,h,Zi),T.__reactInternalMemoizedMergedChildContext=l,tn(Kn),tn(Hn),Jt(Hn,l)):tn(Kn),Jt(Kn,b)}var qr=null,Jo=!1,tl=!1;function vc(l){qr===null?qr=[l]:qr.push(l)}function hf(l){Jo=!0,vc(l)}function mi(){if(!tl&&qr!==null){tl=!0;var l=0,h=Tt;try{var b=qr;for(Tt=1;l<b.length;l++){var T=b[l];do T=T(!0);while(T!==null)}qr=null,Jo=!1}catch(L){throw qr!==null&&(qr=qr.slice(l+1)),nr(ze,mi),L}finally{Tt=h,tl=!1}}return null}var Ns=[],ks=0,ea=null,ta=0,mr=[],yr=0,Ji=null,Gr=1,Yr="";function es(l,h){Ns[ks++]=ta,Ns[ks++]=ea,ea=l,ta=h}function bc(l,h,b){mr[yr++]=Gr,mr[yr++]=Yr,mr[yr++]=Ji,Ji=l;var T=Gr;l=Yr;var L=32-zn(T)-1;T&=~(1<<L),b+=1;var q=32-zn(h)+L;if(30<q){var ue=L-L%5;q=(T&(1<<ue)-1).toString(32),T>>=ue,L-=ue,Gr=1<<32-zn(h)+L|b<<L|T,Yr=q+l}else Gr=1<<q|b<<L|T,Yr=l}function nl(l){l.return!==null&&(es(l,1),bc(l,1,0))}function rl(l){for(;l===ea;)ea=Ns[--ks],Ns[ks]=null,ta=Ns[--ks],Ns[ks]=null;for(;l===Ji;)Ji=mr[--yr],mr[yr]=null,Yr=mr[--yr],mr[yr]=null,Gr=mr[--yr],mr[yr]=null}var lr=null,cr=null,rn=!1,_r=null;function Sc(l,h){var b=vr(5,null,null,0);b.elementType="DELETED",b.stateNode=h,b.return=l,h=l.deletions,h===null?(l.deletions=[b],l.flags|=16):h.push(b)}function Ac(l,h){switch(l.tag){case 5:var b=l.type;return h=h.nodeType!==1||b.toLowerCase()!==h.nodeName.toLowerCase()?null:h,h!==null?(l.stateNode=h,lr=l,cr=hi(h.firstChild),!0):!1;case 6:return h=l.pendingProps===""||h.nodeType!==3?null:h,h!==null?(l.stateNode=h,lr=l,cr=null,!0):!1;case 13:return h=h.nodeType!==8?null:h,h!==null?(b=Ji!==null?{id:Gr,overflow:Yr}:null,l.memoizedState={dehydrated:h,treeContext:b,retryLane:1073741824},b=vr(18,null,null,0),b.stateNode=h,b.return=l,l.child=b,lr=l,cr=null,!0):!1;default:return!1}}function il(l){return(l.mode&1)!==0&&(l.flags&128)===0}function sl(l){if(rn){var h=cr;if(h){var b=h;if(!Ac(l,h)){if(il(l))throw Error(e(418));h=hi(b.nextSibling);var T=lr;h&&Ac(l,h)?Sc(T,b):(l.flags=l.flags&-4097|2,rn=!1,lr=l)}}else{if(il(l))throw Error(e(418));l.flags=l.flags&-4097|2,rn=!1,lr=l}}}function Cc(l){for(l=l.return;l!==null&&l.tag!==5&&l.tag!==3&&l.tag!==13;)l=l.return;lr=l}function na(l){if(l!==lr)return!1;if(!rn)return Cc(l),rn=!0,!1;var h;if((h=l.tag!==3)&&!(h=l.tag!==5)&&(h=l.type,h=h!=="head"&&h!=="body"&&!Ka(l.type,l.memoizedProps)),h&&(h=cr)){if(il(l))throw _c(),Error(e(418));for(;h;)Sc(l,h),h=hi(h.nextSibling)}if(Cc(l),l.tag===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(e(317));e:{for(l=l.nextSibling,h=0;l;){if(l.nodeType===8){var b=l.data;if(b==="/$"){if(h===0){cr=hi(l.nextSibling);break e}h--}else b!=="$"&&b!=="$!"&&b!=="$?"||h++}l=l.nextSibling}cr=null}}else cr=lr?hi(l.stateNode.nextSibling):null;return!0}function _c(){for(var l=cr;l;)l=hi(l.nextSibling)}function Ms(){cr=lr=null,rn=!1}function ol(l){_r===null?_r=[l]:_r.push(l)}var pf=W.ReactCurrentBatchConfig;function go(l,h,b){if(l=b.ref,l!==null&&typeof l!="function"&&typeof l!="object"){if(b._owner){if(b=b._owner,b){if(b.tag!==1)throw Error(e(309));var T=b.stateNode}if(!T)throw Error(e(147,l));var L=T,q=""+l;return h!==null&&h.ref!==null&&typeof h.ref=="function"&&h.ref._stringRef===q?h.ref:(h=function(ue){var ve=L.refs;ue===null?delete ve[q]:ve[q]=ue},h._stringRef=q,h)}if(typeof l!="string")throw Error(e(284));if(!b._owner)throw Error(e(290,l))}return l}function ra(l,h){throw l=Object.prototype.toString.call(h),Error(e(31,l==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":l))}function Ic(l){var h=l._init;return h(l._payload)}function Tc(l){function h(ke,Te){if(l){var De=ke.deletions;De===null?(ke.deletions=[Te],ke.flags|=16):De.push(Te)}}function b(ke,Te){if(!l)return null;for(;Te!==null;)h(ke,Te),Te=Te.sibling;return null}function T(ke,Te){for(ke=new Map;Te!==null;)Te.key!==null?ke.set(Te.key,Te):ke.set(Te.index,Te),Te=Te.sibling;return ke}function L(ke,Te){return ke=Ai(ke,Te),ke.index=0,ke.sibling=null,ke}function q(ke,Te,De){return ke.index=De,l?(De=ke.alternate,De!==null?(De=De.index,De<Te?(ke.flags|=2,Te):De):(ke.flags|=2,Te)):(ke.flags|=1048576,Te)}function ue(ke){return l&&ke.alternate===null&&(ke.flags|=2),ke}function ve(ke,Te,De,et){return Te===null||Te.tag!==6?(Te=Xl(De,ke.mode,et),Te.return=ke,Te):(Te=L(Te,De),Te.return=ke,Te)}function _e(ke,Te,De,et){var dt=De.type;return dt===P?Qe(ke,Te,De.props.children,et,De.key):Te!==null&&(Te.elementType===dt||typeof dt=="object"&&dt!==null&&dt.$$typeof===J&&Ic(dt)===Te.type)?(et=L(Te,De.props),et.ref=go(ke,Te,De),et.return=ke,et):(et=Ta(De.type,De.key,De.props,null,ke.mode,et),et.ref=go(ke,Te,De),et.return=ke,et)}function $e(ke,Te,De,et){return Te===null||Te.tag!==4||Te.stateNode.containerInfo!==De.containerInfo||Te.stateNode.implementation!==De.implementation?(Te=Zl(De,ke.mode,et),Te.return=ke,Te):(Te=L(Te,De.children||[]),Te.return=ke,Te)}function Qe(ke,Te,De,et,dt){return Te===null||Te.tag!==7?(Te=ls(De,ke.mode,et,dt),Te.return=ke,Te):(Te=L(Te,De),Te.return=ke,Te)}function Ke(ke,Te,De){if(typeof Te=="string"&&Te!==""||typeof Te=="number")return Te=Xl(""+Te,ke.mode,De),Te.return=ke,Te;if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case B:return De=Ta(Te.type,Te.key,Te.props,null,ke.mode,De),De.ref=go(ke,null,Te),De.return=ke,De;case U:return Te=Zl(Te,ke.mode,De),Te.return=ke,Te;case J:var et=Te._init;return Ke(ke,et(Te._payload),De)}if(bt(Te)||ne(Te))return Te=ls(Te,ke.mode,De,null),Te.return=ke,Te;ra(ke,Te)}return null}function Ge(ke,Te,De,et){var dt=Te!==null?Te.key:null;if(typeof De=="string"&&De!==""||typeof De=="number")return dt!==null?null:ve(ke,Te,""+De,et);if(typeof De=="object"&&De!==null){switch(De.$$typeof){case B:return De.key===dt?_e(ke,Te,De,et):null;case U:return De.key===dt?$e(ke,Te,De,et):null;case J:return dt=De._init,Ge(ke,Te,dt(De._payload),et)}if(bt(De)||ne(De))return dt!==null?null:Qe(ke,Te,De,et,null);ra(ke,De)}return null}function it(ke,Te,De,et,dt){if(typeof et=="string"&&et!==""||typeof et=="number")return ke=ke.get(De)||null,ve(Te,ke,""+et,dt);if(typeof et=="object"&&et!==null){switch(et.$$typeof){case B:return ke=ke.get(et.key===null?De:et.key)||null,_e(Te,ke,et,dt);case U:return ke=ke.get(et.key===null?De:et.key)||null,$e(Te,ke,et,dt);case J:var yt=et._init;return it(ke,Te,De,yt(et._payload),dt)}if(bt(et)||ne(et))return ke=ke.get(De)||null,Qe(Te,ke,et,dt,null);ra(Te,et)}return null}function lt(ke,Te,De,et){for(var dt=null,yt=null,wt=Te,St=Te=0,Rn=null;wt!==null&&St<De.length;St++){wt.index>St?(Rn=wt,wt=null):Rn=wt.sibling;var Ht=Ge(ke,wt,De[St],et);if(Ht===null){wt===null&&(wt=Rn);break}l&&wt&&Ht.alternate===null&&h(ke,wt),Te=q(Ht,Te,St),yt===null?dt=Ht:yt.sibling=Ht,yt=Ht,wt=Rn}if(St===De.length)return b(ke,wt),rn&&es(ke,St),dt;if(wt===null){for(;St<De.length;St++)wt=Ke(ke,De[St],et),wt!==null&&(Te=q(wt,Te,St),yt===null?dt=wt:yt.sibling=wt,yt=wt);return rn&&es(ke,St),dt}for(wt=T(ke,wt);St<De.length;St++)Rn=it(wt,ke,St,De[St],et),Rn!==null&&(l&&Rn.alternate!==null&&wt.delete(Rn.key===null?St:Rn.key),Te=q(Rn,Te,St),yt===null?dt=Rn:yt.sibling=Rn,yt=Rn);return l&&wt.forEach(function(Ci){return h(ke,Ci)}),rn&&es(ke,St),dt}function ct(ke,Te,De,et){var dt=ne(De);if(typeof dt!="function")throw Error(e(150));if(De=dt.call(De),De==null)throw Error(e(151));for(var yt=dt=null,wt=Te,St=Te=0,Rn=null,Ht=De.next();wt!==null&&!Ht.done;St++,Ht=De.next()){wt.index>St?(Rn=wt,wt=null):Rn=wt.sibling;var Ci=Ge(ke,wt,Ht.value,et);if(Ci===null){wt===null&&(wt=Rn);break}l&&wt&&Ci.alternate===null&&h(ke,wt),Te=q(Ci,Te,St),yt===null?dt=Ci:yt.sibling=Ci,yt=Ci,wt=Rn}if(Ht.done)return b(ke,wt),rn&&es(ke,St),dt;if(wt===null){for(;!Ht.done;St++,Ht=De.next())Ht=Ke(ke,Ht.value,et),Ht!==null&&(Te=q(Ht,Te,St),yt===null?dt=Ht:yt.sibling=Ht,yt=Ht);return rn&&es(ke,St),dt}for(wt=T(ke,wt);!Ht.done;St++,Ht=De.next())Ht=it(wt,ke,St,Ht.value,et),Ht!==null&&(l&&Ht.alternate!==null&&wt.delete(Ht.key===null?St:Ht.key),Te=q(Ht,Te,St),yt===null?dt=Ht:yt.sibling=Ht,yt=Ht);return l&&wt.forEach(function(Gf){return h(ke,Gf)}),rn&&es(ke,St),dt}function gn(ke,Te,De,et){if(typeof De=="object"&&De!==null&&De.type===P&&De.key===null&&(De=De.props.children),typeof De=="object"&&De!==null){switch(De.$$typeof){case B:e:{for(var dt=De.key,yt=Te;yt!==null;){if(yt.key===dt){if(dt=De.type,dt===P){if(yt.tag===7){b(ke,yt.sibling),Te=L(yt,De.props.children),Te.return=ke,ke=Te;break e}}else if(yt.elementType===dt||typeof dt=="object"&&dt!==null&&dt.$$typeof===J&&Ic(dt)===yt.type){b(ke,yt.sibling),Te=L(yt,De.props),Te.ref=go(ke,yt,De),Te.return=ke,ke=Te;break e}b(ke,yt);break}else h(ke,yt);yt=yt.sibling}De.type===P?(Te=ls(De.props.children,ke.mode,et,De.key),Te.return=ke,ke=Te):(et=Ta(De.type,De.key,De.props,null,ke.mode,et),et.ref=go(ke,Te,De),et.return=ke,ke=et)}return ue(ke);case U:e:{for(yt=De.key;Te!==null;){if(Te.key===yt)if(Te.tag===4&&Te.stateNode.containerInfo===De.containerInfo&&Te.stateNode.implementation===De.implementation){b(ke,Te.sibling),Te=L(Te,De.children||[]),Te.return=ke,ke=Te;break e}else{b(ke,Te);break}else h(ke,Te);Te=Te.sibling}Te=Zl(De,ke.mode,et),Te.return=ke,ke=Te}return ue(ke);case J:return yt=De._init,gn(ke,Te,yt(De._payload),et)}if(bt(De))return lt(ke,Te,De,et);if(ne(De))return ct(ke,Te,De,et);ra(ke,De)}return typeof De=="string"&&De!==""||typeof De=="number"?(De=""+De,Te!==null&&Te.tag===6?(b(ke,Te.sibling),Te=L(Te,De),Te.return=ke,ke=Te):(b(ke,Te),Te=Xl(De,ke.mode,et),Te.return=ke,ke=Te),ue(ke)):b(ke,Te)}return gn}var Bs=Tc(!0),Rc=Tc(!1),ia=pi(null),sa=null,Ps=null,al=null;function ll(){al=Ps=sa=null}function cl(l){var h=ia.current;tn(ia),l._currentValue=h}function ul(l,h,b){for(;l!==null;){var T=l.alternate;if((l.childLanes&h)!==h?(l.childLanes|=h,T!==null&&(T.childLanes|=h)):T!==null&&(T.childLanes&h)!==h&&(T.childLanes|=h),l===b)break;l=l.return}}function Ds(l,h){sa=l,al=Ps=null,l=l.dependencies,l!==null&&l.firstContext!==null&&((l.lanes&h)!==0&&(Zn=!0),l.firstContext=null)}function wr(l){var h=l._currentValue;if(al!==l)if(l={context:l,memoizedValue:h,next:null},Ps===null){if(sa===null)throw Error(e(308));Ps=l,sa.dependencies={lanes:0,firstContext:l}}else Ps=Ps.next=l;return h}var ts=null;function fl(l){ts===null?ts=[l]:ts.push(l)}function Nc(l,h,b,T){var L=h.interleaved;return L===null?(b.next=b,fl(h)):(b.next=L.next,L.next=b),h.interleaved=b,Qr(l,T)}function Qr(l,h){l.lanes|=h;var b=l.alternate;for(b!==null&&(b.lanes|=h),b=l,l=l.return;l!==null;)l.childLanes|=h,b=l.alternate,b!==null&&(b.childLanes|=h),b=l,l=l.return;return b.tag===3?b.stateNode:null}var yi=!1;function dl(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function kc(l,h){l=l.updateQueue,h.updateQueue===l&&(h.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,effects:l.effects})}function Kr(l,h){return{eventTime:l,lane:h,tag:0,payload:null,callback:null,next:null}}function wi(l,h,b){var T=l.updateQueue;if(T===null)return null;if(T=T.shared,(Ft&2)!==0){var L=T.pending;return L===null?h.next=h:(h.next=L.next,L.next=h),T.pending=h,Qr(l,b)}return L=T.interleaved,L===null?(h.next=h,fl(T)):(h.next=L.next,L.next=h),T.interleaved=h,Qr(l,b)}function oa(l,h,b){if(h=h.updateQueue,h!==null&&(h=h.shared,(b&4194240)!==0)){var T=h.lanes;T&=l.pendingLanes,b|=T,h.lanes=b,ln(l,b)}}function Mc(l,h){var b=l.updateQueue,T=l.alternate;if(T!==null&&(T=T.updateQueue,b===T)){var L=null,q=null;if(b=b.firstBaseUpdate,b!==null){do{var ue={eventTime:b.eventTime,lane:b.lane,tag:b.tag,payload:b.payload,callback:b.callback,next:null};q===null?L=q=ue:q=q.next=ue,b=b.next}while(b!==null);q===null?L=q=h:q=q.next=h}else L=q=h;b={baseState:T.baseState,firstBaseUpdate:L,lastBaseUpdate:q,shared:T.shared,effects:T.effects},l.updateQueue=b;return}l=b.lastBaseUpdate,l===null?b.firstBaseUpdate=h:l.next=h,b.lastBaseUpdate=h}function aa(l,h,b,T){var L=l.updateQueue;yi=!1;var q=L.firstBaseUpdate,ue=L.lastBaseUpdate,ve=L.shared.pending;if(ve!==null){L.shared.pending=null;var _e=ve,$e=_e.next;_e.next=null,ue===null?q=$e:ue.next=$e,ue=_e;var Qe=l.alternate;Qe!==null&&(Qe=Qe.updateQueue,ve=Qe.lastBaseUpdate,ve!==ue&&(ve===null?Qe.firstBaseUpdate=$e:ve.next=$e,Qe.lastBaseUpdate=_e))}if(q!==null){var Ke=L.baseState;ue=0,Qe=$e=_e=null,ve=q;do{var Ge=ve.lane,it=ve.eventTime;if((T&Ge)===Ge){Qe!==null&&(Qe=Qe.next={eventTime:it,lane:0,tag:ve.tag,payload:ve.payload,callback:ve.callback,next:null});e:{var lt=l,ct=ve;switch(Ge=h,it=b,ct.tag){case 1:if(lt=ct.payload,typeof lt=="function"){Ke=lt.call(it,Ke,Ge);break e}Ke=lt;break e;case 3:lt.flags=lt.flags&-65537|128;case 0:if(lt=ct.payload,Ge=typeof lt=="function"?lt.call(it,Ke,Ge):lt,Ge==null)break e;Ke=re({},Ke,Ge);break e;case 2:yi=!0}}ve.callback!==null&&ve.lane!==0&&(l.flags|=64,Ge=L.effects,Ge===null?L.effects=[ve]:Ge.push(ve))}else it={eventTime:it,lane:Ge,tag:ve.tag,payload:ve.payload,callback:ve.callback,next:null},Qe===null?($e=Qe=it,_e=Ke):Qe=Qe.next=it,ue|=Ge;if(ve=ve.next,ve===null){if(ve=L.shared.pending,ve===null)break;Ge=ve,ve=Ge.next,Ge.next=null,L.lastBaseUpdate=Ge,L.shared.pending=null}}while(!0);if(Qe===null&&(_e=Ke),L.baseState=_e,L.firstBaseUpdate=$e,L.lastBaseUpdate=Qe,h=L.shared.interleaved,h!==null){L=h;do ue|=L.lane,L=L.next;while(L!==h)}else q===null&&(L.shared.lanes=0);is|=ue,l.lanes=ue,l.memoizedState=Ke}}function Bc(l,h,b){if(l=h.effects,h.effects=null,l!==null)for(h=0;h<l.length;h++){var T=l[h],L=T.callback;if(L!==null){if(T.callback=null,T=b,typeof L!="function")throw Error(e(191,L));L.call(T)}}}var mo={},Lr=pi(mo),yo=pi(mo),wo=pi(mo);function ns(l){if(l===mo)throw Error(e(174));return l}function hl(l,h){switch(Jt(wo,h),Jt(yo,l),Jt(Lr,mo),l=h.nodeType,l){case 9:case 11:h=(h=h.documentElement)?h.namespaceURI:de(null,"");break;default:l=l===8?h.parentNode:h,h=l.namespaceURI||null,l=l.tagName,h=de(h,l)}tn(Lr),Jt(Lr,h)}function Os(){tn(Lr),tn(yo),tn(wo)}function Pc(l){ns(wo.current);var h=ns(Lr.current),b=de(h,l.type);h!==b&&(Jt(yo,l),Jt(Lr,b))}function pl(l){yo.current===l&&(tn(Lr),tn(yo))}var on=pi(0);function la(l){for(var h=l;h!==null;){if(h.tag===13){var b=h.memoizedState;if(b!==null&&(b=b.dehydrated,b===null||b.data==="$?"||b.data==="$!"))return h}else if(h.tag===19&&h.memoizedProps.revealOrder!==void 0){if((h.flags&128)!==0)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===l)break;for(;h.sibling===null;){if(h.return===null||h.return===l)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}var gl=[];function ml(){for(var l=0;l<gl.length;l++)gl[l]._workInProgressVersionPrimary=null;gl.length=0}var ca=W.ReactCurrentDispatcher,yl=W.ReactCurrentBatchConfig,rs=0,an=null,Sn=null,In=null,ua=!1,xo=!1,Eo=0,gf=0;function $n(){throw Error(e(321))}function wl(l,h){if(h===null)return!1;for(var b=0;b<h.length&&b<l.length;b++)if(!Re(l[b],h[b]))return!1;return!0}function xl(l,h,b,T,L,q){if(rs=q,an=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,ca.current=l===null||l.memoizedState===null?xf:Ef,l=b(T,L),xo){q=0;do{if(xo=!1,Eo=0,25<=q)throw Error(e(301));q+=1,In=Sn=null,h.updateQueue=null,ca.current=vf,l=b(T,L)}while(xo)}if(ca.current=ha,h=Sn!==null&&Sn.next!==null,rs=0,In=Sn=an=null,ua=!1,h)throw Error(e(300));return l}function El(){var l=Eo!==0;return Eo=0,l}function Ur(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return In===null?an.memoizedState=In=l:In=In.next=l,In}function xr(){if(Sn===null){var l=an.alternate;l=l!==null?l.memoizedState:null}else l=Sn.next;var h=In===null?an.memoizedState:In.next;if(h!==null)In=h,Sn=l;else{if(l===null)throw Error(e(310));Sn=l,l={memoizedState:Sn.memoizedState,baseState:Sn.baseState,baseQueue:Sn.baseQueue,queue:Sn.queue,next:null},In===null?an.memoizedState=In=l:In=In.next=l}return In}function vo(l,h){return typeof h=="function"?h(l):h}function vl(l){var h=xr(),b=h.queue;if(b===null)throw Error(e(311));b.lastRenderedReducer=l;var T=Sn,L=T.baseQueue,q=b.pending;if(q!==null){if(L!==null){var ue=L.next;L.next=q.next,q.next=ue}T.baseQueue=L=q,b.pending=null}if(L!==null){q=L.next,T=T.baseState;var ve=ue=null,_e=null,$e=q;do{var Qe=$e.lane;if((rs&Qe)===Qe)_e!==null&&(_e=_e.next={lane:0,action:$e.action,hasEagerState:$e.hasEagerState,eagerState:$e.eagerState,next:null}),T=$e.hasEagerState?$e.eagerState:l(T,$e.action);else{var Ke={lane:Qe,action:$e.action,hasEagerState:$e.hasEagerState,eagerState:$e.eagerState,next:null};_e===null?(ve=_e=Ke,ue=T):_e=_e.next=Ke,an.lanes|=Qe,is|=Qe}$e=$e.next}while($e!==null&&$e!==q);_e===null?ue=T:_e.next=ve,Re(T,h.memoizedState)||(Zn=!0),h.memoizedState=T,h.baseState=ue,h.baseQueue=_e,b.lastRenderedState=T}if(l=b.interleaved,l!==null){L=l;do q=L.lane,an.lanes|=q,is|=q,L=L.next;while(L!==l)}else L===null&&(b.lanes=0);return[h.memoizedState,b.dispatch]}function bl(l){var h=xr(),b=h.queue;if(b===null)throw Error(e(311));b.lastRenderedReducer=l;var T=b.dispatch,L=b.pending,q=h.memoizedState;if(L!==null){b.pending=null;var ue=L=L.next;do q=l(q,ue.action),ue=ue.next;while(ue!==L);Re(q,h.memoizedState)||(Zn=!0),h.memoizedState=q,h.baseQueue===null&&(h.baseState=q),b.lastRenderedState=q}return[q,T]}function Dc(){}function Oc(l,h){var b=an,T=xr(),L=h(),q=!Re(T.memoizedState,L);if(q&&(T.memoizedState=L,Zn=!0),T=T.queue,Sl(Fc.bind(null,b,T,l),[l]),T.getSnapshot!==h||q||In!==null&&In.memoizedState.tag&1){if(b.flags|=2048,bo(9,Uc.bind(null,b,T,L,h),void 0,null),Tn===null)throw Error(e(349));(rs&30)!==0||Lc(b,h,L)}return L}function Lc(l,h,b){l.flags|=16384,l={getSnapshot:h,value:b},h=an.updateQueue,h===null?(h={lastEffect:null,stores:null},an.updateQueue=h,h.stores=[l]):(b=h.stores,b===null?h.stores=[l]:b.push(l))}function Uc(l,h,b,T){h.value=b,h.getSnapshot=T,Hc(h)&&$c(l)}function Fc(l,h,b){return b(function(){Hc(h)&&$c(l)})}function Hc(l){var h=l.getSnapshot;l=l.value;try{var b=h();return!Re(l,b)}catch{return!0}}function $c(l){var h=Qr(l,1);h!==null&&Nr(h,l,1,-1)}function jc(l){var h=Ur();return typeof l=="function"&&(l=l()),h.memoizedState=h.baseState=l,l={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:vo,lastRenderedState:l},h.queue=l,l=l.dispatch=wf.bind(null,an,l),[h.memoizedState,l]}function bo(l,h,b,T){return l={tag:l,create:h,destroy:b,deps:T,next:null},h=an.updateQueue,h===null?(h={lastEffect:null,stores:null},an.updateQueue=h,h.lastEffect=l.next=l):(b=h.lastEffect,b===null?h.lastEffect=l.next=l:(T=b.next,b.next=l,l.next=T,h.lastEffect=l)),l}function Vc(){return xr().memoizedState}function fa(l,h,b,T){var L=Ur();an.flags|=l,L.memoizedState=bo(1|h,b,void 0,T===void 0?null:T)}function da(l,h,b,T){var L=xr();T=T===void 0?null:T;var q=void 0;if(Sn!==null){var ue=Sn.memoizedState;if(q=ue.destroy,T!==null&&wl(T,ue.deps)){L.memoizedState=bo(h,b,q,T);return}}an.flags|=l,L.memoizedState=bo(1|h,b,q,T)}function zc(l,h){return fa(8390656,8,l,h)}function Sl(l,h){return da(2048,8,l,h)}function Wc(l,h){return da(4,2,l,h)}function qc(l,h){return da(4,4,l,h)}function Gc(l,h){if(typeof h=="function")return l=l(),h(l),function(){h(null)};if(h!=null)return l=l(),h.current=l,function(){h.current=null}}function Yc(l,h,b){return b=b!=null?b.concat([l]):null,da(4,4,Gc.bind(null,h,l),b)}function Al(){}function Qc(l,h){var b=xr();h=h===void 0?null:h;var T=b.memoizedState;return T!==null&&h!==null&&wl(h,T[1])?T[0]:(b.memoizedState=[l,h],l)}function Kc(l,h){var b=xr();h=h===void 0?null:h;var T=b.memoizedState;return T!==null&&h!==null&&wl(h,T[1])?T[0]:(l=l(),b.memoizedState=[l,h],l)}function Xc(l,h,b){return(rs&21)===0?(l.baseState&&(l.baseState=!1,Zn=!0),l.memoizedState=b):(Re(b,h)||(b=xn(),an.lanes|=b,is|=b,l.baseState=!0),h)}function mf(l,h){var b=Tt;Tt=b!==0&&4>b?b:4,l(!0);var T=yl.transition;yl.transition={};try{l(!1),h()}finally{Tt=b,yl.transition=T}}function Zc(){return xr().memoizedState}function yf(l,h,b){var T=bi(l);if(b={lane:T,action:b,hasEagerState:!1,eagerState:null,next:null},Jc(l))eu(h,b);else if(b=Nc(l,h,b,T),b!==null){var L=qn();Nr(b,l,T,L),tu(b,h,T)}}function wf(l,h,b){var T=bi(l),L={lane:T,action:b,hasEagerState:!1,eagerState:null,next:null};if(Jc(l))eu(h,L);else{var q=l.alternate;if(l.lanes===0&&(q===null||q.lanes===0)&&(q=h.lastRenderedReducer,q!==null))try{var ue=h.lastRenderedState,ve=q(ue,b);if(L.hasEagerState=!0,L.eagerState=ve,Re(ve,ue)){var _e=h.interleaved;_e===null?(L.next=L,fl(h)):(L.next=_e.next,_e.next=L),h.interleaved=L;return}}catch{}finally{}b=Nc(l,h,L,T),b!==null&&(L=qn(),Nr(b,l,T,L),tu(b,h,T))}}function Jc(l){var h=l.alternate;return l===an||h!==null&&h===an}function eu(l,h){xo=ua=!0;var b=l.pending;b===null?h.next=h:(h.next=b.next,b.next=h),l.pending=h}function tu(l,h,b){if((b&4194240)!==0){var T=h.lanes;T&=l.pendingLanes,b|=T,h.lanes=b,ln(l,b)}}var ha={readContext:wr,useCallback:$n,useContext:$n,useEffect:$n,useImperativeHandle:$n,useInsertionEffect:$n,useLayoutEffect:$n,useMemo:$n,useReducer:$n,useRef:$n,useState:$n,useDebugValue:$n,useDeferredValue:$n,useTransition:$n,useMutableSource:$n,useSyncExternalStore:$n,useId:$n,unstable_isNewReconciler:!1},xf={readContext:wr,useCallback:function(l,h){return Ur().memoizedState=[l,h===void 0?null:h],l},useContext:wr,useEffect:zc,useImperativeHandle:function(l,h,b){return b=b!=null?b.concat([l]):null,fa(4194308,4,Gc.bind(null,h,l),b)},useLayoutEffect:function(l,h){return fa(4194308,4,l,h)},useInsertionEffect:function(l,h){return fa(4,2,l,h)},useMemo:function(l,h){var b=Ur();return h=h===void 0?null:h,l=l(),b.memoizedState=[l,h],l},useReducer:function(l,h,b){var T=Ur();return h=b!==void 0?b(h):h,T.memoizedState=T.baseState=h,l={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:h},T.queue=l,l=l.dispatch=yf.bind(null,an,l),[T.memoizedState,l]},useRef:function(l){var h=Ur();return l={current:l},h.memoizedState=l},useState:jc,useDebugValue:Al,useDeferredValue:function(l){return Ur().memoizedState=l},useTransition:function(){var l=jc(!1),h=l[0];return l=mf.bind(null,l[1]),Ur().memoizedState=l,[h,l]},useMutableSource:function(){},useSyncExternalStore:function(l,h,b){var T=an,L=Ur();if(rn){if(b===void 0)throw Error(e(407));b=b()}else{if(b=h(),Tn===null)throw Error(e(349));(rs&30)!==0||Lc(T,h,b)}L.memoizedState=b;var q={value:b,getSnapshot:h};return L.queue=q,zc(Fc.bind(null,T,q,l),[l]),T.flags|=2048,bo(9,Uc.bind(null,T,q,b,h),void 0,null),b},useId:function(){var l=Ur(),h=Tn.identifierPrefix;if(rn){var b=Yr,T=Gr;b=(T&~(1<<32-zn(T)-1)).toString(32)+b,h=":"+h+"R"+b,b=Eo++,0<b&&(h+="H"+b.toString(32)),h+=":"}else b=gf++,h=":"+h+"r"+b.toString(32)+":";return l.memoizedState=h},unstable_isNewReconciler:!1},Ef={readContext:wr,useCallback:Qc,useContext:wr,useEffect:Sl,useImperativeHandle:Yc,useInsertionEffect:Wc,useLayoutEffect:qc,useMemo:Kc,useReducer:vl,useRef:Vc,useState:function(){return vl(vo)},useDebugValue:Al,useDeferredValue:function(l){var h=xr();return Xc(h,Sn.memoizedState,l)},useTransition:function(){var l=vl(vo)[0],h=xr().memoizedState;return[l,h]},useMutableSource:Dc,useSyncExternalStore:Oc,useId:Zc,unstable_isNewReconciler:!1},vf={readContext:wr,useCallback:Qc,useContext:wr,useEffect:Sl,useImperativeHandle:Yc,useInsertionEffect:Wc,useLayoutEffect:qc,useMemo:Kc,useReducer:bl,useRef:Vc,useState:function(){return bl(vo)},useDebugValue:Al,useDeferredValue:function(l){var h=xr();return Sn===null?h.memoizedState=l:Xc(h,Sn.memoizedState,l)},useTransition:function(){var l=bl(vo)[0],h=xr().memoizedState;return[l,h]},useMutableSource:Dc,useSyncExternalStore:Oc,useId:Zc,unstable_isNewReconciler:!1};function Ir(l,h){if(l&&l.defaultProps){h=re({},h),l=l.defaultProps;for(var b in l)h[b]===void 0&&(h[b]=l[b]);return h}return h}function Cl(l,h,b,T){h=l.memoizedState,b=b(T,h),b=b==null?h:re({},h,b),l.memoizedState=b,l.lanes===0&&(l.updateQueue.baseState=b)}var pa={isMounted:function(l){return(l=l._reactInternals)?Qn(l)===l:!1},enqueueSetState:function(l,h,b){l=l._reactInternals;var T=qn(),L=bi(l),q=Kr(T,L);q.payload=h,b!=null&&(q.callback=b),h=wi(l,q,L),h!==null&&(Nr(h,l,L,T),oa(h,l,L))},enqueueReplaceState:function(l,h,b){l=l._reactInternals;var T=qn(),L=bi(l),q=Kr(T,L);q.tag=1,q.payload=h,b!=null&&(q.callback=b),h=wi(l,q,L),h!==null&&(Nr(h,l,L,T),oa(h,l,L))},enqueueForceUpdate:function(l,h){l=l._reactInternals;var b=qn(),T=bi(l),L=Kr(b,T);L.tag=2,h!=null&&(L.callback=h),h=wi(l,L,T),h!==null&&(Nr(h,l,T,b),oa(h,l,T))}};function nu(l,h,b,T,L,q,ue){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(T,q,ue):h.prototype&&h.prototype.isPureReactComponent?!Fe(b,T)||!Fe(L,q):!0}function ru(l,h,b){var T=!1,L=gi,q=h.contextType;return typeof q=="object"&&q!==null?q=wr(q):(L=Xn(h)?Zi:Hn.current,T=h.contextTypes,q=(T=T!=null)?Rs(l,L):gi),h=new h(b,q),l.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=pa,l.stateNode=h,h._reactInternals=l,T&&(l=l.stateNode,l.__reactInternalMemoizedUnmaskedChildContext=L,l.__reactInternalMemoizedMaskedChildContext=q),h}function iu(l,h,b,T){l=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(b,T),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(b,T),h.state!==l&&pa.enqueueReplaceState(h,h.state,null)}function _l(l,h,b,T){var L=l.stateNode;L.props=b,L.state=l.memoizedState,L.refs={},dl(l);var q=h.contextType;typeof q=="object"&&q!==null?L.context=wr(q):(q=Xn(h)?Zi:Hn.current,L.context=Rs(l,q)),L.state=l.memoizedState,q=h.getDerivedStateFromProps,typeof q=="function"&&(Cl(l,h,q,b),L.state=l.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof L.getSnapshotBeforeUpdate=="function"||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(h=L.state,typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount(),h!==L.state&&pa.enqueueReplaceState(L,L.state,null),aa(l,b,L,T),L.state=l.memoizedState),typeof L.componentDidMount=="function"&&(l.flags|=4194308)}function Ls(l,h){try{var b="",T=h;do b+=xe(T),T=T.return;while(T);var L=b}catch(q){L=`
Error generating stack: `+q.message+`
`+q.stack}return{value:l,source:h,stack:L,digest:null}}function Il(l,h,b){return{value:l,source:null,stack:b??null,digest:h??null}}function Tl(l,h){try{console.error(h.value)}catch(b){setTimeout(function(){throw b})}}var bf=typeof WeakMap=="function"?WeakMap:Map;function su(l,h,b){b=Kr(-1,b),b.tag=3,b.payload={element:null};var T=h.value;return b.callback=function(){va||(va=!0,Vl=T),Tl(l,h)},b}function ou(l,h,b){b=Kr(-1,b),b.tag=3;var T=l.type.getDerivedStateFromError;if(typeof T=="function"){var L=h.value;b.payload=function(){return T(L)},b.callback=function(){Tl(l,h)}}var q=l.stateNode;return q!==null&&typeof q.componentDidCatch=="function"&&(b.callback=function(){Tl(l,h),typeof T!="function"&&(Ei===null?Ei=new Set([this]):Ei.add(this));var ue=h.stack;this.componentDidCatch(h.value,{componentStack:ue!==null?ue:""})}),b}function au(l,h,b){var T=l.pingCache;if(T===null){T=l.pingCache=new bf;var L=new Set;T.set(h,L)}else L=T.get(h),L===void 0&&(L=new Set,T.set(h,L));L.has(b)||(L.add(b),l=Of.bind(null,l,h,b),h.then(l,l))}function lu(l){do{var h;if((h=l.tag===13)&&(h=l.memoizedState,h=h!==null?h.dehydrated!==null:!0),h)return l;l=l.return}while(l!==null);return null}function cu(l,h,b,T,L){return(l.mode&1)===0?(l===h?l.flags|=65536:(l.flags|=128,b.flags|=131072,b.flags&=-52805,b.tag===1&&(b.alternate===null?b.tag=17:(h=Kr(-1,1),h.tag=2,wi(b,h,1))),b.lanes|=1),l):(l.flags|=65536,l.lanes=L,l)}var Sf=W.ReactCurrentOwner,Zn=!1;function Wn(l,h,b,T){h.child=l===null?Rc(h,null,b,T):Bs(h,l.child,b,T)}function uu(l,h,b,T,L){b=b.render;var q=h.ref;return Ds(h,L),T=xl(l,h,b,T,q,L),b=El(),l!==null&&!Zn?(h.updateQueue=l.updateQueue,h.flags&=-2053,l.lanes&=~L,Xr(l,h,L)):(rn&&b&&nl(h),h.flags|=1,Wn(l,h,T,L),h.child)}function fu(l,h,b,T,L){if(l===null){var q=b.type;return typeof q=="function"&&!Kl(q)&&q.defaultProps===void 0&&b.compare===null&&b.defaultProps===void 0?(h.tag=15,h.type=q,du(l,h,q,T,L)):(l=Ta(b.type,null,T,h,h.mode,L),l.ref=h.ref,l.return=h,h.child=l)}if(q=l.child,(l.lanes&L)===0){var ue=q.memoizedProps;if(b=b.compare,b=b!==null?b:Fe,b(ue,T)&&l.ref===h.ref)return Xr(l,h,L)}return h.flags|=1,l=Ai(q,T),l.ref=h.ref,l.return=h,h.child=l}function du(l,h,b,T,L){if(l!==null){var q=l.memoizedProps;if(Fe(q,T)&&l.ref===h.ref)if(Zn=!1,h.pendingProps=T=q,(l.lanes&L)!==0)(l.flags&131072)!==0&&(Zn=!0);else return h.lanes=l.lanes,Xr(l,h,L)}return Rl(l,h,b,T,L)}function hu(l,h,b){var T=h.pendingProps,L=T.children,q=l!==null?l.memoizedState:null;if(T.mode==="hidden")if((h.mode&1)===0)h.memoizedState={baseLanes:0,cachePool:null,transitions:null},Jt(Fs,ur),ur|=b;else{if((b&1073741824)===0)return l=q!==null?q.baseLanes|b:b,h.lanes=h.childLanes=1073741824,h.memoizedState={baseLanes:l,cachePool:null,transitions:null},h.updateQueue=null,Jt(Fs,ur),ur|=l,null;h.memoizedState={baseLanes:0,cachePool:null,transitions:null},T=q!==null?q.baseLanes:b,Jt(Fs,ur),ur|=T}else q!==null?(T=q.baseLanes|b,h.memoizedState=null):T=b,Jt(Fs,ur),ur|=T;return Wn(l,h,L,b),h.child}function pu(l,h){var b=h.ref;(l===null&&b!==null||l!==null&&l.ref!==b)&&(h.flags|=512,h.flags|=2097152)}function Rl(l,h,b,T,L){var q=Xn(b)?Zi:Hn.current;return q=Rs(h,q),Ds(h,L),b=xl(l,h,b,T,q,L),T=El(),l!==null&&!Zn?(h.updateQueue=l.updateQueue,h.flags&=-2053,l.lanes&=~L,Xr(l,h,L)):(rn&&T&&nl(h),h.flags|=1,Wn(l,h,b,L),h.child)}function gu(l,h,b,T,L){if(Xn(b)){var q=!0;Zo(h)}else q=!1;if(Ds(h,L),h.stateNode===null)ma(l,h),ru(h,b,T),_l(h,b,T,L),T=!0;else if(l===null){var ue=h.stateNode,ve=h.memoizedProps;ue.props=ve;var _e=ue.context,$e=b.contextType;typeof $e=="object"&&$e!==null?$e=wr($e):($e=Xn(b)?Zi:Hn.current,$e=Rs(h,$e));var Qe=b.getDerivedStateFromProps,Ke=typeof Qe=="function"||typeof ue.getSnapshotBeforeUpdate=="function";Ke||typeof ue.UNSAFE_componentWillReceiveProps!="function"&&typeof ue.componentWillReceiveProps!="function"||(ve!==T||_e!==$e)&&iu(h,ue,T,$e),yi=!1;var Ge=h.memoizedState;ue.state=Ge,aa(h,T,ue,L),_e=h.memoizedState,ve!==T||Ge!==_e||Kn.current||yi?(typeof Qe=="function"&&(Cl(h,b,Qe,T),_e=h.memoizedState),(ve=yi||nu(h,b,ve,T,Ge,_e,$e))?(Ke||typeof ue.UNSAFE_componentWillMount!="function"&&typeof ue.componentWillMount!="function"||(typeof ue.componentWillMount=="function"&&ue.componentWillMount(),typeof ue.UNSAFE_componentWillMount=="function"&&ue.UNSAFE_componentWillMount()),typeof ue.componentDidMount=="function"&&(h.flags|=4194308)):(typeof ue.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=T,h.memoizedState=_e),ue.props=T,ue.state=_e,ue.context=$e,T=ve):(typeof ue.componentDidMount=="function"&&(h.flags|=4194308),T=!1)}else{ue=h.stateNode,kc(l,h),ve=h.memoizedProps,$e=h.type===h.elementType?ve:Ir(h.type,ve),ue.props=$e,Ke=h.pendingProps,Ge=ue.context,_e=b.contextType,typeof _e=="object"&&_e!==null?_e=wr(_e):(_e=Xn(b)?Zi:Hn.current,_e=Rs(h,_e));var it=b.getDerivedStateFromProps;(Qe=typeof it=="function"||typeof ue.getSnapshotBeforeUpdate=="function")||typeof ue.UNSAFE_componentWillReceiveProps!="function"&&typeof ue.componentWillReceiveProps!="function"||(ve!==Ke||Ge!==_e)&&iu(h,ue,T,_e),yi=!1,Ge=h.memoizedState,ue.state=Ge,aa(h,T,ue,L);var lt=h.memoizedState;ve!==Ke||Ge!==lt||Kn.current||yi?(typeof it=="function"&&(Cl(h,b,it,T),lt=h.memoizedState),($e=yi||nu(h,b,$e,T,Ge,lt,_e)||!1)?(Qe||typeof ue.UNSAFE_componentWillUpdate!="function"&&typeof ue.componentWillUpdate!="function"||(typeof ue.componentWillUpdate=="function"&&ue.componentWillUpdate(T,lt,_e),typeof ue.UNSAFE_componentWillUpdate=="function"&&ue.UNSAFE_componentWillUpdate(T,lt,_e)),typeof ue.componentDidUpdate=="function"&&(h.flags|=4),typeof ue.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof ue.componentDidUpdate!="function"||ve===l.memoizedProps&&Ge===l.memoizedState||(h.flags|=4),typeof ue.getSnapshotBeforeUpdate!="function"||ve===l.memoizedProps&&Ge===l.memoizedState||(h.flags|=1024),h.memoizedProps=T,h.memoizedState=lt),ue.props=T,ue.state=lt,ue.context=_e,T=$e):(typeof ue.componentDidUpdate!="function"||ve===l.memoizedProps&&Ge===l.memoizedState||(h.flags|=4),typeof ue.getSnapshotBeforeUpdate!="function"||ve===l.memoizedProps&&Ge===l.memoizedState||(h.flags|=1024),T=!1)}return Nl(l,h,b,T,q,L)}function Nl(l,h,b,T,L,q){pu(l,h);var ue=(h.flags&128)!==0;if(!T&&!ue)return L&&Ec(h,b,!1),Xr(l,h,q);T=h.stateNode,Sf.current=h;var ve=ue&&typeof b.getDerivedStateFromError!="function"?null:T.render();return h.flags|=1,l!==null&&ue?(h.child=Bs(h,l.child,null,q),h.child=Bs(h,null,ve,q)):Wn(l,h,ve,q),h.memoizedState=T.state,L&&Ec(h,b,!0),h.child}function mu(l){var h=l.stateNode;h.pendingContext?wc(l,h.pendingContext,h.pendingContext!==h.context):h.context&&wc(l,h.context,!1),hl(l,h.containerInfo)}function yu(l,h,b,T,L){return Ms(),ol(L),h.flags|=256,Wn(l,h,b,T),h.child}var kl={dehydrated:null,treeContext:null,retryLane:0};function Ml(l){return{baseLanes:l,cachePool:null,transitions:null}}function wu(l,h,b){var T=h.pendingProps,L=on.current,q=!1,ue=(h.flags&128)!==0,ve;if((ve=ue)||(ve=l!==null&&l.memoizedState===null?!1:(L&2)!==0),ve?(q=!0,h.flags&=-129):(l===null||l.memoizedState!==null)&&(L|=1),Jt(on,L&1),l===null)return sl(h),l=h.memoizedState,l!==null&&(l=l.dehydrated,l!==null)?((h.mode&1)===0?h.lanes=1:l.data==="$!"?h.lanes=8:h.lanes=1073741824,null):(ue=T.children,l=T.fallback,q?(T=h.mode,q=h.child,ue={mode:"hidden",children:ue},(T&1)===0&&q!==null?(q.childLanes=0,q.pendingProps=ue):q=Ra(ue,T,0,null),l=ls(l,T,b,null),q.return=h,l.return=h,q.sibling=l,h.child=q,h.child.memoizedState=Ml(b),h.memoizedState=kl,l):Bl(h,ue));if(L=l.memoizedState,L!==null&&(ve=L.dehydrated,ve!==null))return Af(l,h,ue,T,ve,L,b);if(q){q=T.fallback,ue=h.mode,L=l.child,ve=L.sibling;var _e={mode:"hidden",children:T.children};return(ue&1)===0&&h.child!==L?(T=h.child,T.childLanes=0,T.pendingProps=_e,h.deletions=null):(T=Ai(L,_e),T.subtreeFlags=L.subtreeFlags&14680064),ve!==null?q=Ai(ve,q):(q=ls(q,ue,b,null),q.flags|=2),q.return=h,T.return=h,T.sibling=q,h.child=T,T=q,q=h.child,ue=l.child.memoizedState,ue=ue===null?Ml(b):{baseLanes:ue.baseLanes|b,cachePool:null,transitions:ue.transitions},q.memoizedState=ue,q.childLanes=l.childLanes&~b,h.memoizedState=kl,T}return q=l.child,l=q.sibling,T=Ai(q,{mode:"visible",children:T.children}),(h.mode&1)===0&&(T.lanes=b),T.return=h,T.sibling=null,l!==null&&(b=h.deletions,b===null?(h.deletions=[l],h.flags|=16):b.push(l)),h.child=T,h.memoizedState=null,T}function Bl(l,h){return h=Ra({mode:"visible",children:h},l.mode,0,null),h.return=l,l.child=h}function ga(l,h,b,T){return T!==null&&ol(T),Bs(h,l.child,null,b),l=Bl(h,h.pendingProps.children),l.flags|=2,h.memoizedState=null,l}function Af(l,h,b,T,L,q,ue){if(b)return h.flags&256?(h.flags&=-257,T=Il(Error(e(422))),ga(l,h,ue,T)):h.memoizedState!==null?(h.child=l.child,h.flags|=128,null):(q=T.fallback,L=h.mode,T=Ra({mode:"visible",children:T.children},L,0,null),q=ls(q,L,ue,null),q.flags|=2,T.return=h,q.return=h,T.sibling=q,h.child=T,(h.mode&1)!==0&&Bs(h,l.child,null,ue),h.child.memoizedState=Ml(ue),h.memoizedState=kl,q);if((h.mode&1)===0)return ga(l,h,ue,null);if(L.data==="$!"){if(T=L.nextSibling&&L.nextSibling.dataset,T)var ve=T.dgst;return T=ve,q=Error(e(419)),T=Il(q,T,void 0),ga(l,h,ue,T)}if(ve=(ue&l.childLanes)!==0,Zn||ve){if(T=Tn,T!==null){switch(ue&-ue){case 4:L=2;break;case 16:L=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:L=32;break;case 536870912:L=268435456;break;default:L=0}L=(L&(T.suspendedLanes|ue))!==0?0:L,L!==0&&L!==q.retryLane&&(q.retryLane=L,Qr(l,L),Nr(T,l,L,-1))}return Ql(),T=Il(Error(e(421))),ga(l,h,ue,T)}return L.data==="$?"?(h.flags|=128,h.child=l.child,h=Lf.bind(null,l),L._reactRetry=h,null):(l=q.treeContext,cr=hi(L.nextSibling),lr=h,rn=!0,_r=null,l!==null&&(mr[yr++]=Gr,mr[yr++]=Yr,mr[yr++]=Ji,Gr=l.id,Yr=l.overflow,Ji=h),h=Bl(h,T.children),h.flags|=4096,h)}function xu(l,h,b){l.lanes|=h;var T=l.alternate;T!==null&&(T.lanes|=h),ul(l.return,h,b)}function Pl(l,h,b,T,L){var q=l.memoizedState;q===null?l.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:T,tail:b,tailMode:L}:(q.isBackwards=h,q.rendering=null,q.renderingStartTime=0,q.last=T,q.tail=b,q.tailMode=L)}function Eu(l,h,b){var T=h.pendingProps,L=T.revealOrder,q=T.tail;if(Wn(l,h,T.children,b),T=on.current,(T&2)!==0)T=T&1|2,h.flags|=128;else{if(l!==null&&(l.flags&128)!==0)e:for(l=h.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&xu(l,b,h);else if(l.tag===19)xu(l,b,h);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===h)break e;for(;l.sibling===null;){if(l.return===null||l.return===h)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}T&=1}if(Jt(on,T),(h.mode&1)===0)h.memoizedState=null;else switch(L){case"forwards":for(b=h.child,L=null;b!==null;)l=b.alternate,l!==null&&la(l)===null&&(L=b),b=b.sibling;b=L,b===null?(L=h.child,h.child=null):(L=b.sibling,b.sibling=null),Pl(h,!1,L,b,q);break;case"backwards":for(b=null,L=h.child,h.child=null;L!==null;){if(l=L.alternate,l!==null&&la(l)===null){h.child=L;break}l=L.sibling,L.sibling=b,b=L,L=l}Pl(h,!0,b,null,q);break;case"together":Pl(h,!1,null,null,void 0);break;default:h.memoizedState=null}return h.child}function ma(l,h){(h.mode&1)===0&&l!==null&&(l.alternate=null,h.alternate=null,h.flags|=2)}function Xr(l,h,b){if(l!==null&&(h.dependencies=l.dependencies),is|=h.lanes,(b&h.childLanes)===0)return null;if(l!==null&&h.child!==l.child)throw Error(e(153));if(h.child!==null){for(l=h.child,b=Ai(l,l.pendingProps),h.child=b,b.return=h;l.sibling!==null;)l=l.sibling,b=b.sibling=Ai(l,l.pendingProps),b.return=h;b.sibling=null}return h.child}function Cf(l,h,b){switch(h.tag){case 3:mu(h),Ms();break;case 5:Pc(h);break;case 1:Xn(h.type)&&Zo(h);break;case 4:hl(h,h.stateNode.containerInfo);break;case 10:var T=h.type._context,L=h.memoizedProps.value;Jt(ia,T._currentValue),T._currentValue=L;break;case 13:if(T=h.memoizedState,T!==null)return T.dehydrated!==null?(Jt(on,on.current&1),h.flags|=128,null):(b&h.child.childLanes)!==0?wu(l,h,b):(Jt(on,on.current&1),l=Xr(l,h,b),l!==null?l.sibling:null);Jt(on,on.current&1);break;case 19:if(T=(b&h.childLanes)!==0,(l.flags&128)!==0){if(T)return Eu(l,h,b);h.flags|=128}if(L=h.memoizedState,L!==null&&(L.rendering=null,L.tail=null,L.lastEffect=null),Jt(on,on.current),T)break;return null;case 22:case 23:return h.lanes=0,hu(l,h,b)}return Xr(l,h,b)}var vu,Dl,bu,Su;vu=function(l,h){for(var b=h.child;b!==null;){if(b.tag===5||b.tag===6)l.appendChild(b.stateNode);else if(b.tag!==4&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===h)break;for(;b.sibling===null;){if(b.return===null||b.return===h)return;b=b.return}b.sibling.return=b.return,b=b.sibling}},Dl=function(){},bu=function(l,h,b,T){var L=l.memoizedProps;if(L!==T){l=h.stateNode,ns(Lr.current);var q=null;switch(b){case"input":L=We(l,L),T=We(l,T),q=[];break;case"select":L=re({},L,{value:void 0}),T=re({},T,{value:void 0}),q=[];break;case"textarea":L=Et(l,L),T=Et(l,T),q=[];break;default:typeof L.onClick!="function"&&typeof T.onClick=="function"&&(l.onclick=Qo)}ft(b,T);var ue;b=null;for($e in L)if(!T.hasOwnProperty($e)&&L.hasOwnProperty($e)&&L[$e]!=null)if($e==="style"){var ve=L[$e];for(ue in ve)ve.hasOwnProperty(ue)&&(b||(b={}),b[ue]="")}else $e!=="dangerouslySetInnerHTML"&&$e!=="children"&&$e!=="suppressContentEditableWarning"&&$e!=="suppressHydrationWarning"&&$e!=="autoFocus"&&(a.hasOwnProperty($e)?q||(q=[]):(q=q||[]).push($e,null));for($e in T){var _e=T[$e];if(ve=L!=null?L[$e]:void 0,T.hasOwnProperty($e)&&_e!==ve&&(_e!=null||ve!=null))if($e==="style")if(ve){for(ue in ve)!ve.hasOwnProperty(ue)||_e&&_e.hasOwnProperty(ue)||(b||(b={}),b[ue]="");for(ue in _e)_e.hasOwnProperty(ue)&&ve[ue]!==_e[ue]&&(b||(b={}),b[ue]=_e[ue])}else b||(q||(q=[]),q.push($e,b)),b=_e;else $e==="dangerouslySetInnerHTML"?(_e=_e?_e.__html:void 0,ve=ve?ve.__html:void 0,_e!=null&&ve!==_e&&(q=q||[]).push($e,_e)):$e==="children"?typeof _e!="string"&&typeof _e!="number"||(q=q||[]).push($e,""+_e):$e!=="suppressContentEditableWarning"&&$e!=="suppressHydrationWarning"&&(a.hasOwnProperty($e)?(_e!=null&&$e==="onScroll"&&en("scroll",l),q||ve===_e||(q=[])):(q=q||[]).push($e,_e))}b&&(q=q||[]).push("style",b);var $e=q;(h.updateQueue=$e)&&(h.flags|=4)}},Su=function(l,h,b,T){b!==T&&(h.flags|=4)};function So(l,h){if(!rn)switch(l.tailMode){case"hidden":h=l.tail;for(var b=null;h!==null;)h.alternate!==null&&(b=h),h=h.sibling;b===null?l.tail=null:b.sibling=null;break;case"collapsed":b=l.tail;for(var T=null;b!==null;)b.alternate!==null&&(T=b),b=b.sibling;T===null?h||l.tail===null?l.tail=null:l.tail.sibling=null:T.sibling=null}}function jn(l){var h=l.alternate!==null&&l.alternate.child===l.child,b=0,T=0;if(h)for(var L=l.child;L!==null;)b|=L.lanes|L.childLanes,T|=L.subtreeFlags&14680064,T|=L.flags&14680064,L.return=l,L=L.sibling;else for(L=l.child;L!==null;)b|=L.lanes|L.childLanes,T|=L.subtreeFlags,T|=L.flags,L.return=l,L=L.sibling;return l.subtreeFlags|=T,l.childLanes=b,h}function _f(l,h,b){var T=h.pendingProps;switch(rl(h),h.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return jn(h),null;case 1:return Xn(h.type)&&Xo(),jn(h),null;case 3:return T=h.stateNode,Os(),tn(Kn),tn(Hn),ml(),T.pendingContext&&(T.context=T.pendingContext,T.pendingContext=null),(l===null||l.child===null)&&(na(h)?h.flags|=4:l===null||l.memoizedState.isDehydrated&&(h.flags&256)===0||(h.flags|=1024,_r!==null&&(ql(_r),_r=null))),Dl(l,h),jn(h),null;case 5:pl(h);var L=ns(wo.current);if(b=h.type,l!==null&&h.stateNode!=null)bu(l,h,b,T,L),l.ref!==h.ref&&(h.flags|=512,h.flags|=2097152);else{if(!T){if(h.stateNode===null)throw Error(e(166));return jn(h),null}if(l=ns(Lr.current),na(h)){T=h.stateNode,b=h.type;var q=h.memoizedProps;switch(T[Or]=h,T[ho]=q,l=(h.mode&1)!==0,b){case"dialog":en("cancel",T),en("close",T);break;case"iframe":case"object":case"embed":en("load",T);break;case"video":case"audio":for(L=0;L<co.length;L++)en(co[L],T);break;case"source":en("error",T);break;case"img":case"image":case"link":en("error",T),en("load",T);break;case"details":en("toggle",T);break;case"input":Ze(T,q),en("invalid",T);break;case"select":T._wrapperState={wasMultiple:!!q.multiple},en("invalid",T);break;case"textarea":$t(T,q),en("invalid",T)}ft(b,q),L=null;for(var ue in q)if(q.hasOwnProperty(ue)){var ve=q[ue];ue==="children"?typeof ve=="string"?T.textContent!==ve&&(q.suppressHydrationWarning!==!0&&Yo(T.textContent,ve,l),L=["children",ve]):typeof ve=="number"&&T.textContent!==""+ve&&(q.suppressHydrationWarning!==!0&&Yo(T.textContent,ve,l),L=["children",""+ve]):a.hasOwnProperty(ue)&&ve!=null&&ue==="onScroll"&&en("scroll",T)}switch(b){case"input":Ue(T),nt(T,q,!0);break;case"textarea":Ue(T),Dt(T);break;case"select":case"option":break;default:typeof q.onClick=="function"&&(T.onclick=Qo)}T=L,h.updateQueue=T,T!==null&&(h.flags|=4)}else{ue=L.nodeType===9?L:L.ownerDocument,l==="http://www.w3.org/1999/xhtml"&&(l=Lt(b)),l==="http://www.w3.org/1999/xhtml"?b==="script"?(l=ue.createElement("div"),l.innerHTML="<script><\/script>",l=l.removeChild(l.firstChild)):typeof T.is=="string"?l=ue.createElement(b,{is:T.is}):(l=ue.createElement(b),b==="select"&&(ue=l,T.multiple?ue.multiple=!0:T.size&&(ue.size=T.size))):l=ue.createElementNS(l,b),l[Or]=h,l[ho]=T,vu(l,h,!1,!1),h.stateNode=l;e:{switch(ue=gt(b,T),b){case"dialog":en("cancel",l),en("close",l),L=T;break;case"iframe":case"object":case"embed":en("load",l),L=T;break;case"video":case"audio":for(L=0;L<co.length;L++)en(co[L],l);L=T;break;case"source":en("error",l),L=T;break;case"img":case"image":case"link":en("error",l),en("load",l),L=T;break;case"details":en("toggle",l),L=T;break;case"input":Ze(l,T),L=We(l,T),en("invalid",l);break;case"option":L=T;break;case"select":l._wrapperState={wasMultiple:!!T.multiple},L=re({},T,{value:void 0}),en("invalid",l);break;case"textarea":$t(l,T),L=Et(l,T),en("invalid",l);break;default:L=T}ft(b,L),ve=L;for(q in ve)if(ve.hasOwnProperty(q)){var _e=ve[q];q==="style"?Ve(l,_e):q==="dangerouslySetInnerHTML"?(_e=_e?_e.__html:void 0,_e!=null&&Y(l,_e)):q==="children"?typeof _e=="string"?(b!=="textarea"||_e!=="")&&ye(l,_e):typeof _e=="number"&&ye(l,""+_e):q!=="suppressContentEditableWarning"&&q!=="suppressHydrationWarning"&&q!=="autoFocus"&&(a.hasOwnProperty(q)?_e!=null&&q==="onScroll"&&en("scroll",l):_e!=null&&M(l,q,_e,ue))}switch(b){case"input":Ue(l),nt(l,T,!1);break;case"textarea":Ue(l),Dt(l);break;case"option":T.value!=null&&l.setAttribute("value",""+be(T.value));break;case"select":l.multiple=!!T.multiple,q=T.value,q!=null?qe(l,!!T.multiple,q,!1):T.defaultValue!=null&&qe(l,!!T.multiple,T.defaultValue,!0);break;default:typeof L.onClick=="function"&&(l.onclick=Qo)}switch(b){case"button":case"input":case"select":case"textarea":T=!!T.autoFocus;break e;case"img":T=!0;break e;default:T=!1}}T&&(h.flags|=4)}h.ref!==null&&(h.flags|=512,h.flags|=2097152)}return jn(h),null;case 6:if(l&&h.stateNode!=null)Su(l,h,l.memoizedProps,T);else{if(typeof T!="string"&&h.stateNode===null)throw Error(e(166));if(b=ns(wo.current),ns(Lr.current),na(h)){if(T=h.stateNode,b=h.memoizedProps,T[Or]=h,(q=T.nodeValue!==b)&&(l=lr,l!==null))switch(l.tag){case 3:Yo(T.nodeValue,b,(l.mode&1)!==0);break;case 5:l.memoizedProps.suppressHydrationWarning!==!0&&Yo(T.nodeValue,b,(l.mode&1)!==0)}q&&(h.flags|=4)}else T=(b.nodeType===9?b:b.ownerDocument).createTextNode(T),T[Or]=h,h.stateNode=T}return jn(h),null;case 13:if(tn(on),T=h.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(rn&&cr!==null&&(h.mode&1)!==0&&(h.flags&128)===0)_c(),Ms(),h.flags|=98560,q=!1;else if(q=na(h),T!==null&&T.dehydrated!==null){if(l===null){if(!q)throw Error(e(318));if(q=h.memoizedState,q=q!==null?q.dehydrated:null,!q)throw Error(e(317));q[Or]=h}else Ms(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;jn(h),q=!1}else _r!==null&&(ql(_r),_r=null),q=!0;if(!q)return h.flags&65536?h:null}return(h.flags&128)!==0?(h.lanes=b,h):(T=T!==null,T!==(l!==null&&l.memoizedState!==null)&&T&&(h.child.flags|=8192,(h.mode&1)!==0&&(l===null||(on.current&1)!==0?An===0&&(An=3):Ql())),h.updateQueue!==null&&(h.flags|=4),jn(h),null);case 4:return Os(),Dl(l,h),l===null&&uo(h.stateNode.containerInfo),jn(h),null;case 10:return cl(h.type._context),jn(h),null;case 17:return Xn(h.type)&&Xo(),jn(h),null;case 19:if(tn(on),q=h.memoizedState,q===null)return jn(h),null;if(T=(h.flags&128)!==0,ue=q.rendering,ue===null)if(T)So(q,!1);else{if(An!==0||l!==null&&(l.flags&128)!==0)for(l=h.child;l!==null;){if(ue=la(l),ue!==null){for(h.flags|=128,So(q,!1),T=ue.updateQueue,T!==null&&(h.updateQueue=T,h.flags|=4),h.subtreeFlags=0,T=b,b=h.child;b!==null;)q=b,l=T,q.flags&=14680066,ue=q.alternate,ue===null?(q.childLanes=0,q.lanes=l,q.child=null,q.subtreeFlags=0,q.memoizedProps=null,q.memoizedState=null,q.updateQueue=null,q.dependencies=null,q.stateNode=null):(q.childLanes=ue.childLanes,q.lanes=ue.lanes,q.child=ue.child,q.subtreeFlags=0,q.deletions=null,q.memoizedProps=ue.memoizedProps,q.memoizedState=ue.memoizedState,q.updateQueue=ue.updateQueue,q.type=ue.type,l=ue.dependencies,q.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),b=b.sibling;return Jt(on,on.current&1|2),h.child}l=l.sibling}q.tail!==null&&zt()>Hs&&(h.flags|=128,T=!0,So(q,!1),h.lanes=4194304)}else{if(!T)if(l=la(ue),l!==null){if(h.flags|=128,T=!0,b=l.updateQueue,b!==null&&(h.updateQueue=b,h.flags|=4),So(q,!0),q.tail===null&&q.tailMode==="hidden"&&!ue.alternate&&!rn)return jn(h),null}else 2*zt()-q.renderingStartTime>Hs&&b!==1073741824&&(h.flags|=128,T=!0,So(q,!1),h.lanes=4194304);q.isBackwards?(ue.sibling=h.child,h.child=ue):(b=q.last,b!==null?b.sibling=ue:h.child=ue,q.last=ue)}return q.tail!==null?(h=q.tail,q.rendering=h,q.tail=h.sibling,q.renderingStartTime=zt(),h.sibling=null,b=on.current,Jt(on,T?b&1|2:b&1),h):(jn(h),null);case 22:case 23:return Yl(),T=h.memoizedState!==null,l!==null&&l.memoizedState!==null!==T&&(h.flags|=8192),T&&(h.mode&1)!==0?(ur&1073741824)!==0&&(jn(h),h.subtreeFlags&6&&(h.flags|=8192)):jn(h),null;case 24:return null;case 25:return null}throw Error(e(156,h.tag))}function If(l,h){switch(rl(h),h.tag){case 1:return Xn(h.type)&&Xo(),l=h.flags,l&65536?(h.flags=l&-65537|128,h):null;case 3:return Os(),tn(Kn),tn(Hn),ml(),l=h.flags,(l&65536)!==0&&(l&128)===0?(h.flags=l&-65537|128,h):null;case 5:return pl(h),null;case 13:if(tn(on),l=h.memoizedState,l!==null&&l.dehydrated!==null){if(h.alternate===null)throw Error(e(340));Ms()}return l=h.flags,l&65536?(h.flags=l&-65537|128,h):null;case 19:return tn(on),null;case 4:return Os(),null;case 10:return cl(h.type._context),null;case 22:case 23:return Yl(),null;case 24:return null;default:return null}}var ya=!1,Vn=!1,Tf=typeof WeakSet=="function"?WeakSet:Set,at=null;function Us(l,h){var b=l.ref;if(b!==null)if(typeof b=="function")try{b(null)}catch(T){un(l,h,T)}else b.current=null}function Ol(l,h,b){try{b()}catch(T){un(l,h,T)}}var Au=!1;function Rf(l,h){if(Ya=Pr,l=Nt(),Ct(l)){if("selectionStart"in l)var b={start:l.selectionStart,end:l.selectionEnd};else e:{b=(b=l.ownerDocument)&&b.defaultView||window;var T=b.getSelection&&b.getSelection();if(T&&T.rangeCount!==0){b=T.anchorNode;var L=T.anchorOffset,q=T.focusNode;T=T.focusOffset;try{b.nodeType,q.nodeType}catch{b=null;break e}var ue=0,ve=-1,_e=-1,$e=0,Qe=0,Ke=l,Ge=null;t:for(;;){for(var it;Ke!==b||L!==0&&Ke.nodeType!==3||(ve=ue+L),Ke!==q||T!==0&&Ke.nodeType!==3||(_e=ue+T),Ke.nodeType===3&&(ue+=Ke.nodeValue.length),(it=Ke.firstChild)!==null;)Ge=Ke,Ke=it;for(;;){if(Ke===l)break t;if(Ge===b&&++$e===L&&(ve=ue),Ge===q&&++Qe===T&&(_e=ue),(it=Ke.nextSibling)!==null)break;Ke=Ge,Ge=Ke.parentNode}Ke=it}b=ve===-1||_e===-1?null:{start:ve,end:_e}}else b=null}b=b||{start:0,end:0}}else b=null;for(Qa={focusedElem:l,selectionRange:b},Pr=!1,at=h;at!==null;)if(h=at,l=h.child,(h.subtreeFlags&1028)!==0&&l!==null)l.return=h,at=l;else for(;at!==null;){h=at;try{var lt=h.alternate;if((h.flags&1024)!==0)switch(h.tag){case 0:case 11:case 15:break;case 1:if(lt!==null){var ct=lt.memoizedProps,gn=lt.memoizedState,ke=h.stateNode,Te=ke.getSnapshotBeforeUpdate(h.elementType===h.type?ct:Ir(h.type,ct),gn);ke.__reactInternalSnapshotBeforeUpdate=Te}break;case 3:var De=h.stateNode.containerInfo;De.nodeType===1?De.textContent="":De.nodeType===9&&De.documentElement&&De.removeChild(De.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(e(163))}}catch(et){un(h,h.return,et)}if(l=h.sibling,l!==null){l.return=h.return,at=l;break}at=h.return}return lt=Au,Au=!1,lt}function Ao(l,h,b){var T=h.updateQueue;if(T=T!==null?T.lastEffect:null,T!==null){var L=T=T.next;do{if((L.tag&l)===l){var q=L.destroy;L.destroy=void 0,q!==void 0&&Ol(h,b,q)}L=L.next}while(L!==T)}}function wa(l,h){if(h=h.updateQueue,h=h!==null?h.lastEffect:null,h!==null){var b=h=h.next;do{if((b.tag&l)===l){var T=b.create;b.destroy=T()}b=b.next}while(b!==h)}}function Ll(l){var h=l.ref;if(h!==null){var b=l.stateNode;switch(l.tag){case 5:l=b;break;default:l=b}typeof h=="function"?h(l):h.current=l}}function Cu(l){var h=l.alternate;h!==null&&(l.alternate=null,Cu(h)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(h=l.stateNode,h!==null&&(delete h[Or],delete h[ho],delete h[Ja],delete h[ff],delete h[df])),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}function _u(l){return l.tag===5||l.tag===3||l.tag===4}function Iu(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||_u(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==18;){if(l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function Ul(l,h,b){var T=l.tag;if(T===5||T===6)l=l.stateNode,h?b.nodeType===8?b.parentNode.insertBefore(l,h):b.insertBefore(l,h):(b.nodeType===8?(h=b.parentNode,h.insertBefore(l,b)):(h=b,h.appendChild(l)),b=b._reactRootContainer,b!=null||h.onclick!==null||(h.onclick=Qo));else if(T!==4&&(l=l.child,l!==null))for(Ul(l,h,b),l=l.sibling;l!==null;)Ul(l,h,b),l=l.sibling}function Fl(l,h,b){var T=l.tag;if(T===5||T===6)l=l.stateNode,h?b.insertBefore(l,h):b.appendChild(l);else if(T!==4&&(l=l.child,l!==null))for(Fl(l,h,b),l=l.sibling;l!==null;)Fl(l,h,b),l=l.sibling}var Pn=null,Tr=!1;function xi(l,h,b){for(b=b.child;b!==null;)Tu(l,h,b),b=b.sibling}function Tu(l,h,b){if(It&&typeof It.onCommitFiberUnmount=="function")try{It.onCommitFiberUnmount(Ot,b)}catch{}switch(b.tag){case 5:Vn||Us(b,h);case 6:var T=Pn,L=Tr;Pn=null,xi(l,h,b),Pn=T,Tr=L,Pn!==null&&(Tr?(l=Pn,b=b.stateNode,l.nodeType===8?l.parentNode.removeChild(b):l.removeChild(b)):Pn.removeChild(b.stateNode));break;case 18:Pn!==null&&(Tr?(l=Pn,b=b.stateNode,l.nodeType===8?Za(l.parentNode,b):l.nodeType===1&&Za(l,b),Sr(l)):Za(Pn,b.stateNode));break;case 4:T=Pn,L=Tr,Pn=b.stateNode.containerInfo,Tr=!0,xi(l,h,b),Pn=T,Tr=L;break;case 0:case 11:case 14:case 15:if(!Vn&&(T=b.updateQueue,T!==null&&(T=T.lastEffect,T!==null))){L=T=T.next;do{var q=L,ue=q.destroy;q=q.tag,ue!==void 0&&((q&2)!==0||(q&4)!==0)&&Ol(b,h,ue),L=L.next}while(L!==T)}xi(l,h,b);break;case 1:if(!Vn&&(Us(b,h),T=b.stateNode,typeof T.componentWillUnmount=="function"))try{T.props=b.memoizedProps,T.state=b.memoizedState,T.componentWillUnmount()}catch(ve){un(b,h,ve)}xi(l,h,b);break;case 21:xi(l,h,b);break;case 22:b.mode&1?(Vn=(T=Vn)||b.memoizedState!==null,xi(l,h,b),Vn=T):xi(l,h,b);break;default:xi(l,h,b)}}function Ru(l){var h=l.updateQueue;if(h!==null){l.updateQueue=null;var b=l.stateNode;b===null&&(b=l.stateNode=new Tf),h.forEach(function(T){var L=Uf.bind(null,l,T);b.has(T)||(b.add(T),T.then(L,L))})}}function Rr(l,h){var b=h.deletions;if(b!==null)for(var T=0;T<b.length;T++){var L=b[T];try{var q=l,ue=h,ve=ue;e:for(;ve!==null;){switch(ve.tag){case 5:Pn=ve.stateNode,Tr=!1;break e;case 3:Pn=ve.stateNode.containerInfo,Tr=!0;break e;case 4:Pn=ve.stateNode.containerInfo,Tr=!0;break e}ve=ve.return}if(Pn===null)throw Error(e(160));Tu(q,ue,L),Pn=null,Tr=!1;var _e=L.alternate;_e!==null&&(_e.return=null),L.return=null}catch($e){un(L,h,$e)}}if(h.subtreeFlags&12854)for(h=h.child;h!==null;)Nu(h,l),h=h.sibling}function Nu(l,h){var b=l.alternate,T=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:if(Rr(h,l),Fr(l),T&4){try{Ao(3,l,l.return),wa(3,l)}catch(ct){un(l,l.return,ct)}try{Ao(5,l,l.return)}catch(ct){un(l,l.return,ct)}}break;case 1:Rr(h,l),Fr(l),T&512&&b!==null&&Us(b,b.return);break;case 5:if(Rr(h,l),Fr(l),T&512&&b!==null&&Us(b,b.return),l.flags&32){var L=l.stateNode;try{ye(L,"")}catch(ct){un(l,l.return,ct)}}if(T&4&&(L=l.stateNode,L!=null)){var q=l.memoizedProps,ue=b!==null?b.memoizedProps:q,ve=l.type,_e=l.updateQueue;if(l.updateQueue=null,_e!==null)try{ve==="input"&&q.type==="radio"&&q.name!=null&&ot(L,q),gt(ve,ue);var $e=gt(ve,q);for(ue=0;ue<_e.length;ue+=2){var Qe=_e[ue],Ke=_e[ue+1];Qe==="style"?Ve(L,Ke):Qe==="dangerouslySetInnerHTML"?Y(L,Ke):Qe==="children"?ye(L,Ke):M(L,Qe,Ke,$e)}switch(ve){case"input":st(L,q);break;case"textarea":Vt(L,q);break;case"select":var Ge=L._wrapperState.wasMultiple;L._wrapperState.wasMultiple=!!q.multiple;var it=q.value;it!=null?qe(L,!!q.multiple,it,!1):Ge!==!!q.multiple&&(q.defaultValue!=null?qe(L,!!q.multiple,q.defaultValue,!0):qe(L,!!q.multiple,q.multiple?[]:"",!1))}L[ho]=q}catch(ct){un(l,l.return,ct)}}break;case 6:if(Rr(h,l),Fr(l),T&4){if(l.stateNode===null)throw Error(e(162));L=l.stateNode,q=l.memoizedProps;try{L.nodeValue=q}catch(ct){un(l,l.return,ct)}}break;case 3:if(Rr(h,l),Fr(l),T&4&&b!==null&&b.memoizedState.isDehydrated)try{Sr(h.containerInfo)}catch(ct){un(l,l.return,ct)}break;case 4:Rr(h,l),Fr(l);break;case 13:Rr(h,l),Fr(l),L=l.child,L.flags&8192&&(q=L.memoizedState!==null,L.stateNode.isHidden=q,!q||L.alternate!==null&&L.alternate.memoizedState!==null||(jl=zt())),T&4&&Ru(l);break;case 22:if(Qe=b!==null&&b.memoizedState!==null,l.mode&1?(Vn=($e=Vn)||Qe,Rr(h,l),Vn=$e):Rr(h,l),Fr(l),T&8192){if($e=l.memoizedState!==null,(l.stateNode.isHidden=$e)&&!Qe&&(l.mode&1)!==0)for(at=l,Qe=l.child;Qe!==null;){for(Ke=at=Qe;at!==null;){switch(Ge=at,it=Ge.child,Ge.tag){case 0:case 11:case 14:case 15:Ao(4,Ge,Ge.return);break;case 1:Us(Ge,Ge.return);var lt=Ge.stateNode;if(typeof lt.componentWillUnmount=="function"){T=Ge,b=Ge.return;try{h=T,lt.props=h.memoizedProps,lt.state=h.memoizedState,lt.componentWillUnmount()}catch(ct){un(T,b,ct)}}break;case 5:Us(Ge,Ge.return);break;case 22:if(Ge.memoizedState!==null){Bu(Ke);continue}}it!==null?(it.return=Ge,at=it):Bu(Ke)}Qe=Qe.sibling}e:for(Qe=null,Ke=l;;){if(Ke.tag===5){if(Qe===null){Qe=Ke;try{L=Ke.stateNode,$e?(q=L.style,typeof q.setProperty=="function"?q.setProperty("display","none","important"):q.display="none"):(ve=Ke.stateNode,_e=Ke.memoizedProps.style,ue=_e!=null&&_e.hasOwnProperty("display")?_e.display:null,ve.style.display=Le("display",ue))}catch(ct){un(l,l.return,ct)}}}else if(Ke.tag===6){if(Qe===null)try{Ke.stateNode.nodeValue=$e?"":Ke.memoizedProps}catch(ct){un(l,l.return,ct)}}else if((Ke.tag!==22&&Ke.tag!==23||Ke.memoizedState===null||Ke===l)&&Ke.child!==null){Ke.child.return=Ke,Ke=Ke.child;continue}if(Ke===l)break e;for(;Ke.sibling===null;){if(Ke.return===null||Ke.return===l)break e;Qe===Ke&&(Qe=null),Ke=Ke.return}Qe===Ke&&(Qe=null),Ke.sibling.return=Ke.return,Ke=Ke.sibling}}break;case 19:Rr(h,l),Fr(l),T&4&&Ru(l);break;case 21:break;default:Rr(h,l),Fr(l)}}function Fr(l){var h=l.flags;if(h&2){try{e:{for(var b=l.return;b!==null;){if(_u(b)){var T=b;break e}b=b.return}throw Error(e(160))}switch(T.tag){case 5:var L=T.stateNode;T.flags&32&&(ye(L,""),T.flags&=-33);var q=Iu(l);Fl(l,q,L);break;case 3:case 4:var ue=T.stateNode.containerInfo,ve=Iu(l);Ul(l,ve,ue);break;default:throw Error(e(161))}}catch(_e){un(l,l.return,_e)}l.flags&=-3}h&4096&&(l.flags&=-4097)}function Nf(l,h,b){at=l,ku(l)}function ku(l,h,b){for(var T=(l.mode&1)!==0;at!==null;){var L=at,q=L.child;if(L.tag===22&&T){var ue=L.memoizedState!==null||ya;if(!ue){var ve=L.alternate,_e=ve!==null&&ve.memoizedState!==null||Vn;ve=ya;var $e=Vn;if(ya=ue,(Vn=_e)&&!$e)for(at=L;at!==null;)ue=at,_e=ue.child,ue.tag===22&&ue.memoizedState!==null?Pu(L):_e!==null?(_e.return=ue,at=_e):Pu(L);for(;q!==null;)at=q,ku(q),q=q.sibling;at=L,ya=ve,Vn=$e}Mu(l)}else(L.subtreeFlags&8772)!==0&&q!==null?(q.return=L,at=q):Mu(l)}}function Mu(l){for(;at!==null;){var h=at;if((h.flags&8772)!==0){var b=h.alternate;try{if((h.flags&8772)!==0)switch(h.tag){case 0:case 11:case 15:Vn||wa(5,h);break;case 1:var T=h.stateNode;if(h.flags&4&&!Vn)if(b===null)T.componentDidMount();else{var L=h.elementType===h.type?b.memoizedProps:Ir(h.type,b.memoizedProps);T.componentDidUpdate(L,b.memoizedState,T.__reactInternalSnapshotBeforeUpdate)}var q=h.updateQueue;q!==null&&Bc(h,q,T);break;case 3:var ue=h.updateQueue;if(ue!==null){if(b=null,h.child!==null)switch(h.child.tag){case 5:b=h.child.stateNode;break;case 1:b=h.child.stateNode}Bc(h,ue,b)}break;case 5:var ve=h.stateNode;if(b===null&&h.flags&4){b=ve;var _e=h.memoizedProps;switch(h.type){case"button":case"input":case"select":case"textarea":_e.autoFocus&&b.focus();break;case"img":_e.src&&(b.src=_e.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(h.memoizedState===null){var $e=h.alternate;if($e!==null){var Qe=$e.memoizedState;if(Qe!==null){var Ke=Qe.dehydrated;Ke!==null&&Sr(Ke)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(e(163))}Vn||h.flags&512&&Ll(h)}catch(Ge){un(h,h.return,Ge)}}if(h===l){at=null;break}if(b=h.sibling,b!==null){b.return=h.return,at=b;break}at=h.return}}function Bu(l){for(;at!==null;){var h=at;if(h===l){at=null;break}var b=h.sibling;if(b!==null){b.return=h.return,at=b;break}at=h.return}}function Pu(l){for(;at!==null;){var h=at;try{switch(h.tag){case 0:case 11:case 15:var b=h.return;try{wa(4,h)}catch(_e){un(h,b,_e)}break;case 1:var T=h.stateNode;if(typeof T.componentDidMount=="function"){var L=h.return;try{T.componentDidMount()}catch(_e){un(h,L,_e)}}var q=h.return;try{Ll(h)}catch(_e){un(h,q,_e)}break;case 5:var ue=h.return;try{Ll(h)}catch(_e){un(h,ue,_e)}}}catch(_e){un(h,h.return,_e)}if(h===l){at=null;break}var ve=h.sibling;if(ve!==null){ve.return=h.return,at=ve;break}at=h.return}}var kf=Math.ceil,xa=W.ReactCurrentDispatcher,Hl=W.ReactCurrentOwner,Er=W.ReactCurrentBatchConfig,Ft=0,Tn=null,yn=null,Dn=0,ur=0,Fs=pi(0),An=0,Co=null,is=0,Ea=0,$l=0,_o=null,Jn=null,jl=0,Hs=1/0,Zr=null,va=!1,Vl=null,Ei=null,ba=!1,vi=null,Sa=0,Io=0,zl=null,Aa=-1,Ca=0;function qn(){return(Ft&6)!==0?zt():Aa!==-1?Aa:Aa=zt()}function bi(l){return(l.mode&1)===0?1:(Ft&2)!==0&&Dn!==0?Dn&-Dn:pf.transition!==null?(Ca===0&&(Ca=xn()),Ca):(l=Tt,l!==0||(l=window.event,l=l===void 0?16:Js(l.type)),l)}function Nr(l,h,b,T){if(50<Io)throw Io=0,zl=null,Error(e(185));we(l,b,T),((Ft&2)===0||l!==Tn)&&(l===Tn&&((Ft&2)===0&&(Ea|=b),An===4&&Si(l,Dn)),er(l,T),b===1&&Ft===0&&(h.mode&1)===0&&(Hs=zt()+500,Jo&&mi()))}function er(l,h){var b=l.callbackNode;ri(l,h);var T=ir(l,l===Tn?Dn:0);if(T===0)b!==null&&Cn(b),l.callbackNode=null,l.callbackPriority=0;else if(h=T&-T,l.callbackPriority!==h){if(b!=null&&Cn(b),h===1)l.tag===0?hf(Ou.bind(null,l)):vc(Ou.bind(null,l)),cf(function(){(Ft&6)===0&&mi()}),b=null;else{switch(Po(T)){case 1:b=ze;break;case 4:b=Mo;break;case 16:b=Yt;break;case 536870912:b=Bo;break;default:b=Yt}b=zu(b,Du.bind(null,l))}l.callbackPriority=h,l.callbackNode=b}}function Du(l,h){if(Aa=-1,Ca=0,(Ft&6)!==0)throw Error(e(327));var b=l.callbackNode;if($s()&&l.callbackNode!==b)return null;var T=ir(l,l===Tn?Dn:0);if(T===0)return null;if((T&30)!==0||(T&l.expiredLanes)!==0||h)h=Ia(l,T);else{h=T;var L=Ft;Ft|=2;var q=Uu();(Tn!==l||Dn!==h)&&(Zr=null,Hs=zt()+500,os(l,h));do try{Pf();break}catch(ve){Lu(l,ve)}while(!0);ll(),xa.current=q,Ft=L,yn!==null?h=0:(Tn=null,Dn=0,h=An)}if(h!==0){if(h===2&&(L=Wt(l),L!==0&&(T=L,h=Wl(l,L))),h===1)throw b=Co,os(l,0),Si(l,T),er(l,zt()),b;if(h===6)Si(l,T);else{if(L=l.current.alternate,(T&30)===0&&!Mf(L)&&(h=Ia(l,T),h===2&&(q=Wt(l),q!==0&&(T=q,h=Wl(l,q))),h===1))throw b=Co,os(l,0),Si(l,T),er(l,zt()),b;switch(l.finishedWork=L,l.finishedLanes=T,h){case 0:case 1:throw Error(e(345));case 2:as(l,Jn,Zr);break;case 3:if(Si(l,T),(T&130023424)===T&&(h=jl+500-zt(),10<h)){if(ir(l,0)!==0)break;if(L=l.suspendedLanes,(L&T)!==T){qn(),l.pingedLanes|=l.suspendedLanes&L;break}l.timeoutHandle=Xa(as.bind(null,l,Jn,Zr),h);break}as(l,Jn,Zr);break;case 4:if(Si(l,T),(T&4194240)===T)break;for(h=l.eventTimes,L=-1;0<T;){var ue=31-zn(T);q=1<<ue,ue=h[ue],ue>L&&(L=ue),T&=~q}if(T=L,T=zt()-T,T=(120>T?120:480>T?480:1080>T?1080:1920>T?1920:3e3>T?3e3:4320>T?4320:1960*kf(T/1960))-T,10<T){l.timeoutHandle=Xa(as.bind(null,l,Jn,Zr),T);break}as(l,Jn,Zr);break;case 5:as(l,Jn,Zr);break;default:throw Error(e(329))}}}return er(l,zt()),l.callbackNode===b?Du.bind(null,l):null}function Wl(l,h){var b=_o;return l.current.memoizedState.isDehydrated&&(os(l,h).flags|=256),l=Ia(l,h),l!==2&&(h=Jn,Jn=b,h!==null&&ql(h)),l}function ql(l){Jn===null?Jn=l:Jn.push.apply(Jn,l)}function Mf(l){for(var h=l;;){if(h.flags&16384){var b=h.updateQueue;if(b!==null&&(b=b.stores,b!==null))for(var T=0;T<b.length;T++){var L=b[T],q=L.getSnapshot;L=L.value;try{if(!Re(q(),L))return!1}catch{return!1}}}if(b=h.child,h.subtreeFlags&16384&&b!==null)b.return=h,h=b;else{if(h===l)break;for(;h.sibling===null;){if(h.return===null||h.return===l)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function Si(l,h){for(h&=~$l,h&=~Ea,l.suspendedLanes|=h,l.pingedLanes&=~h,l=l.expirationTimes;0<h;){var b=31-zn(h),T=1<<b;l[b]=-1,h&=~T}}function Ou(l){if((Ft&6)!==0)throw Error(e(327));$s();var h=ir(l,0);if((h&1)===0)return er(l,zt()),null;var b=Ia(l,h);if(l.tag!==0&&b===2){var T=Wt(l);T!==0&&(h=T,b=Wl(l,T))}if(b===1)throw b=Co,os(l,0),Si(l,h),er(l,zt()),b;if(b===6)throw Error(e(345));return l.finishedWork=l.current.alternate,l.finishedLanes=h,as(l,Jn,Zr),er(l,zt()),null}function Gl(l,h){var b=Ft;Ft|=1;try{return l(h)}finally{Ft=b,Ft===0&&(Hs=zt()+500,Jo&&mi())}}function ss(l){vi!==null&&vi.tag===0&&(Ft&6)===0&&$s();var h=Ft;Ft|=1;var b=Er.transition,T=Tt;try{if(Er.transition=null,Tt=1,l)return l()}finally{Tt=T,Er.transition=b,Ft=h,(Ft&6)===0&&mi()}}function Yl(){ur=Fs.current,tn(Fs)}function os(l,h){l.finishedWork=null,l.finishedLanes=0;var b=l.timeoutHandle;if(b!==-1&&(l.timeoutHandle=-1,lf(b)),yn!==null)for(b=yn.return;b!==null;){var T=b;switch(rl(T),T.tag){case 1:T=T.type.childContextTypes,T!=null&&Xo();break;case 3:Os(),tn(Kn),tn(Hn),ml();break;case 5:pl(T);break;case 4:Os();break;case 13:tn(on);break;case 19:tn(on);break;case 10:cl(T.type._context);break;case 22:case 23:Yl()}b=b.return}if(Tn=l,yn=l=Ai(l.current,null),Dn=ur=h,An=0,Co=null,$l=Ea=is=0,Jn=_o=null,ts!==null){for(h=0;h<ts.length;h++)if(b=ts[h],T=b.interleaved,T!==null){b.interleaved=null;var L=T.next,q=b.pending;if(q!==null){var ue=q.next;q.next=L,T.next=ue}b.pending=T}ts=null}return l}function Lu(l,h){do{var b=yn;try{if(ll(),ca.current=ha,ua){for(var T=an.memoizedState;T!==null;){var L=T.queue;L!==null&&(L.pending=null),T=T.next}ua=!1}if(rs=0,In=Sn=an=null,xo=!1,Eo=0,Hl.current=null,b===null||b.return===null){An=1,Co=h,yn=null;break}e:{var q=l,ue=b.return,ve=b,_e=h;if(h=Dn,ve.flags|=32768,_e!==null&&typeof _e=="object"&&typeof _e.then=="function"){var $e=_e,Qe=ve,Ke=Qe.tag;if((Qe.mode&1)===0&&(Ke===0||Ke===11||Ke===15)){var Ge=Qe.alternate;Ge?(Qe.updateQueue=Ge.updateQueue,Qe.memoizedState=Ge.memoizedState,Qe.lanes=Ge.lanes):(Qe.updateQueue=null,Qe.memoizedState=null)}var it=lu(ue);if(it!==null){it.flags&=-257,cu(it,ue,ve,q,h),it.mode&1&&au(q,$e,h),h=it,_e=$e;var lt=h.updateQueue;if(lt===null){var ct=new Set;ct.add(_e),h.updateQueue=ct}else lt.add(_e);break e}else{if((h&1)===0){au(q,$e,h),Ql();break e}_e=Error(e(426))}}else if(rn&&ve.mode&1){var gn=lu(ue);if(gn!==null){(gn.flags&65536)===0&&(gn.flags|=256),cu(gn,ue,ve,q,h),ol(Ls(_e,ve));break e}}q=_e=Ls(_e,ve),An!==4&&(An=2),_o===null?_o=[q]:_o.push(q),q=ue;do{switch(q.tag){case 3:q.flags|=65536,h&=-h,q.lanes|=h;var ke=su(q,_e,h);Mc(q,ke);break e;case 1:ve=_e;var Te=q.type,De=q.stateNode;if((q.flags&128)===0&&(typeof Te.getDerivedStateFromError=="function"||De!==null&&typeof De.componentDidCatch=="function"&&(Ei===null||!Ei.has(De)))){q.flags|=65536,h&=-h,q.lanes|=h;var et=ou(q,ve,h);Mc(q,et);break e}}q=q.return}while(q!==null)}Hu(b)}catch(dt){h=dt,yn===b&&b!==null&&(yn=b=b.return);continue}break}while(!0)}function Uu(){var l=xa.current;return xa.current=ha,l===null?ha:l}function Ql(){(An===0||An===3||An===2)&&(An=4),Tn===null||(is&268435455)===0&&(Ea&268435455)===0||Si(Tn,Dn)}function Ia(l,h){var b=Ft;Ft|=2;var T=Uu();(Tn!==l||Dn!==h)&&(Zr=null,os(l,h));do try{Bf();break}catch(L){Lu(l,L)}while(!0);if(ll(),Ft=b,xa.current=T,yn!==null)throw Error(e(261));return Tn=null,Dn=0,An}function Bf(){for(;yn!==null;)Fu(yn)}function Pf(){for(;yn!==null&&!Kt();)Fu(yn)}function Fu(l){var h=Vu(l.alternate,l,ur);l.memoizedProps=l.pendingProps,h===null?Hu(l):yn=h,Hl.current=null}function Hu(l){var h=l;do{var b=h.alternate;if(l=h.return,(h.flags&32768)===0){if(b=_f(b,h,ur),b!==null){yn=b;return}}else{if(b=If(b,h),b!==null){b.flags&=32767,yn=b;return}if(l!==null)l.flags|=32768,l.subtreeFlags=0,l.deletions=null;else{An=6,yn=null;return}}if(h=h.sibling,h!==null){yn=h;return}yn=h=l}while(h!==null);An===0&&(An=5)}function as(l,h,b){var T=Tt,L=Er.transition;try{Er.transition=null,Tt=1,Df(l,h,b,T)}finally{Er.transition=L,Tt=T}return null}function Df(l,h,b,T){do $s();while(vi!==null);if((Ft&6)!==0)throw Error(e(327));b=l.finishedWork;var L=l.finishedLanes;if(b===null)return null;if(l.finishedWork=null,l.finishedLanes=0,b===l.current)throw Error(e(177));l.callbackNode=null,l.callbackPriority=0;var q=b.lanes|b.childLanes;if(ht(l,q),l===Tn&&(yn=Tn=null,Dn=0),(b.subtreeFlags&2064)===0&&(b.flags&2064)===0||ba||(ba=!0,zu(Yt,function(){return $s(),null})),q=(b.flags&15990)!==0,(b.subtreeFlags&15990)!==0||q){q=Er.transition,Er.transition=null;var ue=Tt;Tt=1;var ve=Ft;Ft|=4,Hl.current=null,Rf(l,b),Nu(b,l),Fn(Qa),Pr=!!Ya,Qa=Ya=null,l.current=b,Nf(b),ko(),Ft=ve,Tt=ue,Er.transition=q}else l.current=b;if(ba&&(ba=!1,vi=l,Sa=L),q=l.pendingLanes,q===0&&(Ei=null),Mt(b.stateNode),er(l,zt()),h!==null)for(T=l.onRecoverableError,b=0;b<h.length;b++)L=h[b],T(L.value,{componentStack:L.stack,digest:L.digest});if(va)throw va=!1,l=Vl,Vl=null,l;return(Sa&1)!==0&&l.tag!==0&&$s(),q=l.pendingLanes,(q&1)!==0?l===zl?Io++:(Io=0,zl=l):Io=0,mi(),null}function $s(){if(vi!==null){var l=Po(Sa),h=Er.transition,b=Tt;try{if(Er.transition=null,Tt=16>l?16:l,vi===null)var T=!1;else{if(l=vi,vi=null,Sa=0,(Ft&6)!==0)throw Error(e(331));var L=Ft;for(Ft|=4,at=l.current;at!==null;){var q=at,ue=q.child;if((at.flags&16)!==0){var ve=q.deletions;if(ve!==null){for(var _e=0;_e<ve.length;_e++){var $e=ve[_e];for(at=$e;at!==null;){var Qe=at;switch(Qe.tag){case 0:case 11:case 15:Ao(8,Qe,q)}var Ke=Qe.child;if(Ke!==null)Ke.return=Qe,at=Ke;else for(;at!==null;){Qe=at;var Ge=Qe.sibling,it=Qe.return;if(Cu(Qe),Qe===$e){at=null;break}if(Ge!==null){Ge.return=it,at=Ge;break}at=it}}}var lt=q.alternate;if(lt!==null){var ct=lt.child;if(ct!==null){lt.child=null;do{var gn=ct.sibling;ct.sibling=null,ct=gn}while(ct!==null)}}at=q}}if((q.subtreeFlags&2064)!==0&&ue!==null)ue.return=q,at=ue;else e:for(;at!==null;){if(q=at,(q.flags&2048)!==0)switch(q.tag){case 0:case 11:case 15:Ao(9,q,q.return)}var ke=q.sibling;if(ke!==null){ke.return=q.return,at=ke;break e}at=q.return}}var Te=l.current;for(at=Te;at!==null;){ue=at;var De=ue.child;if((ue.subtreeFlags&2064)!==0&&De!==null)De.return=ue,at=De;else e:for(ue=Te;at!==null;){if(ve=at,(ve.flags&2048)!==0)try{switch(ve.tag){case 0:case 11:case 15:wa(9,ve)}}catch(dt){un(ve,ve.return,dt)}if(ve===ue){at=null;break e}var et=ve.sibling;if(et!==null){et.return=ve.return,at=et;break e}at=ve.return}}if(Ft=L,mi(),It&&typeof It.onPostCommitFiberRoot=="function")try{It.onPostCommitFiberRoot(Ot,l)}catch{}T=!0}return T}finally{Tt=b,Er.transition=h}}return!1}function $u(l,h,b){h=Ls(b,h),h=su(l,h,1),l=wi(l,h,1),h=qn(),l!==null&&(we(l,1,h),er(l,h))}function un(l,h,b){if(l.tag===3)$u(l,l,b);else for(;h!==null;){if(h.tag===3){$u(h,l,b);break}else if(h.tag===1){var T=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof T.componentDidCatch=="function"&&(Ei===null||!Ei.has(T))){l=Ls(b,l),l=ou(h,l,1),h=wi(h,l,1),l=qn(),h!==null&&(we(h,1,l),er(h,l));break}}h=h.return}}function Of(l,h,b){var T=l.pingCache;T!==null&&T.delete(h),h=qn(),l.pingedLanes|=l.suspendedLanes&b,Tn===l&&(Dn&b)===b&&(An===4||An===3&&(Dn&130023424)===Dn&&500>zt()-jl?os(l,0):$l|=b),er(l,h)}function ju(l,h){h===0&&((l.mode&1)===0?h=1:(h=ys,ys<<=1,(ys&130023424)===0&&(ys=4194304)));var b=qn();l=Qr(l,h),l!==null&&(we(l,h,b),er(l,b))}function Lf(l){var h=l.memoizedState,b=0;h!==null&&(b=h.retryLane),ju(l,b)}function Uf(l,h){var b=0;switch(l.tag){case 13:var T=l.stateNode,L=l.memoizedState;L!==null&&(b=L.retryLane);break;case 19:T=l.stateNode;break;default:throw Error(e(314))}T!==null&&T.delete(h),ju(l,b)}var Vu;Vu=function(l,h,b){if(l!==null)if(l.memoizedProps!==h.pendingProps||Kn.current)Zn=!0;else{if((l.lanes&b)===0&&(h.flags&128)===0)return Zn=!1,Cf(l,h,b);Zn=(l.flags&131072)!==0}else Zn=!1,rn&&(h.flags&1048576)!==0&&bc(h,ta,h.index);switch(h.lanes=0,h.tag){case 2:var T=h.type;ma(l,h),l=h.pendingProps;var L=Rs(h,Hn.current);Ds(h,b),L=xl(null,h,T,l,L,b);var q=El();return h.flags|=1,typeof L=="object"&&L!==null&&typeof L.render=="function"&&L.$$typeof===void 0?(h.tag=1,h.memoizedState=null,h.updateQueue=null,Xn(T)?(q=!0,Zo(h)):q=!1,h.memoizedState=L.state!==null&&L.state!==void 0?L.state:null,dl(h),L.updater=pa,h.stateNode=L,L._reactInternals=h,_l(h,T,l,b),h=Nl(null,h,T,!0,q,b)):(h.tag=0,rn&&q&&nl(h),Wn(null,h,L,b),h=h.child),h;case 16:T=h.elementType;e:{switch(ma(l,h),l=h.pendingProps,L=T._init,T=L(T._payload),h.type=T,L=h.tag=Hf(T),l=Ir(T,l),L){case 0:h=Rl(null,h,T,l,b);break e;case 1:h=gu(null,h,T,l,b);break e;case 11:h=uu(null,h,T,l,b);break e;case 14:h=fu(null,h,T,Ir(T.type,l),b);break e}throw Error(e(306,T,""))}return h;case 0:return T=h.type,L=h.pendingProps,L=h.elementType===T?L:Ir(T,L),Rl(l,h,T,L,b);case 1:return T=h.type,L=h.pendingProps,L=h.elementType===T?L:Ir(T,L),gu(l,h,T,L,b);case 3:e:{if(mu(h),l===null)throw Error(e(387));T=h.pendingProps,q=h.memoizedState,L=q.element,kc(l,h),aa(h,T,null,b);var ue=h.memoizedState;if(T=ue.element,q.isDehydrated)if(q={element:T,isDehydrated:!1,cache:ue.cache,pendingSuspenseBoundaries:ue.pendingSuspenseBoundaries,transitions:ue.transitions},h.updateQueue.baseState=q,h.memoizedState=q,h.flags&256){L=Ls(Error(e(423)),h),h=yu(l,h,T,b,L);break e}else if(T!==L){L=Ls(Error(e(424)),h),h=yu(l,h,T,b,L);break e}else for(cr=hi(h.stateNode.containerInfo.firstChild),lr=h,rn=!0,_r=null,b=Rc(h,null,T,b),h.child=b;b;)b.flags=b.flags&-3|4096,b=b.sibling;else{if(Ms(),T===L){h=Xr(l,h,b);break e}Wn(l,h,T,b)}h=h.child}return h;case 5:return Pc(h),l===null&&sl(h),T=h.type,L=h.pendingProps,q=l!==null?l.memoizedProps:null,ue=L.children,Ka(T,L)?ue=null:q!==null&&Ka(T,q)&&(h.flags|=32),pu(l,h),Wn(l,h,ue,b),h.child;case 6:return l===null&&sl(h),null;case 13:return wu(l,h,b);case 4:return hl(h,h.stateNode.containerInfo),T=h.pendingProps,l===null?h.child=Bs(h,null,T,b):Wn(l,h,T,b),h.child;case 11:return T=h.type,L=h.pendingProps,L=h.elementType===T?L:Ir(T,L),uu(l,h,T,L,b);case 7:return Wn(l,h,h.pendingProps,b),h.child;case 8:return Wn(l,h,h.pendingProps.children,b),h.child;case 12:return Wn(l,h,h.pendingProps.children,b),h.child;case 10:e:{if(T=h.type._context,L=h.pendingProps,q=h.memoizedProps,ue=L.value,Jt(ia,T._currentValue),T._currentValue=ue,q!==null)if(Re(q.value,ue)){if(q.children===L.children&&!Kn.current){h=Xr(l,h,b);break e}}else for(q=h.child,q!==null&&(q.return=h);q!==null;){var ve=q.dependencies;if(ve!==null){ue=q.child;for(var _e=ve.firstContext;_e!==null;){if(_e.context===T){if(q.tag===1){_e=Kr(-1,b&-b),_e.tag=2;var $e=q.updateQueue;if($e!==null){$e=$e.shared;var Qe=$e.pending;Qe===null?_e.next=_e:(_e.next=Qe.next,Qe.next=_e),$e.pending=_e}}q.lanes|=b,_e=q.alternate,_e!==null&&(_e.lanes|=b),ul(q.return,b,h),ve.lanes|=b;break}_e=_e.next}}else if(q.tag===10)ue=q.type===h.type?null:q.child;else if(q.tag===18){if(ue=q.return,ue===null)throw Error(e(341));ue.lanes|=b,ve=ue.alternate,ve!==null&&(ve.lanes|=b),ul(ue,b,h),ue=q.sibling}else ue=q.child;if(ue!==null)ue.return=q;else for(ue=q;ue!==null;){if(ue===h){ue=null;break}if(q=ue.sibling,q!==null){q.return=ue.return,ue=q;break}ue=ue.return}q=ue}Wn(l,h,L.children,b),h=h.child}return h;case 9:return L=h.type,T=h.pendingProps.children,Ds(h,b),L=wr(L),T=T(L),h.flags|=1,Wn(l,h,T,b),h.child;case 14:return T=h.type,L=Ir(T,h.pendingProps),L=Ir(T.type,L),fu(l,h,T,L,b);case 15:return du(l,h,h.type,h.pendingProps,b);case 17:return T=h.type,L=h.pendingProps,L=h.elementType===T?L:Ir(T,L),ma(l,h),h.tag=1,Xn(T)?(l=!0,Zo(h)):l=!1,Ds(h,b),ru(h,T,L),_l(h,T,L,b),Nl(null,h,T,!0,l,b);case 19:return Eu(l,h,b);case 22:return hu(l,h,b)}throw Error(e(156,h.tag))};function zu(l,h){return nr(l,h)}function Ff(l,h,b,T){this.tag=l,this.key=b,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=T,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vr(l,h,b,T){return new Ff(l,h,b,T)}function Kl(l){return l=l.prototype,!(!l||!l.isReactComponent)}function Hf(l){if(typeof l=="function")return Kl(l)?1:0;if(l!=null){if(l=l.$$typeof,l===V)return 11;if(l===H)return 14}return 2}function Ai(l,h){var b=l.alternate;return b===null?(b=vr(l.tag,h,l.key,l.mode),b.elementType=l.elementType,b.type=l.type,b.stateNode=l.stateNode,b.alternate=l,l.alternate=b):(b.pendingProps=h,b.type=l.type,b.flags=0,b.subtreeFlags=0,b.deletions=null),b.flags=l.flags&14680064,b.childLanes=l.childLanes,b.lanes=l.lanes,b.child=l.child,b.memoizedProps=l.memoizedProps,b.memoizedState=l.memoizedState,b.updateQueue=l.updateQueue,h=l.dependencies,b.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},b.sibling=l.sibling,b.index=l.index,b.ref=l.ref,b}function Ta(l,h,b,T,L,q){var ue=2;if(T=l,typeof l=="function")Kl(l)&&(ue=1);else if(typeof l=="string")ue=5;else e:switch(l){case P:return ls(b.children,L,q,h);case F:ue=8,L|=8;break;case j:return l=vr(12,b,h,L|2),l.elementType=j,l.lanes=q,l;case G:return l=vr(13,b,h,L),l.elementType=G,l.lanes=q,l;case se:return l=vr(19,b,h,L),l.elementType=se,l.lanes=q,l;case K:return Ra(b,L,q,h);default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case Q:ue=10;break e;case $:ue=9;break e;case V:ue=11;break e;case H:ue=14;break e;case J:ue=16,T=null;break e}throw Error(e(130,l==null?l:typeof l,""))}return h=vr(ue,b,h,L),h.elementType=l,h.type=T,h.lanes=q,h}function ls(l,h,b,T){return l=vr(7,l,T,h),l.lanes=b,l}function Ra(l,h,b,T){return l=vr(22,l,T,h),l.elementType=K,l.lanes=b,l.stateNode={isHidden:!1},l}function Xl(l,h,b){return l=vr(6,l,null,h),l.lanes=b,l}function Zl(l,h,b){return h=vr(4,l.children!==null?l.children:[],l.key,h),h.lanes=b,h.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},h}function $f(l,h,b,T,L){this.tag=h,this.containerInfo=l,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ne(0),this.expirationTimes=Ne(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ne(0),this.identifierPrefix=T,this.onRecoverableError=L,this.mutableSourceEagerHydrationData=null}function Jl(l,h,b,T,L,q,ue,ve,_e){return l=new $f(l,h,b,ve,_e),h===1?(h=1,q===!0&&(h|=8)):h=0,q=vr(3,null,null,h),l.current=q,q.stateNode=l,q.memoizedState={element:T,isDehydrated:b,cache:null,transitions:null,pendingSuspenseBoundaries:null},dl(q),l}function jf(l,h,b){var T=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:U,key:T==null?null:""+T,children:l,containerInfo:h,implementation:b}}function Wu(l){if(!l)return gi;l=l._reactInternals;e:{if(Qn(l)!==l||l.tag!==1)throw Error(e(170));var h=l;do{switch(h.tag){case 3:h=h.stateNode.context;break e;case 1:if(Xn(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break e}}h=h.return}while(h!==null);throw Error(e(171))}if(l.tag===1){var b=l.type;if(Xn(b))return xc(l,b,h)}return h}function qu(l,h,b,T,L,q,ue,ve,_e){return l=Jl(b,T,!0,l,L,q,ue,ve,_e),l.context=Wu(null),b=l.current,T=qn(),L=bi(b),q=Kr(T,L),q.callback=h??null,wi(b,q,L),l.current.lanes=L,we(l,L,T),er(l,T),l}function Na(l,h,b,T){var L=h.current,q=qn(),ue=bi(L);return b=Wu(b),h.context===null?h.context=b:h.pendingContext=b,h=Kr(q,ue),h.payload={element:l},T=T===void 0?null:T,T!==null&&(h.callback=T),l=wi(L,h,ue),l!==null&&(Nr(l,L,ue,q),oa(l,L,ue)),ue}function ka(l){if(l=l.current,!l.child)return null;switch(l.child.tag){case 5:return l.child.stateNode;default:return l.child.stateNode}}function Gu(l,h){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var b=l.retryLane;l.retryLane=b!==0&&b<h?b:h}}function ec(l,h){Gu(l,h),(l=l.alternate)&&Gu(l,h)}function Vf(){return null}var Yu=typeof reportError=="function"?reportError:function(l){console.error(l)};function tc(l){this._internalRoot=l}Ma.prototype.render=tc.prototype.render=function(l){var h=this._internalRoot;if(h===null)throw Error(e(409));Na(l,h,null,null)},Ma.prototype.unmount=tc.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var h=l.containerInfo;ss(function(){Na(null,l,null,null)}),h[Wr]=null}};function Ma(l){this._internalRoot=l}Ma.prototype.unstable_scheduleHydration=function(l){if(l){var h=Xt();l={blockedOn:null,target:l,priority:h};for(var b=0;b<kn.length&&h!==0&&h<kn[b].priority;b++);kn.splice(b,0,l),b===0&&Oo(l)}};function nc(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}function Ba(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11&&(l.nodeType!==8||l.nodeValue!==" react-mount-point-unstable "))}function Qu(){}function zf(l,h,b,T,L){if(L){if(typeof T=="function"){var q=T;T=function(){var $e=ka(ue);q.call($e)}}var ue=qu(h,T,l,0,null,!1,!1,"",Qu);return l._reactRootContainer=ue,l[Wr]=ue.current,uo(l.nodeType===8?l.parentNode:l),ss(),ue}for(;L=l.lastChild;)l.removeChild(L);if(typeof T=="function"){var ve=T;T=function(){var $e=ka(_e);ve.call($e)}}var _e=Jl(l,0,!1,null,null,!1,!1,"",Qu);return l._reactRootContainer=_e,l[Wr]=_e.current,uo(l.nodeType===8?l.parentNode:l),ss(function(){Na(h,_e,b,T)}),_e}function Pa(l,h,b,T,L){var q=b._reactRootContainer;if(q){var ue=q;if(typeof L=="function"){var ve=L;L=function(){var _e=ka(ue);ve.call(_e)}}Na(h,ue,l,L)}else ue=zf(b,h,l,L,T);return ka(ue)}ws=function(l){switch(l.tag){case 3:var h=l.stateNode;if(h.current.memoizedState.isDehydrated){var b=Qt(h.pendingLanes);b!==0&&(ln(h,b|1),er(h,zt()),(Ft&6)===0&&(Hs=zt()+500,mi()))}break;case 13:ss(function(){var T=Qr(l,1);if(T!==null){var L=qn();Nr(T,l,1,L)}}),ec(l,1)}},Un=function(l){if(l.tag===13){var h=Qr(l,134217728);if(h!==null){var b=qn();Nr(h,l,134217728,b)}ec(l,134217728)}},pt=function(l){if(l.tag===13){var h=bi(l),b=Qr(l,h);if(b!==null){var T=qn();Nr(b,l,h,T)}ec(l,h)}},Xt=function(){return Tt},Ks=function(l,h){var b=Tt;try{return Tt=l,h()}finally{Tt=b}},ps=function(l,h,b){switch(h){case"input":if(st(l,b),h=b.name,b.type==="radio"&&h!=null){for(b=l;b.parentNode;)b=b.parentNode;for(b=b.querySelectorAll("input[name="+JSON.stringify(""+h)+'][type="radio"]'),h=0;h<b.length;h++){var T=b[h];if(T!==l&&T.form===l.form){var L=Ko(T);if(!L)throw Error(e(90));je(T),st(T,L)}}}break;case"textarea":Vt(l,b);break;case"select":h=b.value,h!=null&&qe(l,!!b.multiple,h,!1)}},gs=Gl,wn=ss;var Wf={usingClientEntryPoint:!1,Events:[po,Is,Ko,Vs,Yn,Gl]},To={findFiberByHostInstance:Xi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},qf={bundleType:To.bundleType,version:To.version,rendererPackageName:To.rendererPackageName,rendererConfig:To.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:W.ReactCurrentDispatcher,findHostInstanceByFiber:function(l){return l=Ro(l),l===null?null:l.stateNode},findFiberByHostInstance:To.findFiberByHostInstance||Vf,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Da=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Da.isDisabled&&Da.supportsFiber)try{Ot=Da.inject(qf),It=Da}catch{}}return reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Wf,reactDom_production_min.createPortal=function(l,h){var b=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nc(h))throw Error(e(200));return jf(l,h,null,b)},reactDom_production_min.createRoot=function(l,h){if(!nc(l))throw Error(e(299));var b=!1,T="",L=Yu;return h!=null&&(h.unstable_strictMode===!0&&(b=!0),h.identifierPrefix!==void 0&&(T=h.identifierPrefix),h.onRecoverableError!==void 0&&(L=h.onRecoverableError)),h=Jl(l,1,!1,null,null,b,!1,T,L),l[Wr]=h.current,uo(l.nodeType===8?l.parentNode:l),new tc(h)},reactDom_production_min.findDOMNode=function(l){if(l==null)return null;if(l.nodeType===1)return l;var h=l._reactInternals;if(h===void 0)throw typeof l.render=="function"?Error(e(188)):(l=Object.keys(l).join(","),Error(e(268,l)));return l=Ro(h),l=l===null?null:l.stateNode,l},reactDom_production_min.flushSync=function(l){return ss(l)},reactDom_production_min.hydrate=function(l,h,b){if(!Ba(h))throw Error(e(200));return Pa(null,l,h,!0,b)},reactDom_production_min.hydrateRoot=function(l,h,b){if(!nc(l))throw Error(e(405));var T=b!=null&&b.hydratedSources||null,L=!1,q="",ue=Yu;if(b!=null&&(b.unstable_strictMode===!0&&(L=!0),b.identifierPrefix!==void 0&&(q=b.identifierPrefix),b.onRecoverableError!==void 0&&(ue=b.onRecoverableError)),h=qu(h,null,l,1,b??null,L,!1,q,ue),l[Wr]=h.current,uo(l),T)for(l=0;l<T.length;l++)b=T[l],L=b._getVersion,L=L(b._source),h.mutableSourceEagerHydrationData==null?h.mutableSourceEagerHydrationData=[b,L]:h.mutableSourceEagerHydrationData.push(b,L);return new Ma(h)},reactDom_production_min.render=function(l,h,b){if(!Ba(h))throw Error(e(200));return Pa(null,l,h,!1,b)},reactDom_production_min.unmountComponentAtNode=function(l){if(!Ba(l))throw Error(e(40));return l._reactRootContainer?(ss(function(){Pa(null,null,l,!1,function(){l._reactRootContainer=null,l[Wr]=null})}),!0):!1},reactDom_production_min.unstable_batchedUpdates=Gl,reactDom_production_min.unstable_renderSubtreeIntoContainer=function(l,h,b,T){if(!Ba(b))throw Error(e(200));if(l==null||l._reactInternals===void 0)throw Error(e(38));return Pa(l,h,b,!1,T)},reactDom_production_min.version="18.3.1-next-f1338f8080-20240426",reactDom_production_min}var hasRequiredReactDom;function requireReactDom(){if(hasRequiredReactDom)return reactDom.exports;hasRequiredReactDom=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),reactDom.exports=requireReactDom_production_min(),reactDom.exports}var hasRequiredClient$1;function requireClient$1(){if(hasRequiredClient$1)return client$1;hasRequiredClient$1=1;var n=requireReactDom();return client$1.createRoot=n.createRoot,client$1.hydrateRoot=n.hydrateRoot,client$1}var clientExports$1=requireClient$1();const ReactDOM=getDefaultExportFromCjs(clientExports$1);var lib$3={},types={},hasRequiredTypes;function requireTypes(){return hasRequiredTypes||(hasRequiredTypes=1,Object.defineProperty(types,"__esModule",{value:!0})),types}var ee={},taskCollection$1={},taskCollection={},utils$4={},hasRequiredUtils$4;function requireUtils$4(){if(hasRequiredUtils$4)return utils$4;hasRequiredUtils$4=1,Object.defineProperty(utils$4,"__esModule",{value:!0}),utils$4._fast_remove_single=void 0;function n(t,e){e!==-1&&(e===0?t.shift():e===t.length-1?t.length=t.length-1:t.splice(e,1))}return utils$4._fast_remove_single=n,utils$4}var bakeCollection={},hasRequiredBakeCollection;function requireBakeCollection(){return hasRequiredBakeCollection||(hasRequiredBakeCollection=1,function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.bakeCollectionVariadic=exports.bakeCollectionAwait=exports.bakeCollection=exports.BAKED_EMPTY_FUNC=void 0,exports.BAKED_EMPTY_FUNC=function(){};var FORLOOP_FALLBACK=1500;function generateArgsDefCode(n){var t="";if(n===0)return t;for(var e=0;e<n-1;++e)t+="arg"+String(e)+", ";return t+="arg"+String(n-1),t}function generateBodyPartsCode(n,t){for(var e="",s="",a=0;a<t;++a)e+="var f".concat(a," = collection[").concat(a,`];
`),s+="f".concat(a,"(").concat(n,`)
`);return{funcDefCode:e,funcCallCode:s}}function generateBodyPartsVariadicCode(n){for(var t="",e="",s=0;s<n;++s)t+="var f".concat(s," = collection[").concat(s,`];
`),e+="f".concat(s,`.apply(undefined, arguments)
`);return{funcDefCode:t,funcCallCode:e}}function bakeCollection(collection,fixedArgsNum){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                `).concat(funcCallCode,`
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);collection.length%10===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 10) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                        collection[i+4](`).concat(argsDefCode,`);
                        collection[i+5](`).concat(argsDefCode,`);
                        collection[i+6](`).concat(argsDefCode,`);
                        collection[i+7](`).concat(argsDefCode,`);
                        collection[i+8](`).concat(argsDefCode,`);
                        collection[i+9](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%4===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 4) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%3===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 3) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                    }
                });
            })`):funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; ++i) {
                        collection[i](`).concat(argsDefCode,`);
                    }
                });
            })`)}{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollection=bakeCollection;function bakeCollectionAwait(collection,fixedArgsNum){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                return Promise.all([ `).concat(funcCallCode,` ]);
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);funcFactoryCode=`(function(collection) {
            return (function(`.concat(argsDefCode,`) {
                var promises = Array(collection.length);
                for (var i = 0; i < collection.length; ++i) {
                    promises[i] = collection[i](`).concat(argsDefCode,`);
                }
                return Promise.all(promises);
            });
        })`)}{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollectionAwait=bakeCollectionAwait;function bakeCollectionVariadic(collection){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var _a=generateBodyPartsVariadicCode(collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function() {
                `).concat(funcCallCode,`
            });
        })`)}else funcFactoryCode=`(function(collection) {
            return (function() {
                for (var i = 0; i < collection.length; ++i) {
                    collection[i].apply(undefined, arguments);
                }
            });
        })`;{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollectionVariadic=bakeCollectionVariadic}(bakeCollection)),bakeCollection}var hasRequiredTaskCollection$1;function requireTaskCollection$1(){if(hasRequiredTaskCollection$1)return taskCollection;hasRequiredTaskCollection$1=1;var n=taskCollection&&taskCollection.__spreadArray||function(M,W,B){if(B||arguments.length===2)for(var U=0,P=W.length,F;U<P;U++)(F||!(U in W))&&(F||(F=Array.prototype.slice.call(W,0,U)),F[U]=W[U]);return M.concat(F||Array.prototype.slice.call(W))};Object.defineProperty(taskCollection,"__esModule",{value:!0}),taskCollection.TaskCollection=void 0;var t=requireUtils$4(),e=requireBakeCollection();function s(M,W){var B=this.length;if(B>1)if(W){var U;(U=this._tasks).push.apply(U,arguments),this.length+=arguments.length}else this._tasks.push(M),this.length++;else if(W){if(B===1){var P=Array(1+arguments.length);P.push(P),P.push.apply(P,arguments),this._tasks=P}else{var P=Array(arguments.length);P.push.apply(P,arguments),this._tasks=P}this.length+=arguments.length}else B===1?this._tasks=[this._tasks,M]:this._tasks=M,this.length++}function a(M,W){var B=this.length;if(B>1)if(W){var U;(U=this._tasks).push.apply(U,arguments),this.length+=arguments.length}else this._tasks.push(M),this.length++;else if(W){if(B===1){var P=Array(1+arguments.length);P.push(P),P.push.apply(P,arguments),this._tasks=P}else{var P=Array(arguments.length);P.push.apply(P,arguments),this._tasks=P}this.length+=arguments.length}else B===1?this._tasks=[this._tasks,M]:this._tasks=M,this.length++;this.firstEmitBuildStrategy?this.call=E:this.rebuild()}function o(M){this.length!==0&&(this.length===1?this._tasks===M&&(this.length=0):((0,t._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(M)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length))}function f(M){if(this.length!==0){if(this.length===1)if(this._tasks===M&&(this.length=0),this.firstEmitBuildStrategy){this.call=e.BAKED_EMPTY_FUNC;return}else{this.rebuild();return}else(0,t._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(M)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length;this.firstEmitBuildStrategy?this.call=E:this.rebuild()}}function p(M){for(var W,B=[],U=1;U<arguments.length;U++)B[U-1]=arguments[U];this.length===0?(this._tasks=B,this.length=1):this.length===1?(B.unshift(this._tasks),this._tasks=B,this.length=this._tasks.length):((W=this._tasks).splice.apply(W,n([M,0],B,!1)),this.length=this._tasks.length)}function y(M){for(var W,B=[],U=1;U<arguments.length;U++)B[U-1]=arguments[U];this.length===0?(this._tasks=B,this.length=1):this.length===1?(B.unshift(this._tasks),this._tasks=B,this.length=this._tasks.length):((W=this._tasks).splice.apply(W,n([M,0],B,!1)),this.length=this._tasks.length),this.firstEmitBuildStrategy?this.call=E:this.rebuild()}function g(){this.length===0?this.call=e.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,e.bakeCollection)(this._tasks,this.argsNum)}function x(){this.length===0?this.call=e.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,e.bakeCollectionAwait)(this._tasks,this.argsNum)}function E(){this.rebuild(),this.call.apply(void 0,arguments)}var A=function(){function M(W,B,U,P){B===void 0&&(B=!0),U===void 0&&(U=null),P===void 0&&(P=!1),this.awaitTasks=P,this.call=e.BAKED_EMPTY_FUNC,this.argsNum=W,this.firstEmitBuildStrategy=!0,P?this.rebuild=x.bind(this):this.rebuild=g.bind(this),this.setAutoRebuild(B),U?typeof U=="function"?(this._tasks=U,this.length=1):(this._tasks=U,this.length=U.length):(this._tasks=null,this.length=0),B&&this.rebuild()}return M}();taskCollection.TaskCollection=A;function S(){this._tasks=null,this.length=0,this.call=e.BAKED_EMPTY_FUNC}function I(){this._tasks=null,this.length=0,this.call=e.BAKED_EMPTY_FUNC}function _(M){this.argsNum<M&&(this.argsNum=M,this.firstEmitBuildStrategy?this.call=E:this.rebuild())}function R(M){M?(this.push=a.bind(this),this.insert=y.bind(this),this.removeLast=f.bind(this)):(this.push=s.bind(this),this.insert=p.bind(this),this.removeLast=o.bind(this))}function N(){return this.length===0?[]:this.length===1?[this._tasks]:this._tasks}function D(M){M.length===0?(this.length=0,this.call=e.BAKED_EMPTY_FUNC):M.length===1?(this.length=1,this.call=M[0],this._tasks=M[0]):(this.length=M.length,this._tasks=M,this.firstEmitBuildStrategy?this.call=E:this.rebuild())}return A.prototype.fastClear=S,A.prototype.clear=I,A.prototype.growArgsNum=_,A.prototype.setAutoRebuild=R,A.prototype.tasksAsArray=N,A.prototype.setTasks=D,taskCollection}var hasRequiredTaskCollection;function requireTaskCollection(){return hasRequiredTaskCollection||(hasRequiredTaskCollection=1,function(n){var t=taskCollection$1&&taskCollection$1.__createBinding||(Object.create?function(s,a,o,f){f===void 0&&(f=o);var p=Object.getOwnPropertyDescriptor(a,o);(!p||("get"in p?!a.__esModule:p.writable||p.configurable))&&(p={enumerable:!0,get:function(){return a[o]}}),Object.defineProperty(s,f,p)}:function(s,a,o,f){f===void 0&&(f=o),s[f]=a[o]}),e=taskCollection$1&&taskCollection$1.__exportStar||function(s,a){for(var o in s)o!=="default"&&!Object.prototype.hasOwnProperty.call(a,o)&&t(a,s,o)};Object.defineProperty(n,"__esModule",{value:!0}),e(requireTaskCollection$1(),n)}(taskCollection$1)),taskCollection$1}var utils$3={},hasRequiredUtils$3;function requireUtils$3(){if(hasRequiredUtils$3)return utils$3;hasRequiredUtils$3=1,Object.defineProperty(utils$3,"__esModule",{value:!0}),utils$3.nullObj=void 0;function n(){var t={};return t.__proto__=null,t}return utils$3.nullObj=n,utils$3}var hasRequiredEe;function requireEe(){if(hasRequiredEe)return ee;hasRequiredEe=1;var n=ee&&ee.__spreadArray||function(B,U,P){if(P||arguments.length===2)for(var F=0,j=U.length,Q;F<j;F++)(Q||!(F in U))&&(Q||(Q=Array.prototype.slice.call(U,0,F)),Q[F]=U[F]);return B.concat(Q||Array.prototype.slice.call(U))};Object.defineProperty(ee,"__esModule",{value:!0}),ee.EventEmitter=void 0;var t=requireTaskCollection(),e=requireUtils$4(),s=requireUtils$3();function a(B,U,P,F,j,Q){var $=this.events[B];if($){if($.length===0)return!1;if($.argsNum<6)$.call(U,P,F,j,Q);else{for(var V=new Array($.argsNum),G=0,se=V.length;G<se;++G)V[G]=arguments[G+1];$.call.apply(void 0,V)}return!0}return!1}function o(B,U,P,F,j,Q){var $=this.events[B],V;if($!==void 0){if($.length===0)return!1;if($.argsNum<6)$.call(U,P,F,j,Q);else{V=new Array($.argsNum);for(var G=0,se=V.length;G<se;++G)V[G]=arguments[G+1];$.call.apply(void 0,V)}}var H=this.onceEvents[B];if(H){if(typeof H=="function")if(this.onceEvents[B]=void 0,arguments.length<6)H(U,P,F,j,Q);else{if(V===void 0){V=new Array(arguments.length-1);for(var G=0,se=V.length;G<se;++G)V[G]=arguments[G+1]}H.apply(void 0,V)}else{var J=H;if(this.onceEvents[B]=void 0,arguments.length<6)for(var G=0;G<J.length;++G)J[G](U,P,F,j,Q);else{if(V===void 0){V=new Array(arguments.length-1);for(var G=0,se=V.length;G<se;++G)V[G]=arguments[G+1]}for(var G=0;G<J.length;++G)J[G].apply(void 0,V)}}return!0}return $!==void 0}var f=function(){function B(){this.events=(0,s.nullObj)(),this.onceEvents=(0,s.nullObj)(),this._symbolKeys=new Set,this.maxListeners=1/0}return Object.defineProperty(B.prototype,"_eventsCount",{get:function(){return this.eventNames().length},enumerable:!1,configurable:!0}),B}();ee.EventEmitter=f;function p(B,U){switch(this.emit===a&&(this.emit=o),typeof this.onceEvents[B]){case"undefined":this.onceEvents[B]=U,typeof B=="symbol"&&this._symbolKeys.add(B);break;case"function":this.onceEvents[B]=[this.onceEvents[B],U];break;case"object":this.onceEvents[B].push(U)}return this}function y(B,U,P){if(P===void 0&&(P=U.length),typeof U!="function")throw new TypeError("The listener must be a function");var F=this.events[B];return F?(F.push(U),F.growArgsNum(P),this.maxListeners!==1/0&&this.maxListeners<=F.length&&console.warn('Maximum event listeners for "'.concat(String(B),'" event!'))):(this.events[B]=new t.TaskCollection(P,!0,U,!1),typeof B=="symbol"&&this._symbolKeys.add(B)),this}function g(B,U){var P=this.events[B];P&&P.removeLast(U);var F=this.onceEvents[B];return F&&(typeof F=="function"?this.onceEvents[B]=void 0:typeof F=="object"&&(F.length===1&&F[0]===U?this.onceEvents[B]=void 0:(0,e._fast_remove_single)(F,F.lastIndexOf(U)))),this}function x(B,U,P,F){P===void 0&&(P=this),F===void 0&&(F=U.length),this.boundFuncs||(this.boundFuncs=new Map);var j=U.bind(P);return this.boundFuncs.set(U,j),this.addListener(B,j,F)}function E(B,U){var P,F,j=(P=this.boundFuncs)===null||P===void 0?void 0:P.get(U);return(F=this.boundFuncs)===null||F===void 0||F.delete(U),this.removeListener(B,j)}function A(B){return this.events[B]&&!!this.events[B].length}function S(B,U,P){if(P===void 0&&(P=U.length),typeof U!="function")throw new TypeError("The listener must be a function");var F=this.events[B];return!F||!(F instanceof t.TaskCollection)?(F=this.events[B]=new t.TaskCollection(P,!0,U,!1),typeof B=="symbol"&&this._symbolKeys.add(B)):(F.insert(0,U),F.growArgsNum(P),this.maxListeners!==1/0&&this.maxListeners<=F.length&&console.warn('Maximum event listeners for "'.concat(String(B),'" event!'))),this}function I(B,U){this.emit===a&&(this.emit=o);var P=this.onceEvents[B];return P?typeof P!="object"?(this.onceEvents[B]=[U,P],typeof B=="symbol"&&this._symbolKeys.add(B)):(P.unshift(U),this.maxListeners!==1/0&&this.maxListeners<=P.length&&console.warn('Maximum event listeners for "'.concat(String(B),'" once event!'))):(this.onceEvents[B]=[U],typeof B=="symbol"&&this._symbolKeys.add(B)),this}function _(B){return B===void 0?(this.events=(0,s.nullObj)(),this.onceEvents=(0,s.nullObj)(),this._symbolKeys=new Set):(this.events[B]=void 0,this.onceEvents[B]=void 0,typeof B=="symbol"&&this._symbolKeys.delete(B)),this}function R(B){return this.maxListeners=B,this}function N(){return this.maxListeners}function D(B){return this.emit===a?this.events[B]?this.events[B].tasksAsArray().slice():[]:this.events[B]&&this.onceEvents[B]?n(n([],this.events[B].tasksAsArray(),!0),typeof this.onceEvents[B]=="function"?[this.onceEvents[B]]:this.onceEvents[B],!0):this.events[B]?this.events[B].tasksAsArray():this.onceEvents[B]?typeof this.onceEvents[B]=="function"?[this.onceEvents[B]]:this.onceEvents[B]:[]}function M(){var B=this;if(this.emit===a){var U=Object.keys(this.events);return n(n([],U,!0),Array.from(this._symbolKeys),!0).filter(function(F){return F in B.events&&B.events[F]&&B.events[F].length})}else{var U=Object.keys(this.events).filter(function(j){return B.events[j]&&B.events[j].length}),P=Object.keys(this.onceEvents).filter(function(j){return B.onceEvents[j]&&B.onceEvents[j].length});return n(n(n([],U,!0),P,!0),Array.from(this._symbolKeys).filter(function(j){return j in B.events&&B.events[j]&&B.events[j].length||j in B.onceEvents&&B.onceEvents[j]&&B.onceEvents[j].length}),!0)}}function W(B){return this.emit===a?this.events[B]&&this.events[B].length||0:(this.events[B]&&this.events[B].length||0)+(this.onceEvents[B]&&this.onceEvents[B].length||0)}return f.prototype.emit=a,f.prototype.on=y,f.prototype.once=p,f.prototype.addListener=y,f.prototype.removeListener=g,f.prototype.addListenerBound=x,f.prototype.removeListenerBound=E,f.prototype.hasListeners=A,f.prototype.prependListener=S,f.prototype.prependOnceListener=I,f.prototype.off=g,f.prototype.removeAllListeners=_,f.prototype.setMaxListeners=R,f.prototype.getMaxListeners=N,f.prototype.listeners=D,f.prototype.eventNames=M,f.prototype.listenerCount=W,ee}var hasRequiredLib$3;function requireLib$3(){return hasRequiredLib$3||(hasRequiredLib$3=1,function(n){var t=lib$3&&lib$3.__createBinding||(Object.create?function(s,a,o,f){f===void 0&&(f=o);var p=Object.getOwnPropertyDescriptor(a,o);(!p||("get"in p?!a.__esModule:p.writable||p.configurable))&&(p={enumerable:!0,get:function(){return a[o]}}),Object.defineProperty(s,f,p)}:function(s,a,o,f){f===void 0&&(f=o),s[f]=a[o]}),e=lib$3&&lib$3.__exportStar||function(s,a){for(var o in s)o!=="default"&&!Object.prototype.hasOwnProperty.call(a,o)&&t(a,s,o)};Object.defineProperty(n,"__esModule",{value:!0}),e(requireTypes(),n),e(requireEe(),n)}(lib$3)),lib$3}var libExports=requireLib$3(),browser={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var n=1e3,t=n*60,e=t*60,s=e*24,a=s*7,o=s*365.25;ms=function(x,E){E=E||{};var A=typeof x;if(A==="string"&&x.length>0)return f(x);if(A==="number"&&isFinite(x))return E.long?y(x):p(x);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(x))};function f(x){if(x=String(x),!(x.length>100)){var E=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(x);if(E){var A=parseFloat(E[1]),S=(E[2]||"ms").toLowerCase();switch(S){case"years":case"year":case"yrs":case"yr":case"y":return A*o;case"weeks":case"week":case"w":return A*a;case"days":case"day":case"d":return A*s;case"hours":case"hour":case"hrs":case"hr":case"h":return A*e;case"minutes":case"minute":case"mins":case"min":case"m":return A*t;case"seconds":case"second":case"secs":case"sec":case"s":return A*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return A;default:return}}}}function p(x){var E=Math.abs(x);return E>=s?Math.round(x/s)+"d":E>=e?Math.round(x/e)+"h":E>=t?Math.round(x/t)+"m":E>=n?Math.round(x/n)+"s":x+"ms"}function y(x){var E=Math.abs(x);return E>=s?g(x,E,s,"day"):E>=e?g(x,E,e,"hour"):E>=t?g(x,E,t,"minute"):E>=n?g(x,E,n,"second"):x+" ms"}function g(x,E,A,S){var I=E>=A*1.5;return Math.round(x/A)+" "+S+(I?"s":"")}return ms}var common$1,hasRequiredCommon$1;function requireCommon$1(){if(hasRequiredCommon$1)return common$1;hasRequiredCommon$1=1;function n(t){s.debug=s,s.default=s,s.coerce=g,s.disable=p,s.enable=o,s.enabled=y,s.humanize=requireMs(),s.destroy=x,Object.keys(t).forEach(E=>{s[E]=t[E]}),s.names=[],s.skips=[],s.formatters={};function e(E){let A=0;for(let S=0;S<E.length;S++)A=(A<<5)-A+E.charCodeAt(S),A|=0;return s.colors[Math.abs(A)%s.colors.length]}s.selectColor=e;function s(E){let A,S=null,I,_;function R(...N){if(!R.enabled)return;const D=R,M=Number(new Date),W=M-(A||M);D.diff=W,D.prev=A,D.curr=M,A=M,N[0]=s.coerce(N[0]),typeof N[0]!="string"&&N.unshift("%O");let B=0;N[0]=N[0].replace(/%([a-zA-Z%])/g,(P,F)=>{if(P==="%%")return"%";B++;const j=s.formatters[F];if(typeof j=="function"){const Q=N[B];P=j.call(D,Q),N.splice(B,1),B--}return P}),s.formatArgs.call(D,N),(D.log||s.log).apply(D,N)}return R.namespace=E,R.useColors=s.useColors(),R.color=s.selectColor(E),R.extend=a,R.destroy=s.destroy,Object.defineProperty(R,"enabled",{enumerable:!0,configurable:!1,get:()=>S!==null?S:(I!==s.namespaces&&(I=s.namespaces,_=s.enabled(E)),_),set:N=>{S=N}}),typeof s.init=="function"&&s.init(R),R}function a(E,A){const S=s(this.namespace+(typeof A>"u"?":":A)+E);return S.log=this.log,S}function o(E){s.save(E),s.namespaces=E,s.names=[],s.skips=[];const A=(typeof E=="string"?E:"").trim().replace(" ",",").split(",").filter(Boolean);for(const S of A)S[0]==="-"?s.skips.push(S.slice(1)):s.names.push(S)}function f(E,A){let S=0,I=0,_=-1,R=0;for(;S<E.length;)if(I<A.length&&(A[I]===E[S]||A[I]==="*"))A[I]==="*"?(_=I,R=S,I++):(S++,I++);else if(_!==-1)I=_+1,R++,S=R;else return!1;for(;I<A.length&&A[I]==="*";)I++;return I===A.length}function p(){const E=[...s.names,...s.skips.map(A=>"-"+A)].join(",");return s.enable(""),E}function y(E){for(const A of s.skips)if(f(E,A))return!1;for(const A of s.names)if(f(E,A))return!0;return!1}function g(E){return E instanceof Error?E.stack||E.message:E}function x(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return s.enable(s.load()),s}return common$1=n,common$1}var hasRequiredBrowser;function requireBrowser(){return hasRequiredBrowser||(hasRequiredBrowser=1,function(n,t){var e={};t.formatArgs=a,t.save=o,t.load=f,t.useColors=s,t.storage=p(),t.destroy=(()=>{let g=!1;return()=>{g||(g=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function s(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let g;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(g=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(g[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function a(g){if(g[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+g[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const x="color: "+this.color;g.splice(1,0,x,"color: inherit");let E=0,A=0;g[0].replace(/%[a-zA-Z%]/g,S=>{S!=="%%"&&(E++,S==="%c"&&(A=E))}),g.splice(A,0,x)}t.log=console.debug||console.log||(()=>{});function o(g){try{g?t.storage.setItem("debug",g):t.storage.removeItem("debug")}catch{}}function f(){let g;try{g=t.storage.getItem("debug")}catch{}return!g&&typeof process<"u"&&"env"in process&&(g=e.DEBUG),g}function p(){try{return localStorage}catch{}}n.exports=requireCommon$1()(t);const{formatters:y}=n.exports;y.j=function(g){try{return JSON.stringify(g)}catch(x){return"[UnexpectedJSONParseError]: "+x.message}}}(browser,browser.exports)),browser.exports}var browserExports=requireBrowser();const createDebug3=getDefaultExportFromCjs(browserExports);function number$2(n){if(!Number.isSafeInteger(n)||n<0)throw new Error(`Wrong positive integer: ${n}`)}function bytes$2(n,...t){if(!(n instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(n.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${n.length}`)}function hash$1(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$2(n.outputLen),number$2(n.blockLen)}function exists$1(n,t=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(t&&n.finished)throw new Error("Hash#digest() has already been called")}function output$1(n,t){bytes$2(n);const e=t.outputLen;if(n.length<e)throw new Error(`digestInto() expects output buffer of length at least ${e}`)}const crypto$4=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const u8a$2=n=>n instanceof Uint8Array,createView$2=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),rotr$2=(n,t)=>n<<32-t|n>>>t,isLE$2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$2)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes$3(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function toBytes$2(n){if(typeof n=="string"&&(n=utf8ToBytes$3(n)),!u8a$2(n))throw new Error(`expected Uint8Array, got ${typeof n}`);return n}function concatBytes$4(...n){const t=new Uint8Array(n.reduce((s,a)=>s+a.length,0));let e=0;return n.forEach(s=>{if(!u8a$2(s))throw new Error("Uint8Array expected");t.set(s,e),e+=s.length}),t}let Hash$2=class{clone(){return this._cloneInto()}};function wrapConstructor$1(n){const t=s=>n().update(toBytes$2(s)).digest(),e=n();return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=()=>n(),t}function randomBytes$2(n=32){if(crypto$4&&typeof crypto$4.getRandomValues=="function")return crypto$4.getRandomValues(new Uint8Array(n));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64$2(n,t,e,s){if(typeof n.setBigUint64=="function")return n.setBigUint64(t,e,s);const a=BigInt(32),o=BigInt(4294967295),f=Number(e>>a&o),p=Number(e&o),y=s?4:0,g=s?0:4;n.setUint32(t+y,f,s),n.setUint32(t+g,p,s)}let SHA2$1=class extends Hash$2{constructor(t,e,s,a){super(),this.blockLen=t,this.outputLen=e,this.padOffset=s,this.isLE=a,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=createView$2(this.buffer)}update(t){exists$1(this);const{view:e,buffer:s,blockLen:a}=this;t=toBytes$2(t);const o=t.length;for(let f=0;f<o;){const p=Math.min(a-this.pos,o-f);if(p===a){const y=createView$2(t);for(;a<=o-f;f+=a)this.process(y,f);continue}s.set(t.subarray(f,f+p),this.pos),this.pos+=p,f+=p,this.pos===a&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){exists$1(this),output$1(t,this),this.finished=!0;const{buffer:e,view:s,blockLen:a,isLE:o}=this;let{pos:f}=this;e[f++]=128,this.buffer.subarray(f).fill(0),this.padOffset>a-f&&(this.process(s,0),f=0);for(let E=f;E<a;E++)e[E]=0;setBigUint64$2(s,a-8,BigInt(this.length*8),o),this.process(s,0);const p=createView$2(t),y=this.outputLen;if(y%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const g=y/4,x=this.get();if(g>x.length)throw new Error("_sha2: outputLen bigger than state");for(let E=0;E<g;E++)p.setUint32(4*E,x[E],o)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const s=t.slice(0,e);return this.destroy(),s}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:s,length:a,finished:o,destroyed:f,pos:p}=this;return t.length=a,t.pos=p,t.finished=o,t.destroyed=f,a%e&&t.buffer.set(s),t}};const Chi$2=(n,t,e)=>n&t^~n&e,Maj$2=(n,t,e)=>n&t^n&e^t&e,SHA256_K$2=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV$1=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$2=new Uint32Array(64);let SHA256$2=class extends SHA2$1{constructor(){super(64,32,8,!1),this.A=IV$1[0]|0,this.B=IV$1[1]|0,this.C=IV$1[2]|0,this.D=IV$1[3]|0,this.E=IV$1[4]|0,this.F=IV$1[5]|0,this.G=IV$1[6]|0,this.H=IV$1[7]|0}get(){const{A:t,B:e,C:s,D:a,E:o,F:f,G:p,H:y}=this;return[t,e,s,a,o,f,p,y]}set(t,e,s,a,o,f,p,y){this.A=t|0,this.B=e|0,this.C=s|0,this.D=a|0,this.E=o|0,this.F=f|0,this.G=p|0,this.H=y|0}process(t,e){for(let E=0;E<16;E++,e+=4)SHA256_W$2[E]=t.getUint32(e,!1);for(let E=16;E<64;E++){const A=SHA256_W$2[E-15],S=SHA256_W$2[E-2],I=rotr$2(A,7)^rotr$2(A,18)^A>>>3,_=rotr$2(S,17)^rotr$2(S,19)^S>>>10;SHA256_W$2[E]=_+SHA256_W$2[E-7]+I+SHA256_W$2[E-16]|0}let{A:s,B:a,C:o,D:f,E:p,F:y,G:g,H:x}=this;for(let E=0;E<64;E++){const A=rotr$2(p,6)^rotr$2(p,11)^rotr$2(p,25),S=x+A+Chi$2(p,y,g)+SHA256_K$2[E]+SHA256_W$2[E]|0,_=(rotr$2(s,2)^rotr$2(s,13)^rotr$2(s,22))+Maj$2(s,a,o)|0;x=g,g=y,y=p,p=f+S|0,f=o,o=a,a=s,s=S+_|0}s=s+this.A|0,a=a+this.B|0,o=o+this.C|0,f=f+this.D|0,p=p+this.E|0,y=y+this.F|0,g=g+this.G|0,x=x+this.H|0,this.set(s,a,o,f,p,y,g,x)}roundClean(){SHA256_W$2.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const sha256$4=wrapConstructor$1(()=>new SHA256$2);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$9=BigInt(0),_1n$9=BigInt(1),_2n$4=BigInt(2),u8a$1=n=>n instanceof Uint8Array,hexes$3=Array.from({length:256},(n,t)=>t.toString(16).padStart(2,"0"));function bytesToHex$3(n){if(!u8a$1(n))throw new Error("Uint8Array expected");let t="";for(let e=0;e<n.length;e++)t+=hexes$3[n[e]];return t}function numberToHexUnpadded$1(n){const t=n.toString(16);return t.length&1?`0${t}`:t}function hexToNumber$2(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return BigInt(n===""?"0":`0x${n}`)}function hexToBytes$3(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const t=n.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const e=new Uint8Array(t/2);for(let s=0;s<e.length;s++){const a=s*2,o=n.slice(a,a+2),f=Number.parseInt(o,16);if(Number.isNaN(f)||f<0)throw new Error("Invalid byte sequence");e[s]=f}return e}function bytesToNumberBE$1(n){return hexToNumber$2(bytesToHex$3(n))}function bytesToNumberLE$1(n){if(!u8a$1(n))throw new Error("Uint8Array expected");return hexToNumber$2(bytesToHex$3(Uint8Array.from(n).reverse()))}function numberToBytesBE$1(n,t){return hexToBytes$3(n.toString(16).padStart(t*2,"0"))}function numberToBytesLE$1(n,t){return numberToBytesBE$1(n,t).reverse()}function numberToVarBytesBE(n){return hexToBytes$3(numberToHexUnpadded$1(n))}function ensureBytes$1(n,t,e){let s;if(typeof t=="string")try{s=hexToBytes$3(t)}catch(o){throw new Error(`${n} must be valid hex string, got "${t}". Cause: ${o}`)}else if(u8a$1(t))s=Uint8Array.from(t);else throw new Error(`${n} must be hex string or Uint8Array`);const a=s.length;if(typeof e=="number"&&a!==e)throw new Error(`${n} expected ${e} bytes, got ${a}`);return s}function concatBytes$3(...n){const t=new Uint8Array(n.reduce((s,a)=>s+a.length,0));let e=0;return n.forEach(s=>{if(!u8a$1(s))throw new Error("Uint8Array expected");t.set(s,e),e+=s.length}),t}function equalBytes$1(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function utf8ToBytes$2(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function bitLen$1(n){let t;for(t=0;n>_0n$9;n>>=_1n$9,t+=1);return t}function bitGet(n,t){return n>>BigInt(t)&_1n$9}const bitSet=(n,t,e)=>n|(e?_1n$9:_0n$9)<<BigInt(t),bitMask$1=n=>(_2n$4<<BigInt(n-1))-_1n$9,u8n$1=n=>new Uint8Array(n),u8fr$1=n=>Uint8Array.from(n);function createHmacDrbg$1(n,t,e){if(typeof n!="number"||n<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof e!="function")throw new Error("hmacFn must be a function");let s=u8n$1(n),a=u8n$1(n),o=0;const f=()=>{s.fill(1),a.fill(0),o=0},p=(...E)=>e(a,s,...E),y=(E=u8n$1())=>{a=p(u8fr$1([0]),E),s=p(),E.length!==0&&(a=p(u8fr$1([1]),E),s=p())},g=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let E=0;const A=[];for(;E<t;){s=p();const S=s.slice();A.push(S),E+=s.length}return concatBytes$3(...A)};return(E,A)=>{f(),y(E);let S;for(;!(S=A(g()));)y();return f(),S}}const validatorFns$1={bigint:n=>typeof n=="bigint",function:n=>typeof n=="function",boolean:n=>typeof n=="boolean",string:n=>typeof n=="string",stringOrUint8Array:n=>typeof n=="string"||n instanceof Uint8Array,isSafeInteger:n=>Number.isSafeInteger(n),array:n=>Array.isArray(n),field:(n,t)=>t.Fp.isValid(n),hash:n=>typeof n=="function"&&Number.isSafeInteger(n.outputLen)};function validateObject$1(n,t,e={}){const s=(a,o,f)=>{const p=validatorFns$1[o];if(typeof p!="function")throw new Error(`Invalid validator "${o}", expected function`);const y=n[a];if(!(f&&y===void 0)&&!p(y,n))throw new Error(`Invalid param ${String(a)}=${y} (${typeof y}), expected ${o}`)};for(const[a,o]of Object.entries(t))s(a,o,!1);for(const[a,o]of Object.entries(e))s(a,o,!0);return n}const ut=Object.freeze(Object.defineProperty({__proto__:null,bitGet,bitLen:bitLen$1,bitMask:bitMask$1,bitSet,bytesToHex:bytesToHex$3,bytesToNumberBE:bytesToNumberBE$1,bytesToNumberLE:bytesToNumberLE$1,concatBytes:concatBytes$3,createHmacDrbg:createHmacDrbg$1,ensureBytes:ensureBytes$1,equalBytes:equalBytes$1,hexToBytes:hexToBytes$3,hexToNumber:hexToNumber$2,numberToBytesBE:numberToBytesBE$1,numberToBytesLE:numberToBytesLE$1,numberToHexUnpadded:numberToHexUnpadded$1,numberToVarBytesBE,utf8ToBytes:utf8ToBytes$2,validateObject:validateObject$1},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$8=BigInt(0),_1n$8=BigInt(1),_2n$3=BigInt(2),_3n$3=BigInt(3),_4n$1=BigInt(4),_5n$1=BigInt(5),_8n$1=BigInt(8);BigInt(9);BigInt(16);function mod$1(n,t){const e=n%t;return e>=_0n$8?e:t+e}function pow(n,t,e){if(e<=_0n$8||t<_0n$8)throw new Error("Expected power/modulo > 0");if(e===_1n$8)return _0n$8;let s=_1n$8;for(;t>_0n$8;)t&_1n$8&&(s=s*n%e),n=n*n%e,t>>=_1n$8;return s}function pow2$1(n,t,e){let s=n;for(;t-- >_0n$8;)s*=s,s%=e;return s}function invert$1(n,t){if(n===_0n$8||t<=_0n$8)throw new Error(`invert: expected positive integers, got n=${n} mod=${t}`);let e=mod$1(n,t),s=t,a=_0n$8,o=_1n$8;for(;e!==_0n$8;){const p=s/e,y=s%e,g=a-o*p;s=e,e=y,a=o,o=g}if(s!==_1n$8)throw new Error("invert: does not exist");return mod$1(a,t)}function tonelliShanks$1(n){const t=(n-_1n$8)/_2n$3;let e,s,a;for(e=n-_1n$8,s=0;e%_2n$3===_0n$8;e/=_2n$3,s++);for(a=_2n$3;a<n&&pow(a,t,n)!==n-_1n$8;a++);if(s===1){const f=(n+_1n$8)/_4n$1;return function(y,g){const x=y.pow(g,f);if(!y.eql(y.sqr(x),g))throw new Error("Cannot find square root");return x}}const o=(e+_1n$8)/_2n$3;return function(p,y){if(p.pow(y,t)===p.neg(p.ONE))throw new Error("Cannot find square root");let g=s,x=p.pow(p.mul(p.ONE,a),e),E=p.pow(y,o),A=p.pow(y,e);for(;!p.eql(A,p.ONE);){if(p.eql(A,p.ZERO))return p.ZERO;let S=1;for(let _=p.sqr(A);S<g&&!p.eql(_,p.ONE);S++)_=p.sqr(_);const I=p.pow(x,_1n$8<<BigInt(g-S-1));x=p.sqr(I),E=p.mul(E,I),A=p.mul(A,x),g=S}return E}}function FpSqrt$1(n){if(n%_4n$1===_3n$3){const t=(n+_1n$8)/_4n$1;return function(s,a){const o=s.pow(a,t);if(!s.eql(s.sqr(o),a))throw new Error("Cannot find square root");return o}}if(n%_8n$1===_5n$1){const t=(n-_5n$1)/_8n$1;return function(s,a){const o=s.mul(a,_2n$3),f=s.pow(o,t),p=s.mul(a,f),y=s.mul(s.mul(p,_2n$3),f),g=s.mul(p,s.sub(y,s.ONE));if(!s.eql(s.sqr(g),a))throw new Error("Cannot find square root");return g}}return tonelliShanks$1(n)}const FIELD_FIELDS$1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField$1(n){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},e=FIELD_FIELDS$1.reduce((s,a)=>(s[a]="function",s),t);return validateObject$1(n,e)}function FpPow$1(n,t,e){if(e<_0n$8)throw new Error("Expected power > 0");if(e===_0n$8)return n.ONE;if(e===_1n$8)return t;let s=n.ONE,a=t;for(;e>_0n$8;)e&_1n$8&&(s=n.mul(s,a)),a=n.sqr(a),e>>=_1n$8;return s}function FpInvertBatch$1(n,t){const e=new Array(t.length),s=t.reduce((o,f,p)=>n.is0(f)?o:(e[p]=o,n.mul(o,f)),n.ONE),a=n.inv(s);return t.reduceRight((o,f,p)=>n.is0(f)?o:(e[p]=n.mul(o,e[p]),n.mul(o,f)),a),e}function nLength$1(n,t){const e=t!==void 0?t:n.toString(2).length,s=Math.ceil(e/8);return{nBitLength:e,nByteLength:s}}function Field$1(n,t,e=!1,s={}){if(n<=_0n$8)throw new Error(`Expected Field ORDER > 0, got ${n}`);const{nBitLength:a,nByteLength:o}=nLength$1(n,t);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const f=FpSqrt$1(n),p=Object.freeze({ORDER:n,BITS:a,BYTES:o,MASK:bitMask$1(a),ZERO:_0n$8,ONE:_1n$8,create:y=>mod$1(y,n),isValid:y=>{if(typeof y!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof y}`);return _0n$8<=y&&y<n},is0:y=>y===_0n$8,isOdd:y=>(y&_1n$8)===_1n$8,neg:y=>mod$1(-y,n),eql:(y,g)=>y===g,sqr:y=>mod$1(y*y,n),add:(y,g)=>mod$1(y+g,n),sub:(y,g)=>mod$1(y-g,n),mul:(y,g)=>mod$1(y*g,n),pow:(y,g)=>FpPow$1(p,y,g),div:(y,g)=>mod$1(y*invert$1(g,n),n),sqrN:y=>y*y,addN:(y,g)=>y+g,subN:(y,g)=>y-g,mulN:(y,g)=>y*g,inv:y=>invert$1(y,n),sqrt:s.sqrt||(y=>f(p,y)),invertBatch:y=>FpInvertBatch$1(p,y),cmov:(y,g,x)=>x?g:y,toBytes:y=>e?numberToBytesLE$1(y,o):numberToBytesBE$1(y,o),fromBytes:y=>{if(y.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${y.length}`);return e?bytesToNumberLE$1(y):bytesToNumberBE$1(y)}});return Object.freeze(p)}function getFieldBytesLength$1(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const t=n.toString(2).length;return Math.ceil(t/8)}function getMinHashLength$1(n){const t=getFieldBytesLength$1(n);return t+Math.ceil(t/2)}function mapHashToField$1(n,t,e=!1){const s=n.length,a=getFieldBytesLength$1(t),o=getMinHashLength$1(t);if(s<16||s<o||s>1024)throw new Error(`expected ${o}-1024 bytes of input, got ${s}`);const f=e?bytesToNumberBE$1(n):bytesToNumberLE$1(n),p=mod$1(f,t-_1n$8)+_1n$8;return e?numberToBytesLE$1(p,a):numberToBytesBE$1(p,a)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$7=BigInt(0),_1n$7=BigInt(1);function wNAF$1(n,t){const e=(a,o)=>{const f=o.negate();return a?f:o},s=a=>{const o=Math.ceil(t/a)+1,f=2**(a-1);return{windows:o,windowSize:f}};return{constTimeNegate:e,unsafeLadder(a,o){let f=n.ZERO,p=a;for(;o>_0n$7;)o&_1n$7&&(f=f.add(p)),p=p.double(),o>>=_1n$7;return f},precomputeWindow(a,o){const{windows:f,windowSize:p}=s(o),y=[];let g=a,x=g;for(let E=0;E<f;E++){x=g,y.push(x);for(let A=1;A<p;A++)x=x.add(g),y.push(x);g=x.double()}return y},wNAF(a,o,f){const{windows:p,windowSize:y}=s(a);let g=n.ZERO,x=n.BASE;const E=BigInt(2**a-1),A=2**a,S=BigInt(a);for(let I=0;I<p;I++){const _=I*y;let R=Number(f&E);f>>=S,R>y&&(R-=A,f+=_1n$7);const N=_,D=_+Math.abs(R)-1,M=I%2!==0,W=R<0;R===0?x=x.add(e(M,o[N])):g=g.add(e(W,o[D]))}return{p:g,f:x}},wNAFCached(a,o,f,p){const y=a._WINDOW_SIZE||1;let g=o.get(a);return g||(g=this.precomputeWindow(a,y),y!==1&&o.set(a,p(g))),this.wNAF(y,g,f)}}}function validateBasic$1(n){return validateField$1(n.Fp),validateObject$1(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength$1(n.n,n.nBitLength),...n,p:n.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validatePointOpts$1(n){const t=validateBasic$1(n);validateObject$1(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:e,Fp:s,a}=t;if(e){if(!s.eql(a,s.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof e!="object"||typeof e.beta!="bigint"||typeof e.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:b2n,hexToBytes:h2b}=ut,DER$1={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(n){const{Err:t}=DER$1;if(n.length<2||n[0]!==2)throw new t("Invalid signature integer tag");const e=n[1],s=n.subarray(2,e+2);if(!e||s.length!==e)throw new t("Invalid signature integer: wrong length");if(s[0]&128)throw new t("Invalid signature integer: negative");if(s[0]===0&&!(s[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:b2n(s),l:n.subarray(e+2)}},toSig(n){const{Err:t}=DER$1,e=typeof n=="string"?h2b(n):n;if(!(e instanceof Uint8Array))throw new Error("ui8a expected");let s=e.length;if(s<2||e[0]!=48)throw new t("Invalid signature tag");if(e[1]!==s-2)throw new t("Invalid signature: incorrect length");const{d:a,l:o}=DER$1._parseInt(e.subarray(2)),{d:f,l:p}=DER$1._parseInt(o);if(p.length)throw new t("Invalid signature: left bytes after parsing");return{r:a,s:f}},hexFromSig(n){const t=g=>Number.parseInt(g[0],16)&8?"00"+g:g,e=g=>{const x=g.toString(16);return x.length&1?`0${x}`:x},s=t(e(n.s)),a=t(e(n.r)),o=s.length/2,f=a.length/2,p=e(o),y=e(f);return`30${e(f+o+4)}02${y}${a}02${p}${s}`}},_0n$6=BigInt(0),_1n$6=BigInt(1);BigInt(2);const _3n$2=BigInt(3);BigInt(4);function weierstrassPoints$1(n){const t=validatePointOpts$1(n),{Fp:e}=t,s=t.toBytes||((I,_,R)=>{const N=_.toAffine();return concatBytes$3(Uint8Array.from([4]),e.toBytes(N.x),e.toBytes(N.y))}),a=t.fromBytes||(I=>{const _=I.subarray(1),R=e.fromBytes(_.subarray(0,e.BYTES)),N=e.fromBytes(_.subarray(e.BYTES,2*e.BYTES));return{x:R,y:N}});function o(I){const{a:_,b:R}=t,N=e.sqr(I),D=e.mul(N,I);return e.add(e.add(D,e.mul(I,_)),R)}if(!e.eql(e.sqr(t.Gy),o(t.Gx)))throw new Error("bad generator point: equation left != right");function f(I){return typeof I=="bigint"&&_0n$6<I&&I<t.n}function p(I){if(!f(I))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function y(I){const{allowedPrivateKeyLengths:_,nByteLength:R,wrapPrivateKey:N,n:D}=t;if(_&&typeof I!="bigint"){if(I instanceof Uint8Array&&(I=bytesToHex$3(I)),typeof I!="string"||!_.includes(I.length))throw new Error("Invalid key");I=I.padStart(R*2,"0")}let M;try{M=typeof I=="bigint"?I:bytesToNumberBE$1(ensureBytes$1("private key",I,R))}catch{throw new Error(`private key must be ${R} bytes, hex or bigint, not ${typeof I}`)}return N&&(M=mod$1(M,D)),p(M),M}const g=new Map;function x(I){if(!(I instanceof E))throw new Error("ProjectivePoint expected")}class E{constructor(_,R,N){if(this.px=_,this.py=R,this.pz=N,_==null||!e.isValid(_))throw new Error("x required");if(R==null||!e.isValid(R))throw new Error("y required");if(N==null||!e.isValid(N))throw new Error("z required")}static fromAffine(_){const{x:R,y:N}=_||{};if(!_||!e.isValid(R)||!e.isValid(N))throw new Error("invalid affine point");if(_ instanceof E)throw new Error("projective point not allowed");const D=M=>e.eql(M,e.ZERO);return D(R)&&D(N)?E.ZERO:new E(R,N,e.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(_){const R=e.invertBatch(_.map(N=>N.pz));return _.map((N,D)=>N.toAffine(R[D])).map(E.fromAffine)}static fromHex(_){const R=E.fromAffine(a(ensureBytes$1("pointHex",_)));return R.assertValidity(),R}static fromPrivateKey(_){return E.BASE.multiply(y(_))}_setWindowSize(_){this._WINDOW_SIZE=_,g.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!e.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:_,y:R}=this.toAffine();if(!e.isValid(_)||!e.isValid(R))throw new Error("bad point: x or y not FE");const N=e.sqr(R),D=o(_);if(!e.eql(N,D))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:_}=this.toAffine();if(e.isOdd)return!e.isOdd(_);throw new Error("Field doesn't support isOdd")}equals(_){x(_);const{px:R,py:N,pz:D}=this,{px:M,py:W,pz:B}=_,U=e.eql(e.mul(R,B),e.mul(M,D)),P=e.eql(e.mul(N,B),e.mul(W,D));return U&&P}negate(){return new E(this.px,e.neg(this.py),this.pz)}double(){const{a:_,b:R}=t,N=e.mul(R,_3n$2),{px:D,py:M,pz:W}=this;let B=e.ZERO,U=e.ZERO,P=e.ZERO,F=e.mul(D,D),j=e.mul(M,M),Q=e.mul(W,W),$=e.mul(D,M);return $=e.add($,$),P=e.mul(D,W),P=e.add(P,P),B=e.mul(_,P),U=e.mul(N,Q),U=e.add(B,U),B=e.sub(j,U),U=e.add(j,U),U=e.mul(B,U),B=e.mul($,B),P=e.mul(N,P),Q=e.mul(_,Q),$=e.sub(F,Q),$=e.mul(_,$),$=e.add($,P),P=e.add(F,F),F=e.add(P,F),F=e.add(F,Q),F=e.mul(F,$),U=e.add(U,F),Q=e.mul(M,W),Q=e.add(Q,Q),F=e.mul(Q,$),B=e.sub(B,F),P=e.mul(Q,j),P=e.add(P,P),P=e.add(P,P),new E(B,U,P)}add(_){x(_);const{px:R,py:N,pz:D}=this,{px:M,py:W,pz:B}=_;let U=e.ZERO,P=e.ZERO,F=e.ZERO;const j=t.a,Q=e.mul(t.b,_3n$2);let $=e.mul(R,M),V=e.mul(N,W),G=e.mul(D,B),se=e.add(R,N),H=e.add(M,W);se=e.mul(se,H),H=e.add($,V),se=e.sub(se,H),H=e.add(R,D);let J=e.add(M,B);return H=e.mul(H,J),J=e.add($,G),H=e.sub(H,J),J=e.add(N,D),U=e.add(W,B),J=e.mul(J,U),U=e.add(V,G),J=e.sub(J,U),F=e.mul(j,H),U=e.mul(Q,G),F=e.add(U,F),U=e.sub(V,F),F=e.add(V,F),P=e.mul(U,F),V=e.add($,$),V=e.add(V,$),G=e.mul(j,G),H=e.mul(Q,H),V=e.add(V,G),G=e.sub($,G),G=e.mul(j,G),H=e.add(H,G),$=e.mul(V,H),P=e.add(P,$),$=e.mul(J,H),U=e.mul(se,U),U=e.sub(U,$),$=e.mul(se,V),F=e.mul(J,F),F=e.add(F,$),new E(U,P,F)}subtract(_){return this.add(_.negate())}is0(){return this.equals(E.ZERO)}wNAF(_){return S.wNAFCached(this,g,_,R=>{const N=e.invertBatch(R.map(D=>D.pz));return R.map((D,M)=>D.toAffine(N[M])).map(E.fromAffine)})}multiplyUnsafe(_){const R=E.ZERO;if(_===_0n$6)return R;if(p(_),_===_1n$6)return this;const{endo:N}=t;if(!N)return S.unsafeLadder(this,_);let{k1neg:D,k1:M,k2neg:W,k2:B}=N.splitScalar(_),U=R,P=R,F=this;for(;M>_0n$6||B>_0n$6;)M&_1n$6&&(U=U.add(F)),B&_1n$6&&(P=P.add(F)),F=F.double(),M>>=_1n$6,B>>=_1n$6;return D&&(U=U.negate()),W&&(P=P.negate()),P=new E(e.mul(P.px,N.beta),P.py,P.pz),U.add(P)}multiply(_){p(_);let R=_,N,D;const{endo:M}=t;if(M){const{k1neg:W,k1:B,k2neg:U,k2:P}=M.splitScalar(R);let{p:F,f:j}=this.wNAF(B),{p:Q,f:$}=this.wNAF(P);F=S.constTimeNegate(W,F),Q=S.constTimeNegate(U,Q),Q=new E(e.mul(Q.px,M.beta),Q.py,Q.pz),N=F.add(Q),D=j.add($)}else{const{p:W,f:B}=this.wNAF(R);N=W,D=B}return E.normalizeZ([N,D])[0]}multiplyAndAddUnsafe(_,R,N){const D=E.BASE,M=(B,U)=>U===_0n$6||U===_1n$6||!B.equals(D)?B.multiplyUnsafe(U):B.multiply(U),W=M(this,R).add(M(_,N));return W.is0()?void 0:W}toAffine(_){const{px:R,py:N,pz:D}=this,M=this.is0();_==null&&(_=M?e.ONE:e.inv(D));const W=e.mul(R,_),B=e.mul(N,_),U=e.mul(D,_);if(M)return{x:e.ZERO,y:e.ZERO};if(!e.eql(U,e.ONE))throw new Error("invZ was invalid");return{x:W,y:B}}isTorsionFree(){const{h:_,isTorsionFree:R}=t;if(_===_1n$6)return!0;if(R)return R(E,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:_,clearCofactor:R}=t;return _===_1n$6?this:R?R(E,this):this.multiplyUnsafe(t.h)}toRawBytes(_=!0){return this.assertValidity(),s(E,this,_)}toHex(_=!0){return bytesToHex$3(this.toRawBytes(_))}}E.BASE=new E(t.Gx,t.Gy,e.ONE),E.ZERO=new E(e.ZERO,e.ONE,e.ZERO);const A=t.nBitLength,S=wNAF$1(E,t.endo?Math.ceil(A/2):A);return{CURVE:t,ProjectivePoint:E,normPrivateKeyToScalar:y,weierstrassEquation:o,isWithinCurveOrder:f}}function validateOpts$1(n){const t=validateBasic$1(n);return validateObject$1(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function weierstrass$2(n){const t=validateOpts$1(n),{Fp:e,n:s}=t,a=e.BYTES+1,o=2*e.BYTES+1;function f(H){return _0n$6<H&&H<e.ORDER}function p(H){return mod$1(H,s)}function y(H){return invert$1(H,s)}const{ProjectivePoint:g,normPrivateKeyToScalar:x,weierstrassEquation:E,isWithinCurveOrder:A}=weierstrassPoints$1({...t,toBytes(H,J,K){const ie=J.toAffine(),ne=e.toBytes(ie.x),re=concatBytes$3;return K?re(Uint8Array.from([J.hasEvenY()?2:3]),ne):re(Uint8Array.from([4]),ne,e.toBytes(ie.y))},fromBytes(H){const J=H.length,K=H[0],ie=H.subarray(1);if(J===a&&(K===2||K===3)){const ne=bytesToNumberBE$1(ie);if(!f(ne))throw new Error("Point is not on curve");const re=E(ne);let X=e.sqrt(re);const ae=(X&_1n$6)===_1n$6;return(K&1)===1!==ae&&(X=e.neg(X)),{x:ne,y:X}}else if(J===o&&K===4){const ne=e.fromBytes(ie.subarray(0,e.BYTES)),re=e.fromBytes(ie.subarray(e.BYTES,2*e.BYTES));return{x:ne,y:re}}else throw new Error(`Point of length ${J} was invalid. Expected ${a} compressed bytes or ${o} uncompressed bytes`)}}),S=H=>bytesToHex$3(numberToBytesBE$1(H,t.nByteLength));function I(H){const J=s>>_1n$6;return H>J}function _(H){return I(H)?p(-H):H}const R=(H,J,K)=>bytesToNumberBE$1(H.slice(J,K));class N{constructor(J,K,ie){this.r=J,this.s=K,this.recovery=ie,this.assertValidity()}static fromCompact(J){const K=t.nByteLength;return J=ensureBytes$1("compactSignature",J,K*2),new N(R(J,0,K),R(J,K,2*K))}static fromDER(J){const{r:K,s:ie}=DER$1.toSig(ensureBytes$1("DER",J));return new N(K,ie)}assertValidity(){if(!A(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!A(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(J){return new N(this.r,this.s,J)}recoverPublicKey(J){const{r:K,s:ie,recovery:ne}=this,re=P(ensureBytes$1("msgHash",J));if(ne==null||![0,1,2,3].includes(ne))throw new Error("recovery id invalid");const X=ne===2||ne===3?K+t.n:K;if(X>=e.ORDER)throw new Error("recovery id 2 or 3 invalid");const ae=(ne&1)===0?"02":"03",te=g.fromHex(ae+S(X)),ce=y(X),xe=p(-re*ce),me=p(ie*ce),Se=g.BASE.multiplyAndAddUnsafe(te,xe,me);if(!Se)throw new Error("point at infinify");return Se.assertValidity(),Se}hasHighS(){return I(this.s)}normalizeS(){return this.hasHighS()?new N(this.r,p(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes$3(this.toDERHex())}toDERHex(){return DER$1.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes$3(this.toCompactHex())}toCompactHex(){return S(this.r)+S(this.s)}}const D={isValidPrivateKey(H){try{return x(H),!0}catch{return!1}},normPrivateKeyToScalar:x,randomPrivateKey:()=>{const H=getMinHashLength$1(t.n);return mapHashToField$1(t.randomBytes(H),t.n)},precompute(H=8,J=g.BASE){return J._setWindowSize(H),J.multiply(BigInt(3)),J}};function M(H,J=!0){return g.fromPrivateKey(H).toRawBytes(J)}function W(H){const J=H instanceof Uint8Array,K=typeof H=="string",ie=(J||K)&&H.length;return J?ie===a||ie===o:K?ie===2*a||ie===2*o:H instanceof g}function B(H,J,K=!0){if(W(H))throw new Error("first arg must be private key");if(!W(J))throw new Error("second arg must be public key");return g.fromHex(J).multiply(x(H)).toRawBytes(K)}const U=t.bits2int||function(H){const J=bytesToNumberBE$1(H),K=H.length*8-t.nBitLength;return K>0?J>>BigInt(K):J},P=t.bits2int_modN||function(H){return p(U(H))},F=bitMask$1(t.nBitLength);function j(H){if(typeof H!="bigint")throw new Error("bigint expected");if(!(_0n$6<=H&&H<F))throw new Error(`bigint expected < 2^${t.nBitLength}`);return numberToBytesBE$1(H,t.nByteLength)}function Q(H,J,K=$){if(["recovered","canonical"].some(Me=>Me in K))throw new Error("sign() legacy options not supported");const{hash:ie,randomBytes:ne}=t;let{lowS:re,prehash:X,extraEntropy:ae}=K;re==null&&(re=!0),H=ensureBytes$1("msgHash",H),X&&(H=ensureBytes$1("prehashed msgHash",ie(H)));const te=P(H),ce=x(J),xe=[j(ce),j(te)];if(ae!=null){const Me=ae===!0?ne(e.BYTES):ae;xe.push(ensureBytes$1("extraEntropy",Me))}const me=concatBytes$3(...xe),Se=te;function be(Me){const Oe=U(Me);if(!A(Oe))return;const Ue=y(Oe),je=g.BASE.multiply(Oe).toAffine(),Pe=p(je.x);if(Pe===_0n$6)return;const We=p(Ue*p(Se+Pe*ce));if(We===_0n$6)return;let Ze=(je.x===Pe?0:2)|Number(je.y&_1n$6),ot=We;return re&&I(We)&&(ot=_(We),Ze^=1),new N(Pe,ot,Ze)}return{seed:me,k2sig:be}}const $={lowS:t.lowS,prehash:!1},V={lowS:t.lowS,prehash:!1};function G(H,J,K=$){const{seed:ie,k2sig:ne}=Q(H,J,K),re=t;return createHmacDrbg$1(re.hash.outputLen,re.nByteLength,re.hmac)(ie,ne)}g.BASE._setWindowSize(8);function se(H,J,K,ie=V){var je;const ne=H;if(J=ensureBytes$1("msgHash",J),K=ensureBytes$1("publicKey",K),"strict"in ie)throw new Error("options.strict was renamed to lowS");const{lowS:re,prehash:X}=ie;let ae,te;try{if(typeof ne=="string"||ne instanceof Uint8Array)try{ae=N.fromDER(ne)}catch(Pe){if(!(Pe instanceof DER$1.Err))throw Pe;ae=N.fromCompact(ne)}else if(typeof ne=="object"&&typeof ne.r=="bigint"&&typeof ne.s=="bigint"){const{r:Pe,s:We}=ne;ae=new N(Pe,We)}else throw new Error("PARSE");te=g.fromHex(K)}catch(Pe){if(Pe.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(re&&ae.hasHighS())return!1;X&&(J=t.hash(J));const{r:ce,s:xe}=ae,me=P(J),Se=y(xe),be=p(me*Se),Me=p(ce*Se),Oe=(je=g.BASE.multiplyAndAddUnsafe(te,be,Me))==null?void 0:je.toAffine();return Oe?p(Oe.x)===ce:!1}return{CURVE:t,getPublicKey:M,getSharedSecret:B,sign:G,verify:se,ProjectivePoint:g,Signature:N,utils:D}}let HMAC$2=class extends Hash$2{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,hash$1(t);const s=toBytes$2(e);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const a=this.blockLen,o=new Uint8Array(a);o.set(s.length>a?t.create().update(s).digest():s);for(let f=0;f<o.length;f++)o[f]^=54;this.iHash.update(o),this.oHash=t.create();for(let f=0;f<o.length;f++)o[f]^=106;this.oHash.update(o),o.fill(0)}update(t){return exists$1(this),this.iHash.update(t),this}digestInto(t){exists$1(this),bytes$2(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:s,finished:a,destroyed:o,blockLen:f,outputLen:p}=this;return t=t,t.finished=a,t.destroyed=o,t.blockLen=f,t.outputLen=p,t.oHash=e._cloneInto(t.oHash),t.iHash=s._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$3=(n,t,e)=>new HMAC$2(n,t).update(e).digest();hmac$3.create=(n,t)=>new HMAC$2(n,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash$1(n){return{hash:n,hmac:(t,...e)=>hmac$3(n,t,concatBytes$4(...e)),randomBytes:randomBytes$2}}function createCurve$1(n,t){const e=s=>weierstrass$2({...n,...getHash$1(s)});return Object.freeze({...e(t),create:e})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1P$1=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N$1=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_1n$5=BigInt(1),_2n$2=BigInt(2),divNearest$1=(n,t)=>(n+t/_2n$2)/t;function sqrtMod$1(n){const t=secp256k1P$1,e=BigInt(3),s=BigInt(6),a=BigInt(11),o=BigInt(22),f=BigInt(23),p=BigInt(44),y=BigInt(88),g=n*n*n%t,x=g*g*n%t,E=pow2$1(x,e,t)*x%t,A=pow2$1(E,e,t)*x%t,S=pow2$1(A,_2n$2,t)*g%t,I=pow2$1(S,a,t)*S%t,_=pow2$1(I,o,t)*I%t,R=pow2$1(_,p,t)*_%t,N=pow2$1(R,y,t)*R%t,D=pow2$1(N,p,t)*_%t,M=pow2$1(D,e,t)*x%t,W=pow2$1(M,f,t)*I%t,B=pow2$1(W,s,t)*g%t,U=pow2$1(B,_2n$2,t);if(!Fp.eql(Fp.sqr(U),n))throw new Error("Cannot find square root");return U}const Fp=Field$1(secp256k1P$1,void 0,void 0,{sqrt:sqrtMod$1}),secp256k1$2=createCurve$1({a:BigInt(0),b:BigInt(7),Fp,n:secp256k1N$1,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:n=>{const t=secp256k1N$1,e=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),s=-_1n$5*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),a=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=e,f=BigInt("0x100000000000000000000000000000000"),p=divNearest$1(o*n,t),y=divNearest$1(-s*n,t);let g=mod$1(n-p*e-y*a,t),x=mod$1(-p*s-y*o,t);const E=g>f,A=x>f;if(E&&(g=t-g),A&&(x=t-x),g>f||x>f)throw new Error("splitScalar: Endomorphism failed, k="+n);return{k1neg:E,k1:g,k2neg:A,k2:x}}}},sha256$4),_0n$5=BigInt(0),fe=n=>typeof n=="bigint"&&_0n$5<n&&n<secp256k1P$1,ge=n=>typeof n=="bigint"&&_0n$5<n&&n<secp256k1N$1,TAGGED_HASH_PREFIXES$1={};function taggedHash$1(n,...t){let e=TAGGED_HASH_PREFIXES$1[n];if(e===void 0){const s=sha256$4(Uint8Array.from(n,a=>a.charCodeAt(0)));e=concatBytes$3(s,s),TAGGED_HASH_PREFIXES$1[n]=e}return sha256$4(concatBytes$3(e,...t))}const pointToBytes$1=n=>n.toRawBytes(!0).slice(1),numTo32b$1=n=>numberToBytesBE$1(n,32),modP$1=n=>mod$1(n,secp256k1P$1),modN$1=n=>mod$1(n,secp256k1N$1),Point$1=secp256k1$2.ProjectivePoint,GmulAdd$1=(n,t,e)=>Point$1.BASE.multiplyAndAddUnsafe(n,t,e);function schnorrGetExtPubKey$1(n){let t=secp256k1$2.utils.normPrivateKeyToScalar(n),e=Point$1.fromPrivateKey(t);return{scalar:e.hasEvenY()?t:modN$1(-t),bytes:pointToBytes$1(e)}}function lift_x$1(n){if(!fe(n))throw new Error("bad x: need 0 < x < p");const t=modP$1(n*n),e=modP$1(t*n+BigInt(7));let s=sqrtMod$1(e);s%_2n$2!==_0n$5&&(s=modP$1(-s));const a=new Point$1(n,s,_1n$5);return a.assertValidity(),a}function challenge$1(...n){return modN$1(bytesToNumberBE$1(taggedHash$1("BIP0340/challenge",...n)))}function schnorrGetPublicKey$1(n){return schnorrGetExtPubKey$1(n).bytes}function schnorrSign$1(n,t,e=randomBytes$2(32)){const s=ensureBytes$1("message",n),{bytes:a,scalar:o}=schnorrGetExtPubKey$1(t),f=ensureBytes$1("auxRand",e,32),p=numTo32b$1(o^bytesToNumberBE$1(taggedHash$1("BIP0340/aux",f))),y=taggedHash$1("BIP0340/nonce",p,a,s),g=modN$1(bytesToNumberBE$1(y));if(g===_0n$5)throw new Error("sign failed: k is zero");const{bytes:x,scalar:E}=schnorrGetExtPubKey$1(g),A=challenge$1(x,a,s),S=new Uint8Array(64);if(S.set(x,0),S.set(numTo32b$1(modN$1(E+A*o)),32),!schnorrVerify$1(S,s,a))throw new Error("sign: Invalid signature produced");return S}function schnorrVerify$1(n,t,e){const s=ensureBytes$1("signature",n,64),a=ensureBytes$1("message",t),o=ensureBytes$1("publicKey",e,32);try{const f=lift_x$1(bytesToNumberBE$1(o)),p=bytesToNumberBE$1(s.subarray(0,32));if(!fe(p))return!1;const y=bytesToNumberBE$1(s.subarray(32,64));if(!ge(y))return!1;const g=challenge$1(numTo32b$1(p),pointToBytes$1(f),a),x=GmulAdd$1(f,y,modN$1(-g));return!(!x||!x.hasEvenY()||x.toAffine().x!==p)}catch{return!1}}const schnorr$1={getPublicKey:schnorrGetPublicKey$1,sign:schnorrSign$1,verify:schnorrVerify$1,utils:{randomPrivateKey:secp256k1$2.utils.randomPrivateKey,lift_x:lift_x$1,pointToBytes:pointToBytes$1,numberToBytesBE:numberToBytesBE$1,bytesToNumberBE:bytesToNumberBE$1,taggedHash:taggedHash$1,mod:mod$1}},crypto$3=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const u8a=n=>n instanceof Uint8Array,createView$1=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),rotr$1=(n,t)=>n<<32-t|n>>>t,isLE$1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$1)throw new Error("Non little-endian hardware is not supported");const hexes$2=Array.from({length:256},(n,t)=>t.toString(16).padStart(2,"0"));function bytesToHex$2(n){if(!u8a(n))throw new Error("Uint8Array expected");let t="";for(let e=0;e<n.length;e++)t+=hexes$2[n[e]];return t}function hexToBytes$2(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const t=n.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const e=new Uint8Array(t/2);for(let s=0;s<e.length;s++){const a=s*2,o=n.slice(a,a+2),f=Number.parseInt(o,16);if(Number.isNaN(f)||f<0)throw new Error("Invalid byte sequence");e[s]=f}return e}function utf8ToBytes$1(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function toBytes$1(n){if(typeof n=="string"&&(n=utf8ToBytes$1(n)),!u8a(n))throw new Error(`expected Uint8Array, got ${typeof n}`);return n}function concatBytes$2(...n){const t=new Uint8Array(n.reduce((s,a)=>s+a.length,0));let e=0;return n.forEach(s=>{if(!u8a(s))throw new Error("Uint8Array expected");t.set(s,e),e+=s.length}),t}let Hash$1=class{clone(){return this._cloneInto()}};function wrapConstructor(n){const t=s=>n().update(toBytes$1(s)).digest(),e=n();return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=()=>n(),t}function randomBytes$1(n=32){if(crypto$3&&typeof crypto$3.getRandomValues=="function")return crypto$3.getRandomValues(new Uint8Array(n));throw new Error("crypto.getRandomValues must be defined")}function number$1(n){if(!Number.isSafeInteger(n)||n<0)throw new Error(`Wrong positive integer: ${n}`)}function bool$1(n){if(typeof n!="boolean")throw new Error(`Expected boolean, not ${n}`)}function bytes$1(n,...t){if(!(n instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(n.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${n.length}`)}function hash(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$1(n.outputLen),number$1(n.blockLen)}function exists(n,t=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(t&&n.finished)throw new Error("Hash#digest() has already been called")}function output(n,t){bytes$1(n);const e=t.outputLen;if(n.length<e)throw new Error(`digestInto() expects output buffer of length at least ${e}`)}const assert={number:number$1,bool:bool$1,bytes:bytes$1,hash,exists,output};function setBigUint64$1(n,t,e,s){if(typeof n.setBigUint64=="function")return n.setBigUint64(t,e,s);const a=BigInt(32),o=BigInt(4294967295),f=Number(e>>a&o),p=Number(e&o),y=s?4:0,g=s?0:4;n.setUint32(t+y,f,s),n.setUint32(t+g,p,s)}class SHA2 extends Hash$1{constructor(t,e,s,a){super(),this.blockLen=t,this.outputLen=e,this.padOffset=s,this.isLE=a,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=createView$1(this.buffer)}update(t){assert.exists(this);const{view:e,buffer:s,blockLen:a}=this;t=toBytes$1(t);const o=t.length;for(let f=0;f<o;){const p=Math.min(a-this.pos,o-f);if(p===a){const y=createView$1(t);for(;a<=o-f;f+=a)this.process(y,f);continue}s.set(t.subarray(f,f+p),this.pos),this.pos+=p,f+=p,this.pos===a&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){assert.exists(this),assert.output(t,this),this.finished=!0;const{buffer:e,view:s,blockLen:a,isLE:o}=this;let{pos:f}=this;e[f++]=128,this.buffer.subarray(f).fill(0),this.padOffset>a-f&&(this.process(s,0),f=0);for(let E=f;E<a;E++)e[E]=0;setBigUint64$1(s,a-8,BigInt(this.length*8),o),this.process(s,0);const p=createView$1(t),y=this.outputLen;if(y%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const g=y/4,x=this.get();if(g>x.length)throw new Error("_sha2: outputLen bigger than state");for(let E=0;E<g;E++)p.setUint32(4*E,x[E],o)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const s=t.slice(0,e);return this.destroy(),s}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:s,length:a,finished:o,destroyed:f,pos:p}=this;return t.length=a,t.pos=p,t.finished=o,t.destroyed=f,a%e&&t.buffer.set(s),t}}const Chi$1=(n,t,e)=>n&t^~n&e,Maj$1=(n,t,e)=>n&t^n&e^t&e,SHA256_K$1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$1=new Uint32Array(64);let SHA256$1=class extends SHA2{constructor(){super(64,32,8,!1),this.A=IV[0]|0,this.B=IV[1]|0,this.C=IV[2]|0,this.D=IV[3]|0,this.E=IV[4]|0,this.F=IV[5]|0,this.G=IV[6]|0,this.H=IV[7]|0}get(){const{A:t,B:e,C:s,D:a,E:o,F:f,G:p,H:y}=this;return[t,e,s,a,o,f,p,y]}set(t,e,s,a,o,f,p,y){this.A=t|0,this.B=e|0,this.C=s|0,this.D=a|0,this.E=o|0,this.F=f|0,this.G=p|0,this.H=y|0}process(t,e){for(let E=0;E<16;E++,e+=4)SHA256_W$1[E]=t.getUint32(e,!1);for(let E=16;E<64;E++){const A=SHA256_W$1[E-15],S=SHA256_W$1[E-2],I=rotr$1(A,7)^rotr$1(A,18)^A>>>3,_=rotr$1(S,17)^rotr$1(S,19)^S>>>10;SHA256_W$1[E]=_+SHA256_W$1[E-7]+I+SHA256_W$1[E-16]|0}let{A:s,B:a,C:o,D:f,E:p,F:y,G:g,H:x}=this;for(let E=0;E<64;E++){const A=rotr$1(p,6)^rotr$1(p,11)^rotr$1(p,25),S=x+A+Chi$1(p,y,g)+SHA256_K$1[E]+SHA256_W$1[E]|0,_=(rotr$1(s,2)^rotr$1(s,13)^rotr$1(s,22))+Maj$1(s,a,o)|0;x=g,g=y,y=p,p=f+S|0,f=o,o=a,a=s,s=S+_|0}s=s+this.A|0,a=a+this.B|0,o=o+this.C|0,f=f+this.D|0,p=p+this.E|0,y=y+this.F|0,g=g+this.G|0,x=x+this.H|0,this.set(s,a,o,f,p,y,g,x)}roundClean(){SHA256_W$1.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};class SHA224 extends SHA256$1{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const sha256$3=wrapConstructor(()=>new SHA256$1);wrapConstructor(()=>new SHA224);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function assertNumber(n){if(!Number.isSafeInteger(n))throw new Error(`Wrong integer: ${n}`)}function chain(...n){const t=(a,o)=>f=>a(o(f)),e=Array.from(n).reverse().reduce((a,o)=>a?t(a,o.encode):o.encode,void 0),s=n.reduce((a,o)=>a?t(a,o.decode):o.decode,void 0);return{encode:e,decode:s}}function alphabet(n){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(e=>{if(assertNumber(e),e<0||e>=n.length)throw new Error(`Digit index outside alphabet: ${e} (alphabet: ${n.length})`);return n[e]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(e=>{if(typeof e!="string")throw new Error(`alphabet.decode: not string element=${e}`);const s=n.indexOf(e);if(s===-1)throw new Error(`Unknown letter: "${e}". Allowed: ${n}`);return s})}}}function join(n=""){if(typeof n!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let e of t)if(typeof e!="string")throw new Error(`join.encode: non-string input=${e}`);return t.join(n)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(n)}}}function padding(n,t="="){if(assertNumber(n),typeof t!="string")throw new Error("padding chr should be string");return{encode(e){if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("padding.encode input should be array of strings");for(let s of e)if(typeof s!="string")throw new Error(`padding.encode: non-string input=${s}`);for(;e.length*n%8;)e.push(t);return e},decode(e){if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("padding.encode input should be array of strings");for(let a of e)if(typeof a!="string")throw new Error(`padding.decode: non-string input=${a}`);let s=e.length;if(s*n%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;s>0&&e[s-1]===t;s--)if(!((s-1)*n%8))throw new Error("Invalid padding: string has too much padding");return e.slice(0,s)}}}function normalize$1(n){if(typeof n!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>n(t)}}function convertRadix(n,t,e){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(e<2)throw new Error(`convertRadix: wrong to=${e}, base cannot be less than 2`);if(!Array.isArray(n))throw new Error("convertRadix: data should be array");if(!n.length)return[];let s=0;const a=[],o=Array.from(n);for(o.forEach(f=>{if(assertNumber(f),f<0||f>=t)throw new Error(`Wrong integer: ${f}`)});;){let f=0,p=!0;for(let y=s;y<o.length;y++){const g=o[y],x=t*f+g;if(!Number.isSafeInteger(x)||t*f/t!==f||x-g!==t*f)throw new Error("convertRadix: carry overflow");if(f=x%e,o[y]=Math.floor(x/e),!Number.isSafeInteger(o[y])||o[y]*e+f!==x)throw new Error("convertRadix: carry overflow");if(p)o[y]?p=!1:s=y;else continue}if(a.push(f),p)break}for(let f=0;f<n.length-1&&n[f]===0;f++)a.push(0);return a.reverse()}const gcd=(n,t)=>t?gcd(t,n%t):n,radix2carry=(n,t)=>n+(t-gcd(n,t));function convertRadix2(n,t,e,s){if(!Array.isArray(n))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(e<=0||e>32)throw new Error(`convertRadix2: wrong to=${e}`);if(radix2carry(t,e)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${e} carryBits=${radix2carry(t,e)}`);let a=0,o=0;const f=2**e-1,p=[];for(const y of n){if(assertNumber(y),y>=2**t)throw new Error(`convertRadix2: invalid data word=${y} from=${t}`);if(a=a<<t|y,o+t>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${t}`);for(o+=t;o>=e;o-=e)p.push((a>>o-e&f)>>>0);a&=2**o-1}if(a=a<<e-o&f,!s&&o>=t)throw new Error("Excess padding");if(!s&&a)throw new Error(`Non-zero padding: ${a}`);return s&&o>0&&p.push(a>>>0),p}function radix(n){return assertNumber(n),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return convertRadix(Array.from(t),2**8,n)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(convertRadix(t,n,2**8))}}}function radix2(n,t=!1){if(assertNumber(n),n<=0||n>32)throw new Error("radix2: bits should be in (0..32]");if(radix2carry(8,n)>32||radix2carry(n,8)>32)throw new Error("radix2: carry overflow");return{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return convertRadix2(Array.from(e),8,n,!t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(convertRadix2(e,n,8,t))}}}function unsafeWrapper(n){if(typeof n!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return n.apply(null,t)}catch{}}}const base16=chain(radix2(4),alphabet("0123456789ABCDEF"),join("")),base32=chain(radix2(5),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),padding(5),join(""));chain(radix2(5),alphabet("0123456789ABCDEFGHIJKLMNOPQRSTUV"),padding(5),join(""));chain(radix2(5),alphabet("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),join(""),normalize$1(n=>n.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const base64=chain(radix2(6),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),padding(6),join("")),base64url=chain(radix2(6),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),padding(6),join("")),genBase58=n=>chain(radix(58),alphabet(n),join("")),base58=genBase58("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");genBase58("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");genBase58("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const XMR_BLOCK_LEN=[0,2,3,5,6,7,9,10,11],base58xmr={encode(n){let t="";for(let e=0;e<n.length;e+=8){const s=n.subarray(e,e+8);t+=base58.encode(s).padStart(XMR_BLOCK_LEN[s.length],"1")}return t},decode(n){let t=[];for(let e=0;e<n.length;e+=11){const s=n.slice(e,e+11),a=XMR_BLOCK_LEN.indexOf(s.length),o=base58.decode(s);for(let f=0;f<o.length-a;f++)if(o[f]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(o.slice(o.length-a)))}return Uint8Array.from(t)}},BECH_ALPHABET=chain(alphabet("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),join("")),POLYMOD_GENERATORS=[996825010,642813549,513874426,1027748829,705979059];function bech32Polymod(n){const t=n>>25;let e=(n&33554431)<<5;for(let s=0;s<POLYMOD_GENERATORS.length;s++)(t>>s&1)===1&&(e^=POLYMOD_GENERATORS[s]);return e}function bechChecksum(n,t,e=1){const s=n.length;let a=1;for(let o=0;o<s;o++){const f=n.charCodeAt(o);if(f<33||f>126)throw new Error(`Invalid prefix (${n})`);a=bech32Polymod(a)^f>>5}a=bech32Polymod(a);for(let o=0;o<s;o++)a=bech32Polymod(a)^n.charCodeAt(o)&31;for(let o of t)a=bech32Polymod(a)^o;for(let o=0;o<6;o++)a=bech32Polymod(a);return a^=e,BECH_ALPHABET.encode(convertRadix2([a%2**30],30,5,!1))}function genBech32(n){const t=n==="bech32"?1:734539939,e=radix2(5),s=e.decode,a=e.encode,o=unsafeWrapper(s);function f(x,E,A=90){if(typeof x!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof x}`);if(!Array.isArray(E)||E.length&&typeof E[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof E}`);const S=x.length+7+E.length;if(A!==!1&&S>A)throw new TypeError(`Length ${S} exceeds limit ${A}`);return x=x.toLowerCase(),`${x}1${BECH_ALPHABET.encode(E)}${bechChecksum(x,E,t)}`}function p(x,E=90){if(typeof x!="string")throw new Error(`bech32.decode input should be string, not ${typeof x}`);if(x.length<8||E!==!1&&x.length>E)throw new TypeError(`Wrong string length: ${x.length} (${x}). Expected (8..${E})`);const A=x.toLowerCase();if(x!==A&&x!==x.toUpperCase())throw new Error("String must be lowercase or uppercase");x=A;const S=x.lastIndexOf("1");if(S===0||S===-1)throw new Error('Letter "1" must be present between prefix and data only');const I=x.slice(0,S),_=x.slice(S+1);if(_.length<6)throw new Error("Data must be at least 6 characters long");const R=BECH_ALPHABET.decode(_).slice(0,-6),N=bechChecksum(I,R,t);if(!_.endsWith(N))throw new Error(`Invalid checksum in ${x}: expected "${N}"`);return{prefix:I,words:R}}const y=unsafeWrapper(p);function g(x){const{prefix:E,words:A}=p(x,!1);return{prefix:E,words:A,bytes:s(A)}}return{encode:f,decode:p,decodeToBytes:g,decodeUnsafe:y,fromWords:s,fromWordsUnsafe:o,toWords:a}}const bech32=genBech32("bech32");genBech32("bech32m");const utf8={encode:n=>new TextDecoder().decode(n),decode:n=>new TextEncoder().encode(n)},hex=chain(radix2(4),alphabet("0123456789abcdef"),join(""),normalize$1(n=>{if(typeof n!="string"||n.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof n} with length ${n.length}`);return n.toLowerCase()})),CODERS={utf8,hex,base16,base32,base64,base64url,base58,base58xmr};`${Object.keys(CODERS).join(", ")}`;function number(n){if(!Number.isSafeInteger(n)||n<0)throw new Error(`positive integer expected, not ${n}`)}function bool(n){if(typeof n!="boolean")throw new Error(`boolean expected, not ${n}`)}function isBytes$2(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function bytes(n,...t){if(!isBytes$2(n))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(n.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${n.length}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const u32=n=>new Uint32Array(n.buffer,n.byteOffset,Math.floor(n.byteLength/4)),isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE)throw new Error("Non little-endian hardware is not supported");function checkOpts(n,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(n,t)}function equalBytes(n,t){if(n.length!==t.length)return!1;let e=0;for(let s=0;s<n.length;s++)e|=n[s]^t[s];return e===0}const wrapCipher=(n,t)=>(Object.assign(t,n),t),BLOCK_SIZE=16,POLY=283;function mul2(n){return n<<1^POLY&-(n>>7)}function mul(n,t){let e=0;for(;t>0;t>>=1)e^=n&-(t&1),n=mul2(n);return e}const sbox=(()=>{let n=new Uint8Array(256);for(let e=0,s=1;e<256;e++,s^=mul2(s))n[e]=s;const t=new Uint8Array(256);t[0]=99;for(let e=0;e<255;e++){let s=n[255-e];s|=s<<8,t[n[e]]=(s^s>>4^s>>5^s>>6^s>>7^99)&255}return t})(),invSbox=sbox.map((n,t)=>sbox.indexOf(t)),rotr32_8=n=>n<<24|n>>>8,rotl32_8=n=>n<<8|n>>>24;function genTtable(n,t){if(n.length!==256)throw new Error("Wrong sbox length");const e=new Uint32Array(256).map((g,x)=>t(n[x])),s=e.map(rotl32_8),a=s.map(rotl32_8),o=a.map(rotl32_8),f=new Uint32Array(256*256),p=new Uint32Array(256*256),y=new Uint16Array(256*256);for(let g=0;g<256;g++)for(let x=0;x<256;x++){const E=g*256+x;f[E]=e[g]^s[x],p[E]=a[g]^o[x],y[E]=n[g]<<8|n[x]}return{sbox:n,sbox2:y,T0:e,T1:s,T2:a,T3:o,T01:f,T23:p}}const tableEncoding=genTtable(sbox,n=>mul(n,3)<<24|n<<16|n<<8|mul(n,2)),tableDecoding=genTtable(invSbox,n=>mul(n,11)<<24|mul(n,13)<<16|mul(n,9)<<8|mul(n,14)),xPowers=(()=>{const n=new Uint8Array(16);for(let t=0,e=1;t<16;t++,e=mul2(e))n[t]=e;return n})();function expandKeyLE(n){bytes(n);const t=n.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);const{sbox2:e}=tableEncoding,s=u32(n),a=s.length,o=p=>applySbox(e,p,p,p,p),f=new Uint32Array(t+28);f.set(s);for(let p=a;p<f.length;p++){let y=f[p-1];p%a===0?y=o(rotr32_8(y))^xPowers[p/a-1]:a>6&&p%a===4&&(y=o(y)),f[p]=f[p-a]^y}return f}function expandKeyDecLE(n){const t=expandKeyLE(n),e=t.slice(),s=t.length,{sbox2:a}=tableEncoding,{T0:o,T1:f,T2:p,T3:y}=tableDecoding;for(let g=0;g<s;g+=4)for(let x=0;x<4;x++)e[g+x]=t[s-g-4+x];t.fill(0);for(let g=4;g<s-4;g++){const x=e[g],E=applySbox(a,x,x,x,x);e[g]=o[E&255]^f[E>>>8&255]^p[E>>>16&255]^y[E>>>24]}return e}function apply0123(n,t,e,s,a,o){return n[e<<8&65280|s>>>8&255]^t[a>>>8&65280|o>>>24&255]}function applySbox(n,t,e,s,a){return n[t&255|e&65280]|n[s>>>16&255|a>>>16&65280]<<16}function encrypt$2(n,t,e,s,a){const{sbox2:o,T01:f,T23:p}=tableEncoding;let y=0;t^=n[y++],e^=n[y++],s^=n[y++],a^=n[y++];const g=n.length/4-2;for(let I=0;I<g;I++){const _=n[y++]^apply0123(f,p,t,e,s,a),R=n[y++]^apply0123(f,p,e,s,a,t),N=n[y++]^apply0123(f,p,s,a,t,e),D=n[y++]^apply0123(f,p,a,t,e,s);t=_,e=R,s=N,a=D}const x=n[y++]^applySbox(o,t,e,s,a),E=n[y++]^applySbox(o,e,s,a,t),A=n[y++]^applySbox(o,s,a,t,e),S=n[y++]^applySbox(o,a,t,e,s);return{s0:x,s1:E,s2:A,s3:S}}function decrypt$2(n,t,e,s,a){const{sbox2:o,T01:f,T23:p}=tableDecoding;let y=0;t^=n[y++],e^=n[y++],s^=n[y++],a^=n[y++];const g=n.length/4-2;for(let I=0;I<g;I++){const _=n[y++]^apply0123(f,p,t,a,s,e),R=n[y++]^apply0123(f,p,e,t,a,s),N=n[y++]^apply0123(f,p,s,e,t,a),D=n[y++]^apply0123(f,p,a,s,e,t);t=_,e=R,s=N,a=D}const x=n[y++]^applySbox(o,t,a,s,e),E=n[y++]^applySbox(o,e,t,a,s),A=n[y++]^applySbox(o,s,e,t,a),S=n[y++]^applySbox(o,a,s,e,t);return{s0:x,s1:E,s2:A,s3:S}}function getDst(n,t){if(!t)return new Uint8Array(n);if(bytes(t),t.length<n)throw new Error(`aes: wrong destination length, expected at least ${n}, got: ${t.length}`);return t}function validateBlockDecrypt(n){if(bytes(n),n.length%BLOCK_SIZE!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${BLOCK_SIZE}`)}function validateBlockEncrypt(n,t,e){let s=n.length;const a=s%BLOCK_SIZE;if(!t&&a!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const o=u32(n);if(t){let y=BLOCK_SIZE-a;y||(y=BLOCK_SIZE),s=s+y}const f=getDst(s,e),p=u32(f);return{b:o,o:p,out:f}}function validatePCKS(n,t){if(!t)return n;const e=n.length;if(!e)throw new Error("aes/pcks5: empty ciphertext not allowed");const s=n[e-1];if(s<=0||s>16)throw new Error(`aes/pcks5: wrong padding byte: ${s}`);const a=n.subarray(0,-s);for(let o=0;o<s;o++)if(n[e-o-1]!==s)throw new Error("aes/pcks5: wrong padding");return a}function padPCKS(n){const t=new Uint8Array(16),e=u32(t);t.set(n);const s=BLOCK_SIZE-n.length;for(let a=BLOCK_SIZE-s;a<BLOCK_SIZE;a++)t[a]=s;return e}const cbc=wrapCipher({blockSize:16,nonceLength:16},function n(t,e,s={}){bytes(t),bytes(e,16);const a=!s.disablePadding;return{encrypt:(o,f)=>{const p=expandKeyLE(t),{b:y,o:g,out:x}=validateBlockEncrypt(o,a,f),E=u32(e);let A=E[0],S=E[1],I=E[2],_=E[3],R=0;for(;R+4<=y.length;)A^=y[R+0],S^=y[R+1],I^=y[R+2],_^=y[R+3],{s0:A,s1:S,s2:I,s3:_}=encrypt$2(p,A,S,I,_),g[R++]=A,g[R++]=S,g[R++]=I,g[R++]=_;if(a){const N=padPCKS(o.subarray(R*4));A^=N[0],S^=N[1],I^=N[2],_^=N[3],{s0:A,s1:S,s2:I,s3:_}=encrypt$2(p,A,S,I,_),g[R++]=A,g[R++]=S,g[R++]=I,g[R++]=_}return p.fill(0),x},decrypt:(o,f)=>{validateBlockDecrypt(o);const p=expandKeyDecLE(t),y=u32(e),g=getDst(o.length,f),x=u32(o),E=u32(g);let A=y[0],S=y[1],I=y[2],_=y[3];for(let R=0;R+4<=x.length;){const N=A,D=S,M=I,W=_;A=x[R+0],S=x[R+1],I=x[R+2],_=x[R+3];const{s0:B,s1:U,s2:P,s3:F}=decrypt$2(p,A,S,I,_);E[R++]=B^N,E[R++]=U^D,E[R++]=P^M,E[R++]=F^W}return p.fill(0),validatePCKS(g,a)}}}),_utf8ToBytes=n=>Uint8Array.from(n.split("").map(t=>t.charCodeAt(0))),sigma16=_utf8ToBytes("expand 16-byte k"),sigma32=_utf8ToBytes("expand 32-byte k"),sigma16_32=u32(sigma16),sigma32_32=u32(sigma32);sigma32_32.slice();function rotl(n,t){return n<<t|n>>>32-t}function isAligned32(n){return n.byteOffset%4===0}const BLOCK_LEN=64,BLOCK_LEN32=16,MAX_COUNTER=2**32-1,U32_EMPTY=new Uint32Array;function runCipher(n,t,e,s,a,o,f,p){const y=a.length,g=new Uint8Array(BLOCK_LEN),x=u32(g),E=isAligned32(a)&&isAligned32(o),A=E?u32(a):U32_EMPTY,S=E?u32(o):U32_EMPTY;for(let I=0;I<y;f++){if(n(t,e,s,x,f,p),f>=MAX_COUNTER)throw new Error("arx: counter overflow");const _=Math.min(BLOCK_LEN,y-I);if(E&&_===BLOCK_LEN){const R=I/4;if(I%4!==0)throw new Error("arx: invalid block position");for(let N=0,D;N<BLOCK_LEN32;N++)D=R+N,S[D]=A[D]^x[N];I+=BLOCK_LEN;continue}for(let R=0,N;R<_;R++)N=I+R,o[N]=a[N]^g[R];I+=_}}function createCipher(n,t){const{allowShortKeys:e,extendNonceFn:s,counterLength:a,counterRight:o,rounds:f}=checkOpts({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof n!="function")throw new Error("core must be a function");return number(a),number(f),bool(o),bool(e),(p,y,g,x,E=0)=>{bytes(p),bytes(y),bytes(g);const A=g.length;if(x||(x=new Uint8Array(A)),bytes(x),number(E),E<0||E>=MAX_COUNTER)throw new Error("arx: counter overflow");if(x.length<A)throw new Error(`arx: output (${x.length}) is shorter than data (${A})`);const S=[];let I=p.length,_,R;if(I===32)_=p.slice(),S.push(_),R=sigma32_32;else if(I===16&&e)_=new Uint8Array(32),_.set(p),_.set(p,16),R=sigma16_32,S.push(_);else throw new Error(`arx: invalid 32-byte key, got length=${I}`);isAligned32(y)||(y=y.slice(),S.push(y));const N=u32(_);if(s){if(y.length!==24)throw new Error("arx: extended nonce must be 24 bytes");s(R,N,u32(y.subarray(0,16)),N),y=y.subarray(16)}const D=16-a;if(D!==y.length)throw new Error(`arx: nonce must be ${D} or 16 bytes`);if(D!==12){const W=new Uint8Array(12);W.set(y,o?0:12-y.length),y=W,S.push(y)}const M=u32(y);for(runCipher(n,R,N,M,g,x,E,f);S.length>0;)S.pop().fill(0);return x}}function chachaCore(n,t,e,s,a,o=20){let f=n[0],p=n[1],y=n[2],g=n[3],x=t[0],E=t[1],A=t[2],S=t[3],I=t[4],_=t[5],R=t[6],N=t[7],D=a,M=e[0],W=e[1],B=e[2],U=f,P=p,F=y,j=g,Q=x,$=E,V=A,G=S,se=I,H=_,J=R,K=N,ie=D,ne=M,re=W,X=B;for(let te=0;te<o;te+=2)U=U+Q|0,ie=rotl(ie^U,16),se=se+ie|0,Q=rotl(Q^se,12),U=U+Q|0,ie=rotl(ie^U,8),se=se+ie|0,Q=rotl(Q^se,7),P=P+$|0,ne=rotl(ne^P,16),H=H+ne|0,$=rotl($^H,12),P=P+$|0,ne=rotl(ne^P,8),H=H+ne|0,$=rotl($^H,7),F=F+V|0,re=rotl(re^F,16),J=J+re|0,V=rotl(V^J,12),F=F+V|0,re=rotl(re^F,8),J=J+re|0,V=rotl(V^J,7),j=j+G|0,X=rotl(X^j,16),K=K+X|0,G=rotl(G^K,12),j=j+G|0,X=rotl(X^j,8),K=K+X|0,G=rotl(G^K,7),U=U+$|0,X=rotl(X^U,16),J=J+X|0,$=rotl($^J,12),U=U+$|0,X=rotl(X^U,8),J=J+X|0,$=rotl($^J,7),P=P+V|0,ie=rotl(ie^P,16),K=K+ie|0,V=rotl(V^K,12),P=P+V|0,ie=rotl(ie^P,8),K=K+ie|0,V=rotl(V^K,7),F=F+G|0,ne=rotl(ne^F,16),se=se+ne|0,G=rotl(G^se,12),F=F+G|0,ne=rotl(ne^F,8),se=se+ne|0,G=rotl(G^se,7),j=j+Q|0,re=rotl(re^j,16),H=H+re|0,Q=rotl(Q^H,12),j=j+Q|0,re=rotl(re^j,8),H=H+re|0,Q=rotl(Q^H,7);let ae=0;s[ae++]=f+U|0,s[ae++]=p+P|0,s[ae++]=y+F|0,s[ae++]=g+j|0,s[ae++]=x+Q|0,s[ae++]=E+$|0,s[ae++]=A+V|0,s[ae++]=S+G|0,s[ae++]=I+se|0,s[ae++]=_+H|0,s[ae++]=R+J|0,s[ae++]=N+K|0,s[ae++]=D+ie|0,s[ae++]=M+ne|0,s[ae++]=W+re|0,s[ae++]=B+X|0}const chacha20=createCipher(chachaCore,{counterRight:!1,counterLength:4,allowShortKeys:!1});let HMAC$1=class extends Hash$1{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,assert.hash(t);const s=toBytes$1(e);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const a=this.blockLen,o=new Uint8Array(a);o.set(s.length>a?t.create().update(s).digest():s);for(let f=0;f<o.length;f++)o[f]^=54;this.iHash.update(o),this.oHash=t.create();for(let f=0;f<o.length;f++)o[f]^=106;this.oHash.update(o),o.fill(0)}update(t){return assert.exists(this),this.iHash.update(t),this}digestInto(t){assert.exists(this),assert.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:s,finished:a,destroyed:o,blockLen:f,outputLen:p}=this;return t=t,t.finished=a,t.destroyed=o,t.blockLen=f,t.outputLen=p,t.oHash=e._cloneInto(t.oHash),t.iHash=s._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$2=(n,t,e)=>new HMAC$1(n,t).update(e).digest();hmac$2.create=(n,t)=>new HMAC$1(n,t);function extract(n,t,e){return assert.hash(n),hmac$2(n,toBytes$1(e),toBytes$1(t))}const HKDF_COUNTER=new Uint8Array([0]),EMPTY_BUFFER=new Uint8Array;function expand(n,t,e,s=32){if(assert.hash(n),assert.number(s),s>255*n.outputLen)throw new Error("Length should be <= 255*HashLen");const a=Math.ceil(s/n.outputLen);e===void 0&&(e=EMPTY_BUFFER);const o=new Uint8Array(a*n.outputLen),f=hmac$2.create(n,t),p=f._cloneInto(),y=new Uint8Array(f.outputLen);for(let g=0;g<a;g++)HKDF_COUNTER[0]=g+1,p.update(g===0?EMPTY_BUFFER:y).update(e).update(HKDF_COUNTER).digestInto(y),o.set(y,n.outputLen*g),f._cloneInto(p);return f.destroy(),p.destroy(),y.fill(0),HKDF_COUNTER.fill(0),o.slice(0,s)}var __defProp$1=Object.defineProperty,__export=(n,t)=>{for(var e in t)__defProp$1(n,e,{get:t[e],enumerable:!0})},verifiedSymbol=Symbol("verified"),isRecord=n=>n instanceof Object;function validateEvent(n){if(!isRecord(n)||typeof n.kind!="number"||typeof n.content!="string"||typeof n.created_at!="number"||typeof n.pubkey!="string"||!n.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(n.tags))return!1;for(let t=0;t<n.tags.length;t++){let e=n.tags[t];if(!Array.isArray(e))return!1;for(let s=0;s<e.length;s++)if(typeof e[s]=="object")return!1}return!0}var utils_exports={};__export(utils_exports,{Queue:()=>Queue$1,QueueNode:()=>QueueNode,binarySearch:()=>binarySearch,insertEventIntoAscendingList:()=>insertEventIntoAscendingList,insertEventIntoDescendingList:()=>insertEventIntoDescendingList,normalizeURL:()=>normalizeURL,utf8Decoder:()=>utf8Decoder,utf8Encoder:()=>utf8Encoder});var utf8Decoder=new TextDecoder("utf-8"),utf8Encoder=new TextEncoder;function normalizeURL(n){n.indexOf("://")===-1&&(n="wss://"+n);let t=new URL(n);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}function insertEventIntoDescendingList(n,t){const[e,s]=binarySearch(n,a=>t.id===a.id?0:t.created_at===a.created_at?-1:a.created_at-t.created_at);return s||n.splice(e,0,t),n}function insertEventIntoAscendingList(n,t){const[e,s]=binarySearch(n,a=>t.id===a.id?0:t.created_at===a.created_at?-1:t.created_at-a.created_at);return s||n.splice(e,0,t),n}function binarySearch(n,t){let e=0,s=n.length-1;for(;e<=s;){const a=Math.floor((e+s)/2),o=t(n[a]);if(o===0)return[a,!0];o<0?s=a-1:e=a+1}return[e,!1]}var QueueNode=class{constructor(n){pe(this,"value");pe(this,"next",null);pe(this,"prev",null);this.value=n}},Queue$1=class{constructor(){pe(this,"first");pe(this,"last");this.first=null,this.last=null}enqueue(t){const e=new QueueNode(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,t.value}},JS=class{generateSecretKey(){return schnorr$1.utils.randomPrivateKey()}getPublicKey(n){return bytesToHex$2(schnorr$1.getPublicKey(n))}finalizeEvent(n,t){const e=n;return e.pubkey=bytesToHex$2(schnorr$1.getPublicKey(t)),e.id=getEventHash$1(e),e.sig=bytesToHex$2(schnorr$1.sign(getEventHash$1(e),t)),e[verifiedSymbol]=!0,e}verifyEvent(n){if(typeof n[verifiedSymbol]=="boolean")return n[verifiedSymbol];const t=getEventHash$1(n);if(t!==n.id)return n[verifiedSymbol]=!1,!1;try{const e=schnorr$1.verify(n.sig,t,n.pubkey);return n[verifiedSymbol]=e,e}catch{return n[verifiedSymbol]=!1,!1}}};function serializeEvent(n){if(!validateEvent(n))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,n.pubkey,n.created_at,n.kind,n.tags,n.content])}function getEventHash$1(n){let t=sha256$3(utf8Encoder.encode(serializeEvent(n)));return bytesToHex$2(t)}var i=new JS,generateSecretKey=i.generateSecretKey,getPublicKey=i.getPublicKey,finalizeEvent=i.finalizeEvent,verifyEvent=i.verifyEvent,kinds_exports={};__export(kinds_exports,{Application:()=>Application,BadgeAward:()=>BadgeAward,BadgeDefinition:()=>BadgeDefinition,BlockedRelaysList:()=>BlockedRelaysList,BookmarkList:()=>BookmarkList,Bookmarksets:()=>Bookmarksets,Calendar:()=>Calendar,CalendarEventRSVP:()=>CalendarEventRSVP,ChannelCreation:()=>ChannelCreation,ChannelHideMessage:()=>ChannelHideMessage,ChannelMessage:()=>ChannelMessage,ChannelMetadata:()=>ChannelMetadata,ChannelMuteUser:()=>ChannelMuteUser,ClassifiedListing:()=>ClassifiedListing,ClientAuth:()=>ClientAuth,CommunitiesList:()=>CommunitiesList,CommunityDefinition:()=>CommunityDefinition,CommunityPostApproval:()=>CommunityPostApproval,Contacts:()=>Contacts,CreateOrUpdateProduct:()=>CreateOrUpdateProduct,CreateOrUpdateStall:()=>CreateOrUpdateStall,Curationsets:()=>Curationsets,Date:()=>Date2,DirectMessageRelaysList:()=>DirectMessageRelaysList,DraftClassifiedListing:()=>DraftClassifiedListing,DraftLong:()=>DraftLong,Emojisets:()=>Emojisets,EncryptedDirectMessage:()=>EncryptedDirectMessage,EventDeletion:()=>EventDeletion,FileMetadata:()=>FileMetadata,FileServerPreference:()=>FileServerPreference,Followsets:()=>Followsets,GenericRepost:()=>GenericRepost,Genericlists:()=>Genericlists,GiftWrap:()=>GiftWrap,HTTPAuth:()=>HTTPAuth,Handlerinformation:()=>Handlerinformation,Handlerrecommendation:()=>Handlerrecommendation,Highlights:()=>Highlights,InterestsList:()=>InterestsList,Interestsets:()=>Interestsets,JobFeedback:()=>JobFeedback,JobRequest:()=>JobRequest,JobResult:()=>JobResult,Label:()=>Label,LightningPubRPC:()=>LightningPubRPC,LiveChatMessage:()=>LiveChatMessage,LiveEvent:()=>LiveEvent,LongFormArticle:()=>LongFormArticle,Metadata:()=>Metadata,Mutelist:()=>Mutelist,NWCWalletInfo:()=>NWCWalletInfo,NWCWalletRequest:()=>NWCWalletRequest,NWCWalletResponse:()=>NWCWalletResponse,NostrConnect:()=>NostrConnect,OpenTimestamps:()=>OpenTimestamps,Pinlist:()=>Pinlist,PrivateDirectMessage:()=>PrivateDirectMessage,ProblemTracker:()=>ProblemTracker,ProfileBadges:()=>ProfileBadges,PublicChatsList:()=>PublicChatsList,Reaction:()=>Reaction,RecommendRelay:()=>RecommendRelay,RelayList:()=>RelayList,Relaysets:()=>Relaysets,Report:()=>Report,Reporting:()=>Reporting,Repost:()=>Repost,Seal:()=>Seal,SearchRelaysList:()=>SearchRelaysList,ShortTextNote:()=>ShortTextNote,Time:()=>Time,UserEmojiList:()=>UserEmojiList,UserStatuses:()=>UserStatuses,Zap:()=>Zap,ZapGoal:()=>ZapGoal,ZapRequest:()=>ZapRequest,classifyKind:()=>classifyKind,isAddressableKind:()=>isAddressableKind,isEphemeralKind:()=>isEphemeralKind,isKind:()=>isKind,isParameterizedReplaceableKind:()=>isParameterizedReplaceableKind,isRegularKind:()=>isRegularKind,isReplaceableKind:()=>isReplaceableKind});function isRegularKind(n){return 1e3<=n&&n<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(n)}function isReplaceableKind(n){return[0,3].includes(n)||1e4<=n&&n<2e4}function isEphemeralKind(n){return 2e4<=n&&n<3e4}function isAddressableKind(n){return 3e4<=n&&n<4e4}var isParameterizedReplaceableKind=isAddressableKind;function classifyKind(n){return isRegularKind(n)?"regular":isReplaceableKind(n)?"replaceable":isEphemeralKind(n)?"ephemeral":isAddressableKind(n)?"parameterized":"unknown"}function isKind(n,t){const e=t instanceof Array?t:[t];return validateEvent(n)&&e.includes(n.kind)||!1}var Metadata=0,ShortTextNote=1,RecommendRelay=2,Contacts=3,EncryptedDirectMessage=4,EventDeletion=5,Repost=6,Reaction=7,BadgeAward=8,Seal=13,PrivateDirectMessage=14,GenericRepost=16,ChannelCreation=40,ChannelMetadata=41,ChannelMessage=42,ChannelHideMessage=43,ChannelMuteUser=44,OpenTimestamps=1040,GiftWrap=1059,FileMetadata=1063,LiveChatMessage=1311,ProblemTracker=1971,Report=1984,Reporting=1984,Label=1985,CommunityPostApproval=4550,JobRequest=5999,JobResult=6999,JobFeedback=7e3,ZapGoal=9041,ZapRequest=9734,Zap=9735,Highlights=9802,Mutelist=1e4,Pinlist=10001,RelayList=10002,BookmarkList=10003,CommunitiesList=10004,PublicChatsList=10005,BlockedRelaysList=10006,SearchRelaysList=10007,InterestsList=10015,UserEmojiList=10030,DirectMessageRelaysList=10050,FileServerPreference=10096,NWCWalletInfo=13194,LightningPubRPC=21e3,ClientAuth=22242,NWCWalletRequest=23194,NWCWalletResponse=23195,NostrConnect=24133,HTTPAuth=27235,Followsets=3e4,Genericlists=30001,Relaysets=30002,Bookmarksets=30003,Curationsets=30004,ProfileBadges=30008,BadgeDefinition=30009,Interestsets=30015,CreateOrUpdateStall=30017,CreateOrUpdateProduct=30018,LongFormArticle=30023,DraftLong=30024,Emojisets=30030,Application=30078,LiveEvent=30311,UserStatuses=30315,ClassifiedListing=30402,DraftClassifiedListing=30403,Date2=31922,Time=31923,Calendar=31924,CalendarEventRSVP=31925,Handlerrecommendation=31989,Handlerinformation=31990,CommunityDefinition=34550;function matchFilter(n,t){if(n.ids&&n.ids.indexOf(t.id)===-1||n.kinds&&n.kinds.indexOf(t.kind)===-1||n.authors&&n.authors.indexOf(t.pubkey)===-1)return!1;for(let e in n)if(e[0]==="#"){let s=e.slice(1),a=n[`#${s}`];if(a&&!t.tags.find(([o,f])=>o===e.slice(1)&&a.indexOf(f)!==-1))return!1}return!(n.since&&t.created_at<n.since||n.until&&t.created_at>n.until)}function matchFilters(n,t){for(let e=0;e<n.length;e++)if(matchFilter(n[e],t))return!0;return!1}var fakejson_exports={};__export(fakejson_exports,{getHex64:()=>getHex64,getInt:()=>getInt,getSubscriptionId:()=>getSubscriptionId,matchEventId:()=>matchEventId,matchEventKind:()=>matchEventKind,matchEventPubkey:()=>matchEventPubkey});function getHex64(n,t){let e=t.length+3,s=n.indexOf(`"${t}":`)+e,a=n.slice(s).indexOf('"')+s+1;return n.slice(a,a+64)}function getInt(n,t){let e=t.length,s=n.indexOf(`"${t}":`)+e+3,a=n.slice(s),o=Math.min(a.indexOf(","),a.indexOf("}"));return parseInt(a.slice(0,o),10)}function getSubscriptionId(n){let t=n.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let e=n.slice(t+7+1).indexOf('"');if(e===-1)return null;let s=t+7+1+e,a=n.slice(s+1,80).indexOf('"');if(a===-1)return null;let o=s+1+a;return n.slice(s+1,o)}function matchEventId(n,t){return t===getHex64(n,"id")}function matchEventPubkey(n,t){return t===getHex64(n,"pubkey")}function matchEventKind(n,t){return t===getInt(n,"kind")}var nip42_exports={};__export(nip42_exports,{makeAuthEvent:()=>makeAuthEvent});function makeAuthEvent(n,t){return{kind:ClientAuth,created_at:Math.floor(Date.now()/1e3),tags:[["relay",n],["challenge",t]],content:""}}var _WebSocket;try{_WebSocket=WebSocket}catch{}var _WebSocket2;try{_WebSocket2=WebSocket}catch{}var nip19_exports={};__export(nip19_exports,{BECH32_REGEX:()=>BECH32_REGEX$1,Bech32MaxSize:()=>Bech32MaxSize,NostrTypeGuard:()=>NostrTypeGuard,decode:()=>decode,decodeNostrURI:()=>decodeNostrURI,encodeBytes:()=>encodeBytes,naddrEncode:()=>naddrEncode,neventEncode:()=>neventEncode,noteEncode:()=>noteEncode,nprofileEncode:()=>nprofileEncode,npubEncode:()=>npubEncode,nsecEncode:()=>nsecEncode});var NostrTypeGuard={isNProfile:n=>/^nprofile1[a-z\d]+$/.test(n||""),isNEvent:n=>/^nevent1[a-z\d]+$/.test(n||""),isNAddr:n=>/^naddr1[a-z\d]+$/.test(n||""),isNSec:n=>/^nsec1[a-z\d]{58}$/.test(n||""),isNPub:n=>/^npub1[a-z\d]{58}$/.test(n||""),isNote:n=>/^note1[a-z\d]+$/.test(n||""),isNcryptsec:n=>/^ncryptsec1[a-z\d]+$/.test(n||"")},Bech32MaxSize=5e3,BECH32_REGEX$1=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function integerToUint8Array(n){const t=new Uint8Array(4);return t[0]=n>>24&255,t[1]=n>>16&255,t[2]=n>>8&255,t[3]=n&255,t}function decodeNostrURI(n){try{return n.startsWith("nostr:")&&(n=n.substring(6)),decode(n)}catch{return{type:"invalid",data:null}}}function decode(n){var a,o,f,p,y,g,x;let{prefix:t,words:e}=bech32.decode(n,Bech32MaxSize),s=new Uint8Array(bech32.fromWords(e));switch(t){case"nprofile":{let E=parseTLV(s);if(!((a=E[0])!=null&&a[0]))throw new Error("missing TLV 0 for nprofile");if(E[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:bytesToHex$2(E[0][0]),relays:E[1]?E[1].map(A=>utf8Decoder.decode(A)):[]}}}case"nevent":{let E=parseTLV(s);if(!((o=E[0])!=null&&o[0]))throw new Error("missing TLV 0 for nevent");if(E[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(E[2]&&E[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(E[3]&&E[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:bytesToHex$2(E[0][0]),relays:E[1]?E[1].map(A=>utf8Decoder.decode(A)):[],author:(f=E[2])!=null&&f[0]?bytesToHex$2(E[2][0]):void 0,kind:(p=E[3])!=null&&p[0]?parseInt(bytesToHex$2(E[3][0]),16):void 0}}}case"naddr":{let E=parseTLV(s);if(!((y=E[0])!=null&&y[0]))throw new Error("missing TLV 0 for naddr");if(!((g=E[2])!=null&&g[0]))throw new Error("missing TLV 2 for naddr");if(E[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!((x=E[3])!=null&&x[0]))throw new Error("missing TLV 3 for naddr");if(E[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:utf8Decoder.decode(E[0][0]),pubkey:bytesToHex$2(E[2][0]),kind:parseInt(bytesToHex$2(E[3][0]),16),relays:E[1]?E[1].map(A=>utf8Decoder.decode(A)):[]}}}case"nsec":return{type:t,data:s};case"npub":case"note":return{type:t,data:bytesToHex$2(s)};default:throw new Error(`unknown prefix ${t}`)}}function parseTLV(n){let t={},e=n;for(;e.length>0;){let s=e[0],a=e[1],o=e.slice(2,2+a);if(e=e.slice(2+a),o.length<a)throw new Error(`not enough data to read on TLV ${s}`);t[s]=t[s]||[],t[s].push(o)}return t}function nsecEncode(n){return encodeBytes("nsec",n)}function npubEncode(n){return encodeBytes("npub",hexToBytes$2(n))}function noteEncode(n){return encodeBytes("note",hexToBytes$2(n))}function encodeBech32(n,t){let e=bech32.toWords(t);return bech32.encode(n,e,Bech32MaxSize)}function encodeBytes(n,t){return encodeBech32(n,t)}function nprofileEncode(n){let t=encodeTLV({0:[hexToBytes$2(n.pubkey)],1:(n.relays||[]).map(e=>utf8Encoder.encode(e))});return encodeBech32("nprofile",t)}function neventEncode(n){let t;n.kind!==void 0&&(t=integerToUint8Array(n.kind));let e=encodeTLV({0:[hexToBytes$2(n.id)],1:(n.relays||[]).map(s=>utf8Encoder.encode(s)),2:n.author?[hexToBytes$2(n.author)]:[],3:t?[new Uint8Array(t)]:[]});return encodeBech32("nevent",e)}function naddrEncode(n){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,n.kind,!1);let e=encodeTLV({0:[utf8Encoder.encode(n.identifier)],1:(n.relays||[]).map(s=>utf8Encoder.encode(s)),2:[hexToBytes$2(n.pubkey)],3:[new Uint8Array(t)]});return encodeBech32("naddr",e)}function encodeTLV(n){let t=[];return Object.entries(n).reverse().forEach(([e,s])=>{s.forEach(a=>{let o=new Uint8Array(a.length+2);o.set([parseInt(e)],0),o.set([a.length],1),o.set(a,2),t.push(o)})}),concatBytes$2(...t)}var nip04_exports={};__export(nip04_exports,{decrypt:()=>decrypt$1,encrypt:()=>encrypt$1});function encrypt$1(n,t,e){const s=n instanceof Uint8Array?bytesToHex$2(n):n,a=secp256k1$2.getSharedSecret(s,"02"+t),o=getNormalizedX(a);let f=Uint8Array.from(randomBytes$1(16)),p=utf8Encoder.encode(e),y=cbc(o,f).encrypt(p),g=base64.encode(new Uint8Array(y)),x=base64.encode(new Uint8Array(f.buffer));return`${g}?iv=${x}`}function decrypt$1(n,t,e){const s=n instanceof Uint8Array?bytesToHex$2(n):n;let[a,o]=e.split("?iv="),f=secp256k1$2.getSharedSecret(s,"02"+t),p=getNormalizedX(f),y=base64.decode(o),g=base64.decode(a),x=cbc(p,y).decrypt(g);return utf8Decoder.decode(x)}function getNormalizedX(n){return n.slice(1,33)}var nip05_exports={};__export(nip05_exports,{NIP05_REGEX:()=>NIP05_REGEX$1,isNip05:()=>isNip05,isValid:()=>isValid,queryProfile:()=>queryProfile,searchDomain:()=>searchDomain,useFetchImplementation:()=>useFetchImplementation});var NIP05_REGEX$1=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,isNip05=n=>NIP05_REGEX$1.test(n||""),_fetch;try{_fetch=fetch}catch(n){}function useFetchImplementation(n){_fetch=n}async function searchDomain(n,t=""){try{const e=`https://${n}/.well-known/nostr.json?name=${t}`,s=await _fetch(e,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");return(await s.json()).names}catch{return{}}}async function queryProfile(n){var a;const t=n.match(NIP05_REGEX$1);if(!t)return null;const[,e="_",s]=t;try{const o=`https://${s}/.well-known/nostr.json?name=${e}`,f=await _fetch(o,{redirect:"manual"});if(f.status!==200)throw Error("Wrong response code");const p=await f.json(),y=p.names[e];return y?{pubkey:y,relays:(a=p.relays)==null?void 0:a[y]}:null}catch{return null}}async function isValid(n,t){const e=await queryProfile(t);return e?e.pubkey===n:!1}var nip10_exports={};__export(nip10_exports,{parse:()=>parse});function parse(n){const t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let e,s;for(let a=n.tags.length-1;a>=0;a--){const o=n.tags[a];if(o[0]==="e"&&o[1]){const[f,p,y,g,x]=o,E={id:p,relays:y?[y]:[],author:x};if(g==="root"){t.root=E;continue}if(g==="reply"){t.reply=E;continue}if(g==="mention"){t.mentions.push(E);continue}e?s=E:e=E,t.mentions.push(E);continue}if(o[0]==="q"&&o[1]){const[f,p,y]=o;t.quotes.push({id:p,relays:y?[y]:[]})}if(o[0]==="p"&&o[1]){t.profiles.push({pubkey:o[1],relays:o[2]?[o[2]]:[]});continue}}return t.root||(t.root=s||e||t.reply),t.reply||(t.reply=e||t.root),[t.reply,t.root].forEach(a=>{if(!a)return;let o=t.mentions.indexOf(a);if(o!==-1&&t.mentions.splice(o,1),a.author){let f=t.profiles.find(p=>p.pubkey===a.author);f&&f.relays&&(a.relays||(a.relays=[]),f.relays.forEach(p=>{var y;((y=a.relays)==null?void 0:y.indexOf(p))===-1&&a.relays.push(p)}),f.relays=a.relays)}}),t.mentions.forEach(a=>{if(a.author){let o=t.profiles.find(f=>f.pubkey===a.author);o&&o.relays&&(a.relays||(a.relays=[]),o.relays.forEach(f=>{a.relays.indexOf(f)===-1&&a.relays.push(f)}),o.relays=a.relays)}}),t}var nip11_exports={};__export(nip11_exports,{fetchRelayInformation:()=>fetchRelayInformation,useFetchImplementation:()=>useFetchImplementation2});var _fetch2;try{_fetch2=fetch}catch{}function useFetchImplementation2(n){_fetch2=n}async function fetchRelayInformation(n){return await(await fetch(n.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var nip13_exports={};__export(nip13_exports,{fastEventHash:()=>fastEventHash,getPow:()=>getPow,minePow:()=>minePow});function getPow(n){let t=0;for(let e=0;e<64;e+=8){const s=parseInt(n.substring(e,e+8),16);if(s===0)t+=32;else{t+=Math.clz32(s);break}}return t}function minePow(n,t){let e=0;const s=n,a=["nonce",e.toString(),t.toString()];for(s.tags.push(a);;){const o=Math.floor(new Date().getTime()/1e3);if(o!==s.created_at&&(e=0,s.created_at=o),a[1]=(++e).toString(),s.id=fastEventHash(s),getPow(s.id)>=t)break}return s}function fastEventHash(n){return bytesToHex$2(sha256$3(utf8Encoder.encode(JSON.stringify([0,n.pubkey,n.created_at,n.kind,n.tags,n.content]))))}var nip17_exports={};__export(nip17_exports,{unwrapEvent:()=>unwrapEvent2,unwrapManyEvents:()=>unwrapManyEvents2,wrapEvent:()=>wrapEvent2,wrapManyEvents:()=>wrapManyEvents2});var nip59_exports={};__export(nip59_exports,{createRumor:()=>createRumor,createSeal:()=>createSeal,createWrap:()=>createWrap,unwrapEvent:()=>unwrapEvent,unwrapManyEvents:()=>unwrapManyEvents,wrapEvent:()=>wrapEvent$1,wrapManyEvents:()=>wrapManyEvents});var nip44_exports={};__export(nip44_exports,{decrypt:()=>decrypt2,encrypt:()=>encrypt2,getConversationKey:()=>getConversationKey,v2:()=>v2});var minPlaintextSize=1,maxPlaintextSize=65535;function getConversationKey(n,t){const e=secp256k1$2.getSharedSecret(n,"02"+t).subarray(1,33);return extract(sha256$3,e,"nip44-v2")}function getMessageKeys(n,t){const e=expand(sha256$3,n,t,76);return{chacha_key:e.subarray(0,32),chacha_nonce:e.subarray(32,44),hmac_key:e.subarray(44,76)}}function calcPaddedLen(n){if(!Number.isSafeInteger(n)||n<1)throw new Error("expected positive integer");if(n<=32)return 32;const t=1<<Math.floor(Math.log2(n-1))+1,e=t<=256?32:t/8;return e*(Math.floor((n-1)/e)+1)}function writeU16BE(n){if(!Number.isSafeInteger(n)||n<minPlaintextSize||n>maxPlaintextSize)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,n,!1),t}function pad(n){const t=utf8Encoder.encode(n),e=t.length,s=writeU16BE(e),a=new Uint8Array(calcPaddedLen(e)-e);return concatBytes$2(s,t,a)}function unpad(n){const t=new DataView(n.buffer).getUint16(0),e=n.subarray(2,2+t);if(t<minPlaintextSize||t>maxPlaintextSize||e.length!==t||n.length!==2+calcPaddedLen(t))throw new Error("invalid padding");return utf8Decoder.decode(e)}function hmacAad(n,t,e){if(e.length!==32)throw new Error("AAD associated data must be 32 bytes");const s=concatBytes$2(e,t);return hmac$2(sha256$3,n,s)}function decodePayload(n){if(typeof n!="string")throw new Error("payload must be a valid string");const t=n.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(n[0]==="#")throw new Error("unknown encryption version");let e;try{e=base64.decode(n)}catch(o){throw new Error("invalid base64: "+o.message)}const s=e.length;if(s<99||s>65603)throw new Error("invalid data length: "+s);const a=e[0];if(a!==2)throw new Error("unknown encryption version "+a);return{nonce:e.subarray(1,33),ciphertext:e.subarray(33,-32),mac:e.subarray(-32)}}function encrypt2(n,t,e=randomBytes$1(32)){const{chacha_key:s,chacha_nonce:a,hmac_key:o}=getMessageKeys(t,e),f=pad(n),p=chacha20(s,a,f),y=hmacAad(o,p,e);return base64.encode(concatBytes$2(new Uint8Array([2]),e,p,y))}function decrypt2(n,t){const{nonce:e,ciphertext:s,mac:a}=decodePayload(n),{chacha_key:o,chacha_nonce:f,hmac_key:p}=getMessageKeys(t,e),y=hmacAad(p,s,e);if(!equalBytes(y,a))throw new Error("invalid MAC");const g=chacha20(o,f,s);return unpad(g)}var v2={utils:{getConversationKey,calcPaddedLen},encrypt:encrypt2,decrypt:decrypt2},TWO_DAYS=2*24*60*60,now=()=>Math.round(Date.now()/1e3),randomNow=()=>Math.round(now()-Math.random()*TWO_DAYS),nip44ConversationKey=(n,t)=>getConversationKey(n,t),nip44Encrypt=(n,t,e)=>encrypt2(JSON.stringify(n),nip44ConversationKey(t,e)),nip44Decrypt=(n,t)=>JSON.parse(decrypt2(n.content,nip44ConversationKey(t,n.pubkey)));function createRumor(n,t){const e={created_at:now(),content:"",tags:[],...n,pubkey:getPublicKey(t)};return e.id=getEventHash$1(e),e}function createSeal(n,t,e){return finalizeEvent({kind:Seal,content:nip44Encrypt(n,t,e),created_at:randomNow(),tags:[]},t)}function createWrap(n,t){const e=generateSecretKey();return finalizeEvent({kind:GiftWrap,content:nip44Encrypt(n,e,t),created_at:randomNow(),tags:[["p",t]]},e)}function wrapEvent$1(n,t,e){const s=createRumor(n,t),a=createSeal(s,t,e);return createWrap(a,e)}function wrapManyEvents(n,t,e){if(!e||e.length===0)throw new Error("At least one recipient is required.");const s=getPublicKey(t),a=[wrapEvent$1(n,t,s)];return e.forEach(o=>{a.push(wrapEvent$1(n,t,o))}),a}function unwrapEvent(n,t){const e=nip44Decrypt(n,t);return nip44Decrypt(e,t)}function unwrapManyEvents(n,t){let e=[];return n.forEach(s=>{e.push(unwrapEvent(s,t))}),e.sort((s,a)=>s.created_at-a.created_at),e}function createEvent(n,t,e,s){const a={created_at:Math.ceil(Date.now()/1e3),kind:PrivateDirectMessage,tags:[],content:t};return(Array.isArray(n)?n:[n]).forEach(({publicKey:f,relayUrl:p})=>{a.tags.push(p?["p",f,p]:["p",f])}),s&&a.tags.push(["e",s.eventId,s.relayUrl||"","reply"]),e&&a.tags.push(["subject",e]),a}function wrapEvent2(n,t,e,s,a){const o=createEvent(t,e,s,a);return wrapEvent$1(o,n,t.publicKey)}function wrapManyEvents2(n,t,e,s,a){if(!t||t.length===0)throw new Error("At least one recipient is required.");return[{publicKey:getPublicKey(n)},...t].map(f=>wrapEvent2(n,f,e,s,a))}var unwrapEvent2=unwrapEvent,unwrapManyEvents2=unwrapManyEvents,nip18_exports={};__export(nip18_exports,{finishRepostEvent:()=>finishRepostEvent,getRepostedEvent:()=>getRepostedEvent,getRepostedEventPointer:()=>getRepostedEventPointer});function finishRepostEvent(n,t,e,s){var f;let a;const o=[...n.tags??[],["e",t.id,e],["p",t.pubkey]];return t.kind===ShortTextNote?a=Repost:(a=GenericRepost,o.push(["k",String(t.kind)])),finalizeEvent({kind:a,tags:o,content:n.content===""||(f=t.tags)!=null&&f.find(p=>p[0]==="-")?"":JSON.stringify(t),created_at:n.created_at},s)}function getRepostedEventPointer(n){if(![Repost,GenericRepost].includes(n.kind))return;let t,e;for(let s=n.tags.length-1;s>=0&&(t===void 0||e===void 0);s--){const a=n.tags[s];a.length>=2&&(a[0]==="e"&&t===void 0?t=a:a[0]==="p"&&e===void 0&&(e=a))}if(t!==void 0)return{id:t[1],relays:[t[2],e==null?void 0:e[2]].filter(s=>typeof s=="string"),author:e==null?void 0:e[1]}}function getRepostedEvent(n,{skipVerification:t}={}){const e=getRepostedEventPointer(n);if(e===void 0||n.content==="")return;let s;try{s=JSON.parse(n.content)}catch{return}if(s.id===e.id&&!(!t&&!verifyEvent(s)))return s}var nip21_exports={};__export(nip21_exports,{NOSTR_URI_REGEX:()=>NOSTR_URI_REGEX,parse:()=>parse2,test:()=>test});var NOSTR_URI_REGEX=new RegExp(`nostr:(${BECH32_REGEX$1.source})`);function test(n){return typeof n=="string"&&new RegExp(`^${NOSTR_URI_REGEX.source}$`).test(n)}function parse2(n){const t=n.match(new RegExp(`^${NOSTR_URI_REGEX.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${n}`);return{uri:t[0],value:t[1],decoded:decode(t[1])}}var nip25_exports={};__export(nip25_exports,{finishReactionEvent:()=>finishReactionEvent,getReactedEventPointer:()=>getReactedEventPointer});function finishReactionEvent(n,t,e){const s=t.tags.filter(a=>a.length>=2&&(a[0]==="e"||a[0]==="p"));return finalizeEvent({...n,kind:Reaction,tags:[...n.tags??[],...s,["e",t.id],["p",t.pubkey]],content:n.content??"+"},e)}function getReactedEventPointer(n){if(n.kind!==Reaction)return;let t,e;for(let s=n.tags.length-1;s>=0&&(t===void 0||e===void 0);s--){const a=n.tags[s];a.length>=2&&(a[0]==="e"&&t===void 0?t=a:a[0]==="p"&&e===void 0&&(e=a))}if(!(t===void 0||e===void 0))return{id:t[1],relays:[t[2],e[2]].filter(s=>s!==void 0),author:e[1]}}var nip27_exports={};__export(nip27_exports,{parse:()=>parse3});var noCharacter=/\W/m,noURLCharacter=/\W |\W$|$|,| /m;function*parse3(n){const t=n.length;let e=0,s=0;for(;s<t;){let a=n.indexOf(":",s);if(a===-1)break;if(n.substring(a-5,a)==="nostr"){const o=n.substring(a+60).match(noCharacter),f=o?a+60+o.index:t;try{let p,{data:y,type:g}=decode(n.substring(a+1,f));switch(g){case"npub":p={pubkey:y};break;case"nsec":case"note":s=f+1;continue;default:p=y}e!==a-5&&(yield{type:"text",text:n.substring(e,a-5)}),yield{type:"reference",pointer:p},s=f,e=s;continue}catch{s=a+1;continue}}else if(n.substring(a-5,a)==="https"||n.substring(a-4,a)==="http"){const o=n.substring(a+4).match(noURLCharacter),f=o?a+4+o.index:t,p=n[a-1]==="s"?5:4;try{let y=new URL(n.substring(a-p,f));if(y.hostname.indexOf(".")===-1)throw new Error("invalid url");if(e!==a-p&&(yield{type:"text",text:n.substring(e,a-p)}),y.pathname.endsWith(".png")||y.pathname.endsWith(".jpg")||y.pathname.endsWith(".jpeg")||y.pathname.endsWith(".gif")||y.pathname.endsWith(".webp")){yield{type:"image",url:y.toString()},s=f,e=s;continue}if(y.pathname.endsWith(".mp4")||y.pathname.endsWith(".avi")||y.pathname.endsWith(".webm")||y.pathname.endsWith(".mkv")){yield{type:"video",url:y.toString()},s=f,e=s;continue}if(y.pathname.endsWith(".mp3")||y.pathname.endsWith(".aac")||y.pathname.endsWith(".ogg")||y.pathname.endsWith(".opus")){yield{type:"audio",url:y.toString()},s=f,e=s;continue}yield{type:"url",url:y.toString()},s=f,e=s;continue}catch{s=f+1;continue}}else if(n.substring(a-3,a)==="wss"||n.substring(a-2,a)==="ws"){const o=n.substring(a+4).match(noURLCharacter),f=o?a+4+o.index:t,p=n[a-1]==="s"?3:2;try{let y=new URL(n.substring(a-p,f));if(y.hostname.indexOf(".")===-1)throw new Error("invalid ws url");e!==a-p&&(yield{type:"text",text:n.substring(e,a-p)}),yield{type:"relay",url:y.toString()},s=f,e=s;continue}catch{s=f+1;continue}}else{s=a+1;continue}}e!==t&&(yield{type:"text",text:n.substring(e)})}var nip28_exports={};__export(nip28_exports,{channelCreateEvent:()=>channelCreateEvent,channelHideMessageEvent:()=>channelHideMessageEvent,channelMessageEvent:()=>channelMessageEvent,channelMetadataEvent:()=>channelMetadataEvent,channelMuteUserEvent:()=>channelMuteUserEvent});var channelCreateEvent=(n,t)=>{let e;if(typeof n.content=="object")e=JSON.stringify(n.content);else if(typeof n.content=="string")e=n.content;else return;return finalizeEvent({kind:ChannelCreation,tags:[...n.tags??[]],content:e,created_at:n.created_at},t)},channelMetadataEvent=(n,t)=>{let e;if(typeof n.content=="object")e=JSON.stringify(n.content);else if(typeof n.content=="string")e=n.content;else return;return finalizeEvent({kind:ChannelMetadata,tags:[["e",n.channel_create_event_id],...n.tags??[]],content:e,created_at:n.created_at},t)},channelMessageEvent=(n,t)=>{const e=[["e",n.channel_create_event_id,n.relay_url,"root"]];return n.reply_to_channel_message_event_id&&e.push(["e",n.reply_to_channel_message_event_id,n.relay_url,"reply"]),finalizeEvent({kind:ChannelMessage,tags:[...e,...n.tags??[]],content:n.content,created_at:n.created_at},t)},channelHideMessageEvent=(n,t)=>{let e;if(typeof n.content=="object")e=JSON.stringify(n.content);else if(typeof n.content=="string")e=n.content;else return;return finalizeEvent({kind:ChannelHideMessage,tags:[["e",n.channel_message_event_id],...n.tags??[]],content:e,created_at:n.created_at},t)},channelMuteUserEvent=(n,t)=>{let e;if(typeof n.content=="object")e=JSON.stringify(n.content);else if(typeof n.content=="string")e=n.content;else return;return finalizeEvent({kind:ChannelMuteUser,tags:[["p",n.pubkey_to_mute],...n.tags??[]],content:e,created_at:n.created_at},t)},nip30_exports={};__export(nip30_exports,{EMOJI_SHORTCODE_REGEX:()=>EMOJI_SHORTCODE_REGEX,matchAll:()=>matchAll,regex:()=>regex,replaceAll:()=>replaceAll});var EMOJI_SHORTCODE_REGEX=/:(\w+):/,regex=()=>new RegExp(`\\B${EMOJI_SHORTCODE_REGEX.source}\\B`,"g");function*matchAll(n){const t=n.matchAll(regex());for(const e of t)try{const[s,a]=e;yield{shortcode:s,name:a,start:e.index,end:e.index+s.length}}catch{}}function replaceAll(n,t){return n.replaceAll(regex(),(e,s)=>t({shortcode:e,name:s}))}var nip39_exports={};__export(nip39_exports,{useFetchImplementation:()=>useFetchImplementation3,validateGithub:()=>validateGithub});var _fetch3;try{_fetch3=fetch}catch{}function useFetchImplementation3(n){_fetch3=n}async function validateGithub(n,t,e){try{return await(await _fetch3(`https://gist.github.com/${t}/${e}/raw`)).text()===`Verifying that I control the following Nostr public key: ${n}`}catch{return!1}}var nip47_exports={};__export(nip47_exports,{makeNwcRequestEvent:()=>makeNwcRequestEvent,parseConnectionString:()=>parseConnectionString});function parseConnectionString(n){const{pathname:t,searchParams:e}=new URL(n),s=t,a=e.get("relay"),o=e.get("secret");if(!s||!a||!o)throw new Error("invalid connection string");return{pubkey:s,relay:a,secret:o}}async function makeNwcRequestEvent(n,t,e){const a=await encrypt$1(t,n,JSON.stringify({method:"pay_invoice",params:{invoice:e}})),o={kind:NWCWalletRequest,created_at:Math.round(Date.now()/1e3),content:a,tags:[["p",n]]};return finalizeEvent(o,t)}var nip54_exports={};__export(nip54_exports,{normalizeIdentifier:()=>normalizeIdentifier});function normalizeIdentifier(n){return n=n.trim().toLowerCase(),n=n.normalize("NFKC"),Array.from(n).map(t=>new RegExp("\\p{Letter}","u").test(t)||new RegExp("\\p{Number}","u").test(t)?t:"-").join("")}var nip57_exports={};__export(nip57_exports,{getZapEndpoint:()=>getZapEndpoint,makeZapReceipt:()=>makeZapReceipt,makeZapRequest:()=>makeZapRequest,useFetchImplementation:()=>useFetchImplementation4,validateZapRequest:()=>validateZapRequest});var _fetch4;try{_fetch4=fetch}catch{}function useFetchImplementation4(n){_fetch4=n}async function getZapEndpoint(n){try{let t="",{lud06:e,lud16:s}=JSON.parse(n.content);if(e){let{words:f}=bech32.decode(e,1e3),p=bech32.fromWords(f);t=utf8Decoder.decode(p)}else if(s){let[f,p]=s.split("@");t=new URL(`/.well-known/lnurlp/${f}`,`https://${p}`).toString()}else return null;let o=await(await _fetch4(t)).json();if(o.allowsNostr&&o.nostrPubkey)return o.callback}catch{}return null}function makeZapRequest({profile:n,event:t,amount:e,relays:s,comment:a=""}){if(!e)throw new Error("amount not given");if(!n)throw new Error("profile not given");let o={kind:9734,created_at:Math.round(Date.now()/1e3),content:a,tags:[["p",n],["amount",e.toString()],["relays",...s]]};if(t&&typeof t=="string"&&o.tags.push(["e",t]),t&&typeof t=="object"){if(isReplaceableKind(t.kind)){const f=["a",`${t.kind}:${t.pubkey}:`];o.tags.push(f)}else if(isAddressableKind(t.kind)){let f=t.tags.find(([y,g])=>y==="d"&&g);if(!f)throw new Error("d tag not found or is empty");const p=["a",`${t.kind}:${t.pubkey}:${f[1]}`];o.tags.push(p)}}return o}function validateZapRequest(n){let t;try{t=JSON.parse(n)}catch{return"Invalid zap request JSON."}if(!validateEvent(t))return"Zap request is not a valid Nostr event.";if(!verifyEvent(t))return"Invalid signature on zap request.";let e=t.tags.find(([o,f])=>o==="p"&&f);if(!e)return"Zap request doesn't have a 'p' tag.";if(!e[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let s=t.tags.find(([o,f])=>o==="e"&&f);return s&&!s[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([o,f])=>o==="relays"&&f)?null:"Zap request doesn't have a 'relays' tag."}function makeZapReceipt({zapRequest:n,preimage:t,bolt11:e,paidAt:s}){let a=JSON.parse(n),o=a.tags.filter(([p])=>p==="e"||p==="p"||p==="a"),f={kind:9735,created_at:Math.round(s.getTime()/1e3),content:"",tags:[...o,["P",a.pubkey],["bolt11",e],["description",n]]};return t&&f.tags.push(["preimage",t]),f}var nip98_exports={};__export(nip98_exports,{getToken:()=>getToken,hashPayload:()=>hashPayload,unpackEventFromToken:()=>unpackEventFromToken,validateEvent:()=>validateEvent2,validateEventKind:()=>validateEventKind,validateEventMethodTag:()=>validateEventMethodTag,validateEventPayloadTag:()=>validateEventPayloadTag,validateEventTimestamp:()=>validateEventTimestamp,validateEventUrlTag:()=>validateEventUrlTag,validateToken:()=>validateToken});var _authorizationScheme="Nostr ";async function getToken(n,t,e,s=!1,a){const o={kind:HTTPAuth,tags:[["u",n],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};a&&o.tags.push(["payload",hashPayload(a)]);const f=await e(o);return(s?_authorizationScheme:"")+base64.encode(utf8Encoder.encode(JSON.stringify(f)))}async function validateToken(n,t,e){const s=await unpackEventFromToken(n).catch(o=>{throw o});return await validateEvent2(s,t,e).catch(o=>{throw o})}async function unpackEventFromToken(n){if(!n)throw new Error("Missing token");n=n.replace(_authorizationScheme,"");const t=utf8Decoder.decode(base64.decode(n));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function validateEventTimestamp(n){return n.created_at?Math.round(new Date().getTime()/1e3)-n.created_at<60:!1}function validateEventKind(n){return n.kind===HTTPAuth}function validateEventUrlTag(n,t){const e=n.tags.find(s=>s[0]==="u");return e?e.length>0&&e[1]===t:!1}function validateEventMethodTag(n,t){const e=n.tags.find(s=>s[0]==="method");return e?e.length>0&&e[1].toLowerCase()===t.toLowerCase():!1}function hashPayload(n){const t=sha256$3(utf8Encoder.encode(JSON.stringify(n)));return bytesToHex$2(t)}function validateEventPayloadTag(n,t){const e=n.tags.find(a=>a[0]==="payload");if(!e)return!1;const s=hashPayload(t);return e.length>0&&e[1]===s}async function validateEvent2(n,t,e,s){if(!verifyEvent(n))throw new Error("Invalid nostr event, signature invalid");if(!validateEventKind(n))throw new Error("Invalid nostr event, kind invalid");if(!validateEventTimestamp(n))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!validateEventUrlTag(n,t))throw new Error("Invalid nostr event, url tag invalid");if(!validateEventMethodTag(n,e))throw new Error("Invalid nostr event, method tag invalid");if(s&&typeof s=="object"&&Object.keys(s).length>0&&!validateEventPayloadTag(n,s))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const crypto$2=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function isBytes$1(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function anumber(n){if(!Number.isSafeInteger(n)||n<0)throw new Error("positive integer expected, got "+n)}function abytes$1(n,...t){if(!isBytes$1(n))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(n.length))throw new Error("Uint8Array expected of length "+t+", got length="+n.length)}function ahash(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");anumber(n.outputLen),anumber(n.blockLen)}function aexists(n,t=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(t&&n.finished)throw new Error("Hash#digest() has already been called")}function aoutput(n,t){abytes$1(n);const e=t.outputLen;if(n.length<e)throw new Error("digestInto() expects output buffer of length at least "+e)}function clean(...n){for(let t=0;t<n.length;t++)n[t].fill(0)}function createView(n){return new DataView(n.buffer,n.byteOffset,n.byteLength)}function rotr(n,t){return n<<32-t|n>>>t}const hasHexBuiltin$1=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",hexes$1=Array.from({length:256},(n,t)=>t.toString(16).padStart(2,"0"));function bytesToHex$1(n){if(abytes$1(n),hasHexBuiltin$1)return n.toHex();let t="";for(let e=0;e<n.length;e++)t+=hexes$1[n[e]];return t}const asciis$1={_0:48,_9:57,A:65,F:70,a:97,f:102};function asciiToBase16$1(n){if(n>=asciis$1._0&&n<=asciis$1._9)return n-asciis$1._0;if(n>=asciis$1.A&&n<=asciis$1.F)return n-(asciis$1.A-10);if(n>=asciis$1.a&&n<=asciis$1.f)return n-(asciis$1.a-10)}function hexToBytes$1(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);if(hasHexBuiltin$1)return Uint8Array.fromHex(n);const t=n.length,e=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const s=new Uint8Array(e);for(let a=0,o=0;a<e;a++,o+=2){const f=asciiToBase16$1(n.charCodeAt(o)),p=asciiToBase16$1(n.charCodeAt(o+1));if(f===void 0||p===void 0){const y=n[o]+n[o+1];throw new Error('hex string expected, got non-hex character "'+y+'" at index '+o)}s[a]=f*16+p}return s}function utf8ToBytes(n){if(typeof n!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(n))}function toBytes(n){return typeof n=="string"&&(n=utf8ToBytes(n)),abytes$1(n),n}function concatBytes$1(...n){let t=0;for(let s=0;s<n.length;s++){const a=n[s];abytes$1(a),t+=a.length}const e=new Uint8Array(t);for(let s=0,a=0;s<n.length;s++){const o=n[s];e.set(o,a),a+=o.length}return e}class Hash{}function createHasher(n){const t=s=>n().update(toBytes(s)).digest(),e=n();return t.outputLen=e.outputLen,t.blockLen=e.blockLen,t.create=()=>n(),t}function randomBytes(n=32){if(crypto$2&&typeof crypto$2.getRandomValues=="function")return crypto$2.getRandomValues(new Uint8Array(n));if(crypto$2&&typeof crypto$2.randomBytes=="function")return Uint8Array.from(crypto$2.randomBytes(n));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64(n,t,e,s){if(typeof n.setBigUint64=="function")return n.setBigUint64(t,e,s);const a=BigInt(32),o=BigInt(4294967295),f=Number(e>>a&o),p=Number(e&o),y=s?4:0,g=s?0:4;n.setUint32(t+y,f,s),n.setUint32(t+g,p,s)}function Chi(n,t,e){return n&t^~n&e}function Maj(n,t,e){return n&t^n&e^t&e}class HashMD extends Hash{constructor(t,e,s,a){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=e,this.padOffset=s,this.isLE=a,this.buffer=new Uint8Array(t),this.view=createView(this.buffer)}update(t){aexists(this),t=toBytes(t),abytes$1(t);const{view:e,buffer:s,blockLen:a}=this,o=t.length;for(let f=0;f<o;){const p=Math.min(a-this.pos,o-f);if(p===a){const y=createView(t);for(;a<=o-f;f+=a)this.process(y,f);continue}s.set(t.subarray(f,f+p),this.pos),this.pos+=p,f+=p,this.pos===a&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){aexists(this),aoutput(t,this),this.finished=!0;const{buffer:e,view:s,blockLen:a,isLE:o}=this;let{pos:f}=this;e[f++]=128,clean(this.buffer.subarray(f)),this.padOffset>a-f&&(this.process(s,0),f=0);for(let E=f;E<a;E++)e[E]=0;setBigUint64(s,a-8,BigInt(this.length*8),o),this.process(s,0);const p=createView(t),y=this.outputLen;if(y%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const g=y/4,x=this.get();if(g>x.length)throw new Error("_sha2: outputLen bigger than state");for(let E=0;E<g;E++)p.setUint32(4*E,x[E],o)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const s=t.slice(0,e);return this.destroy(),s}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:s,length:a,finished:o,destroyed:f,pos:p}=this;return t.destroyed=f,t.finished=o,t.length=a,t.pos=p,a%e&&t.buffer.set(s),t}clone(){return this._cloneInto()}}const SHA256_IV=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_K=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_W=new Uint32Array(64);class SHA256 extends HashMD{constructor(t=32){super(64,t,8,!1),this.A=SHA256_IV[0]|0,this.B=SHA256_IV[1]|0,this.C=SHA256_IV[2]|0,this.D=SHA256_IV[3]|0,this.E=SHA256_IV[4]|0,this.F=SHA256_IV[5]|0,this.G=SHA256_IV[6]|0,this.H=SHA256_IV[7]|0}get(){const{A:t,B:e,C:s,D:a,E:o,F:f,G:p,H:y}=this;return[t,e,s,a,o,f,p,y]}set(t,e,s,a,o,f,p,y){this.A=t|0,this.B=e|0,this.C=s|0,this.D=a|0,this.E=o|0,this.F=f|0,this.G=p|0,this.H=y|0}process(t,e){for(let E=0;E<16;E++,e+=4)SHA256_W[E]=t.getUint32(e,!1);for(let E=16;E<64;E++){const A=SHA256_W[E-15],S=SHA256_W[E-2],I=rotr(A,7)^rotr(A,18)^A>>>3,_=rotr(S,17)^rotr(S,19)^S>>>10;SHA256_W[E]=_+SHA256_W[E-7]+I+SHA256_W[E-16]|0}let{A:s,B:a,C:o,D:f,E:p,F:y,G:g,H:x}=this;for(let E=0;E<64;E++){const A=rotr(p,6)^rotr(p,11)^rotr(p,25),S=x+A+Chi(p,y,g)+SHA256_K[E]+SHA256_W[E]|0,_=(rotr(s,2)^rotr(s,13)^rotr(s,22))+Maj(s,a,o)|0;x=g,g=y,y=p,p=f+S|0,f=o,o=a,a=s,s=S+_|0}s=s+this.A|0,a=a+this.B|0,o=o+this.C|0,f=f+this.D|0,p=p+this.E|0,y=y+this.F|0,g=g+this.G|0,x=x+this.H|0,this.set(s,a,o,f,p,y,g,x)}roundClean(){clean(SHA256_W)}destroy(){this.set(0,0,0,0,0,0,0,0),clean(this.buffer)}}const sha256$2=createHasher(()=>new SHA256);class HMAC extends Hash{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,ahash(t);const s=toBytes(e);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const a=this.blockLen,o=new Uint8Array(a);o.set(s.length>a?t.create().update(s).digest():s);for(let f=0;f<o.length;f++)o[f]^=54;this.iHash.update(o),this.oHash=t.create();for(let f=0;f<o.length;f++)o[f]^=106;this.oHash.update(o),clean(o)}update(t){return aexists(this),this.iHash.update(t),this}digestInto(t){aexists(this),abytes$1(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:s,finished:a,destroyed:o,blockLen:f,outputLen:p}=this;return t=t,t.finished=a,t.destroyed=o,t.blockLen=f,t.outputLen=p,t.oHash=e._cloneInto(t.oHash),t.iHash=s._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hmac$1=(n,t,e)=>new HMAC(n,t).update(e).digest();hmac$1.create=(n,t)=>new HMAC(n,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$4=BigInt(0),_1n$4=BigInt(1);function isBytes(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function abytes(n){if(!isBytes(n))throw new Error("Uint8Array expected")}function abool(n,t){if(typeof t!="boolean")throw new Error(n+" boolean expected, got "+t)}function numberToHexUnpadded(n){const t=n.toString(16);return t.length&1?"0"+t:t}function hexToNumber$1(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return n===""?_0n$4:BigInt("0x"+n)}const hasHexBuiltin=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",hexes=Array.from({length:256},(n,t)=>t.toString(16).padStart(2,"0"));function bytesToHex(n){if(abytes(n),hasHexBuiltin)return n.toHex();let t="";for(let e=0;e<n.length;e++)t+=hexes[n[e]];return t}const asciis={_0:48,_9:57,A:65,F:70,a:97,f:102};function asciiToBase16(n){if(n>=asciis._0&&n<=asciis._9)return n-asciis._0;if(n>=asciis.A&&n<=asciis.F)return n-(asciis.A-10);if(n>=asciis.a&&n<=asciis.f)return n-(asciis.a-10)}function hexToBytes(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);if(hasHexBuiltin)return Uint8Array.fromHex(n);const t=n.length,e=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const s=new Uint8Array(e);for(let a=0,o=0;a<e;a++,o+=2){const f=asciiToBase16(n.charCodeAt(o)),p=asciiToBase16(n.charCodeAt(o+1));if(f===void 0||p===void 0){const y=n[o]+n[o+1];throw new Error('hex string expected, got non-hex character "'+y+'" at index '+o)}s[a]=f*16+p}return s}function bytesToNumberBE(n){return hexToNumber$1(bytesToHex(n))}function bytesToNumberLE(n){return abytes(n),hexToNumber$1(bytesToHex(Uint8Array.from(n).reverse()))}function numberToBytesBE(n,t){return hexToBytes(n.toString(16).padStart(t*2,"0"))}function numberToBytesLE(n,t){return numberToBytesBE(n,t).reverse()}function ensureBytes(n,t,e){let s;if(typeof t=="string")try{s=hexToBytes(t)}catch(o){throw new Error(n+" must be hex string or Uint8Array, cause: "+o)}else if(isBytes(t))s=Uint8Array.from(t);else throw new Error(n+" must be hex string or Uint8Array");const a=s.length;if(typeof e=="number"&&a!==e)throw new Error(n+" of length "+e+" expected, got "+a);return s}function concatBytes(...n){let t=0;for(let s=0;s<n.length;s++){const a=n[s];abytes(a),t+=a.length}const e=new Uint8Array(t);for(let s=0,a=0;s<n.length;s++){const o=n[s];e.set(o,a),a+=o.length}return e}const isPosBig=n=>typeof n=="bigint"&&_0n$4<=n;function inRange(n,t,e){return isPosBig(n)&&isPosBig(t)&&isPosBig(e)&&t<=n&&n<e}function aInRange(n,t,e,s){if(!inRange(t,e,s))throw new Error("expected valid "+n+": "+e+" <= n < "+s+", got "+t)}function bitLen(n){let t;for(t=0;n>_0n$4;n>>=_1n$4,t+=1);return t}const bitMask=n=>(_1n$4<<BigInt(n))-_1n$4,u8n=n=>new Uint8Array(n),u8fr=n=>Uint8Array.from(n);function createHmacDrbg(n,t,e){if(typeof n!="number"||n<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof e!="function")throw new Error("hmacFn must be a function");let s=u8n(n),a=u8n(n),o=0;const f=()=>{s.fill(1),a.fill(0),o=0},p=(...E)=>e(a,s,...E),y=(E=u8n(0))=>{a=p(u8fr([0]),E),s=p(),E.length!==0&&(a=p(u8fr([1]),E),s=p())},g=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let E=0;const A=[];for(;E<t;){s=p();const S=s.slice();A.push(S),E+=s.length}return concatBytes(...A)};return(E,A)=>{f(),y(E);let S;for(;!(S=A(g()));)y();return f(),S}}const validatorFns={bigint:n=>typeof n=="bigint",function:n=>typeof n=="function",boolean:n=>typeof n=="boolean",string:n=>typeof n=="string",stringOrUint8Array:n=>typeof n=="string"||isBytes(n),isSafeInteger:n=>Number.isSafeInteger(n),array:n=>Array.isArray(n),field:(n,t)=>t.Fp.isValid(n),hash:n=>typeof n=="function"&&Number.isSafeInteger(n.outputLen)};function validateObject(n,t,e={}){const s=(a,o,f)=>{const p=validatorFns[o];if(typeof p!="function")throw new Error("invalid validator function");const y=n[a];if(!(f&&y===void 0)&&!p(y,n))throw new Error("param "+String(a)+" is invalid. Expected "+o+", got "+y)};for(const[a,o]of Object.entries(t))s(a,o,!1);for(const[a,o]of Object.entries(e))s(a,o,!0);return n}function memoized(n){const t=new WeakMap;return(e,...s)=>{const a=t.get(e);if(a!==void 0)return a;const o=n(e,...s);return t.set(e,o),o}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$3=BigInt(0),_1n$3=BigInt(1),_2n$1=BigInt(2),_3n$1=BigInt(3),_4n=BigInt(4),_5n=BigInt(5),_8n=BigInt(8);function mod(n,t){const e=n%t;return e>=_0n$3?e:t+e}function pow2(n,t,e){let s=n;for(;t-- >_0n$3;)s*=s,s%=e;return s}function invert(n,t){if(n===_0n$3)throw new Error("invert: expected non-zero number");if(t<=_0n$3)throw new Error("invert: expected positive modulus, got "+t);let e=mod(n,t),s=t,a=_0n$3,o=_1n$3;for(;e!==_0n$3;){const p=s/e,y=s%e,g=a-o*p;s=e,e=y,a=o,o=g}if(s!==_1n$3)throw new Error("invert: does not exist");return mod(a,t)}function tonelliShanks(n){let t=n-_1n$3,e=0;for(;t%_2n$1===_0n$3;)t/=_2n$1,e++;let s=_2n$1;const a=Field(n);for(;s<n&&FpIsSquare(a,s);)if(s++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(e===1){const f=(n+_1n$3)/_4n;return function(y,g){const x=y.pow(g,f);if(!y.eql(y.sqr(x),g))throw new Error("Cannot find square root");return x}}const o=(t+_1n$3)/_2n$1;return function(p,y){if(!FpIsSquare(p,y))throw new Error("Cannot find square root");let g=e,x=p.pow(p.mul(p.ONE,s),t),E=p.pow(y,o),A=p.pow(y,t);for(;!p.eql(A,p.ONE);){if(p.eql(A,p.ZERO))return p.ZERO;let S=1;for(let _=p.sqr(A);S<g&&!p.eql(_,p.ONE);S++)_=p.sqr(_);const I=p.pow(x,_1n$3<<BigInt(g-S-1));x=p.sqr(I),E=p.mul(E,I),A=p.mul(A,x),g=S}return E}}function FpSqrt(n){return n%_4n===_3n$1?function(e,s){const a=(n+_1n$3)/_4n,o=e.pow(s,a);if(!e.eql(e.sqr(o),s))throw new Error("Cannot find square root");return o}:n%_8n===_5n?function(e,s){const a=e.mul(s,_2n$1),o=(n-_5n)/_8n,f=e.pow(a,o),p=e.mul(s,f),y=e.mul(e.mul(p,_2n$1),f),g=e.mul(p,e.sub(y,e.ONE));if(!e.eql(e.sqr(g),s))throw new Error("Cannot find square root");return g}:tonelliShanks(n)}const FIELD_FIELDS=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField(n){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},e=FIELD_FIELDS.reduce((s,a)=>(s[a]="function",s),t);return validateObject(n,e)}function FpPow(n,t,e){if(e<_0n$3)throw new Error("invalid exponent, negatives unsupported");if(e===_0n$3)return n.ONE;if(e===_1n$3)return t;let s=n.ONE,a=t;for(;e>_0n$3;)e&_1n$3&&(s=n.mul(s,a)),a=n.sqr(a),e>>=_1n$3;return s}function FpInvertBatch(n,t,e=!1){const s=new Array(t.length).fill(e?n.ZERO:void 0),a=t.reduce((f,p,y)=>n.is0(p)?f:(s[y]=f,n.mul(f,p)),n.ONE),o=n.inv(a);return t.reduceRight((f,p,y)=>n.is0(p)?f:(s[y]=n.mul(f,s[y]),n.mul(f,p)),o),s}function FpLegendre(n,t){const e=(n.ORDER-_1n$3)/_2n$1,s=n.pow(t,e),a=n.eql(s,n.ONE),o=n.eql(s,n.ZERO),f=n.eql(s,n.neg(n.ONE));if(!a&&!o&&!f)throw new Error("Cannot find square root: probably non-prime P");return a?1:o?0:-1}function FpIsSquare(n,t){const e=FpLegendre(n,t);return e===0||e===1}function nLength(n,t){t!==void 0&&anumber(t);const e=t!==void 0?t:n.toString(2).length,s=Math.ceil(e/8);return{nBitLength:e,nByteLength:s}}function Field(n,t,e=!1,s={}){if(n<=_0n$3)throw new Error("invalid field: expected ORDER > 0, got "+n);const{nBitLength:a,nByteLength:o}=nLength(n,t);if(o>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let f;const p=Object.freeze({ORDER:n,isLE:e,BITS:a,BYTES:o,MASK:bitMask(a),ZERO:_0n$3,ONE:_1n$3,create:y=>mod(y,n),isValid:y=>{if(typeof y!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof y);return _0n$3<=y&&y<n},is0:y=>y===_0n$3,isOdd:y=>(y&_1n$3)===_1n$3,neg:y=>mod(-y,n),eql:(y,g)=>y===g,sqr:y=>mod(y*y,n),add:(y,g)=>mod(y+g,n),sub:(y,g)=>mod(y-g,n),mul:(y,g)=>mod(y*g,n),pow:(y,g)=>FpPow(p,y,g),div:(y,g)=>mod(y*invert(g,n),n),sqrN:y=>y*y,addN:(y,g)=>y+g,subN:(y,g)=>y-g,mulN:(y,g)=>y*g,inv:y=>invert(y,n),sqrt:s.sqrt||(y=>(f||(f=FpSqrt(n)),f(p,y))),toBytes:y=>e?numberToBytesLE(y,o):numberToBytesBE(y,o),fromBytes:y=>{if(y.length!==o)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+y.length);return e?bytesToNumberLE(y):bytesToNumberBE(y)},invertBatch:y=>FpInvertBatch(p,y),cmov:(y,g,x)=>x?g:y});return Object.freeze(p)}function getFieldBytesLength(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const t=n.toString(2).length;return Math.ceil(t/8)}function getMinHashLength(n){const t=getFieldBytesLength(n);return t+Math.ceil(t/2)}function mapHashToField(n,t,e=!1){const s=n.length,a=getFieldBytesLength(t),o=getMinHashLength(t);if(s<16||s<o||s>1024)throw new Error("expected "+o+"-1024 bytes of input, got "+s);const f=e?bytesToNumberLE(n):bytesToNumberBE(n),p=mod(f,t-_1n$3)+_1n$3;return e?numberToBytesLE(p,a):numberToBytesBE(p,a)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$2=BigInt(0),_1n$2=BigInt(1);function constTimeNegate(n,t){const e=t.negate();return n?e:t}function validateW(n,t){if(!Number.isSafeInteger(n)||n<=0||n>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+n)}function calcWOpts(n,t){validateW(n,t);const e=Math.ceil(t/n)+1,s=2**(n-1),a=2**n,o=bitMask(n),f=BigInt(n);return{windows:e,windowSize:s,mask:o,maxNumber:a,shiftBy:f}}function calcOffsets(n,t,e){const{windowSize:s,mask:a,maxNumber:o,shiftBy:f}=e;let p=Number(n&a),y=n>>f;p>s&&(p-=o,y+=_1n$2);const g=t*s,x=g+Math.abs(p)-1,E=p===0,A=p<0,S=t%2!==0;return{nextN:y,offset:x,isZero:E,isNeg:A,isNegF:S,offsetF:g}}function validateMSMPoints(n,t){if(!Array.isArray(n))throw new Error("array expected");n.forEach((e,s)=>{if(!(e instanceof t))throw new Error("invalid point at index "+s)})}function validateMSMScalars(n,t){if(!Array.isArray(n))throw new Error("array of scalars expected");n.forEach((e,s)=>{if(!t.isValid(e))throw new Error("invalid scalar at index "+s)})}const pointPrecomputes=new WeakMap,pointWindowSizes=new WeakMap;function getW(n){return pointWindowSizes.get(n)||1}function wNAF(n,t){return{constTimeNegate,hasPrecomputes(e){return getW(e)!==1},unsafeLadder(e,s,a=n.ZERO){let o=e;for(;s>_0n$2;)s&_1n$2&&(a=a.add(o)),o=o.double(),s>>=_1n$2;return a},precomputeWindow(e,s){const{windows:a,windowSize:o}=calcWOpts(s,t),f=[];let p=e,y=p;for(let g=0;g<a;g++){y=p,f.push(y);for(let x=1;x<o;x++)y=y.add(p),f.push(y);p=y.double()}return f},wNAF(e,s,a){let o=n.ZERO,f=n.BASE;const p=calcWOpts(e,t);for(let y=0;y<p.windows;y++){const{nextN:g,offset:x,isZero:E,isNeg:A,isNegF:S,offsetF:I}=calcOffsets(a,y,p);a=g,E?f=f.add(constTimeNegate(S,s[I])):o=o.add(constTimeNegate(A,s[x]))}return{p:o,f}},wNAFUnsafe(e,s,a,o=n.ZERO){const f=calcWOpts(e,t);for(let p=0;p<f.windows&&a!==_0n$2;p++){const{nextN:y,offset:g,isZero:x,isNeg:E}=calcOffsets(a,p,f);if(a=y,!x){const A=s[g];o=o.add(E?A.negate():A)}}return o},getPrecomputes(e,s,a){let o=pointPrecomputes.get(s);return o||(o=this.precomputeWindow(s,e),e!==1&&pointPrecomputes.set(s,a(o))),o},wNAFCached(e,s,a){const o=getW(e);return this.wNAF(o,this.getPrecomputes(o,e,a),s)},wNAFCachedUnsafe(e,s,a,o){const f=getW(e);return f===1?this.unsafeLadder(e,s,o):this.wNAFUnsafe(f,this.getPrecomputes(f,e,a),s,o)},setWindowSize(e,s){validateW(s,t),pointWindowSizes.set(e,s),pointPrecomputes.delete(e)}}}function pippenger(n,t,e,s){if(validateMSMPoints(e,n),validateMSMScalars(s,t),e.length!==s.length)throw new Error("arrays of points and scalars must have equal length");const a=n.ZERO,o=bitLen(BigInt(e.length)),f=o>12?o-3:o>4?o-2:o?2:1,p=bitMask(f),y=new Array(Number(p)+1).fill(a),g=Math.floor((t.BITS-1)/f)*f;let x=a;for(let E=g;E>=0;E-=f){y.fill(a);for(let S=0;S<s.length;S++){const I=s[S],_=Number(I>>BigInt(E)&p);y[_]=y[_].add(e[S])}let A=a;for(let S=y.length-1,I=a;S>0;S--)I=I.add(y[S]),A=A.add(I);if(x=x.add(A),E!==0)for(let S=0;S<f;S++)x=x.double()}return x}function validateBasic(n){return validateField(n.Fp),validateObject(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength(n.n,n.nBitLength),...n,p:n.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validateSigVerOpts(n){n.lowS!==void 0&&abool("lowS",n.lowS),n.prehash!==void 0&&abool("prehash",n.prehash)}function validatePointOpts(n){const t=validateBasic(n);validateObject(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:e,Fp:s,a}=t;if(e){if(!s.eql(a,s.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof e!="object"||typeof e.beta!="bigint"||typeof e.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...t})}class DERErr extends Error{constructor(t=""){super(t)}}const DER={Err:DERErr,_tlv:{encode:(n,t)=>{const{Err:e}=DER;if(n<0||n>256)throw new e("tlv.encode: wrong tag");if(t.length&1)throw new e("tlv.encode: unpadded data");const s=t.length/2,a=numberToHexUnpadded(s);if(a.length/2&128)throw new e("tlv.encode: long form length too big");const o=s>127?numberToHexUnpadded(a.length/2|128):"";return numberToHexUnpadded(n)+o+a+t},decode(n,t){const{Err:e}=DER;let s=0;if(n<0||n>256)throw new e("tlv.encode: wrong tag");if(t.length<2||t[s++]!==n)throw new e("tlv.decode: wrong tlv");const a=t[s++],o=!!(a&128);let f=0;if(!o)f=a;else{const y=a&127;if(!y)throw new e("tlv.decode(long): indefinite length not supported");if(y>4)throw new e("tlv.decode(long): byte length is too big");const g=t.subarray(s,s+y);if(g.length!==y)throw new e("tlv.decode: length bytes not complete");if(g[0]===0)throw new e("tlv.decode(long): zero leftmost byte");for(const x of g)f=f<<8|x;if(s+=y,f<128)throw new e("tlv.decode(long): not minimal encoding")}const p=t.subarray(s,s+f);if(p.length!==f)throw new e("tlv.decode: wrong value length");return{v:p,l:t.subarray(s+f)}}},_int:{encode(n){const{Err:t}=DER;if(n<_0n$1)throw new t("integer: negative integers are not allowed");let e=numberToHexUnpadded(n);if(Number.parseInt(e[0],16)&8&&(e="00"+e),e.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return e},decode(n){const{Err:t}=DER;if(n[0]&128)throw new t("invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return bytesToNumberBE(n)}},toSig(n){const{Err:t,_int:e,_tlv:s}=DER,a=ensureBytes("signature",n),{v:o,l:f}=s.decode(48,a);if(f.length)throw new t("invalid signature: left bytes after parsing");const{v:p,l:y}=s.decode(2,o),{v:g,l:x}=s.decode(2,y);if(x.length)throw new t("invalid signature: left bytes after parsing");return{r:e.decode(p),s:e.decode(g)}},hexFromSig(n){const{_tlv:t,_int:e}=DER,s=t.encode(2,e.encode(n.r)),a=t.encode(2,e.encode(n.s)),o=s+a;return t.encode(48,o)}},_0n$1=BigInt(0),_1n$1=BigInt(1);BigInt(2);const _3n=BigInt(3);BigInt(4);function weierstrassPoints(n){const t=validatePointOpts(n),{Fp:e}=t,s=Field(t.n,t.nBitLength),a=t.toBytes||((_,R,N)=>{const D=R.toAffine();return concatBytes(Uint8Array.from([4]),e.toBytes(D.x),e.toBytes(D.y))}),o=t.fromBytes||(_=>{const R=_.subarray(1),N=e.fromBytes(R.subarray(0,e.BYTES)),D=e.fromBytes(R.subarray(e.BYTES,2*e.BYTES));return{x:N,y:D}});function f(_){const{a:R,b:N}=t,D=e.sqr(_),M=e.mul(D,_);return e.add(e.add(M,e.mul(_,R)),N)}if(!e.eql(e.sqr(t.Gy),f(t.Gx)))throw new Error("bad generator point: equation left != right");function p(_){return inRange(_,_1n$1,t.n)}function y(_){const{allowedPrivateKeyLengths:R,nByteLength:N,wrapPrivateKey:D,n:M}=t;if(R&&typeof _!="bigint"){if(isBytes(_)&&(_=bytesToHex(_)),typeof _!="string"||!R.includes(_.length))throw new Error("invalid private key");_=_.padStart(N*2,"0")}let W;try{W=typeof _=="bigint"?_:bytesToNumberBE(ensureBytes("private key",_,N))}catch{throw new Error("invalid private key, expected hex or "+N+" bytes, got "+typeof _)}return D&&(W=mod(W,M)),aInRange("private key",W,_1n$1,M),W}function g(_){if(!(_ instanceof A))throw new Error("ProjectivePoint expected")}const x=memoized((_,R)=>{const{px:N,py:D,pz:M}=_;if(e.eql(M,e.ONE))return{x:N,y:D};const W=_.is0();R==null&&(R=W?e.ONE:e.inv(M));const B=e.mul(N,R),U=e.mul(D,R),P=e.mul(M,R);if(W)return{x:e.ZERO,y:e.ZERO};if(!e.eql(P,e.ONE))throw new Error("invZ was invalid");return{x:B,y:U}}),E=memoized(_=>{if(_.is0()){if(t.allowInfinityPoint&&!e.is0(_.py))return;throw new Error("bad point: ZERO")}const{x:R,y:N}=_.toAffine();if(!e.isValid(R)||!e.isValid(N))throw new Error("bad point: x or y not FE");const D=e.sqr(N),M=f(R);if(!e.eql(D,M))throw new Error("bad point: equation left != right");if(!_.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class A{constructor(R,N,D){if(R==null||!e.isValid(R))throw new Error("x required");if(N==null||!e.isValid(N)||e.is0(N))throw new Error("y required");if(D==null||!e.isValid(D))throw new Error("z required");this.px=R,this.py=N,this.pz=D,Object.freeze(this)}static fromAffine(R){const{x:N,y:D}=R||{};if(!R||!e.isValid(N)||!e.isValid(D))throw new Error("invalid affine point");if(R instanceof A)throw new Error("projective point not allowed");const M=W=>e.eql(W,e.ZERO);return M(N)&&M(D)?A.ZERO:new A(N,D,e.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(R){const N=FpInvertBatch(e,R.map(D=>D.pz));return R.map((D,M)=>D.toAffine(N[M])).map(A.fromAffine)}static fromHex(R){const N=A.fromAffine(o(ensureBytes("pointHex",R)));return N.assertValidity(),N}static fromPrivateKey(R){return A.BASE.multiply(y(R))}static msm(R,N){return pippenger(A,s,R,N)}_setWindowSize(R){I.setWindowSize(this,R)}assertValidity(){E(this)}hasEvenY(){const{y:R}=this.toAffine();if(e.isOdd)return!e.isOdd(R);throw new Error("Field doesn't support isOdd")}equals(R){g(R);const{px:N,py:D,pz:M}=this,{px:W,py:B,pz:U}=R,P=e.eql(e.mul(N,U),e.mul(W,M)),F=e.eql(e.mul(D,U),e.mul(B,M));return P&&F}negate(){return new A(this.px,e.neg(this.py),this.pz)}double(){const{a:R,b:N}=t,D=e.mul(N,_3n),{px:M,py:W,pz:B}=this;let U=e.ZERO,P=e.ZERO,F=e.ZERO,j=e.mul(M,M),Q=e.mul(W,W),$=e.mul(B,B),V=e.mul(M,W);return V=e.add(V,V),F=e.mul(M,B),F=e.add(F,F),U=e.mul(R,F),P=e.mul(D,$),P=e.add(U,P),U=e.sub(Q,P),P=e.add(Q,P),P=e.mul(U,P),U=e.mul(V,U),F=e.mul(D,F),$=e.mul(R,$),V=e.sub(j,$),V=e.mul(R,V),V=e.add(V,F),F=e.add(j,j),j=e.add(F,j),j=e.add(j,$),j=e.mul(j,V),P=e.add(P,j),$=e.mul(W,B),$=e.add($,$),j=e.mul($,V),U=e.sub(U,j),F=e.mul($,Q),F=e.add(F,F),F=e.add(F,F),new A(U,P,F)}add(R){g(R);const{px:N,py:D,pz:M}=this,{px:W,py:B,pz:U}=R;let P=e.ZERO,F=e.ZERO,j=e.ZERO;const Q=t.a,$=e.mul(t.b,_3n);let V=e.mul(N,W),G=e.mul(D,B),se=e.mul(M,U),H=e.add(N,D),J=e.add(W,B);H=e.mul(H,J),J=e.add(V,G),H=e.sub(H,J),J=e.add(N,M);let K=e.add(W,U);return J=e.mul(J,K),K=e.add(V,se),J=e.sub(J,K),K=e.add(D,M),P=e.add(B,U),K=e.mul(K,P),P=e.add(G,se),K=e.sub(K,P),j=e.mul(Q,J),P=e.mul($,se),j=e.add(P,j),P=e.sub(G,j),j=e.add(G,j),F=e.mul(P,j),G=e.add(V,V),G=e.add(G,V),se=e.mul(Q,se),J=e.mul($,J),G=e.add(G,se),se=e.sub(V,se),se=e.mul(Q,se),J=e.add(J,se),V=e.mul(G,J),F=e.add(F,V),V=e.mul(K,J),P=e.mul(H,P),P=e.sub(P,V),V=e.mul(H,G),j=e.mul(K,j),j=e.add(j,V),new A(P,F,j)}subtract(R){return this.add(R.negate())}is0(){return this.equals(A.ZERO)}wNAF(R){return I.wNAFCached(this,R,A.normalizeZ)}multiplyUnsafe(R){const{endo:N,n:D}=t;aInRange("scalar",R,_0n$1,D);const M=A.ZERO;if(R===_0n$1)return M;if(this.is0()||R===_1n$1)return this;if(!N||I.hasPrecomputes(this))return I.wNAFCachedUnsafe(this,R,A.normalizeZ);let{k1neg:W,k1:B,k2neg:U,k2:P}=N.splitScalar(R),F=M,j=M,Q=this;for(;B>_0n$1||P>_0n$1;)B&_1n$1&&(F=F.add(Q)),P&_1n$1&&(j=j.add(Q)),Q=Q.double(),B>>=_1n$1,P>>=_1n$1;return W&&(F=F.negate()),U&&(j=j.negate()),j=new A(e.mul(j.px,N.beta),j.py,j.pz),F.add(j)}multiply(R){const{endo:N,n:D}=t;aInRange("scalar",R,_1n$1,D);let M,W;if(N){const{k1neg:B,k1:U,k2neg:P,k2:F}=N.splitScalar(R);let{p:j,f:Q}=this.wNAF(U),{p:$,f:V}=this.wNAF(F);j=I.constTimeNegate(B,j),$=I.constTimeNegate(P,$),$=new A(e.mul($.px,N.beta),$.py,$.pz),M=j.add($),W=Q.add(V)}else{const{p:B,f:U}=this.wNAF(R);M=B,W=U}return A.normalizeZ([M,W])[0]}multiplyAndAddUnsafe(R,N,D){const M=A.BASE,W=(U,P)=>P===_0n$1||P===_1n$1||!U.equals(M)?U.multiplyUnsafe(P):U.multiply(P),B=W(this,N).add(W(R,D));return B.is0()?void 0:B}toAffine(R){return x(this,R)}isTorsionFree(){const{h:R,isTorsionFree:N}=t;if(R===_1n$1)return!0;if(N)return N(A,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:R,clearCofactor:N}=t;return R===_1n$1?this:N?N(A,this):this.multiplyUnsafe(t.h)}toRawBytes(R=!0){return abool("isCompressed",R),this.assertValidity(),a(A,this,R)}toHex(R=!0){return abool("isCompressed",R),bytesToHex(this.toRawBytes(R))}}A.BASE=new A(t.Gx,t.Gy,e.ONE),A.ZERO=new A(e.ZERO,e.ONE,e.ZERO);const S=t.nBitLength,I=wNAF(A,t.endo?Math.ceil(S/2):S);return{CURVE:t,ProjectivePoint:A,normPrivateKeyToScalar:y,weierstrassEquation:f,isWithinCurveOrder:p}}function validateOpts(n){const t=validateBasic(n);return validateObject(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function weierstrass$1(n){const t=validateOpts(n),{Fp:e,n:s}=t,a=e.BYTES+1,o=2*e.BYTES+1;function f(se){return mod(se,s)}function p(se){return invert(se,s)}const{ProjectivePoint:y,normPrivateKeyToScalar:g,weierstrassEquation:x,isWithinCurveOrder:E}=weierstrassPoints({...t,toBytes(se,H,J){const K=H.toAffine(),ie=e.toBytes(K.x),ne=concatBytes;return abool("isCompressed",J),J?ne(Uint8Array.from([H.hasEvenY()?2:3]),ie):ne(Uint8Array.from([4]),ie,e.toBytes(K.y))},fromBytes(se){const H=se.length,J=se[0],K=se.subarray(1);if(H===a&&(J===2||J===3)){const ie=bytesToNumberBE(K);if(!inRange(ie,_1n$1,e.ORDER))throw new Error("Point is not on curve");const ne=x(ie);let re;try{re=e.sqrt(ne)}catch(te){const ce=te instanceof Error?": "+te.message:"";throw new Error("Point is not on curve"+ce)}const X=(re&_1n$1)===_1n$1;return(J&1)===1!==X&&(re=e.neg(re)),{x:ie,y:re}}else if(H===o&&J===4){const ie=e.fromBytes(K.subarray(0,e.BYTES)),ne=e.fromBytes(K.subarray(e.BYTES,2*e.BYTES));return{x:ie,y:ne}}else{const ie=a,ne=o;throw new Error("invalid Point, expected length of "+ie+", or uncompressed "+ne+", got "+H)}}}),A=se=>bytesToHex(numberToBytesBE(se,t.nByteLength));function S(se){const H=s>>_1n$1;return se>H}function I(se){return S(se)?f(-se):se}const _=(se,H,J)=>bytesToNumberBE(se.slice(H,J));class R{constructor(H,J,K){aInRange("r",H,_1n$1,s),aInRange("s",J,_1n$1,s),this.r=H,this.s=J,K!=null&&(this.recovery=K),Object.freeze(this)}static fromCompact(H){const J=t.nByteLength;return H=ensureBytes("compactSignature",H,J*2),new R(_(H,0,J),_(H,J,2*J))}static fromDER(H){const{r:J,s:K}=DER.toSig(ensureBytes("DER",H));return new R(J,K)}assertValidity(){}addRecoveryBit(H){return new R(this.r,this.s,H)}recoverPublicKey(H){const{r:J,s:K,recovery:ie}=this,ne=U(ensureBytes("msgHash",H));if(ie==null||![0,1,2,3].includes(ie))throw new Error("recovery id invalid");const re=ie===2||ie===3?J+t.n:J;if(re>=e.ORDER)throw new Error("recovery id 2 or 3 invalid");const X=(ie&1)===0?"02":"03",ae=y.fromHex(X+A(re)),te=p(re),ce=f(-ne*te),xe=f(K*te),me=y.BASE.multiplyAndAddUnsafe(ae,ce,xe);if(!me)throw new Error("point at infinify");return me.assertValidity(),me}hasHighS(){return S(this.s)}normalizeS(){return this.hasHighS()?new R(this.r,f(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes(this.toDERHex())}toDERHex(){return DER.hexFromSig(this)}toCompactRawBytes(){return hexToBytes(this.toCompactHex())}toCompactHex(){return A(this.r)+A(this.s)}}const N={isValidPrivateKey(se){try{return g(se),!0}catch{return!1}},normPrivateKeyToScalar:g,randomPrivateKey:()=>{const se=getMinHashLength(t.n);return mapHashToField(t.randomBytes(se),t.n)},precompute(se=8,H=y.BASE){return H._setWindowSize(se),H.multiply(BigInt(3)),H}};function D(se,H=!0){return y.fromPrivateKey(se).toRawBytes(H)}function M(se){const H=isBytes(se),J=typeof se=="string",K=(H||J)&&se.length;return H?K===a||K===o:J?K===2*a||K===2*o:se instanceof y}function W(se,H,J=!0){if(M(se))throw new Error("first arg must be private key");if(!M(H))throw new Error("second arg must be public key");return y.fromHex(H).multiply(g(se)).toRawBytes(J)}const B=t.bits2int||function(se){if(se.length>8192)throw new Error("input is too large");const H=bytesToNumberBE(se),J=se.length*8-t.nBitLength;return J>0?H>>BigInt(J):H},U=t.bits2int_modN||function(se){return f(B(se))},P=bitMask(t.nBitLength);function F(se){return aInRange("num < 2^"+t.nBitLength,se,_0n$1,P),numberToBytesBE(se,t.nByteLength)}function j(se,H,J=Q){if(["recovered","canonical"].some(be=>be in J))throw new Error("sign() legacy options not supported");const{hash:K,randomBytes:ie}=t;let{lowS:ne,prehash:re,extraEntropy:X}=J;ne==null&&(ne=!0),se=ensureBytes("msgHash",se),validateSigVerOpts(J),re&&(se=ensureBytes("prehashed msgHash",K(se)));const ae=U(se),te=g(H),ce=[F(te),F(ae)];if(X!=null&&X!==!1){const be=X===!0?ie(e.BYTES):X;ce.push(ensureBytes("extraEntropy",be))}const xe=concatBytes(...ce),me=ae;function Se(be){const Me=B(be);if(!E(Me))return;const Oe=p(Me),Ue=y.BASE.multiply(Me).toAffine(),je=f(Ue.x);if(je===_0n$1)return;const Pe=f(Oe*f(me+je*te));if(Pe===_0n$1)return;let We=(Ue.x===je?0:2)|Number(Ue.y&_1n$1),Ze=Pe;return ne&&S(Pe)&&(Ze=I(Pe),We^=1),new R(je,Ze,We)}return{seed:xe,k2sig:Se}}const Q={lowS:t.lowS,prehash:!1},$={lowS:t.lowS,prehash:!1};function V(se,H,J=Q){const{seed:K,k2sig:ie}=j(se,H,J),ne=t;return createHmacDrbg(ne.hash.outputLen,ne.nByteLength,ne.hmac)(K,ie)}y.BASE._setWindowSize(8);function G(se,H,J,K=$){var We;const ie=se;H=ensureBytes("msgHash",H),J=ensureBytes("publicKey",J);const{lowS:ne,prehash:re,format:X}=K;if(validateSigVerOpts(K),"strict"in K)throw new Error("options.strict was renamed to lowS");if(X!==void 0&&X!=="compact"&&X!=="der")throw new Error("format must be compact or der");const ae=typeof ie=="string"||isBytes(ie),te=!ae&&!X&&typeof ie=="object"&&ie!==null&&typeof ie.r=="bigint"&&typeof ie.s=="bigint";if(!ae&&!te)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let ce,xe;try{if(te&&(ce=new R(ie.r,ie.s)),ae){try{X!=="compact"&&(ce=R.fromDER(ie))}catch(Ze){if(!(Ze instanceof DER.Err))throw Ze}!ce&&X!=="der"&&(ce=R.fromCompact(ie))}xe=y.fromHex(J)}catch{return!1}if(!ce||ne&&ce.hasHighS())return!1;re&&(H=t.hash(H));const{r:me,s:Se}=ce,be=U(H),Me=p(Se),Oe=f(be*Me),Ue=f(me*Me),je=(We=y.BASE.multiplyAndAddUnsafe(xe,Oe,Ue))==null?void 0:We.toAffine();return je?f(je.x)===me:!1}return{CURVE:t,getPublicKey:D,getSharedSecret:W,sign:V,verify:G,ProjectivePoint:y,Signature:R,utils:N}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash(n){return{hash:n,hmac:(t,...e)=>hmac$1(n,t,concatBytes$1(...e)),randomBytes}}function createCurve(n,t){const e=s=>weierstrass$1({...n,...getHash(s)});return{...e(t),create:e}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1P=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_1n=BigInt(1),_2n=BigInt(2),divNearest=(n,t)=>(n+t/_2n)/t;function sqrtMod(n){const t=secp256k1P,e=BigInt(3),s=BigInt(6),a=BigInt(11),o=BigInt(22),f=BigInt(23),p=BigInt(44),y=BigInt(88),g=n*n*n%t,x=g*g*n%t,E=pow2(x,e,t)*x%t,A=pow2(E,e,t)*x%t,S=pow2(A,_2n,t)*g%t,I=pow2(S,a,t)*S%t,_=pow2(I,o,t)*I%t,R=pow2(_,p,t)*_%t,N=pow2(R,y,t)*R%t,D=pow2(N,p,t)*_%t,M=pow2(D,e,t)*x%t,W=pow2(M,f,t)*I%t,B=pow2(W,s,t)*g%t,U=pow2(B,_2n,t);if(!Fpk1.eql(Fpk1.sqr(U),n))throw new Error("Cannot find square root");return U}const Fpk1=Field(secp256k1P,void 0,void 0,{sqrt:sqrtMod}),secp256k1$1=createCurve({a:BigInt(0),b:BigInt(7),Fp:Fpk1,n:secp256k1N,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:n=>{const t=secp256k1N,e=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),s=-_1n*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),a=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=e,f=BigInt("0x100000000000000000000000000000000"),p=divNearest(o*n,t),y=divNearest(-s*n,t);let g=mod(n-p*e-y*a,t),x=mod(-p*s-y*o,t);const E=g>f,A=x>f;if(E&&(g=t-g),A&&(x=t-x),g>f||x>f)throw new Error("splitScalar: Endomorphism failed, k="+n);return{k1neg:E,k1:g,k2neg:A,k2:x}}}},sha256$2),_0n=BigInt(0),TAGGED_HASH_PREFIXES={};function taggedHash(n,...t){let e=TAGGED_HASH_PREFIXES[n];if(e===void 0){const s=sha256$2(Uint8Array.from(n,a=>a.charCodeAt(0)));e=concatBytes(s,s),TAGGED_HASH_PREFIXES[n]=e}return sha256$2(concatBytes(e,...t))}const pointToBytes=n=>n.toRawBytes(!0).slice(1),numTo32b=n=>numberToBytesBE(n,32),modP=n=>mod(n,secp256k1P),modN=n=>mod(n,secp256k1N),Point=secp256k1$1.ProjectivePoint,GmulAdd=(n,t,e)=>Point.BASE.multiplyAndAddUnsafe(n,t,e);function schnorrGetExtPubKey(n){let t=secp256k1$1.utils.normPrivateKeyToScalar(n),e=Point.fromPrivateKey(t);return{scalar:e.hasEvenY()?t:modN(-t),bytes:pointToBytes(e)}}function lift_x(n){aInRange("x",n,_1n,secp256k1P);const t=modP(n*n),e=modP(t*n+BigInt(7));let s=sqrtMod(e);s%_2n!==_0n&&(s=modP(-s));const a=new Point(n,s,_1n);return a.assertValidity(),a}const num=bytesToNumberBE;function challenge(...n){return modN(num(taggedHash("BIP0340/challenge",...n)))}function schnorrGetPublicKey(n){return schnorrGetExtPubKey(n).bytes}function schnorrSign(n,t,e=randomBytes(32)){const s=ensureBytes("message",n),{bytes:a,scalar:o}=schnorrGetExtPubKey(t),f=ensureBytes("auxRand",e,32),p=numTo32b(o^num(taggedHash("BIP0340/aux",f))),y=taggedHash("BIP0340/nonce",p,a,s),g=modN(num(y));if(g===_0n)throw new Error("sign failed: k is zero");const{bytes:x,scalar:E}=schnorrGetExtPubKey(g),A=challenge(x,a,s),S=new Uint8Array(64);if(S.set(x,0),S.set(numTo32b(modN(E+A*o)),32),!schnorrVerify(S,s,a))throw new Error("sign: Invalid signature produced");return S}function schnorrVerify(n,t,e){const s=ensureBytes("signature",n,64),a=ensureBytes("message",t),o=ensureBytes("publicKey",e,32);try{const f=lift_x(num(o)),p=num(s.subarray(0,32));if(!inRange(p,_1n,secp256k1P))return!1;const y=num(s.subarray(32,64));if(!inRange(y,_1n,secp256k1N))return!1;const g=challenge(numTo32b(p),pointToBytes(f),a),x=GmulAdd(f,y,modN(-g));return!(!x||!x.hasEvenY()||x.toAffine().x!==p)}catch{return!1}}const schnorr={getPublicKey:schnorrGetPublicKey,sign:schnorrSign,verify:schnorrVerify,utils:{randomPrivateKey:secp256k1$1.utils.randomPrivateKey,lift_x,pointToBytes,numberToBytesBE,bytesToNumberBE,taggedHash,mod}},sha256$1=sha256$2;var dist={},LRUCache={},LRUCacheNode={},hasRequiredLRUCacheNode;function requireLRUCacheNode(){if(hasRequiredLRUCacheNode)return LRUCacheNode;hasRequiredLRUCacheNode=1,Object.defineProperty(LRUCacheNode,"__esModule",{value:!0}),LRUCacheNode.LRUCacheNode=void 0;let n=class{constructor(e,s,a){const{entryExpirationTimeInMS:o=null,next:f=null,prev:p=null,onEntryEvicted:y,onEntryMarkedAsMostRecentlyUsed:g,clone:x,cloneFn:E}=a??{};if(typeof o=="number"&&(o<=0||Number.isNaN(o)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.clone=x??!1,this.cloneFn=E??this.defaultClone,this.key=e,this.internalValue=this.clone?this.cloneFn(s):s,this.created=Date.now(),this.entryExpirationTimeInMS=o,this.next=f,this.prev=p,this.onEntryEvicted=y,this.onEntryMarkedAsMostRecentlyUsed=g}get value(){return this.clone?this.cloneFn(this.internalValue):this.internalValue}get isExpired(){return typeof this.entryExpirationTimeInMS=="number"&&Date.now()-this.created>this.entryExpirationTimeInMS}invokeOnEvicted(){if(this.onEntryEvicted){const{key:e,value:s,isExpired:a}=this;this.onEntryEvicted({key:e,value:s,isExpired:a})}}invokeOnEntryMarkedAsMostRecentlyUsed(){if(this.onEntryMarkedAsMostRecentlyUsed){const{key:e,value:s}=this;this.onEntryMarkedAsMostRecentlyUsed({key:e,value:s})}}defaultClone(e){return typeof e=="boolean"||typeof e=="string"||typeof e=="number"?e:JSON.parse(JSON.stringify(e))}};return LRUCacheNode.LRUCacheNode=n,LRUCacheNode}var hasRequiredLRUCache;function requireLRUCache(){if(hasRequiredLRUCache)return LRUCache;hasRequiredLRUCache=1,Object.defineProperty(LRUCache,"__esModule",{value:!0}),LRUCache.LRUCache=void 0;const n=requireLRUCacheNode();let t=class{constructor(s){this.lookupTable=new Map,this.head=null,this.tail=null;const{maxSize:a=25,entryExpirationTimeInMS:o=null,onEntryEvicted:f,onEntryMarkedAsMostRecentlyUsed:p,cloneFn:y,clone:g}=s??{};if(Number.isNaN(a)||a<=0)throw new Error("maxSize must be greater than 0.");if(typeof o=="number"&&(o<=0||Number.isNaN(o)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.maxSizeInternal=a,this.entryExpirationTimeInMS=o,this.onEntryEvicted=f,this.onEntryMarkedAsMostRecentlyUsed=p,this.clone=g,this.cloneFn=y}get size(){return this.cleanCache(),this.lookupTable.size}get remainingSize(){return this.maxSizeInternal-this.size}get newest(){return this.head?this.head.isExpired?(this.removeNodeFromListAndLookupTable(this.head),this.newest):this.mapNodeToEntry(this.head):null}get oldest(){return this.tail?this.tail.isExpired?(this.removeNodeFromListAndLookupTable(this.tail),this.oldest):this.mapNodeToEntry(this.tail):null}get maxSize(){return this.maxSizeInternal}set maxSize(s){if(Number.isNaN(s)||s<=0)throw new Error("maxSize must be greater than 0.");this.maxSizeInternal=s,this.enforceSizeLimit()}set(s,a,o){const f=this.lookupTable.get(s);f&&this.removeNodeFromListAndLookupTable(f);const p=new n.LRUCacheNode(s,a,{entryExpirationTimeInMS:this.entryExpirationTimeInMS,onEntryEvicted:this.onEntryEvicted,onEntryMarkedAsMostRecentlyUsed:this.onEntryMarkedAsMostRecentlyUsed,clone:this.clone,cloneFn:this.cloneFn,...o});return this.setNodeAsHead(p),this.lookupTable.set(s,p),this.enforceSizeLimit(),this}get(s){const a=this.lookupTable.get(s);return a?a.isExpired?(this.removeNodeFromListAndLookupTable(a),null):(this.setNodeAsHead(a),a.value):null}peek(s){const a=this.lookupTable.get(s);return a?a.isExpired?(this.removeNodeFromListAndLookupTable(a),null):a.value:null}delete(s){const a=this.lookupTable.get(s);return a?this.removeNodeFromListAndLookupTable(a):!1}has(s){const a=this.lookupTable.get(s);return a?a.isExpired?(this.removeNodeFromListAndLookupTable(a),!1):!0:!1}clear(){this.head=null,this.tail=null,this.lookupTable.clear()}find(s){let a=this.head;for(;a;){if(a.isExpired){const f=a.next;this.removeNodeFromListAndLookupTable(a),a=f;continue}const o=this.mapNodeToEntry(a);if(s(o))return this.setNodeAsHead(a),o;a=a.next}return null}forEach(s){let a=this.head,o=0;for(;a;){if(a.isExpired){const f=a.next;this.removeNodeFromListAndLookupTable(a),a=f;continue}s(a.value,a.key,o),a=a.next,o++}}*values(){let s=this.head;for(;s;){if(s.isExpired){const a=s.next;this.removeNodeFromListAndLookupTable(s),s=a;continue}yield s.value,s=s.next}}*keys(){let s=this.head;for(;s;){if(s.isExpired){const a=s.next;this.removeNodeFromListAndLookupTable(s),s=a;continue}yield s.key,s=s.next}}*entries(){let s=this.head;for(;s;){if(s.isExpired){const a=s.next;this.removeNodeFromListAndLookupTable(s),s=a;continue}yield this.mapNodeToEntry(s),s=s.next}}*[Symbol.iterator](){let s=this.head;for(;s;){if(s.isExpired){const a=s.next;this.removeNodeFromListAndLookupTable(s),s=a;continue}yield this.mapNodeToEntry(s),s=s.next}}enforceSizeLimit(){let s=this.tail;for(;s!==null&&this.size>this.maxSizeInternal;){const a=s.prev;this.removeNodeFromListAndLookupTable(s),s=a}}mapNodeToEntry({key:s,value:a}){return{key:s,value:a}}setNodeAsHead(s){this.removeNodeFromList(s),this.head?(s.next=this.head,this.head.prev=s,this.head=s):(this.head=s,this.tail=s),s.invokeOnEntryMarkedAsMostRecentlyUsed()}removeNodeFromList(s){s.prev!==null&&(s.prev.next=s.next),s.next!==null&&(s.next.prev=s.prev),this.head===s&&(this.head=s.next),this.tail===s&&(this.tail=s.prev),s.next=null,s.prev=null}removeNodeFromListAndLookupTable(s){return s.invokeOnEvicted(),this.removeNodeFromList(s),this.lookupTable.delete(s.key)}cleanCache(){if(!this.entryExpirationTimeInMS)return;const s=[];for(const a of this.lookupTable.values())a.isExpired&&s.push(a);s.forEach(a=>this.removeNodeFromListAndLookupTable(a))}};return LRUCache.LRUCache=t,LRUCache}var hasRequiredDist;function requireDist(){return hasRequiredDist||(hasRequiredDist=1,function(n){var t=dist&&dist.__createBinding||(Object.create?function(s,a,o,f){f===void 0&&(f=o);var p=Object.getOwnPropertyDescriptor(a,o);(!p||("get"in p?!a.__esModule:p.writable||p.configurable))&&(p={enumerable:!0,get:function(){return a[o]}}),Object.defineProperty(s,f,p)}:function(s,a,o,f){f===void 0&&(f=o),s[f]=a[o]}),e=dist&&dist.__exportStar||function(s,a){for(var o in s)o!=="default"&&!Object.prototype.hasOwnProperty.call(a,o)&&t(a,s,o)};Object.defineProperty(n,"__esModule",{value:!0}),e(requireLRUCache(),n)}(dist)),dist}var distExports=requireDist(),lib$2={},hasRequiredLib$2;function requireLib$2(){return hasRequiredLib$2||(hasRequiredLib$2=1,function(n){/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(n,"__esModule",{value:!0}),n.bytes=n.stringToBytes=n.str=n.bytesToString=n.hex=n.utf8=n.bech32m=n.bech32=n.base58check=n.base58xmr=n.base58xrp=n.base58flickr=n.base58=n.base64url=n.base64=n.base32crockford=n.base32hex=n.base32=n.base16=n.utils=n.assertNumber=void 0;function t($){if(!Number.isSafeInteger($))throw new Error(`Wrong integer: ${$}`)}n.assertNumber=t;function e(...$){const V=(H,J)=>K=>H(J(K)),G=Array.from($).reverse().reduce((H,J)=>H?V(H,J.encode):J.encode,void 0),se=$.reduce((H,J)=>H?V(H,J.decode):J.decode,void 0);return{encode:G,decode:se}}function s($){return{encode:V=>{if(!Array.isArray(V)||V.length&&typeof V[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return V.map(G=>{if(t(G),G<0||G>=$.length)throw new Error(`Digit index outside alphabet: ${G} (alphabet: ${$.length})`);return $[G]})},decode:V=>{if(!Array.isArray(V)||V.length&&typeof V[0]!="string")throw new Error("alphabet.decode input should be array of strings");return V.map(G=>{if(typeof G!="string")throw new Error(`alphabet.decode: not string element=${G}`);const se=$.indexOf(G);if(se===-1)throw new Error(`Unknown letter: "${G}". Allowed: ${$}`);return se})}}}function a($=""){if(typeof $!="string")throw new Error("join separator should be string");return{encode:V=>{if(!Array.isArray(V)||V.length&&typeof V[0]!="string")throw new Error("join.encode input should be array of strings");for(let G of V)if(typeof G!="string")throw new Error(`join.encode: non-string input=${G}`);return V.join($)},decode:V=>{if(typeof V!="string")throw new Error("join.decode input should be string");return V.split($)}}}function o($,V="="){if(t($),typeof V!="string")throw new Error("padding chr should be string");return{encode(G){if(!Array.isArray(G)||G.length&&typeof G[0]!="string")throw new Error("padding.encode input should be array of strings");for(let se of G)if(typeof se!="string")throw new Error(`padding.encode: non-string input=${se}`);for(;G.length*$%8;)G.push(V);return G},decode(G){if(!Array.isArray(G)||G.length&&typeof G[0]!="string")throw new Error("padding.encode input should be array of strings");for(let H of G)if(typeof H!="string")throw new Error(`padding.decode: non-string input=${H}`);let se=G.length;if(se*$%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;se>0&&G[se-1]===V;se--)if(!((se-1)*$%8))throw new Error("Invalid padding: string has too much padding");return G.slice(0,se)}}}function f($){if(typeof $!="function")throw new Error("normalize fn should be function");return{encode:V=>V,decode:V=>$(V)}}function p($,V,G){if(V<2)throw new Error(`convertRadix: wrong from=${V}, base cannot be less than 2`);if(G<2)throw new Error(`convertRadix: wrong to=${G}, base cannot be less than 2`);if(!Array.isArray($))throw new Error("convertRadix: data should be array");if(!$.length)return[];let se=0;const H=[],J=Array.from($);for(J.forEach(K=>{if(t(K),K<0||K>=V)throw new Error(`Wrong integer: ${K}`)});;){let K=0,ie=!0;for(let ne=se;ne<J.length;ne++){const re=J[ne],X=V*K+re;if(!Number.isSafeInteger(X)||V*K/V!==K||X-re!==V*K)throw new Error("convertRadix: carry overflow");if(K=X%G,J[ne]=Math.floor(X/G),!Number.isSafeInteger(J[ne])||J[ne]*G+K!==X)throw new Error("convertRadix: carry overflow");if(ie)J[ne]?ie=!1:se=ne;else continue}if(H.push(K),ie)break}for(let K=0;K<$.length-1&&$[K]===0;K++)H.push(0);return H.reverse()}const y=($,V)=>V?y(V,$%V):$,g=($,V)=>$+(V-y($,V));function x($,V,G,se){if(!Array.isArray($))throw new Error("convertRadix2: data should be array");if(V<=0||V>32)throw new Error(`convertRadix2: wrong from=${V}`);if(G<=0||G>32)throw new Error(`convertRadix2: wrong to=${G}`);if(g(V,G)>32)throw new Error(`convertRadix2: carry overflow from=${V} to=${G} carryBits=${g(V,G)}`);let H=0,J=0;const K=2**G-1,ie=[];for(const ne of $){if(t(ne),ne>=2**V)throw new Error(`convertRadix2: invalid data word=${ne} from=${V}`);if(H=H<<V|ne,J+V>32)throw new Error(`convertRadix2: carry overflow pos=${J} from=${V}`);for(J+=V;J>=G;J-=G)ie.push((H>>J-G&K)>>>0);H&=2**J-1}if(H=H<<G-J&K,!se&&J>=V)throw new Error("Excess padding");if(!se&&H)throw new Error(`Non-zero padding: ${H}`);return se&&J>0&&ie.push(H>>>0),ie}function E($){return t($),{encode:V=>{if(!(V instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return p(Array.from(V),2**8,$)},decode:V=>{if(!Array.isArray(V)||V.length&&typeof V[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(p(V,$,2**8))}}}function A($,V=!1){if(t($),$<=0||$>32)throw new Error("radix2: bits should be in (0..32]");if(g(8,$)>32||g($,8)>32)throw new Error("radix2: carry overflow");return{encode:G=>{if(!(G instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return x(Array.from(G),8,$,!V)},decode:G=>{if(!Array.isArray(G)||G.length&&typeof G[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(x(G,$,8,V))}}}function S($){if(typeof $!="function")throw new Error("unsafeWrapper fn should be function");return function(...V){try{return $.apply(null,V)}catch{}}}function I($,V){if(t($),typeof V!="function")throw new Error("checksum fn should be function");return{encode(G){if(!(G instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const se=V(G).slice(0,$),H=new Uint8Array(G.length+$);return H.set(G),H.set(se,G.length),H},decode(G){if(!(G instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const se=G.slice(0,-$),H=V(se).slice(0,$),J=G.slice(-$);for(let K=0;K<$;K++)if(H[K]!==J[K])throw new Error("Invalid checksum");return se}}}n.utils={alphabet:s,chain:e,checksum:I,radix:E,radix2:A,join:a,padding:o},n.base16=e(A(4),s("0123456789ABCDEF"),a("")),n.base32=e(A(5),s("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),o(5),a("")),n.base32hex=e(A(5),s("0123456789ABCDEFGHIJKLMNOPQRSTUV"),o(5),a("")),n.base32crockford=e(A(5),s("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),a(""),f($=>$.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),n.base64=e(A(6),s("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),o(6),a("")),n.base64url=e(A(6),s("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),o(6),a(""));const _=$=>e(E(58),s($),a(""));n.base58=_("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),n.base58flickr=_("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),n.base58xrp=_("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const R=[0,2,3,5,6,7,9,10,11];n.base58xmr={encode($){let V="";for(let G=0;G<$.length;G+=8){const se=$.subarray(G,G+8);V+=n.base58.encode(se).padStart(R[se.length],"1")}return V},decode($){let V=[];for(let G=0;G<$.length;G+=11){const se=$.slice(G,G+11),H=R.indexOf(se.length),J=n.base58.decode(se);for(let K=0;K<J.length-H;K++)if(J[K]!==0)throw new Error("base58xmr: wrong padding");V=V.concat(Array.from(J.slice(J.length-H)))}return Uint8Array.from(V)}};const N=$=>e(I(4,V=>$($(V))),n.base58);n.base58check=N;const D=e(s("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),a("")),M=[996825010,642813549,513874426,1027748829,705979059];function W($){const V=$>>25;let G=($&33554431)<<5;for(let se=0;se<M.length;se++)(V>>se&1)===1&&(G^=M[se]);return G}function B($,V,G=1){const se=$.length;let H=1;for(let J=0;J<se;J++){const K=$.charCodeAt(J);if(K<33||K>126)throw new Error(`Invalid prefix (${$})`);H=W(H)^K>>5}H=W(H);for(let J=0;J<se;J++)H=W(H)^$.charCodeAt(J)&31;for(let J of V)H=W(H)^J;for(let J=0;J<6;J++)H=W(H);return H^=G,D.encode(x([H%2**30],30,5,!1))}function U($){const V=$==="bech32"?1:734539939,G=A(5),se=G.decode,H=G.encode,J=S(se);function K(X,ae,te=90){if(typeof X!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof X}`);if(!Array.isArray(ae)||ae.length&&typeof ae[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof ae}`);const ce=X.length+7+ae.length;if(te!==!1&&ce>te)throw new TypeError(`Length ${ce} exceeds limit ${te}`);return X=X.toLowerCase(),`${X}1${D.encode(ae)}${B(X,ae,V)}`}function ie(X,ae=90){if(typeof X!="string")throw new Error(`bech32.decode input should be string, not ${typeof X}`);if(X.length<8||ae!==!1&&X.length>ae)throw new TypeError(`Wrong string length: ${X.length} (${X}). Expected (8..${ae})`);const te=X.toLowerCase();if(X!==te&&X!==X.toUpperCase())throw new Error("String must be lowercase or uppercase");X=te;const ce=X.lastIndexOf("1");if(ce===0||ce===-1)throw new Error('Letter "1" must be present between prefix and data only');const xe=X.slice(0,ce),me=X.slice(ce+1);if(me.length<6)throw new Error("Data must be at least 6 characters long");const Se=D.decode(me).slice(0,-6),be=B(xe,Se,V);if(!me.endsWith(be))throw new Error(`Invalid checksum in ${X}: expected "${be}"`);return{prefix:xe,words:Se}}const ne=S(ie);function re(X){const{prefix:ae,words:te}=ie(X,!1);return{prefix:ae,words:te,bytes:se(te)}}return{encode:K,decode:ie,decodeToBytes:re,decodeUnsafe:ne,fromWords:se,fromWordsUnsafe:J,toWords:H}}n.bech32=U("bech32"),n.bech32m=U("bech32m"),n.utf8={encode:$=>new TextDecoder().decode($),decode:$=>new TextEncoder().encode($)},n.hex=e(A(4),s("0123456789abcdef"),a(""),f($=>{if(typeof $!="string"||$.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof $} with length ${$.length}`);return $.toLowerCase()}));const P={utf8:n.utf8,hex:n.hex,base16:n.base16,base32:n.base32,base64:n.base64,base64url:n.base64url,base58:n.base58,base58xmr:n.base58xmr},F=`Invalid encoding type. Available types: ${Object.keys(P).join(", ")}`,j=($,V)=>{if(typeof $!="string"||!P.hasOwnProperty($))throw new TypeError(F);if(!(V instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return P[$].encode(V)};n.bytesToString=j,n.str=n.bytesToString;const Q=($,V)=>{if(!P.hasOwnProperty($))throw new TypeError(F);if(typeof V!="string")throw new TypeError("stringToBytes() expects string");return P[$].decode(V)};n.stringToBytes=Q,n.bytes=n.stringToBytes}(lib$2)),lib$2}var bolt11,hasRequiredBolt11;function requireBolt11(){if(hasRequiredBolt11)return bolt11;hasRequiredBolt11=1;const{bech32:n,hex:t,utf8:e}=requireLib$2(),s={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},a={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},o={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},f={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},p={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},y=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],g={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},x=BigInt("2100000000000000000"),E=BigInt(1e11),A={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},S={};for(let B=0,U=Object.keys(A);B<U.length;B++){const P=U[B],F=A[U[B]].toString();S[F]=P}const I={1:B=>t.encode(n.fromWordsUnsafe(B)),16:B=>t.encode(n.fromWordsUnsafe(B)),13:B=>e.encode(n.fromWordsUnsafe(B)),19:B=>t.encode(n.fromWordsUnsafe(B)),23:B=>t.encode(n.fromWordsUnsafe(B)),27:B=>t.encode(n.fromWordsUnsafe(B)),6:R,24:R,3:N,5:D};function _(B){return U=>({tagCode:parseInt(B),words:n.encode("unknown",U,Number.MAX_SAFE_INTEGER)})}function R(B){return B.reverse().reduce((U,P,F)=>U+P*Math.pow(32,F),0)}function N(B){const U=[];let P,F,j,Q,$,V=n.fromWordsUnsafe(B);for(;V.length>0;)P=t.encode(V.slice(0,33)),F=t.encode(V.slice(33,41)),j=parseInt(t.encode(V.slice(41,45)),16),Q=parseInt(t.encode(V.slice(45,49)),16),$=parseInt(t.encode(V.slice(49,51)),16),V=V.slice(51),U.push({pubkey:P,short_channel_id:F,fee_base_msat:j,fee_proportional_millionths:Q,cltv_expiry_delta:$});return U}function D(B){const U=B.slice().reverse().map(j=>[!!(j&1),!!(j&2),!!(j&4),!!(j&8),!!(j&16)]).reduce((j,Q)=>j.concat(Q),[]);for(;U.length<y.length*2;)U.push(!1);const P={};y.forEach((j,Q)=>{let $;U[Q*2]?$="required":U[Q*2+1]?$="supported":$="unsupported",P[j]=$});const F=U.slice(y.length*2);return P.extra_bits={start_bit:y.length*2,bits:F,has_required:F.reduce((j,Q,$)=>$%2!==0?j||!1:j||Q,!1)},P}function M(B,U){let P,F;if(B.slice(-1).match(/^[munp]$/))P=B.slice(-1),F=B.slice(0,-1);else{if(B.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");F=B}if(!F.match(/^\d+$/))throw new Error("Not a valid human readable amount");const j=BigInt(F),Q=P?j*E/g[P]:j*E;if(P==="p"&&j%BigInt(10)!==BigInt(0)||Q>x)throw new Error("Amount is outside of valid range");return U?Q.toString():Q}function W(B,U){if(typeof B!="string")throw new Error("Lightning Payment Request must be string");if(B.slice(0,2).toLowerCase()!=="ln")throw new Error("Not a proper lightning payment request");const P=[],F=n.decode(B,Number.MAX_SAFE_INTEGER);B=B.toLowerCase();const j=F.prefix;let Q=F.words,$=B.slice(j.length+1),V=Q.slice(-104);Q=Q.slice(0,-104);let G=j.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(G&&!G[2]&&(G=j.match(/^ln(\S+)$/)),!G)throw new Error("Not a proper lightning payment request");P.push({name:"lightning_network",letters:"ln"});const se=G[1];let H;if(U){if(U.bech32===void 0||U.pubKeyHash===void 0||U.scriptHash===void 0||!Array.isArray(U.validWitnessVersions))throw new Error("Invalid network");H=U}else switch(se){case s.bech32:H=s;break;case a.bech32:H=a;break;case o.bech32:H=o;break;case f.bech32:H=f;break;case p.bech32:H=p;break}if(!H||H.bech32!==se)throw new Error("Unknown coin bech32 prefix");P.push({name:"coin_network",letters:se,value:H});const J=G[2];let K;if(J){const xe=G[3];K=M(J+xe,!0),P.push({name:"amount",letters:G[2]+G[3],value:K})}else K=null;P.push({name:"separator",letters:"1"});const ie=R(Q.slice(0,7));Q=Q.slice(7),P.push({name:"timestamp",letters:$.slice(0,7),value:ie}),$=$.slice(7);let ne,re,X,ae;for(;Q.length>0;){const xe=Q[0].toString();ne=S[xe]||"unknown_tag",re=I[xe]||_(xe),Q=Q.slice(1),X=R(Q.slice(0,2)),Q=Q.slice(2),ae=Q.slice(0,X),Q=Q.slice(X),P.push({name:ne,tag:$[0],letters:$.slice(0,3+X),value:re(ae)}),$=$.slice(3+X)}P.push({name:"signature",letters:$.slice(0,104),value:t.encode(n.fromWordsUnsafe(V))}),$=$.slice(104),P.push({name:"checksum",letters:$});let te={paymentRequest:B,sections:P,get expiry(){let xe=P.find(me=>me.name==="expiry");if(xe)return ce("timestamp")+xe.value},get route_hints(){return P.filter(xe=>xe.name==="route_hint").map(xe=>xe.value)}};for(let xe in A)xe!=="route_hint"&&Object.defineProperty(te,xe,{get(){return ce(xe)}});return te;function ce(xe){let me=P.find(Se=>Se.name===xe);return me?me.value:void 0}}return bolt11={decode:W,hrpToMillisat:M},bolt11}var bolt11Exports=requireBolt11(),NDKKind=(n=>(n[n.Metadata=0]="Metadata",n[n.Text=1]="Text",n[n.RecommendRelay=2]="RecommendRelay",n[n.Contacts=3]="Contacts",n[n.EncryptedDirectMessage=4]="EncryptedDirectMessage",n[n.EventDeletion=5]="EventDeletion",n[n.Repost=6]="Repost",n[n.Reaction=7]="Reaction",n[n.BadgeAward=8]="BadgeAward",n[n.GroupChat=9]="GroupChat",n[n.GroupNote=11]="GroupNote",n[n.GroupReply=12]="GroupReply",n[n.GiftWrapSeal=13]="GiftWrapSeal",n[n.PrivateDirectMessage=14]="PrivateDirectMessage",n[n.Image=20]="Image",n[n.Video=21]="Video",n[n.ShortVideo=22]="ShortVideo",n[n.Story=23]="Story",n[n.Vanish=62]="Vanish",n[n.CashuWalletBackup=375]="CashuWalletBackup",n[n.GiftWrap=1059]="GiftWrap",n[n.GenericRepost=16]="GenericRepost",n[n.ChannelCreation=40]="ChannelCreation",n[n.ChannelMetadata=41]="ChannelMetadata",n[n.ChannelMessage=42]="ChannelMessage",n[n.ChannelHideMessage=43]="ChannelHideMessage",n[n.ChannelMuteUser=44]="ChannelMuteUser",n[n.WikiMergeRequest=818]="WikiMergeRequest",n[n.GenericReply=1111]="GenericReply",n[n.Media=1063]="Media",n[n.Report=1984]="Report",n[n.Label=1985]="Label",n[n.DVMReqTextExtraction=5e3]="DVMReqTextExtraction",n[n.DVMReqTextSummarization=5001]="DVMReqTextSummarization",n[n.DVMReqTextTranslation=5002]="DVMReqTextTranslation",n[n.DVMReqTextGeneration=5050]="DVMReqTextGeneration",n[n.DVMReqImageGeneration=5100]="DVMReqImageGeneration",n[n.DVMReqTextToSpeech=5250]="DVMReqTextToSpeech",n[n.DVMReqDiscoveryNostrContent=5300]="DVMReqDiscoveryNostrContent",n[n.DVMReqDiscoveryNostrPeople=5301]="DVMReqDiscoveryNostrPeople",n[n.DVMReqTimestamping=5900]="DVMReqTimestamping",n[n.DVMEventSchedule=5905]="DVMEventSchedule",n[n.DVMJobFeedback=7e3]="DVMJobFeedback",n[n.Subscribe=7001]="Subscribe",n[n.Unsubscribe=7002]="Unsubscribe",n[n.SubscriptionReceipt=7003]="SubscriptionReceipt",n[n.CashuReserve=7373]="CashuReserve",n[n.CashuQuote=7374]="CashuQuote",n[n.CashuToken=7375]="CashuToken",n[n.CashuWalletTx=7376]="CashuWalletTx",n[n.GroupAdminAddUser=9e3]="GroupAdminAddUser",n[n.GroupAdminRemoveUser=9001]="GroupAdminRemoveUser",n[n.GroupAdminEditMetadata=9002]="GroupAdminEditMetadata",n[n.GroupAdminEditStatus=9006]="GroupAdminEditStatus",n[n.GroupAdminCreateGroup=9007]="GroupAdminCreateGroup",n[n.GroupAdminRequestJoin=9021]="GroupAdminRequestJoin",n[n.MuteList=1e4]="MuteList",n[n.PinList=10001]="PinList",n[n.RelayList=10002]="RelayList",n[n.BookmarkList=10003]="BookmarkList",n[n.CommunityList=10004]="CommunityList",n[n.PublicChatList=10005]="PublicChatList",n[n.BlockRelayList=10006]="BlockRelayList",n[n.SearchRelayList=10007]="SearchRelayList",n[n.SimpleGroupList=10009]="SimpleGroupList",n[n.InterestList=10015]="InterestList",n[n.CashuMintList=10019]="CashuMintList",n[n.EmojiList=10030]="EmojiList",n[n.DirectMessageReceiveRelayList=10050]="DirectMessageReceiveRelayList",n[n.BlossomList=10063]="BlossomList",n[n.NostrWaletConnectInfo=13194]="NostrWaletConnectInfo",n[n.TierList=17e3]="TierList",n[n.CashuWallet=17375]="CashuWallet",n[n.FollowSet=3e4]="FollowSet",n[n.CategorizedPeopleList=3e4]="CategorizedPeopleList",n[n.CategorizedBookmarkList=30001]="CategorizedBookmarkList",n[n.RelaySet=30002]="RelaySet",n[n.CategorizedRelayList=30002]="CategorizedRelayList",n[n.BookmarkSet=30003]="BookmarkSet",n[n.CurationSet=30004]="CurationSet",n[n.ArticleCurationSet=30004]="ArticleCurationSet",n[n.VideoCurationSet=30005]="VideoCurationSet",n[n.ImageCurationSet=30006]="ImageCurationSet",n[n.InterestSet=30015]="InterestSet",n[n.InterestsList=30015]="InterestsList",n[n.EmojiSet=30030]="EmojiSet",n[n.ModularArticle=30040]="ModularArticle",n[n.ModularArticleItem=30041]="ModularArticleItem",n[n.Wiki=30818]="Wiki",n[n.Draft=31234]="Draft",n[n.SubscriptionTier=37001]="SubscriptionTier",n[n.EcashMintRecommendation=38e3]="EcashMintRecommendation",n[n.HighlightSet=39802]="HighlightSet",n[n.CategorizedHighlightList=39802]="CategorizedHighlightList",n[n.Nutzap=9321]="Nutzap",n[n.ZapRequest=9734]="ZapRequest",n[n.Zap=9735]="Zap",n[n.Highlight=9802]="Highlight",n[n.ClientAuth=22242]="ClientAuth",n[n.NostrWalletConnectReq=23194]="NostrWalletConnectReq",n[n.NostrWalletConnectRes=23195]="NostrWalletConnectRes",n[n.NostrConnect=24133]="NostrConnect",n[n.BlossomUpload=24242]="BlossomUpload",n[n.HttpAuth=27235]="HttpAuth",n[n.ProfileBadge=30008]="ProfileBadge",n[n.BadgeDefinition=30009]="BadgeDefinition",n[n.MarketStall=30017]="MarketStall",n[n.MarketProduct=30018]="MarketProduct",n[n.Article=30023]="Article",n[n.AppSpecificData=30078]="AppSpecificData",n[n.Classified=30402]="Classified",n[n.HorizontalVideo=34235]="HorizontalVideo",n[n.VerticalVideo=34236]="VerticalVideo",n[n.LegacyCashuWallet=37375]="LegacyCashuWallet",n[n.GroupMetadata=39e3]="GroupMetadata",n[n.GroupAdmins=39001]="GroupAdmins",n[n.GroupMembers=39002]="GroupMembers",n[n.AppRecommendation=31989]="AppRecommendation",n[n.AppHandler=31990]="AppHandler",n))(NDKKind||{});function getRelaysForSync(n,t,e="write"){if(!n.outboxTracker)return;const s=n.outboxTracker.data.get(t);if(s)return e==="write"?s.writeRelays:s.readRelays}async function getWriteRelaysFor(n,t,e="write"){if(n.outboxTracker)return n.outboxTracker.data.has(t)||await n.outboxTracker.trackUsers([t]),getRelaysForSync(n,t,e)}function getTopRelaysForAuthors(n,t){const e=new Map;return t.forEach(a=>{const o=getRelaysForSync(n,a);o&&o.forEach(f=>{const p=e.get(f)||0;e.set(f,p+1)})}),Array.from(e.entries()).sort((a,o)=>o[1]-a[1]).map(a=>a[0])}function getAllRelaysForAllPubkeys(n,t,e="read"){const s=new Map,a=new Set;return t.forEach(o=>{const f=getRelaysForSync(n,o,e);f&&f.size>0?(f.forEach(p=>{(s.get(p)||new Set).add(o)}),s.set(o,f)):a.add(o)}),{pubkeysToRelays:s,authorsMissingRelays:a}}function chooseRelayCombinationForPubkeys(n,t,e,{count:s,preferredRelays:a}={}){s??(s=2),a??(a=new Set);const o=n.pool,f=o.connectedRelays();f.forEach(A=>{a==null||a.add(A.url)});const p=new Map,{pubkeysToRelays:y,authorsMissingRelays:g}=getAllRelaysForAllPubkeys(n,t,e),x=getTopRelaysForAuthors(n,t),E=(A,S)=>{const I=p.get(S)||[];I.push(A),p.set(S,I)};for(const[A,S]of y.entries()){let I=s;for(const _ of f)S.has(_.url)&&(E(A,_.url),I--);for(const _ of S)p.has(_)&&(E(A,_),I--);if(!(I<=0))for(const _ of x){if(I<=0)break;S.has(_)&&(E(A,_),I--)}}for(const A of g)o.permanentAndConnectedRelays().forEach(S=>{const I=p.get(S.url)||[];I.push(A),p.set(S.url,I)});return p}function getRelaysForFilterWithAuthors(n,t,e=2){return chooseRelayCombinationForPubkeys(n,t,"write",{count:e})}function tryNormalizeRelayUrl(n){try{return normalizeRelayUrl(n)}catch{return}}function normalizeRelayUrl(n){let t=normalizeUrl(n,{stripAuthentication:!1,stripWWW:!1,stripHash:!0});return t.endsWith("/")||(t+="/"),t}function normalize(n){const t=new Set;for(const e of n)try{t.add(normalizeRelayUrl(e))}catch{}return Array.from(t)}var DATA_URL_DEFAULT_MIME_TYPE="text/plain",DATA_URL_DEFAULT_CHARSET="us-ascii",testParameter=(n,t)=>t.some(e=>e instanceof RegExp?e.test(n):e===n),supportedProtocols=new Set(["https:","http:","file:"]),hasCustomProtocol=n=>{try{const{protocol:t}=new URL(n);return t.endsWith(":")&&!t.includes(".")&&!supportedProtocols.has(t)}catch{return!1}},normalizeDataURL=(n,{stripHash:t})=>{var E,A,S,I;const e=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(n);if(!e)throw new Error(`Invalid URL: ${n}`);const s=((E=e.groups)==null?void 0:E.type)??"",a=((A=e.groups)==null?void 0:A.data)??"";let o=((S=e.groups)==null?void 0:S.hash)??"";const f=s.split(";");o=t?"":o;let p=!1;f[f.length-1]==="base64"&&(f.pop(),p=!0);const y=((I=f.shift())==null?void 0:I.toLowerCase())??"",x=[...f.map(_=>{let[R,N=""]=_.split("=").map(D=>D.trim());return R==="charset"&&(N=N.toLowerCase(),N===DATA_URL_DEFAULT_CHARSET)?"":`${R}${N?`=${N}`:""}`}).filter(Boolean)];return p&&x.push("base64"),(x.length>0||y&&y!==DATA_URL_DEFAULT_MIME_TYPE)&&x.unshift(y),`data:${x.join(";")},${p?a.trim():a}${o?`#${o}`:""}`};function normalizeUrl(n,t={}){if(t={defaultProtocol:"http",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,removeExplicitPort:!1,sortQueryParameters:!0,...t},typeof t.defaultProtocol=="string"&&!t.defaultProtocol.endsWith(":")&&(t.defaultProtocol=`${t.defaultProtocol}:`),n=n.trim(),/^data:/i.test(n))return normalizeDataURL(n,t);if(hasCustomProtocol(n))return n;const e=n.startsWith("//");!e&&/^\.*\//.test(n)||(n=n.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));const a=new URL(n);if(a.hostname=a.hostname.toLowerCase(),t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&a.protocol==="https:"&&(a.protocol="http:"),t.forceHttps&&a.protocol==="http:"&&(a.protocol="https:"),t.stripAuthentication&&(a.username="",a.password=""),t.stripHash?a.hash="":t.stripTextFragment&&(a.hash=a.hash.replace(/#?:~:text.*?$/i,"")),a.pathname){const f=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let p=0,y="";for(;;){const x=f.exec(a.pathname);if(!x)break;const E=x[0],A=x.index,S=a.pathname.slice(p,A);y+=S.replace(/\/{2,}/g,"/"),y+=E,p=A+E.length}const g=a.pathname.slice(p,a.pathname.length);y+=g.replace(/\/{2,}/g,"/"),a.pathname=y}if(a.pathname)try{a.pathname=decodeURI(a.pathname)}catch{}if(t.removeDirectoryIndex===!0&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let f=a.pathname.split("/");const p=f[f.length-1];testParameter(p,t.removeDirectoryIndex)&&(f=f.slice(0,-1),a.pathname=`${f.slice(1).join("/")}/`)}if(a.hostname&&(a.hostname=a.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(a.hostname)&&(a.hostname=a.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(const f of[...a.searchParams.keys()])testParameter(f,t.removeQueryParameters)&&a.searchParams.delete(f);if(!Array.isArray(t.keepQueryParameters)&&t.removeQueryParameters===!0&&(a.search=""),Array.isArray(t.keepQueryParameters)&&t.keepQueryParameters.length>0)for(const f of[...a.searchParams.keys()])testParameter(f,t.keepQueryParameters)||a.searchParams.delete(f);if(t.sortQueryParameters){a.searchParams.sort();try{a.search=decodeURIComponent(a.search)}catch{}}t.removeTrailingSlash&&(a.pathname=a.pathname.replace(/\/$/,"")),t.removeExplicitPort&&a.port&&(a.port="");const o=n;return n=a.toString(),!t.removeSingleSlash&&a.pathname==="/"&&!o.endsWith("/")&&a.hash===""&&(n=n.replace(/\/$/,"")),(t.removeTrailingSlash||a.pathname==="/")&&a.hash===""&&t.removeSingleSlash&&(n=n.replace(/\/$/,"")),e&&!t.normalizeProtocol&&(n=n.replace(/^http:\/\//,"//")),t.stripProtocol&&(n=n.replace(/^(?:https?:)?\/\//,"")),n}var MAX_RECONNECT_ATTEMPTS=5,FLAPPING_THRESHOLD_MS=1e3,NDKRelayConnectivity=class{constructor(n,t){pe(this,"ndkRelay");pe(this,"ws");pe(this,"_status");pe(this,"timeoutMs");pe(this,"connectedAt");pe(this,"_connectionStats",{attempts:0,success:0,durations:[]});pe(this,"debug");pe(this,"netDebug");pe(this,"connectTimeout");pe(this,"reconnectTimeout");pe(this,"ndk");pe(this,"openSubs",new Map);pe(this,"openCountRequests",new Map);pe(this,"openEventPublishes",new Map);pe(this,"serial",0);pe(this,"baseEoseTimeout",4400);pe(this,"updateConnectionStats",{connected:()=>{this._connectionStats.success++,this._connectionStats.connectedAt=Date.now()},disconnected:()=>{this._connectionStats.connectedAt&&(this._connectionStats.durations.push(Date.now()-this._connectionStats.connectedAt),this._connectionStats.durations.length>100&&this._connectionStats.durations.shift()),this._connectionStats.connectedAt=void 0},attempt:()=>{this._connectionStats.attempts++,this._connectionStats.connectedAt=Date.now()}});this.ndkRelay=n,this._status=1;const e=Math.floor(Math.random()*1e3);this.debug=this.ndkRelay.debug.extend(`connectivity${e}`),this.ndk=t}async connect(n,t=!0){if(this._status!==2&&this._status!==1||this.reconnectTimeout){this.debug("Relay requested to be connected but was in state %s or it had a reconnect timeout",this._status);return}this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),n??(n=this.timeoutMs),!this.timeoutMs&&n&&(this.timeoutMs=n),this.timeoutMs&&(this.connectTimeout=setTimeout(()=>this.onConnectionError(t),this.timeoutMs));try{this.updateConnectionStats.attempt(),this._status===1?this._status=4:this._status=2,this.ws=new WebSocket(this.ndkRelay.url),this.ws.onopen=this.onConnect.bind(this),this.ws.onclose=this.onDisconnect.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onerror=this.onError.bind(this)}catch(e){throw this.debug(`Failed to connect to ${this.ndkRelay.url}`,e),this._status=1,t?this.handleReconnection():this.ndkRelay.emit("delayed-connect",2*24*60*60*1e3),e}}disconnect(){var n;this._status=0;try{(n=this.ws)==null||n.close()}catch(t){this.debug("Failed to disconnect",t),this._status=1}}onConnectionError(n){this.debug(`Error connecting to ${this.ndkRelay.url}`,this.timeoutMs),n&&!this.reconnectTimeout&&this.handleReconnection()}onConnect(){var n;(n=this.netDebug)==null||n.call(this,"connected",this.ndkRelay),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),this.updateConnectionStats.connected(),this._status=5,this.ndkRelay.emit("connect"),this.ndkRelay.emit("ready")}onDisconnect(){var n;(n=this.netDebug)==null||n.call(this,"disconnected",this.ndkRelay),this.updateConnectionStats.disconnected(),this._status===5&&this.handleReconnection(),this._status=1,this.ndkRelay.emit("disconnect")}onMessage(n){var t;(t=this.netDebug)==null||t.call(this,n.data,this.ndkRelay,"recv");try{const e=JSON.parse(n.data),[s,a,...o]=e;switch(s){case"EVENT":{const f=this.openSubs.get(a),p=e[2];if(!f){this.debug(`Received event for unknown subscription ${a}`);return}f.onevent(p);return}case"COUNT":{const f=e[2],p=this.openCountRequests.get(a);p&&(p.resolve(f.count),this.openCountRequests.delete(a));return}case"EOSE":{const f=this.openSubs.get(a);if(!f)return;f.oneose(a);return}case"OK":{const f=e[2],p=e[3],y=this.openEventPublishes.get(a),g=y==null?void 0:y.pop();if(!y||!g){this.debug("Received OK for unknown event publish",a);return}f?g.resolve(p):g.reject(new Error(p)),y.length===0?this.openEventPublishes.delete(a):this.openEventPublishes.set(a,y);return}case"CLOSED":{const f=this.openSubs.get(a);if(!f)return;f.onclosed(e[2]);return}case"NOTICE":this.onNotice(e[1]);return;case"AUTH":{this.onAuthRequested(e[1]);return}}}catch(e){this.debug(`Error parsing message from ${this.ndkRelay.url}: ${e.message}`,e==null?void 0:e.stack);return}}async onAuthRequested(n){var e,s,a;const t=this.ndkRelay.authPolicy??((e=this.ndk)==null?void 0:e.relayAuthDefaultPolicy);if(this.debug("Relay requested authentication",{havePolicy:!!t}),this._status===7){this.debug("Already authenticating, ignoring");return}if(this._status=6,t){if(this._status>=5){this._status=7;let o;try{o=await t(this.ndkRelay,n)}catch(f){this.debug("Authentication policy threw an error",f),o=!1}if(this.debug("Authentication policy returned",!!o),o instanceof NDKEvent||o===!0){o instanceof NDKEvent&&await this.auth(o);const f=async()=>{if(this._status>=5&&this._status<8){const p=new NDKEvent(this.ndk);p.kind=22242,p.tags=[["relay",this.ndkRelay.url],["challenge",n]],await p.sign(),this.auth(p).then(()=>{this._status=8,this.ndkRelay.emit("authed"),this.debug("Authentication successful")}).catch(y=>{this._status=6,this.ndkRelay.emit("auth:failed",y),this.debug("Authentication failed",y)})}else this.debug("Authentication failed, it changed status, status is %d",this._status)};o===!0&&((s=this.ndk)!=null&&s.signer?f().catch(p=>{console.error("Error authenticating",p)}):(this.debug("No signer available for authentication localhost"),(a=this.ndk)==null||a.once("signer:ready",f))),this._status=5,this.ndkRelay.emit("authed")}}}else this.ndkRelay.emit("auth",n)}onError(n){this.debug(`WebSocket error on ${this.ndkRelay.url}:`,n)}get status(){return this._status}isAvailable(){return this._status===5}isFlapping(){const n=this._connectionStats.durations;if(n.length%3!==0)return!1;const e=n.reduce((f,p)=>f+p,0)/n.length,s=n.map(f=>(f-e)**2).reduce((f,p)=>f+p,0)/n.length;return Math.sqrt(s)<FLAPPING_THRESHOLD_MS}async onNotice(n){this.ndkRelay.emit("notice",n)}handleReconnection(n=0){if(this.reconnectTimeout)return;if(this.isFlapping()){this.ndkRelay.emit("flapping",this._connectionStats),this._status=3;return}const t=this.connectedAt?Math.max(0,6e4-(Date.now()-this.connectedAt)):5e3*(this._connectionStats.attempts+1);this.reconnectTimeout=setTimeout(()=>{this.reconnectTimeout=void 0,this._status=2,this.connect().catch(e=>{n<MAX_RECONNECT_ATTEMPTS?setTimeout(()=>{this.handleReconnection(n+1)},1e3*(n+1)^4):this.debug("Reconnect failed")})},t),this.ndkRelay.emit("delayed-connect",t),this.debug("Reconnecting in",t),this._connectionStats.nextReconnectAt=Date.now()+t}async send(n){var t,e,s;this._status>=5&&((t=this.ws)==null?void 0:t.readyState)===WebSocket.OPEN?((e=this.ws)==null||e.send(n),(s=this.netDebug)==null||s.call(this,n,this.ndkRelay,"send")):this.debug(`Not connected to ${this.ndkRelay.url} (%d), not sending message ${n}`,this._status)}async auth(n){const t=new Promise((e,s)=>{const a=this.openEventPublishes.get(n.id)??[];a.push({resolve:e,reject:s}),this.openEventPublishes.set(n.id,a)});return this.send(`["AUTH",${JSON.stringify(n.rawEvent())}]`),t}async publish(n){const t=new Promise((e,s)=>{const a=this.openEventPublishes.get(n.id)??[];a.length>0&&console.warn(`Duplicate event publishing detected, you are publishing event ${n.id} twice`),a.push({resolve:e,reject:s}),this.openEventPublishes.set(n.id,a)});return this.send(`["EVENT",${JSON.stringify(n)}]`),t}async count(n,t){this.serial++;const e=(t==null?void 0:t.id)||`count:${this.serial}`,s=new Promise((a,o)=>{this.openCountRequests.set(e,{resolve:a,reject:o})});return this.send(`["COUNT","${e}",${JSON.stringify(n).substring(1)}`),s}close(n,t){this.send(`["CLOSE","${n}"]`);const e=this.openSubs.get(n);this.openSubs.delete(n),e&&e.onclose(t)}req(n){`${this.send(`["REQ","${n.subId}",${JSON.stringify(n.executeFilters).substring(1)}`)}`,this.openSubs.set(n.subId,n)}get connectionStats(){return this._connectionStats}get url(){return this.ndkRelay.url}get connected(){var n;return this._status>=5&&((n=this.ws)==null?void 0:n.readyState)===WebSocket.OPEN}},NDKRelayPublisher=class{constructor(n){pe(this,"ndkRelay");pe(this,"debug");this.ndkRelay=n,this.debug=n.debug.extend("publisher")}async publish(n,t=2500){let e;const s=()=>new Promise((x,E)=>{try{this.publishEvent(n).then(A=>{this.ndkRelay.emit("published",n),n.emit("relay:published",this.ndkRelay),x(!0)}).catch(E)}catch(A){E(A)}}),a=new Promise((x,E)=>{e=setTimeout(()=>{e=void 0,E(new Error(`Timeout: ${t}ms`))},t)}),o=()=>{s().then(x=>f(x)).catch(x=>p(x))};let f,p;const y=x=>{throw this.ndkRelay.debug("Publish failed",x,n.id),this.ndkRelay.emit("publish:failed",n,x),n.emit("relay:publish:failed",this.ndkRelay,x),x},g=()=>{e&&clearTimeout(e),this.ndkRelay.removeListener("connect",o)};return this.ndkRelay.status>=5?Promise.race([s(),a]).catch(y).finally(g):(this.ndkRelay.status<=1?(console.warn("Relay is disconnected, trying to connect to publish an event",this.ndkRelay.url),this.ndkRelay.connect()):console.warn("Relay not connected, waiting for connection to publish an event",this.ndkRelay.url),Promise.race([new Promise((x,E)=>{f=x,p=E,this.ndkRelay.on("connect",o)}),a]).catch(y).finally(g))}async publishEvent(n){return this.ndkRelay.connectivity.publish(n.rawEvent())}};function filterFingerprint(n,t){const e=[];for(const a of n){const o=Object.entries(a||{}).map(([f,p])=>["since","until"].includes(f)?`${f}:${p}`:f).sort().join("-");e.push(o)}let s=t?"+":"";return s+=e.join("|"),s}function mergeFilters(n){const t=[],e={};return n.filter(s=>!!s.limit).forEach(s=>t.push(s)),n=n.filter(s=>!s.limit),n.length===0?t:(n.forEach(s=>{Object.entries(s).forEach(([a,o])=>{Array.isArray(o)?e[a]===void 0?e[a]=[...o]:e[a]=Array.from(new Set([...e[a],...o])):e[a]=o})}),[...t,e])}var NDKRelaySubscription=class{constructor(n,t,e){pe(this,"fingerprint");pe(this,"items",new Map);pe(this,"topSubManager");pe(this,"debug");pe(this,"status",0);pe(this,"onClose");pe(this,"relay");pe(this,"eosed",!1);pe(this,"executionTimer");pe(this,"fireTime");pe(this,"delayType");pe(this,"executeFilters");pe(this,"id",Math.random().toString(36).substring(7));pe(this,"_subId");pe(this,"subIdParts",new Set);pe(this,"executeOnRelayReady",()=>{if(this.status===2){if(this.items.size===0){this.debug("No items to execute; this relay was probably too slow to respond and the caller gave up",{status:this.status,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size,id:this.id,subId:this.subId}),this.cleanup();return}this.debug("Executing on relay ready",{status:this.status,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size}),this.status=1,this.execute()}});pe(this,"reExecuteAfterAuth",(()=>{const n=this.subId;this.debug("Re-executing after auth",this.items.size),this.eosed?this.relay.close(this.subId):this.debug("We are abandoning an opened subscription, once it EOSE's, the handler will close it",{oldSubId:n}),this._subId=void 0,this.status=1,this.execute(),this.debug("Re-executed after auth %s  %s",n,this.subId)}).bind(this));this.relay=n,this.topSubManager=e,this.debug=n.debug.extend(`sub[${this.id}]`),this.fingerprint=t||Math.random().toString(36).substring(7)}get subId(){return this._subId?this._subId:(this._subId=this.fingerprint.slice(0,15),this._subId)}addSubIdPart(n){this.subIdParts.add(n)}addItem(n,t){if(this.debug("Adding item",{filters:t,internalId:n.internalId,status:this.status,fingerprint:this.fingerprint,id:this.subId,items:this.items,itemsSize:this.items.size}),!this.items.has(n.internalId))switch(n.on("close",this.removeItem.bind(this,n)),this.items.set(n.internalId,{subscription:n,filters:t}),this.status!==3&&n.subId&&(!this._subId||this._subId.length<48)&&(this.status===0||this.status===1)&&this.addSubIdPart(n.subId),this.status){case 0:this.evaluateExecutionPlan(n);break;case 3:break;case 1:this.evaluateExecutionPlan(n);break;case 4:throw this.debug("Subscription is closed, cannot add new items %o (%o)",n,t),new Error("Cannot add new items to a closed subscription")}}removeItem(n){if(this.items.delete(n.internalId),this.items.size===0){if(!this.eosed)return;this.close(),this.cleanup()}}close(){if(this.status===4)return;const n=this.status;if(this.status=4,n===3)try{this.relay.close(this.subId)}catch(t){this.debug("Error closing subscription",t,this)}else this.debug("Subscription wanted to close but it wasn't running, this is probably ok",{subId:this.subId,prevStatus:n,sub:this});this.cleanup()}cleanup(){this.executionTimer&&clearTimeout(this.executionTimer),this.relay.off("ready",this.executeOnRelayReady),this.relay.off("authed",this.reExecuteAfterAuth),this.onClose&&this.onClose(this)}evaluateExecutionPlan(n){if(!n.isGroupable()){this.status=1,this.execute();return}if(n.filters.find(s=>!!s.limit)&&(this.executeFilters=this.compileFilters(),this.executeFilters.length>=10)){this.status=1,this.execute();return}const t=n.groupableDelay,e=n.groupableDelayType;if(!t)throw new Error("Cannot group a subscription without a delay");if(this.status===0)this.schedule(t,e);else{const s=this.delayType,a=this.fireTime-Date.now();if(s==="at-least"&&e==="at-least")a<t&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(t,e));else if(s==="at-least"&&e==="at-most")a>t&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(t,e));else if(s==="at-most"&&e==="at-most")a>t&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(t,e));else if(s==="at-most"&&e==="at-least")a>t&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(t,e));else throw new Error(`Unknown delay type combination ${s} ${e}`)}}schedule(n,t){this.status=1;const e=Date.now();this.fireTime=e+n,this.delayType=t;const s=setTimeout(this.execute.bind(this),n);t==="at-least"&&(this.executionTimer=s)}finalizeSubId(){this.subIdParts.size>0?this._subId=Array.from(this.subIdParts).join("-"):this._subId=this.fingerprint.slice(0,15),this._subId+=`-${Math.random().toString(36).substring(2,7)}`}execute(){if(this.status===1){if(!this.relay.connected){this.status=2,this.debug("Waiting for relay to be ready",{status:this.status,id:this.subId,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size}),this.relay.once("ready",this.executeOnRelayReady);return}this.relay.status<8&&this.relay.once("authed",this.reExecuteAfterAuth),this.status=3,this.finalizeSubId(),this.executeFilters=this.compileFilters(),this.relay.req(this)}}onstart(){}onevent(n){this.topSubManager.dispatchEvent(n,this.relay)}oneose(n){if(this.eosed=!0,n!==this.subId){this.debug("Received EOSE for an abandoned subscription",n,this.subId),this.relay.close(n);return}this.items.size===0&&this.close();for(const{subscription:t}of this.items.values())t.eoseReceived(this.relay),t.closeOnEose&&(this.debug("Removing item because of EOSE",{filters:t.filters,internalId:t.internalId,status:this.status,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size}),this.removeItem(t))}onclose(n){this.status=4}onclosed(n){if(n)for(const{subscription:t}of this.items.values())t.closedReceived(this.relay,n)}compileFilters(){const n=[],t=Array.from(this.items.values()).map(s=>s.filters);if(!t[0])return this.debug(" No filters to merge",this.items),console.error("BUG: No filters to merge!",this.items),[];const e=t[0].length;for(let s=0;s<e;s++){const a=t.map(o=>o[s]);n.push(...mergeFilters(a))}return n}},NDKRelaySubscriptionManager=class{constructor(n,t){pe(this,"relay");pe(this,"subscriptions");pe(this,"generalSubManager");this.relay=n,this.subscriptions=new Map,this.generalSubManager=t}addSubscription(n,t){let e;if(!n.isGroupable())e=this.createSubscription(n,t);else{const s=filterFingerprint(t,n.closeOnEose);s&&(e=(this.subscriptions.get(s)||[]).find(o=>o.status<3)),e??(e=this.createSubscription(n,t,s))}e.addItem(n,t)}createSubscription(n,t,e){const s=new NDKRelaySubscription(this.relay,e||null,this.generalSubManager);s.onClose=this.onRelaySubscriptionClose.bind(this);const a=this.subscriptions.get(s.fingerprint)??[];return this.subscriptions.set(s.fingerprint,[...a,s]),s}onRelaySubscriptionClose(n){let t=this.subscriptions.get(n.fingerprint)??[];t?t.length===1?this.subscriptions.delete(n.fingerprint):(t=t.filter(e=>e.id!==n.id),this.subscriptions.set(n.fingerprint,t)):console.warn("Unexpectedly did not find a subscription with fingerprint",n.fingerprint)}},us,NDKRelay=(us=class extends libExports.EventEmitter{constructor(e,s,a){super();pe(this,"url");pe(this,"scores");pe(this,"connectivity");pe(this,"subs");pe(this,"publisher");pe(this,"authPolicy");pe(this,"lowestValidationRatio");pe(this,"targetValidationRatio");pe(this,"validationRatioFn");pe(this,"validatedEventCount",0);pe(this,"nonValidatedEventCount",0);pe(this,"trusted",!1);pe(this,"complaining",!1);pe(this,"debug");pe(this,"req");pe(this,"close");this.url=normalizeRelayUrl(e),this.scores=new Map,this.debug=createDebug3(`ndk:relay:${e}`),this.connectivity=new NDKRelayConnectivity(this,a),this.connectivity.netDebug=a==null?void 0:a.netDebug,this.req=this.connectivity.req.bind(this.connectivity),this.close=this.connectivity.close.bind(this.connectivity),this.subs=new NDKRelaySubscriptionManager(this,a.subManager),this.publisher=new NDKRelayPublisher(this),this.authPolicy=s,this.targetValidationRatio=a==null?void 0:a.initialValidationRatio,this.lowestValidationRatio=a==null?void 0:a.lowestValidationRatio,this.validationRatioFn=((a==null?void 0:a.validationRatioFn)??us.defaultValidationRatioUpdateFn).bind(this),this.updateValidationRatio(),a||console.trace("relay created without ndk")}updateValidationRatio(){if(this.validationRatioFn&&this.validatedEventCount>0){const e=this.validationRatioFn(this,this.validatedEventCount,this.nonValidatedEventCount);this.targetValidationRatio=e}setTimeout(()=>{this.updateValidationRatio()},3e4)}get status(){return this.connectivity.status}get connectionStats(){return this.connectivity.connectionStats}async connect(e,s=!0){return this.connectivity.connect(e,s)}disconnect(){this.status!==1&&this.connectivity.disconnect()}subscribe(e,s){this.subs.addSubscription(e,s)}async publish(e,s=2500){return this.publisher.publish(e,s)}referenceTags(){return[["r",this.url]]}addValidatedEvent(){this.validatedEventCount++}addNonValidatedEvent(){this.nonValidatedEventCount++}get validationRatio(){return this.nonValidatedEventCount===0?1:this.validatedEventCount/(this.validatedEventCount+this.nonValidatedEventCount)}shouldValidateEvent(){return this.trusted?!1:this.targetValidationRatio===void 0||this.targetValidationRatio>=1?!0:Math.random()<this.targetValidationRatio}get connected(){return this.connectivity.connected}},pe(us,"defaultValidationRatioUpdateFn",(e,s,a)=>{if(e.lowestValidationRatio===void 0||e.targetValidationRatio===void 0)return 1;let o=e.validationRatio;if(e.validationRatio>e.targetValidationRatio){const f=s/100;o=Math.max(e.lowestValidationRatio,e.validationRatio-f)}return o<e.validationRatio?o:e.validationRatio}),us),NDKPublishError=class extends Error{constructor(t,e,s,a){super(t);pe(this,"errors");pe(this,"publishedToRelays");pe(this,"intendedRelaySet");this.errors=e,this.publishedToRelays=s,this.intendedRelaySet=a}get relayErrors(){const t=[];for(const[e,s]of this.errors)t.push(`${e.url}: ${s}`);return t.join(`
`)}},NDKRelaySet=class Ku{constructor(t,e,s){pe(this,"relays");pe(this,"debug");pe(this,"ndk");pe(this,"pool");this.relays=t,this.ndk=e,this.pool=s??e.pool,this.debug=e.debug.extend("relayset")}addRelay(t){this.relays.add(t)}get relayUrls(){return Array.from(this.relays).map(t=>t.url)}static fromRelayUrls(t,e,s=!0,a){if(a=a??e.pool,!a)throw new Error("No pool provided");const o=new Set;for(const f of t){const p=a.relays.get(normalizeRelayUrl(f));if(p)p.status<5&&s&&p.connect(),o.add(p);else{const y=new NDKRelay(normalizeRelayUrl(f),e==null?void 0:e.relayAuthDefaultPolicy,e);a.useTemporaryRelay(y,void 0,`requested from fromRelayUrls ${t}`),o.add(y)}}return new Ku(new Set(o),e,a)}async publish(t,e,s=1){var y;const a=new Set,o=new Map,f=t.isEphemeral();t.publishStatus="pending";const p=g=>{a.add(g)};t.on("relay:published",p);try{const g=Array.from(this.relays).map(x=>new Promise(E=>{const A=e?setTimeout(()=>{a.has(x)||(o.set(x,new Error(`Publish timeout after ${e}ms`)),E(!1))},e):null;x.publish(t,e).then(S=>{A&&clearTimeout(A),S?(a.add(x),E(!0)):E(!1)}).catch(S=>{A&&clearTimeout(A),f||o.set(x,S),E(!1)})}));if(await Promise.all(g),a.size<s){if(!f){const x=new NDKPublishError("Not enough relays received the event ("+a.size+" published, "+s+" required)",o,a,this);throw t.publishStatus="error",t.publishError=x,(y=this.ndk)==null||y.emit("event:publish-failed",t,x,this.relayUrls),x}}else t.publishStatus="success",t.emit("published",{relaySet:this,publishedToRelays:a});return a}finally{t.off("relay:published",p)}}get size(){return this.relays.size}},d$1=createDebug3("ndk:outbox:calculate");async function calculateRelaySetFromEvent(n,t,e){var p,y;const s=new Set,a=await getWriteRelaysFor(n,t.pubkey);a&&a.forEach(g=>{var E;const x=(E=n.pool)==null?void 0:E.getRelay(g);x&&s.add(x)});let o=t.tags.filter(g=>["a","e"].includes(g[0])).map(g=>g[2]).filter(g=>g==null?void 0:g.startsWith("wss://")).filter(g=>{try{return new URL(g),!0}catch{return!1}}).map(g=>normalizeRelayUrl(g));o=Array.from(new Set(o)).slice(0,5),o.forEach(g=>{var E;const x=(E=n.pool)==null?void 0:E.getRelay(g,!0,!0);x&&(d$1("Adding relay hint %s",g),s.add(x))});const f=t.getMatchingTags("p").map(g=>g[1]);if(f.length<5?Array.from(chooseRelayCombinationForPubkeys(n,f,"read",{preferredRelays:new Set(a)}).keys()).forEach(x=>{var A;const E=(A=n.pool)==null?void 0:A.getRelay(x,!1,!0);E&&(d$1("Adding p-tagged relay %s",x),s.add(E))}):d$1("Too many p-tags to consider %d",f.length),(p=n.pool)==null||p.permanentAndConnectedRelays().forEach(g=>s.add(g)),e&&s.size<e){const g=(y=n.explicitRelayUrls)==null?void 0:y.filter(x=>!Array.from(s).some(E=>E.url===x)).slice(0,e-s.size);g==null||g.forEach(x=>{var A;const E=(A=n.pool)==null?void 0:A.getRelay(x,!1,!0);E&&(d$1("Adding explicit relay %s",x),s.add(E))})}return new NDKRelaySet(s,n)}function calculateRelaySetsFromFilter(n,t,e){const s=new Map,a=new Set;if(t.forEach(o=>{o.authors&&o.authors.forEach(f=>a.add(f))}),a.size>0){const o=getRelaysForFilterWithAuthors(n,Array.from(a));for(const f of o.keys())s.set(f,[]);for(const f of t)if(f.authors)for(const[p,y]of o.entries()){const g=f.authors.filter(x=>y.includes(x));s.set(p,[...s.get(p),{...f,authors:g}])}else for(const p of o.keys())s.set(p,[...s.get(p),f])}else n.explicitRelayUrls&&n.explicitRelayUrls.forEach(o=>{s.set(o,t)});return s.size===0&&e.permanentAndConnectedRelays().slice(0,5).forEach(o=>{s.set(o.url,t)}),s}function calculateRelaySetsFromFilters(n,t,e){return calculateRelaySetsFromFilter(n,t,e)}function mergeTags(n,t){const e=new Map,s=f=>f.join(","),a=(f,p)=>f.every((y,g)=>y===p[g]),o=f=>{for(const[p,y]of e)if(a(y,f)||a(f,y)){f.length>=y.length&&e.set(p,f);return}e.set(s(f),f)};return n.concat(t).forEach(o),Array.from(e.values())}var hashtagRegex=new RegExp(`(?<=\\s|^)(#[^\\s!@#$%^&*()=+./,[{\\]};:'"?><]+)`,"g");function generateHashtags(n){const t=n.match(hashtagRegex),e=new Set,s=new Set;if(t)for(const a of t)e.has(a.slice(1))||(s.add(a.slice(1)),e.add(a.slice(1)));return Array.from(s)}async function generateContentTags(n,t=[]){const e=/(@|nostr:)(npub|nprofile|note|nevent|naddr)[a-zA-Z0-9]+/g,s=[],a=f=>{t.find(p=>["q",f[0]].includes(p[0])&&p[1]===f[1])||t.push(f)};n=n.replace(e,f=>{try{const p=f.split(/(@|nostr:)/)[2],{type:y,data:g}=nip19_exports.decode(p);let x;switch(y){case"npub":x=["p",g];break;case"nprofile":x=["p",g.pubkey];break;case"note":s.push(new Promise(async E=>{a(["q",g,await maybeGetEventRelayUrl(p)]),E()}));break;case"nevent":s.push(new Promise(async E=>{const{id:A,author:S}=g;let{relays:I}=g;(!I||I.length===0)&&(I=[await maybeGetEventRelayUrl(p)]),a(["q",A,I[0]]),S&&a(["p",S]),E()}));break;case"naddr":s.push(new Promise(async E=>{const A=[g.kind,g.pubkey,g.identifier].join(":");let S=g.relays??[];S.length===0&&(S=[await maybeGetEventRelayUrl(p)]),a(["q",A,S[0]]),a(["p",g.pubkey]),E()}));break;default:return f}return x&&a(x),`nostr:${p}`}catch{return f}}),await Promise.all(s);const o=generateHashtags(n).map(f=>["t",f]);return t=mergeTags(t,o),{content:n,tags:t}}async function maybeGetEventRelayUrl(n){return""}async function encrypt(n,t,e="nip44"){let s;if(!this.ndk)throw new Error("No NDK instance found!");let a=t;if(a||(this.ndk.assertSigner(),a=this.ndk.signer),!a)throw new Error("no NDK signer");const o=n||(()=>{const f=this.getMatchingTags("p");if(f.length!==1)throw new Error("No recipient could be determined and no explicit recipient was provided");return this.ndk.getUser({pubkey:f[0][1]})})();if(e==="nip44"&&await isEncryptionEnabled(a,"nip44")&&(s=await a.encrypt(o,this.content,"nip44")),(!s||e==="nip04")&&await isEncryptionEnabled(a,"nip04")&&(s=await a.encrypt(o,this.content,"nip04")),!s)throw new Error("Failed to encrypt event.");this.content=s}async function decrypt(n,t,e){var p,y,g,x;if((y=(p=this.ndk)==null?void 0:p.cacheAdapter)!=null&&y.getDecryptedEvent){let E=null;if(typeof this.ndk.cacheAdapter.getDecryptedEvent=="function"&&(E=this.ndk.cacheAdapter.getDecryptedEvent(this.id)),E){this.content=E.content;return}}let s;if(!this.ndk)throw new Error("No NDK instance found!");let a=t;if(a||(this.ndk.assertSigner(),a=this.ndk.signer),!a)throw new Error("no NDK signer");const o=n||this.author;if(!o)throw new Error("No sender provided and no author available");const f=e||(this.content.match(/\\?iv=/)?"nip04":"nip44");if((f==="nip04"||this.kind===4)&&await isEncryptionEnabled(a,"nip04")&&this.content.search("\\?iv=")&&(s=await a.decrypt(o,this.content,"nip04")),!s&&f==="nip44"&&await isEncryptionEnabled(a,"nip44")&&(s=await a.decrypt(o,this.content,"nip44")),!s)throw new Error("Failed to decrypt event.");this.content=s,(x=(g=this.ndk)==null?void 0:g.cacheAdapter)!=null&&x.addDecryptedEvent&&this.ndk.cacheAdapter.addDecryptedEvent(this)}async function isEncryptionEnabled(n,t){return n.encryptionEnabled?t?!!await n.encryptionEnabled(t):!0:!1}function eventHasETagMarkers(n){for(const t of n.tags)if(t[0]==="e"&&(t[3]??"").length>0)return!0;return!1}function getRootTag(n,t){t??(t=n.tagType());const e=n.tags.find(isTagRootTag);if(!e){if(eventHasETagMarkers(n))return;const s=n.getMatchingTags(t);if(s.length<3)return s[0]}return e}var nip22RootTags=new Set(["A","E","I"]),nip22ReplyTags=new Set(["a","e","i"]);function getReplyTag(n,t){if(n.kind===1111){let a;for(const o of n.tags)if(nip22RootTags.has(o[0]))a=o;else if(nip22ReplyTags.has(o[0])){a=o;break}return a}t??(t=n.tagType());let e=!1,s;for(const a of n.tags)if(a[0]===t){if((a[3]??"").length>0&&(e=!0),e&&a[3]==="reply")return a;e&&a[3]==="root"&&(s=a),e||(s=a)}return s}function isTagRootTag(n){return n[0]==="E"||n[3]==="root"}async function fetchTaggedEvent(n,t){if(!this.ndk)throw new Error("NDK instance not found");const e=this.getMatchingTags(n,t);if(e.length===0)return;const[s,a,o]=e[0];let f=o!==""?this.ndk.pool.getRelay(o):void 0;return await this.ndk.fetchEvent(a,{},f)}async function fetchRootEvent(n){if(!this.ndk)throw new Error("NDK instance not found");const t=getRootTag(this);if(t)return this.ndk.fetchEventFromTag(t,this,n)}async function fetchReplyEvent(n){if(!this.ndk)throw new Error("NDK instance not found");const t=getReplyTag(this);if(t)return this.ndk.fetchEventFromTag(t,this,n)}function isReplaceable(){if(this.kind===void 0)throw new Error("Kind not set");return[0,3].includes(this.kind)||this.kind>=1e4&&this.kind<2e4||this.kind>=3e4&&this.kind<4e4}function isEphemeral(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=2e4&&this.kind<3e4}function isParamReplaceable(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=3e4&&this.kind<4e4}var DEFAULT_RELAY_COUNT=2;function encode(n=DEFAULT_RELAY_COUNT){let t=[];return this.onRelays.length>0?t=this.onRelays.map(e=>e.url):this.relay&&(t=[this.relay.url]),t.length>n&&(t=t.slice(0,n)),this.isParamReplaceable()?nip19_exports.naddrEncode({kind:this.kind,pubkey:this.pubkey,identifier:this.replaceableDTag(),relays:t}):t.length>0?nip19_exports.neventEncode({id:this.tagId(),relays:t,author:this.pubkey}):nip19_exports.noteEncode(this.tagId())}async function repost(n=!0,t){if(!t&&n){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),t=this.ndk.signer}const e=new NDKEvent(this.ndk,{kind:getKind(this)});return this.isProtected||(e.content=JSON.stringify(this.rawEvent())),e.tag(this),this.kind!==1&&e.tags.push(["k",`${this.kind}`]),t&&await e.sign(t),n&&await e.publish(),e}function getKind(n){return n.kind===1?6:16}function serialize(n=!1,t=!1){const e=[0,this.pubkey,this.created_at,this.kind,this.tags,this.content];return n&&e.push(this.sig),t&&e.push(this.id),JSON.stringify(e)}function deserialize(n){const t=JSON.parse(n),e={pubkey:t[1],created_at:t[2],kind:t[3],tags:t[4],content:t[5]};if(t.length>=7){const s=t[6],a=t[7];s&&s.length===128?(e.sig=s,a&&a.length===64&&(e.id=a)):s&&s.length===64&&(e.id=s,a&&a.length===128&&(e.sig=a))}return e}var worker,processingQueue={};function signatureVerificationInit(n){worker=n,worker.onmessage=t=>{const[e,s]=t.data,a=processingQueue[e];if(!a){console.error("No record found for event",e);return}delete processingQueue[e];for(const o of a.resolves)o(s)}}async function verifySignatureAsync(n,t,e){const s=n.ndk,a=Date.now();let o;return s.signatureVerificationFunction?(console.log("[NDK-CORE] Using custom signature verification function async"),o=await s.signatureVerificationFunction(n),console.log("Custom signature verification result",n.id,{result:o})):(console.log("Using worker-based signature verification async"),o=await new Promise(f=>{const p=n.serialize();let y=!1;processingQueue[n.id]||(processingQueue[n.id]={event:n,resolves:[],relay:e},y=!0),processingQueue[n.id].resolves.push(f),y&&(worker==null||worker.postMessage({serialized:p,id:n.id,sig:n.sig,pubkey:n.pubkey}))})),s.signatureVerificationTimeMs+=Date.now()-a,o}var PUBKEY_REGEX=/^[a-f0-9]{64}$/;function validate(){if(typeof this.kind!="number"||typeof this.content!="string"||typeof this.created_at!="number"||typeof this.pubkey!="string"||!this.pubkey.match(PUBKEY_REGEX)||!Array.isArray(this.tags))return!1;for(let n=0;n<this.tags.length;n++){const t=this.tags[n];if(!Array.isArray(t))return!1;for(let e=0;e<t.length;e++)if(typeof t[e]=="object")return!1}return!0}var verifiedSignatures=new distExports.LRUCache({maxSize:1e3,entryExpirationTimeInMS:6e4});function verifySignature(n){var e;if(typeof this.signatureVerified=="boolean")return this.signatureVerified;const t=verifiedSignatures.get(this.id);if(t!==null)return this.signatureVerified=!!t,this.signatureVerified;try{if((e=this.ndk)!=null&&e.asyncSigVerification)verifySignatureAsync(this,n,this.relay).then(s=>{var a,o;n&&(this.signatureVerified=s,s&&verifiedSignatures.set(this.id,this.sig)),s||(this.relay?(a=this.ndk)==null||a.reportInvalidSignature(this,this.relay):(o=this.ndk)==null||o.reportInvalidSignature(this),verifiedSignatures.set(this.id,!1))}).catch(s=>{console.error("signature verification error",this.id,s)});else{const s=sha256$1(new TextEncoder().encode(this.serialize())),a=schnorr.verify(this.sig,s,this.pubkey);return a?verifiedSignatures.set(this.id,this.sig):verifiedSignatures.set(this.id,!1),this.signatureVerified=a,a}}catch{return this.signatureVerified=!1,!1}}function getEventHash(){return getEventHashFromSerializedEvent(this.serialize())}function getEventHashFromSerializedEvent(n){const t=sha256$1(new TextEncoder().encode(n));return bytesToHex$1(t)}var skipClientTagOnKinds=new Set([0,4,1059,13,3,9734,5]),NDKEvent=class cs extends libExports.EventEmitter{constructor(e,s){var a;super();pe(this,"ndk");pe(this,"created_at");pe(this,"content","");pe(this,"tags",[]);pe(this,"kind");pe(this,"id","");pe(this,"sig");pe(this,"pubkey","");pe(this,"signatureVerified");pe(this,"_author");pe(this,"relay");pe(this,"publishStatus","success");pe(this,"publishError");pe(this,"serialize",serialize.bind(this));pe(this,"getEventHash",getEventHash.bind(this));pe(this,"validate",validate.bind(this));pe(this,"verifySignature",verifySignature.bind(this));pe(this,"isReplaceable",isReplaceable.bind(this));pe(this,"isEphemeral",isEphemeral.bind(this));pe(this,"isDvm",()=>this.kind&&this.kind>=5e3&&this.kind<=7e3);pe(this,"isParamReplaceable",isParamReplaceable.bind(this));pe(this,"encode",encode.bind(this));pe(this,"encrypt",encrypt.bind(this));pe(this,"decrypt",decrypt.bind(this));pe(this,"fetchTaggedEvent",fetchTaggedEvent.bind(this));pe(this,"fetchRootEvent",fetchRootEvent.bind(this));pe(this,"fetchReplyEvent",fetchReplyEvent.bind(this));pe(this,"repost",repost.bind(this));this.ndk=e,this.created_at=s==null?void 0:s.created_at,this.content=(s==null?void 0:s.content)||"",this.tags=(s==null?void 0:s.tags)||[],this.id=(s==null?void 0:s.id)||"",this.sig=s==null?void 0:s.sig,this.pubkey=(s==null?void 0:s.pubkey)||"",this.kind=s==null?void 0:s.kind,s instanceof cs&&(this.relay&&(this.relay=s.relay,(a=this.ndk)==null||a.subManager.seenEvent(s.id,this.relay)),this.publishStatus=s.publishStatus,this.publishError=s.publishError)}get onRelays(){let e=[];return this.ndk?e=this.ndk.subManager.seenEvents.get(this.id)||[]:this.relay&&e.push(this.relay),e}static deserialize(e,s){return new cs(e,deserialize(s))}rawEvent(){return{created_at:this.created_at,content:this.content,tags:this.tags,kind:this.kind,pubkey:this.pubkey,id:this.id,sig:this.sig}}set author(e){var s;this.pubkey=e.pubkey,this._author=e,(s=this._author).ndk??(s.ndk=this.ndk)}get author(){if(this._author)return this._author;if(!this.ndk)throw new Error("No NDK instance found");const e=this.ndk.getUser({pubkey:this.pubkey});return this._author=e,e}tagExternal(e,s,a){const o=["i"],f=["k"];switch(s){case"url":{const p=new URL(e);p.hash="",o.push(p.toString()),f.push(`${p.protocol}//${p.host}`);break}case"hashtag":o.push(`#${e.toLowerCase()}`),f.push("#");break;case"geohash":o.push(`geo:${e.toLowerCase()}`),f.push("geo");break;case"isbn":o.push(`isbn:${e.replace(/-/g,"")}`),f.push("isbn");break;case"podcast:guid":o.push(`podcast:guid:${e}`),f.push("podcast:guid");break;case"podcast:item:guid":o.push(`podcast:item:guid:${e}`),f.push("podcast:item:guid");break;case"podcast:publisher:guid":o.push(`podcast:publisher:guid:${e}`),f.push("podcast:publisher:guid");break;case"isan":o.push(`isan:${e.split("-").slice(0,4).join("-")}`),f.push("isan");break;case"doi":o.push(`doi:${e.toLowerCase()}`),f.push("doi");break;default:throw new Error(`Unsupported NIP-73 entity type: ${s}`)}a&&o.push(a),this.tags.push(o),this.tags.push(f)}tag(e,s,a,o){let f=[];if(e.fetchProfile!==void 0){o??(o="p");const y=[o,e.pubkey];s&&y.push("",s),f.push(y)}else if(e instanceof cs){const y=e;a??(a=(y==null?void 0:y.pubkey)===this.pubkey),f=y.referenceTags(s,a,o);for(const g of y.getMatchingTags("p"))g[1]!==this.pubkey&&(this.tags.find(x=>x[0]==="p"&&x[1]===g[1])||this.tags.push(["p",g[1]]))}else if(Array.isArray(e))f=[e];else throw new Error("Invalid argument",e);this.tags=mergeTags(this.tags,f)}async toNostrEvent(e){var o,f;if(!e&&this.pubkey===""){const p=await((f=(o=this.ndk)==null?void 0:o.signer)==null?void 0:f.user());this.pubkey=(p==null?void 0:p.pubkey)||""}this.created_at||(this.created_at=Math.floor(Date.now()/1e3));const{content:s,tags:a}=await this.generateTags();this.content=s||"",this.tags=a;try{this.id=this.getEventHash()}catch{}return this.rawEvent()}getMatchingTags(e,s){const a=this.tags.filter(o=>o[0]===e);return s===void 0?a:a.filter(o=>o[3]===s)}hasTag(e,s){return this.tags.some(a=>a[0]===e&&(!s||a[3]===s))}tagValue(e,s){const a=this.getMatchingTags(e,s);if(a.length!==0)return a[0][1]}get alt(){return this.tagValue("alt")}set alt(e){this.removeTag("alt"),e&&this.tags.push(["alt",e])}get dTag(){return this.tagValue("d")}set dTag(e){this.removeTag("d"),e&&this.tags.push(["d",e])}removeTag(e,s){const a=Array.isArray(e)?e:[e];this.tags=this.tags.filter(o=>{const f=a.includes(o[0]),p=s?o[3]===s:!0;return!(f&&p)})}replaceTag(e){this.removeTag(e[0]),this.tags.push(e)}async sign(e){var a,o;e?this.author=await e.user():((a=this.ndk)==null||a.assertSigner(),e=(o=this.ndk)==null?void 0:o.signer);const s=await this.toNostrEvent();return this.sig=await e.sign(s),this.sig}async publishReplaceable(e,s,a){return this.id="",this.created_at=Math.floor(Date.now()/1e3),this.sig="",this.publish(e,s,a)}async publish(e,s,a){var p,y,g;if(a||(a=1),this.sig||await this.sign(),!this.ndk)throw new Error("NDKEvent must be associated with an NDK instance to publish");if((!e||e.size===0)&&(e=this.ndk.devWriteRelaySet||await calculateRelaySetFromEvent(this.ndk,this,a)),this.kind===5&&((p=this.ndk.cacheAdapter)!=null&&p.deleteEventIds)){const x=this.getMatchingTags("e").map(E=>E[1]);this.ndk.cacheAdapter.deleteEventIds(x)}const o=this.rawEvent();if((y=this.ndk.cacheAdapter)!=null&&y.addUnpublishedEvent&&shouldTrackUnpublishedEvent(this))try{this.ndk.cacheAdapter.addUnpublishedEvent(this,e.relayUrls)}catch(x){console.error("Error adding unpublished event to cache",x)}this.kind===5&&((g=this.ndk.cacheAdapter)!=null&&g.deleteEventIds)&&this.ndk.cacheAdapter.deleteEventIds(this.getMatchingTags("e").map(x=>x[1])),this.ndk.subManager.dispatchEvent(o,void 0,!0);const f=await e.publish(this,s,a);return f.forEach(x=>{var E;return(E=this.ndk)==null?void 0:E.subManager.seenEvent(this.id,x)}),f}async generateTags(){var o,f,p;let e=[];const s=await generateContentTags(this.content,this.tags),a=s.content;if(e=s.tags,this.kind&&this.isParamReplaceable()&&!this.getMatchingTags("d")[0]){const g=this.tagValue("title");let E=[...Array(g?6:16)].map(()=>Math.random().toString(36)[2]).join("");g&&g.length>0&&(E=`${g.replace(/[^a-z0-9]+/gi,"-").replace(/^-|-$/g,"")}-${E}`),e.push(["d",E])}if(this.shouldAddClientTag){const y=["client",((o=this.ndk)==null?void 0:o.clientName)??""];(f=this.ndk)!=null&&f.clientNip89&&y.push((p=this.ndk)==null?void 0:p.clientNip89),e.push(y)}else this.shouldStripClientTag&&(e=e.filter(y=>y[0]!=="client"));return{content:a||"",tags:e}}get shouldAddClientTag(){var e,s;return!(!((e=this.ndk)!=null&&e.clientName)&&!((s=this.ndk)!=null&&s.clientNip89)||skipClientTagOnKinds.has(this.kind)||this.isEphemeral()||this.isReplaceable()&&!this.isParamReplaceable()||this.isDvm()||this.hasTag("client"))}get shouldStripClientTag(){return skipClientTagOnKinds.has(this.kind)}muted(){var o,f;const e=(o=this.ndk)==null?void 0:o.mutedIds.get(this.pubkey);if(e&&e==="p")return"author";const s=this.tagReference(),a=(f=this.ndk)==null?void 0:f.mutedIds.get(s[1]);return a&&a===s[0]?"event":null}replaceableDTag(){if(this.kind&&this.kind>=3e4&&this.kind<=4e4){const e=this.getMatchingTags("d")[0];return e?e[1]:""}throw new Error("Event is not a parameterized replaceable event")}deduplicationKey(){return this.kind===0||this.kind===3||this.kind&&this.kind>=1e4&&this.kind<2e4?`${this.kind}:${this.pubkey}`:this.tagId()}tagId(){return this.isParamReplaceable()?this.tagAddress():this.id}tagAddress(){if(this.isParamReplaceable()){const e=this.dTag??"";return`${this.kind}:${this.pubkey}:${e}`}if(this.isReplaceable())return`${this.kind}:${this.pubkey}:`;throw new Error("Event is not a replaceable event")}tagType(){return this.isParamReplaceable()?"a":"e"}tagReference(e){let s;return this.isParamReplaceable()?s=["a",this.tagAddress()]:s=["e",this.tagId()],this.relay?s.push(this.relay.url):s.push(""),s.push(e??""),this.isParamReplaceable()||s.push(this.pubkey),s}referenceTags(e,s,a){let o=[];return this.isParamReplaceable()?o=[[a??"a",this.tagAddress()],[a??"e",this.id]]:o=[[a??"e",this.id]],o=o.map(f=>{var p,y,g;return f[0]==="e"||e?f.push(((p=this.relay)==null?void 0:p.url)??""):(y=this.relay)!=null&&y.url&&f.push((g=this.relay)==null?void 0:g.url),f}),o.forEach(f=>{f[0]==="e"?(f.push(e??""),f.push(this.pubkey)):e&&f.push(e)}),o=[...o,...this.getMatchingTags("h")],s||o.push(...this.author.referenceTags()),o}filter(){return this.isParamReplaceable()?{"#a":[this.tagId()]}:{"#e":[this.tagId()]}}nip22Filter(){return this.isParamReplaceable()?{"#A":[this.tagId()]}:{"#E":[this.tagId()]}}async delete(e,s=!0){var o;if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const a=new cs(this.ndk,{kind:5,content:e||""});return a.tag(this,void 0,!0),a.tags.push(["k",(o=this.kind)==null?void 0:o.toString()]),s&&(this.emit("deleted"),await a.publish()),a}set isProtected(e){this.removeTag("-"),e&&this.tags.push(["-"])}get isProtected(){return this.hasTag("-")}async react(e,s=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const a=new cs(this.ndk,{kind:7,content:e});return a.tag(this),s&&await a.publish(),a}get isValid(){return this.validate()}get inspect(){return JSON.stringify(this.rawEvent(),null,4)}dump(){console.debug(JSON.stringify(this.rawEvent(),null,4)),console.debug("Event on relays:",this.onRelays.map(e=>e.url).join(", "))}reply(){var s,a;const e=new cs(this.ndk);if(this.kind===1)e.kind=1,this.hasTag("e")?e.tags=[...e.tags,...this.getMatchingTags("e"),...this.getMatchingTags("p"),...this.getMatchingTags("a"),...this.referenceTags("reply")]:e.tag(this,"root");else{e.kind=1111;const o=["A","E","I","P"],f=this.tags.filter(p=>o.includes(p[0]));if(f.length>0){const p=this.tagValue("K");e.tags.push(...f),p&&e.tags.push(["K",p]);const[y,g,x,...E]=this.tagReference(),A=[y,g,...E];e.tags.push(A)}else{const[p,y,g,x]=this.tagReference(),E=[p,y,x??""];p==="e"&&E.push(this.pubkey),e.tags.push(E);const A=[...E];A[0]=A[0].toUpperCase(),e.tags.push(A),e.tags.push(["K",(s=this.kind)==null?void 0:s.toString()]),e.tags.push(["P",this.pubkey])}e.tags.push(["k",(a=this.kind)==null?void 0:a.toString()]),e.tags.push(...this.getMatchingTags("p")),e.tags.push(["p",this.pubkey])}return e}},untrackedUnpublishedEvents=new Set([24133,13194,23194,23195]);function shouldTrackUnpublishedEvent(n){return!untrackedUnpublishedEvents.has(n.kind)}var NDKPool=class extends libExports.EventEmitter{constructor(t,e,s,{debug:a,name:o}={}){super();pe(this,"_relays",new Map);pe(this,"status","idle");pe(this,"autoConnectRelays",new Set);pe(this,"poolBlacklistRelayUrls",new Set);pe(this,"debug");pe(this,"temporaryRelayTimers",new Map);pe(this,"flappingRelays",new Set);pe(this,"backoffTimes",new Map);pe(this,"ndk");pe(this,"_name","unnamed");this.debug=a??s.debug.extend("pool"),o&&(this._name=o),this.ndk=s,this.relayUrls=t,this.poolBlacklistRelayUrls=new Set(e),this.ndk.pools.push(this)}get blacklistRelayUrls(){const t=new Set(this.ndk.blacklistRelayUrls);return this.poolBlacklistRelayUrls.forEach(e=>t.add(e)),t}get relays(){return this._relays}set relayUrls(t){this._relays.clear();for(const e of t){const s=new NDKRelay(e,void 0,this.ndk);s.connectivity.netDebug=this.ndk.netDebug,this.addRelay(s)}}get name(){return this._name}set name(t){this._name=t,this.debug=this.debug.extend(t)}useTemporaryRelay(t,e=3e4,s){const a=this.relays.has(t.url);a||(this.addRelay(t),this.debug("Adding temporary relay %s for filters %o",t.url,s));const o=this.temporaryRelayTimers.get(t.url);if(o&&clearTimeout(o),!a||o){const f=setTimeout(()=>{var p;(p=this.ndk.explicitRelayUrls)!=null&&p.includes(t.url)||this.removeRelay(t.url)},e);this.temporaryRelayTimers.set(t.url,f)}}addRelay(t,e=!0){var _,R;const s=this.relays.has(t.url),a=(_=this.blacklistRelayUrls)==null?void 0:_.has(t.url),o=t.url.includes("/npub1");let f=!0;const p=t.url;if(s)return;if(a){this.debug(`Refusing to add relay ${p}: blacklisted`);return}if(o){this.debug(`Refusing to add relay ${p}: is a filter relay`);return}if((R=this.ndk.cacheAdapter)!=null&&R.getRelayStatus){const N=this.ndk.cacheAdapter.getRelayStatus(p);if(N!=null&&N.dontConnectBefore){if(N.dontConnectBefore>Date.now()){const D=N.dontConnectBefore-Date.now();this.debug(`Refusing to add relay ${p}: delayed connect for ${D}ms`),setTimeout(()=>{this.addRelay(t,e)},D);return}f=!1}}const y=N=>this.emit("notice",t,N),g=()=>this.handleRelayConnect(p),x=()=>this.handleRelayReady(t),E=()=>this.emit("relay:disconnect",t),A=()=>this.handleFlapping(t),S=N=>this.emit("relay:auth",t,N),I=()=>this.emit("relay:authed",t);t.off("notice",y),t.off("connect",g),t.off("ready",x),t.off("disconnect",E),t.off("flapping",A),t.off("auth",S),t.off("authed",I),t.on("notice",y),t.on("connect",g),t.on("ready",x),t.on("disconnect",E),t.on("flapping",A),t.on("auth",S),t.on("authed",I),t.on("delayed-connect",N=>{var D;(D=this.ndk.cacheAdapter)!=null&&D.updateRelayStatus&&this.ndk.cacheAdapter.updateRelayStatus(t.url,{dontConnectBefore:Date.now()+N})}),this._relays.set(p,t),e&&this.autoConnectRelays.add(p),e&&this.status==="active"&&(this.emit("relay:connecting",t),t.connect(void 0,f).catch(N=>{this.debug(`Failed to connect to relay ${p}`,N)}))}removeRelay(t){const e=this.relays.get(t);if(e)return e.disconnect(),this.relays.delete(t),this.autoConnectRelays.delete(t),this.emit("relay:disconnect",e),!0;const s=this.temporaryRelayTimers.get(t);return s&&(clearTimeout(s),this.temporaryRelayTimers.delete(t)),!1}isRelayConnected(t){const e=normalizeRelayUrl(t),s=this.relays.get(e);return s?s.status===5:!1}getRelay(t,e=!0,s=!1,a){let o=this.relays.get(normalizeRelayUrl(t));return o||(o=new NDKRelay(t,void 0,this.ndk),o.connectivity.netDebug=this.ndk.netDebug,s?this.useTemporaryRelay(o,3e4,a):this.addRelay(o,e)),o}handleRelayConnect(t){const e=this.relays.get(t);if(!e){console.error("NDK BUG: relay not found in pool",{relayUrl:t});return}this.emit("relay:connect",e),this.stats().connected===this.relays.size&&this.emit("connect")}handleRelayReady(t){this.emit("relay:ready",t)}async connect(t){this.status="active",this.debug(`Connecting to ${this.relays.size} relays${t?`, timeout ${t}ms`:""}...`);const e=Array.from(this.autoConnectRelays.keys()).map(f=>this.relays.get(f)).filter(f=>!!f);for(const f of e)f.status!==5&&f.status!==4&&(this.emit("relay:connecting",f),f.connect().catch(p=>{this.debug(`Failed to connect to relay ${f.url}: ${p??"No reason specified"}`)}));const s=()=>e.every(f=>f.status===5),a=new Promise(f=>{if(s()){f();return}const p=[];for(const y of e){const g=()=>{if(s()){for(let x=0;x<e.length;x++)e[x].off("connect",p[x]);f()}};p.push(g),y.on("connect",g)}}),o=typeof t=="number"?new Promise(f=>setTimeout(f,t)):new Promise(()=>{});await Promise.race([a,o])}checkOnFlappingRelays(){const t=this.flappingRelays.size,e=this.relays.size;if(t/e>=.8)for(const s of this.flappingRelays)this.backoffTimes.set(s,0)}handleFlapping(t){this.debug(`Relay ${t.url} is flapping`);let e=this.backoffTimes.get(t.url)||5e3;e=e*2,this.backoffTimes.set(t.url,e),this.debug(`Backoff time for ${t.url} is ${e}ms`),setTimeout(()=>{this.debug(`Attempting to reconnect to ${t.url}`),this.emit("relay:connecting",t),t.connect(),this.checkOnFlappingRelays()},e),t.disconnect(),this.emit("flapping",t)}size(){return this.relays.size}stats(){const t={total:0,connected:0,disconnected:0,connecting:0};for(const e of this.relays.values())t.total++,e.status===5?t.connected++:e.status===1?t.disconnected++:e.status===4&&t.connecting++;return t}connectedRelays(){return Array.from(this.relays.values()).filter(t=>t.status>=5)}permanentAndConnectedRelays(){return Array.from(this.relays.values()).filter(t=>t.status>=5&&!this.temporaryRelayTimers.has(t.url))}urls(){return Array.from(this.relays.keys())}},_i,NDKCashuMintList=(_i=class extends NDKEvent{constructor(e,s){super(e,s);pe(this,"_p2pk");this.kind??(this.kind=10019)}static from(e){return new _i(e.ndk,e)}set relays(e){this.tags=this.tags.filter(s=>s[0]!=="relay");for(const s of e)this.tags.push(["relay",s])}get relays(){const e=[];for(const s of this.tags)s[0]==="relay"&&e.push(s[1]);return e}set mints(e){this.tags=this.tags.filter(s=>s[0]!=="mint");for(const s of e)this.tags.push(["mint",s])}get mints(){const e=[];for(const s of this.tags)s[0]==="mint"&&e.push(s[1]);return Array.from(new Set(e))}get p2pk(){return this._p2pk?this._p2pk:(this._p2pk=this.tagValue("pubkey")??this.pubkey,this._p2pk)}set p2pk(e){this._p2pk=e,this.removeTag("pubkey"),e&&this.tags.push(["pubkey",e])}get relaySet(){return NDKRelaySet.fromRelayUrls(this.relays,this.ndk)}},pe(_i,"kind",10019),pe(_i,"kinds",[10019]),_i),Ii,NDKArticle=(Ii=class extends NDKEvent{constructor(t,e){super(t,e),this.kind??(this.kind=30023)}static from(t){return new Ii(t.ndk,t)}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get image(){return this.tagValue("image")}set image(t){this.removeTag("image"),t&&this.tags.push(["image",t])}get summary(){return this.tagValue("summary")}set summary(t){this.removeTag("summary"),t&&this.tags.push(["summary",t])}get published_at(){const t=this.tagValue("published_at");if(t){let e=Number.parseInt(t);return e>1e12&&(e=Math.floor(e/1e3)),e}}set published_at(t){this.removeTag("published_at"),t!==void 0&&this.tags.push(["published_at",t.toString()])}async generateTags(){return super.generateTags(),this.published_at||(this.published_at=this.created_at),super.generateTags()}get url(){return this.tagValue("url")}set url(t){t?this.tags.push(["url",t]):this.removeTag("url")}},pe(Ii,"kind",30023),pe(Ii,"kinds",[30023]),Ii);function proofsTotalBalance(n){return n.reduce((t,e)=>{if(e.amount<0)throw new Error("proof amount is negative");return t+e.amount},0)}var Ti,NDKCashuToken=(Ti=class extends NDKEvent{constructor(e,s){super(e,s);pe(this,"_proofs",[]);pe(this,"_mint");pe(this,"_deletes",[]);pe(this,"original");this.kind??(this.kind=7375)}static async from(e){const s=new Ti(e.ndk,e);s.original=e;try{await s.decrypt()}catch{s.content=s.original.content}try{const a=JSON.parse(s.content);if(s.proofs=a.proofs,s.mint=a.mint??s.tagValue("mint"),s.deletedTokens=a.del??[],!Array.isArray(s.proofs))return}catch{return}return s}get proofs(){return this._proofs}set proofs(e){const s=new Set;this._proofs=e.filter(a=>s.has(a.C)?(console.warn("Passed in proofs had duplicates, ignoring",a.C),!1):a.amount<0?(console.warn("Invalid proof with negative amount",a),!1):(s.add(a.C),!0)).map(this.cleanProof)}cleanProof(e){return{id:e.id,amount:e.amount,C:e.C,secret:e.secret}}async toNostrEvent(e){if(!this.ndk)throw new Error("no ndk");if(!this.ndk.signer)throw new Error("no signer");const s={proofs:this.proofs.map(this.cleanProof),mint:this.mint,del:this.deletedTokens??[]};this.content=JSON.stringify(s);const a=await this.ndk.signer.user();return await this.encrypt(a,void 0,"nip44"),super.toNostrEvent(e)}set mint(e){this._mint=e}get mint(){return this._mint}get deletedTokens(){return this._deletes}set deletedTokens(e){this._deletes=e}get amount(){return proofsTotalBalance(this.proofs)}async publish(e,s,a){return this.original?this.original.publish(e,s,a):super.publish(e,s,a)}},pe(Ti,"kind",7375),pe(Ti,"kinds",[7375]),Ti),Ri,NDKHighlight=(Ri=class extends NDKEvent{constructor(e,s){super(e,s);pe(this,"_article");this.kind??(this.kind=9802)}static from(e){return new Ri(e.ndk,e)}get url(){return this.tagValue("r")}set context(e){e===void 0?this.tags=this.tags.filter(([s,a])=>s!=="context"):(this.tags=this.tags.filter(([s,a])=>s!=="context"),this.tags.push(["context",e]))}get context(){var e;return((e=this.tags.find(([s,a])=>s==="context"))==null?void 0:e[1])??void 0}get article(){return this._article}set article(e){this._article=e,typeof e=="string"?this.tags.push(["r",e]):this.tag(e)}getArticleTag(){return this.getMatchingTags("a")[0]||this.getMatchingTags("e")[0]||this.getMatchingTags("r")[0]}async getArticle(){var a;if(this._article!==void 0)return this._article;let e;const s=this.getArticleTag();if(s){switch(s[0]){case"a":{const[o,f,p]=s[1].split(":");e=nip19_exports.naddrEncode({kind:Number.parseInt(o),pubkey:f,identifier:p});break}case"e":e=nip19_exports.noteEncode(s[1]);break;case"r":this._article=s[1];break}if(e){let o=await((a=this.ndk)==null?void 0:a.fetchEvent(e));o&&(o.kind===30023&&(o=NDKArticle.from(o)),this._article=o)}return this._article}}},pe(Ri,"kind",9802),pe(Ri,"kinds",[9802]),Ri);function mapImetaTag(n){const t={};if(n.length===2){const s=n[1].split(" ");for(let a=0;a<s.length;a+=2){const o=s[a],f=s[a+1];o==="fallback"?(t.fallback||(t.fallback=[]),t.fallback.push(f)):t[o]=f}return t}const e=n.slice(1);for(const s of e){const a=s.split(" "),o=a[0],f=a.slice(1).join(" ");o==="fallback"?(t.fallback||(t.fallback=[]),t.fallback.push(f)):t[o]=f}return t}function imetaTagToTag(n){const t=["imeta"];for(const[e,s]of Object.entries(n))if(Array.isArray(s))for(const a of s)t.push(`${e} ${a}`);else s&&t.push(`${e} ${s}`);return t}var Ni,NDKImage=(Ni=class extends NDKEvent{constructor(e,s){super(e,s);pe(this,"_imetas");this.kind??(this.kind=20)}static from(e){return new Ni(e.ndk,e.rawEvent())}get isValid(){return this.imetas.length>0}get imetas(){return this._imetas?this._imetas:(this._imetas=this.tags.filter(e=>e[0]==="imeta").map(mapImetaTag).filter(e=>!!e.url),this._imetas)}set imetas(e){this._imetas=e,this.tags=this.tags.filter(s=>s[0]!=="imeta"),this.tags.push(...e.map(imetaTagToTag))}},pe(Ni,"kind",20),pe(Ni,"kinds",[20]),Ni),fs,NDKList=(fs=class extends NDKEvent{constructor(e,s){super(e,s);pe(this,"_encryptedTags");pe(this,"encryptedTagsLength");this.kind??(this.kind=30001)}static from(e){return new fs(e.ndk,e)}get title(){const e=this.tagValue("title")||this.tagValue("name");return e||(this.kind===3?"Contacts":this.kind===1e4?"Mute":this.kind===10001?"Pinned Notes":this.kind===10002?"Relay Metadata":this.kind===10003?"Bookmarks":this.kind===10004?"Communities":this.kind===10005?"Public Chats":this.kind===10006?"Blocked Relays":this.kind===10007?"Search Relays":this.kind===10050?"Direct Message Receive Relays":this.kind===10015?"Interests":this.kind===10030?"Emojis":this.tagValue("d"))}set title(e){this.removeTag(["title","name"]),e&&this.tags.push(["title",e])}get name(){return this.title}set name(e){this.title=e}get description(){return this.tagValue("description")}set description(e){this.removeTag("description"),e&&this.tags.push(["description",e])}get image(){return this.tagValue("image")}set image(e){this.removeTag("image"),e&&this.tags.push(["image",e])}isEncryptedTagsCacheValid(){return!!(this._encryptedTags&&this.encryptedTagsLength===this.content.length)}async encryptedTags(e=!0){if(e&&this.isEncryptedTagsCacheValid())return this._encryptedTags;if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const s=await this.ndk.signer.user();try{if(this.content.length>0)try{const a=await this.ndk.signer.decrypt(s,this.content),o=JSON.parse(a);return o!=null&&o[0]?(this.encryptedTagsLength=this.content.length,this._encryptedTags=o):(this.encryptedTagsLength=this.content.length,this._encryptedTags=[])}catch{}}catch{}return[]}validateTag(e){return!0}getItems(e){return this.tags.filter(s=>s[0]===e)}get items(){return this.tags.filter(e=>!["d","L","l","title","name","description","published_at","summary","image","thumb","alt","expiration","subject","client"].includes(e[0]))}async addItem(e,s=void 0,a=!1,o="bottom"){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");let f;if(e instanceof NDKEvent)f=[e.tagReference(s)];else if(e instanceof NDKUser)f=e.referenceTags();else if(e instanceof NDKRelay)f=e.referenceTags();else if(Array.isArray(e))f=[e];else throw new Error("Invalid object type");if(s&&f[0].push(s),a){const p=await this.ndk.signer.user(),y=await this.encryptedTags();o==="top"?y.unshift(...f):y.push(...f),this._encryptedTags=y,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(y),await this.encrypt(p)}else o==="top"?this.tags.unshift(...f):this.tags.push(...f);this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItemByValue(e,s=!0){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const a=this.tags.findIndex(y=>y[1]===e);a>=0&&this.tags.splice(a,1);const o=await this.ndk.signer.user(),f=await this.encryptedTags(),p=f.findIndex(y=>y[1]===e);if(p>=0&&(f.splice(p,1),this._encryptedTags=f,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(f),await this.encrypt(o)),s)return this.publishReplaceable();this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItem(e,s){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");if(s){const a=await this.ndk.signer.user(),o=await this.encryptedTags();o.splice(e,1),this._encryptedTags=o,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(o),await this.encrypt(a)}else this.tags.splice(e,1);return this.created_at=Math.floor(Date.now()/1e3),this.emit("change"),this}has(e){return this.items.some(s=>s[1]===e)}filterForItems(){const e=new Set,s=new Map,a=[];for(const o of this.items)if(o[0]==="e"&&o[1])e.add(o[1]);else if(o[0]==="a"&&o[1]){const[f,p,y]=o[1].split(":");if(!f||!p)continue;const g=`${f}:${p}`,x=s.get(g)||[];x.push(y||""),s.set(g,x)}if(e.size>0&&a.push({ids:Array.from(e)}),s.size>0)for(const[o,f]of s.entries()){const[p,y]=o.split(":");a.push({kinds:[Number.parseInt(p)],authors:[y],"#d":f})}return a}},pe(fs,"kinds",[10063,30001,10004,10050,10030,10015,10001,10002,10007,10006,10003]),fs),lists_default=NDKList,ei,NDKNutzap=(ei=class extends NDKEvent{constructor(e,s){super(e,s);pe(this,"debug");pe(this,"_proofs",[]);pe(this,"sender",this.author);this.kind??(this.kind=9321),this.debug=(e==null?void 0:e.debug.extend("nutzap"))??createDebug3("ndk:nutzap"),this.alt||(this.alt="This is a nutzap");try{const a=this.getMatchingTags("proof");a.length?this._proofs=a.map(o=>JSON.parse(o[1])):this._proofs=JSON.parse(this.content)}catch{return}}static from(e){const s=new ei(e.ndk,e);if(!(!s._proofs||!s._proofs.length))return s}set comment(e){this.content=e??""}get comment(){const e=this.tagValue("comment");return e||this.content}set proofs(e){this._proofs=e,this.tags=this.tags.filter(s=>s[0]!=="proof");for(const s of e)this.tags.push(["proof",JSON.stringify(s)])}get proofs(){return this._proofs}get rawP2pk(){var s;const e=this.proofs[0];try{const a=JSON.parse(e.secret);let o;if(typeof a=="string"?(o=JSON.parse(a),this.debug("stringified payload",e.secret)):typeof a=="object"&&(o=a),Array.isArray(o)&&o[0]==="P2PK"&&o.length>1&&typeof o[1]=="object"&&o[1]!==null||typeof o=="object"&&o!==null&&typeof((s=o[1])==null?void 0:s.data)=="string")return o[1].data}catch(a){this.debug("error parsing p2pk pubkey",a,this.proofs[0])}}get p2pk(){const e=this.rawP2pk;if(e)return e.startsWith("02")?e.slice(2):e}get mint(){return this.tagValue("u")}set mint(e){this.replaceTag(["u",e])}get unit(){let e=this.tagValue("unit")??"sat";return e!=null&&e.startsWith("msat")&&(e="sat"),e}set unit(e){if(this.removeTag("unit"),e!=null&&e.startsWith("msat"))throw new Error("msat is not allowed, use sat denomination instead");e&&this.tag(["unit",e])}get amount(){return this.proofs.reduce((s,a)=>s+a.amount,0)}set target(e){this.tags=this.tags.filter(s=>s[0]!=="p"),e instanceof NDKEvent&&this.tags.push(e.tagReference())}set recipientPubkey(e){this.removeTag("p"),this.tag(["p",e])}get recipientPubkey(){return this.tagValue("p")}get recipient(){const e=this.recipientPubkey;return this.ndk?this.ndk.getUser({pubkey:e}):new NDKUser({pubkey:e})}async toNostrEvent(){this.unit==="msat"&&(this.unit="sat"),this.removeTag("amount"),this.tags.push(["amount",this.amount.toString()]);const e=await super.toNostrEvent();return e.content=this.comment,e}get isValid(){let e=0,s=0,a=0;for(const o of this.tags)o[0]==="e"&&e++,o[0]==="p"&&s++,o[0]==="u"&&a++;return s===1&&a===1&&e<=1&&this.proofs.length>0}},pe(ei,"kind",9321),pe(ei,"kinds",[ei.kind]),ei),ki,NDKSimpleGroupMemberList=(ki=class extends NDKEvent{constructor(e,s){super(e,s);pe(this,"relaySet");pe(this,"memberSet",new Set);this.kind??(this.kind=39002),this.memberSet=new Set(this.members)}static from(e){return new ki(e.ndk,e)}get members(){return this.getMatchingTags("p").map(e=>e[1])}hasMember(e){return this.memberSet.has(e)}async publish(e,s,a){return e??(e=this.relaySet),super.publishReplaceable(e,s,a)}},pe(ki,"kind",39002),pe(ki,"kinds",[39002]),ki),Mi,NDKSimpleGroupMetadata=(Mi=class extends NDKEvent{constructor(t,e){super(t,e),this.kind??(this.kind=39e3)}static from(t){return new Mi(t.ndk,t)}get name(){return this.tagValue("name")}get picture(){return this.tagValue("picture")}get about(){return this.tagValue("about")}get scope(){if(this.getMatchingTags("public").length>0)return"public";if(this.getMatchingTags("public").length>0)return"private"}set scope(t){this.removeTag("public"),this.removeTag("private"),t==="public"?this.tags.push(["public",""]):t==="private"&&this.tags.push(["private",""])}get access(){if(this.getMatchingTags("open").length>0)return"open";if(this.getMatchingTags("closed").length>0)return"closed"}set access(t){this.removeTag("open"),this.removeTag("closed"),t==="open"?this.tags.push(["open",""]):t==="closed"&&this.tags.push(["closed",""])}},pe(Mi,"kind",39e3),pe(Mi,"kinds",[39e3]),Mi);function strToPosition(n){const[t,e]=n.split(",").map(Number);return{x:t,y:e}}function strToDimension(n){const[t,e]=n.split("x").map(Number);return{width:t,height:e}}var kr,NDKStorySticker=(kr=class{constructor(t){pe(this,"type");pe(this,"value");pe(this,"position");pe(this,"dimension");pe(this,"properties");pe(this,"hasValidDimensions",()=>typeof this.dimension.width=="number"&&typeof this.dimension.height=="number"&&!Number.isNaN(this.dimension.width)&&!Number.isNaN(this.dimension.height));pe(this,"hasValidPosition",()=>typeof this.position.x=="number"&&typeof this.position.y=="number"&&!Number.isNaN(this.position.x)&&!Number.isNaN(this.position.y));if(Array.isArray(t)){const e=t;if(e[0]!=="sticker"||e.length<5)throw new Error("Invalid sticker tag");this.type=e[1],this.value=e[2],this.position=strToPosition(e[3]),this.dimension=strToDimension(e[4]);const s={};for(let a=5;a<e.length;a++){const[o,...f]=e[a].split(" ");s[o]=f.join(" ")}Object.keys(s).length>0&&(this.properties=s)}else this.type=t,this.value=void 0,this.position={x:0,y:0},this.dimension={width:0,height:0}}static fromTag(t){try{return new kr(t)}catch{return null}}get style(){var t;return(t=this.properties)==null?void 0:t.style}set style(t){var e;t?this.properties={...this.properties,style:t}:(e=this.properties)==null||delete e.style}get rotation(){var t;return(t=this.properties)!=null&&t.rot?Number.parseFloat(this.properties.rot):void 0}set rotation(t){var e;t!==void 0?this.properties={...this.properties,rot:t.toString()}:(e=this.properties)==null||delete e.rot}get isValid(){return this.hasValidDimensions()&&this.hasValidPosition()}toTag(){if(!this.isValid){const s=[this.hasValidDimensions()?void 0:"dimensions is invalid",this.hasValidPosition()?void 0:"position is invalid"].filter(Boolean);throw new Error(`Invalid sticker: ${s.join(", ")}`)}let t;switch(this.type){case"event":t=this.value.tagId();break;case"pubkey":t=this.value.pubkey;break;default:t=this.value}const e=["sticker",this.type,t,coordinates(this.position),dimension(this.dimension)];if(this.properties)for(const[s,a]of Object.entries(this.properties))e.push(`${s} ${a}`);return e}},pe(kr,"Text","text"),pe(kr,"Pubkey","pubkey"),pe(kr,"Event","event"),pe(kr,"Prompt","prompt"),pe(kr,"Countdown","countdown"),kr),Bi,NDKStory=(Bi=class extends NDKEvent{constructor(e,s){super(e,s);pe(this,"_imeta");pe(this,"_dimensions");if(this.kind??(this.kind=23),s)for(const a of s.tags)switch(a[0]){case"imeta":this._imeta=mapImetaTag(a);break;case"dim":this.dimensions=strToDimension(a[1]);break}}static from(e){return new Bi(e.ndk,e)}get isValid(){return!!this.imeta}get imeta(){return this._imeta}set imeta(e){this._imeta=e,this.tags=this.tags.filter(s=>s[0]!=="imeta"),e&&this.tags.push(imetaTagToTag(e))}get dimensions(){const e=this.tagValue("dim");if(e)return strToDimension(e)}set dimensions(e){this.removeTag("dim"),e&&this.tags.push(["dim",`${e.width}x${e.height}`])}get duration(){const e=this.tagValue("dur");if(e)return Number.parseInt(e)}set duration(e){this.removeTag("dur"),e!==void 0&&this.tags.push(["dur",e.toString()])}get stickers(){const e=[];for(const s of this.tags){if(s[0]!=="sticker"||s.length<5)continue;const a=NDKStorySticker.fromTag(s);a&&e.push(a)}return e}addSticker(e){let s;if(e instanceof NDKStorySticker)s=e;else{const a=["sticker",e.type,typeof e.value=="string"?e.value:"",coordinates(e.position),dimension(e.dimension)];if(e.properties)for(const[o,f]of Object.entries(e.properties))a.push(`${o} ${f}`);s=new NDKStorySticker(a),s.value=e.value}s.type==="pubkey"?this.tag(s.value):s.type==="event"&&this.tag(s.value),this.tags.push(s.toTag())}removeSticker(e){const s=this.stickers;if(e<0||e>=s.length)return;let a=0;for(let o=0;o<this.tags.length;o++)if(this.tags[o][0]==="sticker"){if(a===e){this.tags.splice(o,1);break}a++}}},pe(Bi,"kind",23),pe(Bi,"kinds",[23]),Bi),coordinates=n=>`${n.x},${n.y}`,dimension=n=>`${n.width}x${n.height}`,possibleIntervalFrequencies=["daily","weekly","monthly","quarterly","yearly"];function newAmount(n,t,e){return["amount",n.toString(),t,e]}function parseTagToSubscriptionAmount(n){const t=Number.parseInt(n[1]);if(Number.isNaN(t)||t===void 0||t===null||t<=0)return;const e=n[2];if(e===void 0||e==="")return;const s=n[3];if(s!==void 0&&possibleIntervalFrequencies.includes(s))return{amount:t,currency:e,term:s}}var Pi,NDKSubscriptionTier=(Pi=class extends NDKArticle{constructor(t,e){const s=(e==null?void 0:e.kind)??37001;super(t,e),this.kind=s}static from(t){return new Pi(t.ndk,t)}get perks(){return this.getMatchingTags("perk").map(t=>t[1]).filter(t=>t!==void 0)}addPerk(t){this.tags.push(["perk",t])}get amounts(){return this.getMatchingTags("amount").map(t=>parseTagToSubscriptionAmount(t)).filter(t=>t!==void 0)}addAmount(t,e,s){this.tags.push(newAmount(t,e,s))}set relayUrl(t){this.tags.push(["r",t])}get relayUrls(){return this.getMatchingTags("r").map(t=>t[1]).filter(t=>t!==void 0)}get verifierPubkey(){return this.tagValue("p")}set verifierPubkey(t){this.removeTag("p"),t&&this.tags.push(["p",t])}get isValid(){return this.title!==void 0&&this.amounts.length>0}},pe(Pi,"kind",37001),pe(Pi,"kinds",[37001]),Pi),Di,NDKVideo=(Di=class extends NDKEvent{constructor(){super(...arguments);pe(this,"_imetas")}static from(e){return new Di(e.ndk,e.rawEvent())}get title(){return this.tagValue("title")}set title(e){this.removeTag("title"),e&&this.tags.push(["title",e])}get thumbnail(){var s;let e;return this.imetas&&this.imetas.length>0&&(e=(s=this.imetas[0].image)==null?void 0:s[0]),e??this.tagValue("thumb")}get imetas(){return this._imetas?this._imetas:(this._imetas=this.tags.filter(e=>e[0]==="imeta").map(mapImetaTag),this._imetas)}set imetas(e){this._imetas=e,this.tags=this.tags.filter(s=>s[0]!=="imeta"),this.tags.push(...e.map(imetaTagToTag))}get url(){return this.imetas&&this.imetas.length>0?this.imetas[0].url:this.tagValue("url")}get published_at(){const e=this.tagValue("published_at");if(e)return Number.parseInt(e)}async generateTags(){var e,s;if(super.generateTags(),!this.kind&&(s=(e=this.imetas)==null?void 0:e[0])!=null&&s.dim){const[a,o]=this.imetas[0].dim.split("x"),f=a&&o&&Number.parseInt(a)<Number.parseInt(o);this.duration&&this.duration<120&&f?this.kind=22:this.kind=21}return super.generateTags()}get duration(){const e=this.tagValue("duration");if(e)return Number.parseInt(e)}set duration(e){this.removeTag("duration"),e!==void 0&&this.tags.push(["duration",Math.floor(e).toString()])}},pe(Di,"kind",21),pe(Di,"kinds",[34235,34236,22,21]),Di),Oi,NDKWiki=(Oi=class extends NDKArticle{static from(t){return new Oi(t.ndk,t.rawEvent())}get isDefered(){return this.hasTag("a","defer")}get deferedId(){return this.tagValue("a","defer")}set defer(t){this.removeTag("a","defer"),this.tag(t,"defer")}},pe(Oi,"kind",30818),pe(Oi,"kinds",[30818]),Oi),ds,NDKBlossomList=(ds=class extends NDKEvent{constructor(t,e){super(t,e),this.kind??(this.kind=10063)}static from(t){return new ds(t.ndk,t.rawEvent())}get servers(){return this.tags.filter(t=>t[0]==="server").map(t=>t[1])}set servers(t){this.tags=this.tags.filter(e=>e[0]!=="server");for(const e of t)this.tags.push(["server",e])}get default(){const t=this.servers;return t.length>0?t[0]:void 0}set default(t){if(!t)return;const s=this.servers.filter(a=>a!==t);this.servers=[t,...s]}addServer(t){if(!t)return;const e=this.servers;e.includes(t)||(this.servers=[...e,t])}removeServer(t){if(!t)return;const e=this.servers;this.servers=e.filter(s=>s!==t)}},pe(ds,"kinds",[10063]),ds);function wrapEvent(n){const t=new Map;for(const s of[NDKImage,NDKVideo,NDKCashuMintList,NDKArticle,NDKHighlight,NDKWiki,NDKNutzap,NDKSimpleGroupMemberList,NDKSimpleGroupMetadata,NDKSubscriptionTier,NDKCashuToken,NDKList,NDKStory,NDKBlossomList])for(const a of s.kinds)t.set(a,s);const e=t.get(n.kind);return e?e.from(n):n}function queryFullyFilled(n){return!!(filterIncludesIds(n.filter)&&resultHasAllRequestedIds(n))}function filterIncludesIds(n){return!!n.ids}function resultHasAllRequestedIds(n){const t=n.filter.ids;return!!t&&t.length===n.eventFirstSeen.size}function filterFromId(n){let t;if(n.match(NIP33_A_REGEX)){const[e,s,a]=n.split(":"),o={authors:[s],kinds:[Number.parseInt(e)]};return a&&(o["#d"]=[a]),o}if(n.match(BECH32_REGEX))try{switch(t=nip19_exports.decode(n),t.type){case"nevent":{const e={ids:[t.data.id]};return t.data.author&&(e.authors=[t.data.author]),t.data.kind&&(e.kinds=[t.data.kind]),e}case"note":return{ids:[t.data]};case"naddr":{const e={authors:[t.data.pubkey],kinds:[t.data.kind]};return t.data.identifier&&(e["#d"]=[t.data.identifier]),e}}}catch(e){console.error("Error decoding",n,e)}return{ids:[n]}}function isNip33AValue(n){return n.match(NIP33_A_REGEX)!==null}var NIP33_A_REGEX=/^(\d+):([0-9A-Fa-f]+)(?::(.*))?$/,BECH32_REGEX=/^n(event|ote|profile|pub|addr)1[\d\w]+$/;function relaysFromBech32(n,t){try{const e=nip19_exports.decode(n);if(["naddr","nevent"].includes(e==null?void 0:e.type)){const s=e.data;if(s!=null&&s.relays)return s.relays.map(a=>new NDKRelay(a,t.relayAuthDefaultPolicy,t))}}catch{}return[]}var defaultOpts={closeOnEose:!1,cacheUsage:"CACHE_FIRST",dontSaveToCache:!1,groupable:!0,groupableDelay:100,groupableDelayType:"at-most",cacheUnconstrainFilter:["limit","since","until"]},NDKSubscription=class extends libExports.EventEmitter{constructor(t,e,s,a){super();pe(this,"subId");pe(this,"filters");pe(this,"opts");pe(this,"pool");pe(this,"skipVerification",!1);pe(this,"skipValidation",!1);pe(this,"relayFilters");pe(this,"relaySet");pe(this,"ndk");pe(this,"debug");pe(this,"eventFirstSeen",new Map);pe(this,"eosesSeen",new Set);pe(this,"lastEventReceivedAt");pe(this,"mostRecentCacheEventTimestamp");pe(this,"internalId");pe(this,"closeOnEose");pe(this,"poolMonitor");pe(this,"skipOptimisticPublishEvent",!1);pe(this,"cacheUnconstrainFilter");pe(this,"onStopped");pe(this,"eoseTimeout");pe(this,"eosed",!1);this.ndk=t,this.opts={...defaultOpts,...s||{}},this.pool=this.opts.pool||t.pool,this.filters=Array.isArray(e)?e:[e],this.subId=a||this.opts.subId,this.internalId=Math.random().toString(36).substring(7),this.debug=t.debug.extend(`subscription[${this.opts.subId??this.internalId}]`),this.opts.relaySet?this.relaySet=this.opts.relaySet:this.opts.relayUrls&&(this.relaySet=NDKRelaySet.fromRelayUrls(this.opts.relayUrls,this.ndk)),this.skipVerification=this.opts.skipVerification||!1,this.skipValidation=this.opts.skipValidation||!1,this.closeOnEose=this.opts.closeOnEose||!1,this.skipOptimisticPublishEvent=this.opts.skipOptimisticPublishEvent||!1,this.cacheUnconstrainFilter=this.opts.cacheUnconstrainFilter}relaysMissingEose(){var e;return this.relayFilters?Array.from((e=this.relayFilters)==null?void 0:e.keys()).filter(s=>!this.eosesSeen.has(this.pool.getRelay(s,!1,!1))):[]}get filter(){return this.filters[0]}get groupableDelay(){var t;if(this.isGroupable())return(t=this.opts)==null?void 0:t.groupableDelay}get groupableDelayType(){var t;return((t=this.opts)==null?void 0:t.groupableDelayType)||"at-most"}isGroupable(){var t;return((t=this.opts)==null?void 0:t.groupable)||!1}shouldQueryCache(){var e;return this.opts.addSinceFromCache?!0:((e=this.opts)==null?void 0:e.cacheUsage)==="ONLY_RELAY"?!1:(this.filters.some(s=>{var a;return(a=s.kinds)==null?void 0:a.some(o=>kindIsEphemeral(o))}),!0)}shouldQueryRelays(){var t;return((t=this.opts)==null?void 0:t.cacheUsage)!=="ONLY_CACHE"}shouldWaitForCache(){var t;return this.opts.addSinceFromCache?!0:!!this.opts.closeOnEose&&!!((t=this.ndk.cacheAdapter)!=null&&t.locking)&&this.opts.cacheUsage!=="PARALLEL"}start(t=!0){let e;const s=o=>{if(t)for(const f of o)(!this.mostRecentCacheEventTimestamp||f.created_at>this.mostRecentCacheEventTimestamp)&&(this.mostRecentCacheEventTimestamp=f.created_at),this.eventReceived(f,void 0,!0,!1);else{e=[];for(const f of o){(!this.mostRecentCacheEventTimestamp||f.created_at>this.mostRecentCacheEventTimestamp)&&(this.mostRecentCacheEventTimestamp=f.created_at),f.ndk=this.ndk;const p=this.opts.wrap?wrapEvent(f):f;if(!p)break;if(p instanceof Promise){p.then(y=>{this.emitEvent(!1,y,void 0,!0,!1)});break}this.eventFirstSeen.set(p.id,Date.now()),e.push(p)}}},a=()=>{this.shouldQueryRelays()?(this.startWithRelays(),this.startPoolMonitor()):this.emit("eose",this)};return this.shouldQueryCache()?(e=this.startWithCache(),e instanceof Promise?this.shouldWaitForCache()?(e.then(o=>{if(s(o),queryFullyFilled(this)){this.emit("eose",this);return}a()}),null):(e.then(o=>{s(o)}),a(),null):(s(e),queryFullyFilled(this)?this.emit("eose",this):a(),e)):(a(),null)}startPoolMonitor(){this.debug.extend("pool-monitor"),this.poolMonitor=t=>{var s,a;if((s=this.relayFilters)!=null&&s.has(t.url))return;calculateRelaySetsFromFilters(this.ndk,this.filters,this.pool).get(t.url)&&((a=this.relayFilters)==null||a.set(t.url,this.filters),t.subscribe(this,this.filters))},this.pool.on("relay:connect",this.poolMonitor)}stop(){var t;this.emit("close",this),this.poolMonitor&&this.pool.off("relay:connect",this.poolMonitor),(t=this.onStopped)==null||t.call(this)}hasAuthorsFilter(){return this.filters.some(t=>{var e;return(e=t.authors)==null?void 0:e.length})}startWithCache(){var t;return(t=this.ndk.cacheAdapter)!=null&&t.query?this.ndk.cacheAdapter.query(this):[]}startWithRelays(){let t=this.filters;if(this.opts.addSinceFromCache&&this.mostRecentCacheEventTimestamp){const e=this.mostRecentCacheEventTimestamp+1;t=t.map(s=>({...s,since:Math.max(s.since||0,e)}))}if(!this.relaySet||this.relaySet.relays.size===0)this.relayFilters=calculateRelaySetsFromFilters(this.ndk,t,this.pool);else{this.relayFilters=new Map;for(const e of this.relaySet.relays)this.relayFilters.set(e.url,t)}for(const[e,s]of this.relayFilters)this.pool.getRelay(e,!0,!0,s).subscribe(this,s)}eventReceived(t,e,s=!1,a=!1){var y;const o=t.id,f=this.eventFirstSeen.has(o);let p;if(t instanceof NDKEvent&&(p=t),f){const g=Date.now()-(this.eventFirstSeen.get(o)||0);if(this.emit("event:dup",t,e,g,this,s,a),e){const x=verifiedSignatures.get(o);if(x&&typeof x=="string")if(t.sig===x)e.addValidatedEvent();else{const E=t instanceof NDKEvent?t:new NDKEvent(this.ndk,t);this.ndk.reportInvalidSignature(E,e)}}}else{if(p??(p=new NDKEvent(this.ndk,t)),p.ndk=this.ndk,p.relay=e,!s&&!a){if(!this.skipValidation&&!p.isValid){this.debug("Event failed validation %s from relay %s",o,e==null?void 0:e.url);return}if(e)if(e.shouldValidateEvent()&&!this.skipVerification){if(p.relay=e,!this.ndk.asyncSigVerification){if(!p.verifySignature(!0)){this.debug("Event failed signature validation",t),this.ndk.reportInvalidSignature(p,e);return}e.addValidatedEvent()}}else e.addNonValidatedEvent();this.ndk.cacheAdapter&&!this.opts.dontSaveToCache&&this.ndk.cacheAdapter.setEvent(p,this.filters,e)}(!a||this.skipOptimisticPublishEvent!==!0)&&(this.emitEvent(((y=this.opts)==null?void 0:y.wrap)??!1,p,e,s,a),this.eventFirstSeen.set(o,Date.now()))}this.lastEventReceivedAt=Date.now()}emitEvent(t,e,s,a,o){const f=t?wrapEvent(e):e;f instanceof Promise?f.then(p=>this.emitEvent(!1,p,s,a,o)):f&&this.emit("event",f,s,this,a,o)}closedReceived(t,e){this.emit("closed",t,e)}eoseReceived(t){var f;this.debug("EOSE received from %s",t.url),this.eosesSeen.add(t);let e=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0;const s=this.eosesSeen.size===((f=this.relayFilters)==null?void 0:f.size),a=queryFullyFilled(this),o=p=>{var y;this.debug("Performing EOSE: %s %d",p,this.eosed),!this.eosed&&(this.eoseTimeout&&clearTimeout(this.eoseTimeout),this.emit("eose",this),this.eosed=!0,(y=this.opts)!=null&&y.closeOnEose&&this.stop())};if(a||s)o("query filled or seen all");else if(this.relayFilters){let p=1e3;const y=new Set(this.pool.connectedRelays().map(E=>E.url)),g=Array.from(this.relayFilters.keys()).filter(E=>y.has(E));if(g.length===0){this.debug("No connected relays, waiting for all relays to connect",Array.from(this.relayFilters.keys()).join(", "));return}const x=this.eosesSeen.size/g.length;if(this.debug("Percentage of relays that have sent EOSE",{subId:this.subId,percentageOfRelaysThatHaveSentEose:x,seen:this.eosesSeen.size,total:g.length}),this.eosesSeen.size>=2&&x>=.5){if(p=p*(1-x),p===0){o("time to wait was 0");return}this.eoseTimeout&&clearTimeout(this.eoseTimeout);const E=()=>{e=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0,e!==void 0&&e<20?this.eoseTimeout=setTimeout(E,p):o(`send eose timeout: ${p}`)};this.eoseTimeout=setTimeout(E,p)}}}},kindIsEphemeral=n=>n>=2e4&&n<3e4;async function follows(n,t,e=3){var a,o;if(!this.ndk)throw new Error("NDK not set");const s=await this.ndk.fetchEvent({kinds:[e],authors:[this.pubkey]},n||{groupable:!1});if(s){const f=new Set;return s.tags.forEach(p=>{p[0]==="p"&&f.add(p[1])}),t&&((o=(a=this.ndk)==null?void 0:a.outboxTracker)==null||o.trackUsers(Array.from(f))),[...f].reduce((p,y)=>{const g=new NDKUser({pubkey:y});return g.ndk=this.ndk,p.add(g),p},new Set)}return new Set}var NIP05_REGEX=/^(?:([\w.+-]+)@)?([\w.-]+)$/;async function getNip05For(n,t,e=fetch,s={}){return await n.queuesNip05.add({id:t,func:async()=>{var y,g,x;if((y=n.cacheAdapter)!=null&&y.loadNip05){const E=await n.cacheAdapter.loadNip05(t);if(E!=="missing"){if(E){const A=new NDKUser({pubkey:E.pubkey,relayUrls:E.relays,nip46Urls:E.nip46});return A.ndk=n,A}if(s.cache!=="no-cache")return null}}const a=t.match(NIP05_REGEX);if(!a)return null;const[o,f="_",p]=a;try{const E=await e(`https://${p}/.well-known/nostr.json?name=${f}`,s),{names:A,relays:S,nip46:I}=parseNIP05Result(await E.json()),_=A[f.toLowerCase()];let R=null;return _&&(R={pubkey:_,relays:S==null?void 0:S[_],nip46:I==null?void 0:I[_]}),(g=n==null?void 0:n.cacheAdapter)!=null&&g.saveNip05&&n.cacheAdapter.saveNip05(t,R),R}catch(E){return(x=n==null?void 0:n.cacheAdapter)!=null&&x.saveNip05&&(n==null||n.cacheAdapter.saveNip05(t,null)),console.error("Failed to fetch NIP05 for",t,E),null}}})}function parseNIP05Result(n){const t={names:{}};for(const[e,s]of Object.entries(n.names))typeof e=="string"&&typeof s=="string"&&(t.names[e.toLowerCase()]=s);if(n.relays){t.relays={};for(const[e,s]of Object.entries(n.relays))typeof e=="string"&&Array.isArray(s)&&(t.relays[e]=s.filter(a=>typeof a=="string"))}if(n.nip46){t.nip46={};for(const[e,s]of Object.entries(n.nip46))typeof e=="string"&&Array.isArray(s)&&(t.nip46[e]=s.filter(a=>typeof a=="string"))}return t}function profileFromEvent(n){const t={};let e;try{e=JSON.parse(n.content)}catch(s){throw new Error(`Failed to parse profile event: ${s}`)}t.profileEvent=JSON.stringify(n.rawEvent());for(const s of Object.keys(e))switch(s){case"name":t.name=e.name;break;case"display_name":t.displayName=e.display_name;break;case"image":case"picture":t.picture=e.picture||e.image,t.image=t.picture;break;case"banner":t.banner=e.banner;break;case"bio":t.bio=e.bio;break;case"nip05":t.nip05=e.nip05;break;case"lud06":t.lud06=e.lud06;break;case"lud16":t.lud16=e.lud16;break;case"about":t.about=e.about;break;case"website":t.website=e.website;break;default:t[s]=e[s];break}return t.created_at=n.created_at,t}function serializeProfile(n){const t={};for(const[e,s]of Object.entries(n))switch(e){case"username":case"name":t.name=s;break;case"displayName":t.display_name=s;break;case"image":case"picture":t.picture=s;break;case"bio":case"about":t.about=s;break;default:t[e]=s;break}return JSON.stringify(t)}var NDKUser=class Xu{constructor(t){pe(this,"ndk");pe(this,"profile");pe(this,"profileEvent");pe(this,"_npub");pe(this,"_pubkey");pe(this,"relayUrls",[]);pe(this,"nip46Urls",[]);pe(this,"follows",follows.bind(this));if(t.npub&&(this._npub=t.npub),t.hexpubkey&&(this._pubkey=t.hexpubkey),t.pubkey&&(this._pubkey=t.pubkey),t.relayUrls&&(this.relayUrls=t.relayUrls),t.nip46Urls&&(this.nip46Urls=t.nip46Urls),t.nprofile)try{const e=nip19_exports.decode(t.nprofile);e.type==="nprofile"&&(this._pubkey=e.data.pubkey,e.data.relays&&e.data.relays.length>0&&this.relayUrls.push(...e.data.relays))}catch(e){console.error("Failed to decode nprofile",e)}}get npub(){if(!this._npub){if(!this._pubkey)throw new Error("pubkey not set");this._npub=nip19_exports.npubEncode(this.pubkey)}return this._npub}get nprofile(){var e,s;const t=(s=(e=this.profileEvent)==null?void 0:e.onRelays)==null?void 0:s.map(a=>a.url);return nip19_exports.nprofileEncode({pubkey:this.pubkey,relays:t})}set npub(t){this._npub=t}get pubkey(){if(!this._pubkey){if(!this._npub)throw new Error("npub not set");this._pubkey=nip19_exports.decode(this.npub).data}return this._pubkey}set pubkey(t){this._pubkey=t}filter(){return{"#p":[this.pubkey]}}async getZapInfo(t){if(!this.ndk)throw new Error("No NDK instance found");const e=async f=>{if(!t)return f;let p;const y=new Promise((g,x)=>{p=setTimeout(()=>x(new Error("Timeout")),t)});try{const g=await Promise.race([f,y]);return p&&clearTimeout(p),g}catch(g){if(g instanceof Error&&g.message==="Timeout")try{return await f}catch{return}return}},[s,a]=await Promise.all([e(this.fetchProfile()),e(this.ndk.fetchEvent({kinds:[10019],authors:[this.pubkey]}))]),o=new Map;if(a){const f=NDKCashuMintList.from(a);f.mints.length>0&&o.set("nip61",{mints:f.mints,relays:f.relays,p2pk:f.p2pk})}if(s){const{lud06:f,lud16:p}=s;o.set("nip57",{lud06:f,lud16:p})}return o}static async fromNip05(t,e,s=!1){if(!e)throw new Error("No NDK instance found");const a={};s&&(a.cache="no-cache");const o=await getNip05For(e,t,e==null?void 0:e.httpFetch,a);if(o){const f=new Xu({pubkey:o.pubkey,relayUrls:o.relays,nip46Urls:o.nip46});return f.ndk=e,f}}async fetchProfile(t,e=!1){if(!this.ndk)throw new Error("NDK not set");let s=null;if(this.ndk.cacheAdapter&&(this.ndk.cacheAdapter.fetchProfile||this.ndk.cacheAdapter.fetchProfileSync)&&(t==null?void 0:t.cacheUsage)!=="ONLY_RELAY"){let a=null;if(this.ndk.cacheAdapter.fetchProfileSync?a=this.ndk.cacheAdapter.fetchProfileSync(this.pubkey):this.ndk.cacheAdapter.fetchProfile&&(a=await this.ndk.cacheAdapter.fetchProfile(this.pubkey)),a)return this.profile=a,a}return t??(t={}),t.cacheUsage??(t.cacheUsage="ONLY_RELAY"),t.closeOnEose??(t.closeOnEose=!0),t.groupable??(t.groupable=!0),t.groupableDelay??(t.groupableDelay=250),s||(s=await this.ndk.fetchEvent({kinds:[0],authors:[this.pubkey]},t)),s?(this.profile=profileFromEvent(s),e&&this.profile&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.saveProfile&&this.ndk.cacheAdapter.saveProfile(this.pubkey,this.profile),this.profile):null}async followSet(t,e,s=3){const a=await this.follows(t,e,s);return new Set(Array.from(a).map(o=>o.pubkey))}tagReference(){return["p",this.pubkey]}referenceTags(t){const e=[["p",this.pubkey]];return t&&e[0].push("",t),e}async publish(){if(!this.ndk)throw new Error("No NDK instance found");if(!this.profile)throw new Error("No profile available");this.ndk.assertSigner(),await new NDKEvent(this.ndk,{kind:0,content:serializeProfile(this.profile)}).publish()}async follow(t,e,s=3){if(!this.ndk)throw new Error("No NDK instance found");if(this.ndk.assertSigner(),e||(e=await this.follows(void 0,void 0,s)),e.has(t))return!1;e.add(t);const a=new NDKEvent(this.ndk,{kind:s});for(const o of e)a.tag(o);return await a.publish(),!0}async unfollow(t,e,s=3){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),e||(e=await this.follows(void 0,void 0,s));const a=new Set;let o=!1;for(const p of e)p.pubkey!==t.pubkey?a.add(p):o=!0;if(!o)return!1;const f=new NDKEvent(this.ndk,{kind:s});for(const p of a)f.tag(p);return await f.publish()}async validateNip05(t){if(!this.ndk)throw new Error("No NDK instance found");const e=await getNip05For(this.ndk,t);return e===null?null:e.pubkey===this.pubkey}},MARKERS={REDEEMED:"redeemed",CREATED:"created",DESTROYED:"destroyed",RESERVED:"reserved"},Jr,NDKCashuWalletTx=(Jr=class extends NDKEvent{constructor(t,e){super(t,e),this.kind??(this.kind=7376)}static async from(t){const e=new Jr(t.ndk,t),s=e.content;try{await e.decrypt()}catch{e.content??(e.content=s)}try{const a=JSON.parse(e.content);e.tags=[...a,...e.tags]}catch{return}return e}set direction(t){this.removeTag("direction"),t&&this.tags.push(["direction",t])}get direction(){return this.tagValue("direction")}set amount(t){this.removeTag("amount"),this.tags.push(["amount",t.toString()])}get amount(){const t=this.tagValue("amount");if(t!==void 0)return Number(t)}set fee(t){this.removeTag("fee"),this.tags.push(["fee",t.toString()])}get fee(){const t=this.tagValue("fee");if(t!==void 0)return Number(t)}set unit(t){this.removeTag("unit"),t&&this.tags.push(["unit",t.toString()])}get unit(){return this.tagValue("unit")}set description(t){this.removeTag("description"),t&&this.tags.push(["description",t.toString()])}get description(){return this.tagValue("description")}set mint(t){this.removeTag("mint"),t&&this.tags.push(["mint",t.toString()])}get mint(){return this.tagValue("mint")}set destroyedTokens(t){for(const e of t)this.tags.push(e.tagReference(MARKERS.DESTROYED))}set destroyedTokenIds(t){for(const e of t)this.tags.push(["e",e,"",MARKERS.DESTROYED])}set createdTokens(t){for(const e of t)this.tags.push(e.tagReference(MARKERS.CREATED))}set reservedTokens(t){for(const e of t)this.tags.push(e.tagReference(MARKERS.RESERVED))}addRedeemedNutzap(t){this.tag(t,MARKERS.REDEEMED)}async toNostrEvent(t){var o,f;const e=[],s=[];for(const p of this.tags)this.shouldEncryptTag(p)?e.push(p):s.push(p);this.tags=s.filter(p=>p[0]!=="client"),this.content=JSON.stringify(e);const a=await((f=(o=this.ndk)==null?void 0:o.signer)==null?void 0:f.user());if(a){const p=a.pubkey;this.tags=this.tags.filter(y=>y[0]!=="p"||y[1]!==p)}return await this.encrypt(a,void 0,"nip44"),super.toNostrEvent(t)}get hasNutzapRedemption(){return this.getMatchingTags("e",MARKERS.REDEEMED).length>0}shouldEncryptTag(t){return!(["client"].includes(t[0])||t[0]==="e"&&t[3]===MARKERS.REDEEMED||t[0]==="p")}},pe(Jr,"MARKERS",MARKERS),pe(Jr,"kind",7376),pe(Jr,"kinds",[7376]),Jr),READ_MARKER="read",WRITE_MARKER="write",NDKRelayList=class Zu extends NDKEvent{constructor(t,e){super(t,e),this.kind??(this.kind=10002)}static from(t){return new Zu(t.ndk,t.rawEvent())}get readRelayUrls(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").filter(t=>!t[2]||t[2]&&t[2]===READ_MARKER).map(t=>tryNormalizeRelayUrl(t[1])).filter(t=>!!t)}set readRelayUrls(t){for(const e of t)this.tags.push(["r",e,READ_MARKER])}get writeRelayUrls(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").filter(t=>!t[2]||t[2]&&t[2]===WRITE_MARKER).map(t=>tryNormalizeRelayUrl(t[1])).filter(t=>!!t)}set writeRelayUrls(t){for(const e of t)this.tags.push(["r",e,WRITE_MARKER])}get bothRelayUrls(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").filter(t=>!t[2]).map(t=>t[1])}set bothRelayUrls(t){for(const e of t)this.tags.push(["r",e])}get relays(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").map(t=>t[1])}get relaySet(){if(!this.ndk)throw new Error("NDKRelayList has no NDK instance");return new NDKRelaySet(new Set(this.relays.map(t=>{var e;return(e=this.ndk)==null?void 0:e.pool.getRelay(t)}).filter(t=>!!t)),this.ndk)}};function relayListFromKind3(n,t){try{const e=JSON.parse(t.content),s=new NDKRelayList(n),a=new Set,o=new Set;for(let[f,p]of Object.entries(e)){try{f=normalizeRelayUrl(f)}catch{continue}if(!p)a.add(f),o.add(f);else{const y=p;y.write&&o.add(f),y.read&&a.add(f)}}return s.readRelayUrls=Array.from(a),s.writeRelayUrls=Array.from(o),s}catch{}}var signerRegistry=new Map;function registerSigner(n,t){signerRegistry.set(n,t)}var NDKPrivateKeySigner=class rc{constructor(t,e){pe(this,"_user");pe(this,"_privateKey");pe(this,"_pubkey");if(typeof t=="string")if(t.startsWith("nsec1")){const{type:s,data:a}=nip19_exports.decode(t);if(s==="nsec")this._privateKey=a;else throw new Error("Invalid private key provided.")}else if(t.length===64)this._privateKey=hexToBytes$1(t);else throw new Error("Invalid private key provided.");else this._privateKey=t;this._pubkey=getPublicKey(this._privateKey),e&&(this._user=e.getUser({pubkey:this._pubkey})),this._user??(this._user=new NDKUser({pubkey:this._pubkey}))}get privateKey(){if(!this._privateKey)throw new Error("Not ready");return bytesToHex$1(this._privateKey)}get pubkey(){if(!this._pubkey)throw new Error("Not ready");return this._pubkey}get nsec(){if(!this._privateKey)throw new Error("Not ready");return nip19_exports.nsecEncode(this._privateKey)}get npub(){if(!this._pubkey)throw new Error("Not ready");return nip19_exports.npubEncode(this._pubkey)}static generate(){const t=generateSecretKey();return new rc(t)}async blockUntilReady(){return this._user}async user(){return this._user}get userSync(){return this._user}async sign(t){if(!this._privateKey)throw Error("Attempted to sign without a private key");return finalizeEvent(t,this._privateKey).sig}async encryptionEnabled(t){const e=[];return(!t||t==="nip04")&&e.push("nip04"),(!t||t==="nip44")&&e.push("nip44"),e}async encrypt(t,e,s){if(!this._privateKey||!this.privateKey)throw Error("Attempted to encrypt without a private key");const a=t.pubkey;if(s==="nip44"){const o=nip44_exports.v2.utils.getConversationKey(this._privateKey,a);return await nip44_exports.v2.encrypt(e,o)}return await nip04_exports.encrypt(this._privateKey,a,e)}async decrypt(t,e,s){if(!this._privateKey||!this.privateKey)throw Error("Attempted to decrypt without a private key");const a=t.pubkey;if(s==="nip44"){const o=nip44_exports.v2.utils.getConversationKey(this._privateKey,a);return await nip44_exports.v2.decrypt(e,o)}return await nip04_exports.decrypt(this._privateKey,a,e)}toPayload(){if(!this._privateKey)throw new Error("Private key not available");const t={type:"private-key",payload:this.privateKey};return JSON.stringify(t)}static async fromPayload(t,e){const s=JSON.parse(t);if(s.type!=="private-key")throw new Error(`Invalid payload type: expected 'private-key', got ${s.type}`);if(!s.payload||typeof s.payload!="string")throw new Error("Invalid payload content for private-key signer");return new rc(s.payload,e)}};registerSigner("private-key",NDKPrivateKeySigner);function disconnect(n,t){return t??(t=createDebug3("ndk:relay:auth-policies:disconnect")),async e=>{t==null||t(`Relay ${e.url} requested authentication, disconnecting`),n.removeRelay(e.url)}}async function signAndAuth(n,t,e,s,a,o){try{await n.sign(e),a(n)}catch(f){s==null||s(`Failed to publish auth event to relay ${t.url}`,f),o(n)}}function signIn({ndk:n,signer:t,debug:e}={}){return e??(e=createDebug3("ndk:auth-policies:signIn")),async(s,a)=>{e==null||e(`Relay ${s.url} requested authentication, signing in`);const o=new NDKEvent(n);return o.kind=22242,o.tags=[["relay",s.url],["challenge",a]],t??(t=n==null?void 0:n.signer),new Promise(async(f,p)=>{t?await signAndAuth(o,s,t,e,f,p):n==null||n.once("signer:ready",async y=>{await signAndAuth(o,s,y,e,f,p)})})}}var NDKRelayAuthPolicies={disconnect,signIn},NDKNip07Signer=class Ju{constructor(t=1e3,e){pe(this,"_userPromise");pe(this,"encryptionQueue",[]);pe(this,"encryptionProcessing",!1);pe(this,"debug");pe(this,"waitTimeout");pe(this,"_pubkey");pe(this,"ndk");pe(this,"_user");this.debug=createDebug3("ndk:nip07"),this.waitTimeout=t,this.ndk=e}get pubkey(){if(!this._pubkey)throw new Error("Not ready");return this._pubkey}async blockUntilReady(){var s;await this.waitForExtension();const t=await((s=window.nostr)==null?void 0:s.getPublicKey());if(!t)throw new Error("User rejected access");this._pubkey=t;let e;return this.ndk?e=this.ndk.getUser({pubkey:t}):e=new NDKUser({pubkey:t}),this._user=e,e}async user(){return this._userPromise||(this._userPromise=this.blockUntilReady()),this._userPromise}get userSync(){if(!this._user)throw new Error("User not ready");return this._user}async sign(t){var s;await this.waitForExtension();const e=await((s=window.nostr)==null?void 0:s.signEvent(t));if(!e)throw new Error("Failed to sign event");return e.sig}async relays(t){var a,o;await this.waitForExtension();const e=await((o=(a=window.nostr)==null?void 0:a.getRelays)==null?void 0:o.call(a))||{},s=[];for(const f of Object.keys(e))e[f].read&&e[f].write&&s.push(f);return s.map(f=>new NDKRelay(f,t==null?void 0:t.relayAuthDefaultPolicy,t))}async encryptionEnabled(t){var s,a;const e=[];return(!t||t==="nip04")&&((s=window.nostr)!=null&&s.nip04)&&e.push("nip04"),(!t||t==="nip44")&&((a=window.nostr)!=null&&a.nip44)&&e.push("nip44"),e}async encrypt(t,e,s="nip04"){if(!await this.encryptionEnabled(s))throw new Error(`${s}encryption is not available from your browser extension`);await this.waitForExtension();const a=t.pubkey;return this.queueEncryption(s,"encrypt",a,e)}async decrypt(t,e,s="nip04"){if(!await this.encryptionEnabled(s))throw new Error(`${s}encryption is not available from your browser extension`);await this.waitForExtension();const a=t.pubkey;return this.queueEncryption(s,"decrypt",a,e)}async queueEncryption(t,e,s,a){return new Promise((o,f)=>{this.encryptionQueue.push({scheme:t,method:e,counterpartyHexpubkey:s,value:a,resolve:o,reject:f}),this.encryptionProcessing||this.processEncryptionQueue()})}async processEncryptionQueue(t,e=0){var x,E;if(!t&&this.encryptionQueue.length===0){this.encryptionProcessing=!1;return}this.encryptionProcessing=!0;const s=t||this.encryptionQueue.shift();if(!s){this.encryptionProcessing=!1;return}const{scheme:a,method:o,counterpartyHexpubkey:f,value:p,resolve:y,reject:g}=s;this.debug("Processing encryption queue item",{method:o,counterpartyHexpubkey:f,value:p});try{const A=await((E=(x=window.nostr)==null?void 0:x[a])==null?void 0:E[o](f,p));if(!A)throw new Error("Failed to encrypt/decrypt");y(A)}catch(A){const S=A instanceof Error?A.message:String(A);if(S.includes("call already executing")&&e<5){this.debug("Retrying encryption queue item",{method:o,counterpartyHexpubkey:f,value:p,retries:e}),setTimeout(()=>{this.processEncryptionQueue(s,e+1)},50*e);return}g(A instanceof Error?A:new Error(S))}this.processEncryptionQueue()}waitForExtension(){return new Promise((t,e)=>{if(window.nostr){t();return}let s;const a=setInterval(()=>{window.nostr&&(clearTimeout(s),clearInterval(a),t())},100);s=setTimeout(()=>{clearInterval(a),e(new Error("NIP-07 extension not available"))},this.waitTimeout)})}toPayload(){return JSON.stringify({type:"nip07",payload:""})}static async fromPayload(t,e){const s=JSON.parse(t);if(s.type!=="nip07")throw new Error(`Invalid payload type: expected 'nip07', got ${s.type}`);return new Ju(void 0,e)}};registerSigner("nip07",NDKNip07Signer);var NDKNostrRpc=class extends libExports.EventEmitter{constructor(t,e,s,a){super();pe(this,"ndk");pe(this,"signer");pe(this,"relaySet");pe(this,"debug");pe(this,"encryptionType","nip04");pe(this,"pool");if(this.ndk=t,this.signer=e,a){this.pool=new NDKPool(a,[],t,{debug:s.extend("rpc-pool"),name:"Nostr RPC"}),this.relaySet=new NDKRelaySet(new Set,t,this.pool);for(const o of a){const f=this.pool.getRelay(o,!1,!1);f.authPolicy=NDKRelayAuthPolicies.signIn({ndk:t,signer:e,debug:s}),this.relaySet.addRelay(f),f.connect()}}this.debug=s.extend("rpc")}subscribe(t){const e=this.ndk.subscribe(t,{closeOnEose:!1,groupable:!1,cacheUsage:"ONLY_RELAY",pool:this.pool,relaySet:this.relaySet},!1);return e.on("event",async s=>{console.log("Received event",s.rawEvent());try{const a=await this.parseEvent(s);a.method?(console.log("Received request",a),this.emit("request",a)):(console.log("Received response",a),this.emit(`response-${a.id}`,a),this.emit("response",a))}catch(a){this.debug("error parsing event",a,s.rawEvent())}}),new Promise(s=>{e.on("eose",()=>{this.debug("eosed"),s(e)}),e.start()})}async parseEvent(t){this.encryptionType==="nip44"&&t.content.includes("?iv=")?this.encryptionType="nip04":this.encryptionType==="nip04"&&!t.content.includes("?iv=")&&(this.encryptionType="nip44");const e=this.ndk.getUser({pubkey:t.pubkey});e.ndk=this.ndk;let s;try{s=await this.signer.decrypt(e,t.content,this.encryptionType)}catch{const E=this.encryptionType==="nip04"?"nip44":"nip04";s=await this.signer.decrypt(e,t.content,E),this.encryptionType=E}const a=JSON.parse(s),{id:o,method:f,params:p,result:y,error:g}=a;return f?{id:o,pubkey:t.pubkey,method:f,params:p,event:t}:{id:o,result:y,error:g,event:t}}async sendResponse(t,e,s,a=24133,o){const f={id:t,result:s};o&&(f.error=o);const p=await this.signer.user(),y=this.ndk.getUser({pubkey:e}),g=new NDKEvent(this.ndk,{kind:a,content:JSON.stringify(f),tags:[["p",e]],pubkey:p.pubkey});g.content=await this.signer.encrypt(y,g.content,this.encryptionType),await g.sign(this.signer),await g.publish(this.relaySet)}async sendRequest(t,e,s=[],a=24133,o){console.log("Sending request",e,s);const f=Math.random().toString(36).substring(7),p=await this.signer.user(),y=this.ndk.getUser({pubkey:t}),g={id:f,method:e,params:s},x=new Promise(()=>{const A=S=>{S.result==="auth_url"?(this.once(`response-${f}`,A),this.emit("authUrl",S.error)):o&&o(S)};this.once(`response-${f}`,A)});console.log("Sending request",g);const E=new NDKEvent(this.ndk,{kind:a,content:JSON.stringify(g),tags:[["p",t]],pubkey:p.pubkey});return E.content=await this.signer.encrypt(y,E.content,this.encryptionType),await E.sign(this.signer),await E.publish(this.relaySet),x}};async function ndkSignerFromPayload(n,t){let e;try{e=JSON.parse(n)}catch(a){console.error("Failed to parse signer payload string",n,a);return}if(!e||typeof e.type!="string"){console.error("Failed to parse signer payload string",n,new Error("Missing type field"));return}const s=signerRegistry.get(e.type);if(!s)throw new Error(`Unknown signer type: ${e.type}`);try{return await s.fromPayload(n,t)}catch(a){const o=a instanceof Error?a.message:String(a);throw new Error(`Failed to deserialize signer type ${e.type}: ${o}`)}}function nostrConnectGenerateSecret(){return Math.random().toString(36).substring(2,15)}function generateNostrConnectUri(n,t,e,s){const a={name:s!=null&&s.name?encodeURIComponent(s.name):"",url:s!=null&&s.url?encodeURIComponent(s.url):"",image:s!=null&&s.image?encodeURIComponent(s.image):"",perms:s!=null&&s.perms?encodeURIComponent(s.perms):""};let o=`nostrconnect://${n}?image=${a.image}&url=${a.url}&name=${a.name}&perms=${a.perms}&secret=${encodeURIComponent(t)}`;return e&&(o+=`&relay=${encodeURIComponent(e)}`),o}var NDKNip46Signer=class Oa extends libExports.EventEmitter{constructor(e,s,a,o,f){super();pe(this,"ndk");pe(this,"_user");pe(this,"bunkerPubkey");pe(this,"userPubkey");pe(this,"secret");pe(this,"localSigner");pe(this,"nip05");pe(this,"rpc");pe(this,"debug");pe(this,"relayUrls");pe(this,"subscription");pe(this,"nostrConnectUri");pe(this,"nostrConnectSecret");this.ndk=e,this.debug=e.debug.extend("nip46:signer"),this.relayUrls=o,a?typeof a=="string"?this.localSigner=new NDKPrivateKeySigner(a):this.localSigner=a:this.localSigner=NDKPrivateKeySigner.generate(),s===!1||(s?s.startsWith("bunker://")?this.bunkerFlowInit(s):this.nip05Init(s):this.nostrconnectFlowInit(f)),this.rpc=new NDKNostrRpc(this.ndk,this.localSigner,this.debug,this.relayUrls)}get pubkey(){if(!this.userPubkey)throw new Error("Not ready");return this.userPubkey}static bunker(e,s,a){return new Oa(e,s,a)}static nostrconnect(e,s,a,o){return new Oa(e,void 0,a,[s],o)}nostrconnectFlowInit(e){var a;this.nostrConnectSecret=nostrConnectGenerateSecret();const s=this.localSigner.pubkey;this.nostrConnectUri=generateNostrConnectUri(s,this.nostrConnectSecret,(a=this.relayUrls)==null?void 0:a[0],e)}bunkerFlowInit(e){const s=new URL(e),a=s.hostname||s.pathname.replace(/^\/\//,""),o=s.searchParams.get("pubkey"),f=s.searchParams.getAll("relay"),p=s.searchParams.get("secret");this.bunkerPubkey=a,this.userPubkey=o,this.relayUrls=f,this.secret=p}nip05Init(e){this.nip05=e}async startListening(){if(this.subscription)return;const e=await this.localSigner.user();if(!e)throw new Error("Local signer not ready");this.subscription=await this.rpc.subscribe({kinds:[24133],"#p":[e.pubkey]})}async user(){return this._user?this._user:this.blockUntilReady()}get userSync(){if(!this._user)throw new Error("Remote user not ready synchronously");return this._user}async blockUntilReadyNostrConnect(){return new Promise((e,s)=>{const a=o=>{o.result===this.nostrConnectSecret&&(this._user=o.event.author,this.userPubkey=o.event.pubkey,this.bunkerPubkey=o.event.pubkey,this.rpc.off("response",a),e(this._user))};this.startListening(),this.rpc.on("response",a)})}async blockUntilReady(){if(!this.bunkerPubkey&&!this.nostrConnectSecret&&!this.nip05)throw new Error("Bunker pubkey not set");if(this.nostrConnectSecret)return this.blockUntilReadyNostrConnect();if(this.nip05&&!this.userPubkey){const e=await NDKUser.fromNip05(this.nip05,this.ndk);e&&(this._user=e,this.userPubkey=e.pubkey,this.relayUrls=e.nip46Urls,this.rpc=new NDKNostrRpc(this.ndk,this.localSigner,this.debug,this.relayUrls))}if(!this.bunkerPubkey&&this.userPubkey)this.bunkerPubkey=this.userPubkey;else if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");return await this.startListening(),this.rpc.on("authUrl",(...e)=>{this.emit("authUrl",...e)}),new Promise((e,s)=>{const a=[this.userPubkey??""];if(this.secret&&a.push(this.secret),!this.bunkerPubkey)throw new Error("Bunker pubkey not set");console.log("sending connect"),this.rpc.sendRequest(this.bunkerPubkey,"connect",a,24133,o=>{o.result==="ack"?this.getPublicKey().then(f=>{this.userPubkey=f,this._user=this.ndk.getUser({pubkey:f}),e(this._user)}):s(o.error)})})}stop(){var e;(e=this.subscription)==null||e.stop(),this.subscription=void 0}async getPublicKey(){return this.userPubkey?this.userPubkey:new Promise((e,s)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"get_public_key",[],24133,a=>{e(a.result)})})}async encryptionEnabled(e){return e?[e]:Promise.resolve(["nip04","nip44"])}async encrypt(e,s,a="nip04"){return this.encryption(e,s,a,"encrypt")}async decrypt(e,s,a="nip04"){return this.encryption(e,s,a,"decrypt")}async encryption(e,s,a,o){return new Promise((p,y)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,`${a}_${o}`,[e.pubkey,s],24133,g=>{g.error?y(g.error):p(g.result)})})}async sign(e){return new Promise((a,o)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"sign_event",[JSON.stringify(e)],24133,f=>{if(f.error)o(f.error);else{const p=JSON.parse(f.result);a(p.sig)}})})}async createAccount(e,s,a){await this.startListening();const o=[];return e&&o.push(e),s&&o.push(s),a&&o.push(a),new Promise((f,p)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"create_account",o,24133,y=>{if(y.error)p(y.error);else{const g=y.result;f(g)}})})}toPayload(){if(!this.bunkerPubkey||!this.userPubkey)throw new Error("NIP-46 signer is not fully initialized for serialization");const e={type:"nip46",payload:{bunkerPubkey:this.bunkerPubkey,userPubkey:this.userPubkey,relayUrls:this.relayUrls,secret:this.secret,localSignerPayload:this.localSigner.toPayload(),nip05:this.nip05||null}};return JSON.stringify(e)}static async fromPayload(e,s){if(console.log("from payload",e),!s)throw new Error("NDK instance is required to deserialize NIP-46 signer");const a=JSON.parse(e);if(a.type!=="nip46")throw new Error(`Invalid payload type: expected 'nip46', got ${a.type}`);const o=a.payload;if(!o||typeof o!="object"||!o.localSignerPayload)throw new Error("Invalid payload content for nip46 signer");const f=await ndkSignerFromPayload(o.localSignerPayload,s);if(!f)throw new Error("Failed to deserialize local signer for NIP-46");if(!(f instanceof NDKPrivateKeySigner))throw new Error("Local signer must be an instance of NDKPrivateKeySigner");let p;return console.log("restore payload",o),p=new Oa(s,!1,f,o.relayUrls),p.userPubkey=o.userPubkey,p.bunkerPubkey=o.bunkerPubkey,p.relayUrls=o.relayUrls,p.secret=o.secret,o.userPubkey&&(p._user=new NDKUser({pubkey:o.userPubkey}),p._user&&(p._user.ndk=s)),p}};registerSigner("nip46",NDKNip46Signer);function dedup(n,t){return n.created_at>t.created_at?n:t}async function getRelayListForUser(n,t){return(await getRelayListForUsers([n],t)).get(n)}async function getRelayListForUsers(n,t,e=!1,s=1e3){var E;const a=t.outboxPool||t.pool,o=new Set;for(const A of a.relays.values())o.add(A);const f=new Map,p=new Map,y=new NDKRelaySet(o,t);if((E=t.cacheAdapter)!=null&&E.locking&&!e){const A=await t.fetchEvents({kinds:[3,10002],authors:Array.from(new Set(n))},{cacheUsage:"ONLY_CACHE",subId:"ndk-relay-list-fetch"});for(const S of A)S.kind===10002&&f.set(S.pubkey,NDKRelayList.from(S));for(const S of A)if(S.kind===3){if(f.has(S.pubkey))continue;const I=relayListFromKind3(t,S);I&&p.set(S.pubkey,I)}n=n.filter(S=>!f.has(S)&&!p.has(S))}if(n.length===0)return f;const g=new Map,x=new Map;return new Promise(A=>{(async()=>{const I={closeOnEose:!0,pool:a,groupable:!0,subId:"ndk-relay-list-fetch",addSinceFromCache:!0,relaySet:y};y&&(I.relaySet=y),t.subscribe({kinds:[3,10002],authors:n},I,{onEvent:_=>{if(_.kind===10002){const R=g.get(_.pubkey);if(R&&R.created_at>_.created_at)return;g.set(_.pubkey,_)}else if(_.kind===3){const R=x.get(_.pubkey);if(R&&R.created_at>_.created_at)return;x.set(_.pubkey,_)}},onEose:()=>{for(const _ of g.values())f.set(_.pubkey,NDKRelayList.from(_));for(const _ of n){if(f.has(_))continue;const R=x.get(_);if(!R)continue;const N=relayListFromKind3(t,R);N&&f.set(_,N)}A(f)}}),setTimeout(()=>{A(f)},s)})()})}var OutboxItem=class{constructor(n){pe(this,"type");pe(this,"relayUrlScores");pe(this,"readRelays");pe(this,"writeRelays");this.type=n,this.relayUrlScores=new Map,this.readRelays=new Set,this.writeRelays=new Set}},OutboxTracker=class extends libExports.EventEmitter{constructor(t){super();pe(this,"data");pe(this,"ndk");pe(this,"debug");this.ndk=t,this.debug=t.debug.extend("outbox-tracker"),this.data=new distExports.LRUCache({maxSize:1e5,entryExpirationTimeInMS:2*60*1e3})}async trackUsers(t,e=!1){const s=[];for(let a=0;a<t.length;a+=400){const f=t.slice(a,a+400).map(p=>getKeyFromItem(p)).filter(p=>!this.data.has(p));if(f.length!==0){for(const p of f)this.data.set(p,new OutboxItem("user"));s.push(new Promise(p=>{getRelayListForUsers(f,this.ndk,e).then(y=>{for(const[g,x]of y){let E=this.data.get(g);if(E??(E=new OutboxItem("user")),x){E.readRelays=new Set(normalize(x.readRelayUrls)),E.writeRelays=new Set(normalize(x.writeRelayUrls));for(const A of E.readRelays)this.ndk.pool.blacklistRelayUrls.has(A)&&E.readRelays.delete(A);for(const A of E.writeRelays)this.ndk.pool.blacklistRelayUrls.has(A)&&E.writeRelays.delete(A);this.data.set(g,E)}}}).finally(p)}))}}return Promise.all(s)}track(t,e,s=!0){const a=getKeyFromItem(t);e??(e=getTypeFromItem(t));let o=this.data.get(a);return o||(o=new OutboxItem(e),t instanceof NDKUser&&this.trackUsers([t])),o}};function getKeyFromItem(n){return n instanceof NDKUser?n.pubkey:n}function getTypeFromItem(n){return n instanceof NDKUser?"user":"kind"}function correctRelaySet(n,t){const e=t.connectedRelays();if(!Array.from(n.relays).some(a=>e.map(o=>o.url).includes(a.url)))for(const a of e)n.addRelay(a);if(e.length===0)for(const a of t.relays.values())n.addRelay(a);return n}var NDKSubscriptionManager=class{constructor(){pe(this,"subscriptions");pe(this,"seenEvents",new Map);this.subscriptions=new Map}add(n){this.subscriptions.set(n.internalId,n),n.onStopped,n.onStopped=()=>{this.subscriptions.delete(n.internalId)},n.on("close",()=>{this.subscriptions.delete(n.internalId)})}seenEvent(n,t){const e=this.seenEvents.get(n)||[];e.push(t),this.seenEvents.set(n,e)}dispatchEvent(n,t,e=!1){t&&this.seenEvent(n.id,t);const s=this.subscriptions.values(),a=[];for(const o of s)matchFilters(o.filters,n)&&a.push(o);for(const o of a)o.eventReceived(n,t,!1,e)}},debug7=createDebug3("ndk:active-user");async function getUserRelayList(n){if(!this.autoConnectUserRelays)return;const t=await getRelayListForUser(n.pubkey,this);if(t){for(const e of t.relays){let s=this.pool.relays.get(e);s||(s=new NDKRelay(e,this.relayAuthDefaultPolicy,this),this.pool.addRelay(s))}return t}}async function setActiveUser(n){const t=this.outboxPool||this.pool;t.connectedRelays.length>0?setActiveUserConnected.call(this,n):t.once("connect",()=>{setActiveUserConnected.call(this,n)})}async function setActiveUserConnected(n){var o;const t=await getUserRelayList.call(this,n),e=[{kinds:[10006],authors:[n.pubkey]}];this.autoFetchUserMutelist&&((o=e[0].kinds)==null||o.push(1e4));const s=new Map,a=t?t.relaySet:void 0;this.subscribe(e,{subId:"active-user-settings",closeOnEose:!0,relaySet:a},{onEvent:f=>{const p=s.get(f.kind);p&&p.created_at>=f.created_at||s.set(f.kind,f)},onEose:()=>{for(const f of s.values())processEvent$1.call(this,f)}})}async function processEvent$1(n){n.kind===10006?processBlockRelayList.call(this,n):n.kind===1e4&&processMuteList.call(this,n)}function processBlockRelayList(n){const t=lists_default.from(n);for(const e of t.items)this.pool.blacklistRelayUrls.add(e[0]);debug7("Added %d relays to relay blacklist",t.items.length)}function processMuteList(n){const t=lists_default.from(n);for(const e of t.items)this.mutedIds.set(e[1],e[0]);debug7("Added %d users to mute list",t.items.length)}function getEntity(n){try{const t=nip19_exports.decode(n);return t.type==="npub"?npub(this,t.data):t.type==="nprofile"?nprofile(this,t.data):t}catch{return null}}function npub(n,t){return n.getUser({pubkey:t})}function nprofile(n,t){const e=n.getUser({pubkey:t.pubkey});return t.relays&&(e.relayUrls=t.relays),e}function isValidHint(n){if(!n||n==="")return!1;try{return new URL(n),!0}catch{return!1}}async function fetchEventFromTag(n,t,e,s={type:"timeout"}){const a=this.debug.extend("fetch-event-from-tag"),[o,f,p]=n;e={},a("fetching event from tag",n,e,s);const y=getRelaysForSync(this,t.pubkey);if(y&&y.size>0){a("fetching event from author relays %o",Array.from(y));const _=NDKRelaySet.fromRelayUrls(Array.from(y),this),R=await this.fetchEvent(f,e,_);if(R)return R}else a("no author relays found for %s",t.pubkey,t);const g=calculateRelaySetsFromFilters(this,[{ids:[f]}],this.pool);a("fetching event without relay hint",g);const x=await this.fetchEvent(f,e);if(x)return x;if(p&&p!==""){const _=await this.fetchEvent(f,e,this.pool.getRelay(p,!0,!0,[{ids:[f]}]));if(_)return _}let E;const A=isValidHint(p)?this.pool.getRelay(p,!1,!0,[{ids:[f]}]):void 0,S=new Promise(_=>{this.fetchEvent(f,e,A).then(_)});if(!isValidHint(p)||s.type==="none")return S;const I=new Promise(async _=>{const R=s.relaySet,N=s.timeout??1500,D=new Promise(M=>setTimeout(M,N));if(s.type==="timeout"&&await D,E)_(E);else{a("fallback fetch triggered");const M=await this.fetchEvent(f,e,R);_(M)}});switch(s.type){case"timeout":return Promise.race([S,I]);case"eose":return E=await S,E||I}}var Queue=class{constructor(n,t){pe(this,"queue",[]);pe(this,"maxConcurrency");pe(this,"processing",new Set);pe(this,"promises",new Map);this.maxConcurrency=t}add(n){if(this.promises.has(n.id))return this.promises.get(n.id);const t=new Promise((e,s)=>{this.queue.push({...n,func:()=>n.func().then(a=>(e(a),a),a=>{throw s(a),a})}),this.process()});return this.promises.set(n.id,t),t.finally(()=>{this.promises.delete(n.id),this.processing.delete(n.id),this.process()}),t}process(){if(this.processing.size>=this.maxConcurrency||this.queue.length===0)return;const n=this.queue.shift();!n||this.processing.has(n.id)||(this.processing.add(n.id),n.func())}clear(){this.queue=[]}clearProcessing(){this.processing.clear()}clearAll(){this.clear(),this.clearProcessing()}length(){return this.queue.length}},DEFAULT_OUTBOX_RELAYS=["wss://purplepag.es/","wss://nos.lol/"],DEFAULT_BLACKLISTED_RELAYS=["wss://brb.io/","wss://nostr.mutinywallet.com/"],NDK=class extends libExports.EventEmitter{constructor(t={}){super();pe(this,"_explicitRelayUrls");pe(this,"blacklistRelayUrls");pe(this,"pool");pe(this,"outboxPool");pe(this,"_signer");pe(this,"_activeUser");pe(this,"cacheAdapter");pe(this,"debug");pe(this,"devWriteRelaySet");pe(this,"outboxTracker");pe(this,"mutedIds");pe(this,"clientName");pe(this,"clientNip89");pe(this,"queuesZapConfig");pe(this,"queuesNip05");pe(this,"asyncSigVerification",!1);pe(this,"initialValidationRatio",1);pe(this,"lowestValidationRatio",.1);pe(this,"validationRatioFn");pe(this,"autoBlacklistInvalidRelays",!1);pe(this,"subManager");pe(this,"_signatureVerificationFunction");pe(this,"_signatureVerificationWorker");pe(this,"signatureVerificationTimeMs",0);pe(this,"publishingFailureHandled",!1);pe(this,"pools",[]);pe(this,"relayAuthDefaultPolicy");pe(this,"httpFetch");pe(this,"netDebug");pe(this,"autoConnectUserRelays",!0);pe(this,"autoFetchUserMutelist",!0);pe(this,"walletConfig");pe(this,"fetchEventFromTag",fetchEventFromTag.bind(this));pe(this,"getEntity",getEntity.bind(this));this.debug=t.debug||createDebug3("ndk"),this.netDebug=t.netDebug,this._explicitRelayUrls=t.explicitRelayUrls||[],this.blacklistRelayUrls=t.blacklistRelayUrls||DEFAULT_BLACKLISTED_RELAYS,this.subManager=new NDKSubscriptionManager,this.pool=new NDKPool(t.explicitRelayUrls||[],[],this),this.pool.name="Main",this.pool.on("relay:auth",async(e,s)=>{this.relayAuthDefaultPolicy&&await this.relayAuthDefaultPolicy(e,s)}),this.autoConnectUserRelays=t.autoConnectUserRelays??!0,this.autoFetchUserMutelist=t.autoFetchUserMutelist??!0,this.clientName=t.clientName,this.clientNip89=t.clientNip89,this.relayAuthDefaultPolicy=t.relayAuthDefaultPolicy,t.enableOutboxModel&&(this.outboxPool=new NDKPool(t.outboxRelayUrls||DEFAULT_OUTBOX_RELAYS,[],this,{debug:this.debug.extend("outbox-pool"),name:"Outbox Pool"}),this.outboxTracker=new OutboxTracker(this)),this.signer=t.signer,this.cacheAdapter=t.cacheAdapter,this.mutedIds=t.mutedIds||new Map,t.devWriteRelayUrls&&(this.devWriteRelaySet=NDKRelaySet.fromRelayUrls(t.devWriteRelayUrls,this)),this.queuesZapConfig=new Queue("zaps",3),this.queuesNip05=new Queue("nip05",10),t.signatureVerificationWorker&&(this.signatureVerificationWorker=t.signatureVerificationWorker),t.signatureVerificationFunction&&(this.signatureVerificationFunction=t.signatureVerificationFunction),this.initialValidationRatio=t.initialValidationRatio||1,this.lowestValidationRatio=t.lowestValidationRatio||.1,this.autoBlacklistInvalidRelays=t.autoBlacklistInvalidRelays||!1,this.validationRatioFn=t.validationRatioFn||this.defaultValidationRatioFn;try{this.httpFetch=fetch}catch{}}set explicitRelayUrls(t){this._explicitRelayUrls=t.map(normalizeRelayUrl),this.pool.relayUrls=t}get explicitRelayUrls(){return this._explicitRelayUrls||[]}set signatureVerificationWorker(t){this._signatureVerificationWorker=t,t?(signatureVerificationInit(t),this.asyncSigVerification=!0):this.asyncSigVerification=!1}set signatureVerificationFunction(t){this._signatureVerificationFunction=t,this.asyncSigVerification=!!t}get signatureVerificationFunction(){return this._signatureVerificationFunction}addExplicitRelay(t,e,s=!0){var o;let a;return typeof t=="string"?a=new NDKRelay(t,e,this):a=t,this.pool.addRelay(a,s),(o=this.explicitRelayUrls)==null||o.push(a.url),a}toJSON(){return{relayCount:this.pool.relays.size}.toString()}get activeUser(){return this._activeUser}set activeUser(t){var s;const e=((s=this._activeUser)==null?void 0:s.pubkey)!==(t==null?void 0:t.pubkey);this._activeUser=t,t&&e?setActiveUser.call(this,t):t||(this.mutedIds=new Map)}get signer(){return this._signer}set signer(t){this._signer=t,t&&this.emit("signer:ready",t),t==null||t.user().then(e=>{e.ndk=this,this.activeUser=e})}async connect(t){var s,a;this._signer&&this.autoConnectUserRelays&&(this.debug("Attempting to connect to user relays specified by signer %o",await((a=(s=this._signer).relays)==null?void 0:a.call(s,this))),this._signer.relays&&(await this._signer.relays(this)).forEach(f=>this.pool.addRelay(f)));const e=[this.pool.connect(t)];return this.outboxPool&&e.push(this.outboxPool.connect(t)),Promise.allSettled(e).then(()=>{})}reportInvalidSignature(t,e){this.debug(`Invalid signature detected for event ${t.id}${e?` from relay ${e.url}`:""}`),this.emit("event:invalid-sig",t,e),this.autoBlacklistInvalidRelays&&e&&this.blacklistRelay(e.url)}blacklistRelay(t){if(this.blacklistRelayUrls||(this.blacklistRelayUrls=[]),!this.blacklistRelayUrls.includes(t)){this.blacklistRelayUrls.push(t),this.debug(`Added relay to blacklist: ${t}`);const e=this.pool.getRelay(t,!1,!1);e&&(e.disconnect(),this.debug(`Disconnected from blacklisted relay: ${t}`))}}defaultValidationRatioFn(t,e,s){if(e<10)return this.initialValidationRatio;const a=Math.min(e/100,1),o=this.initialValidationRatio*(1-a)+this.lowestValidationRatio*a;return Math.max(o,this.lowestValidationRatio)}getUser(t){const e=new NDKUser(t);return e.ndk=this,e}async getUserFromNip05(t,e=!1){return NDKUser.fromNip05(t,this,e)}subscribe(t,e,s=!0,a=!0){var g;let o=e==null?void 0:e.relaySet,f=a;s instanceof NDKRelaySet?(console.warn("relaySet is deprecated, use opts.relaySet instead. This will be removed in version v2.14.0"),o=s,f=a):(typeof s=="boolean"||typeof s=="object")&&(f=s);const p=new NDKSubscription(this,t,{relaySet:o,...e});this.subManager.add(p);const y=p.pool;if(p.relaySet)for(const x of p.relaySet.relays)y.useTemporaryRelay(x,void 0,p.filters);if(this.outboxPool&&p.hasAuthorsFilter()){const x=p.filters.filter(E=>{var A;return E.authors&&((A=E.authors)==null?void 0:A.length)>0}).flatMap(E=>E.authors);(g=this.outboxTracker)==null||g.trackUsers(x)}if(f){let x;typeof f=="object"&&(f.onEvent&&p.on("event",f.onEvent),f.onEose&&p.on("eose",f.onEose),f.onEvents&&(x=f.onEvents)),setTimeout(()=>{const E=p.start(!x);E&&E.length>0&&x&&x(E)},0)}return p}fetchEventSync(t){if(!this.cacheAdapter)throw new Error("Cache adapter not set");let e;typeof t=="string"?e=[filterFromId(t)]:e=t;const s=new NDKSubscription(this,e),a=this.cacheAdapter.query(s);if(a instanceof Promise)throw new Error("Cache adapter is async");return a.map(o=>(o.ndk=this,o))}async fetchEvent(t,e,s){let a,o;if(s instanceof NDKRelay?o=new NDKRelaySet(new Set([s]),this):s instanceof NDKRelaySet&&(o=s),!s&&typeof t=="string"&&!isNip33AValue(t)){const f=relaysFromBech32(t,this);f.length>0&&(o=new NDKRelaySet(new Set(f),this),o=correctRelaySet(o,this.pool))}if(typeof t=="string"?a=[filterFromId(t)]:Array.isArray(t)?a=t:a=[t],a.length===0)throw new Error(`Invalid filter: ${JSON.stringify(t)}`);return new Promise(f=>{let p=null;const y={...e||{},closeOnEose:!0};o&&(y.relaySet=o);const g=this.subscribe(a,y,!1),x=setTimeout(()=>{g.stop(),f(p)},1e4);g.on("event",E=>{E.ndk=this,E.isReplaceable()?(!p||p.created_at<E.created_at)&&(p=E):(clearTimeout(x),f(E))}),g.on("eose",()=>{clearTimeout(x),f(p)}),g.start()})}async fetchEvents(t,e,s){return new Promise(a=>{const o=new Map,f={...e||{},closeOnEose:!0};s&&(f.relaySet=s);const p=this.subscribe(t,f,!1),y=g=>{let x;g instanceof NDKEvent?x=g:x=new NDKEvent(void 0,g);const E=x.deduplicationKey(),A=o.get(E);A&&(x=dedup(A,x)),x.ndk=this,o.set(E,x)};p.on("event",y),p.on("eose",()=>{a(new Set(o.values()))}),p.start()})}assertSigner(){if(!this.signer)throw this.emit("signer:required"),new Error("Signer required")}set wallet(t){var e,s;if(!t){this.walletConfig=void 0;return}this.walletConfig??(this.walletConfig={}),this.walletConfig.lnPay=(e=t==null?void 0:t.lnPay)==null?void 0:e.bind(t),this.walletConfig.cashuPay=(s=t==null?void 0:t.cashuPay)==null?void 0:s.bind(t)}};createDebug3("ndk:zapper:ln");createDebug3("ndk:zapper");const explicitRelayUrls=["wss://relay.damus.io","wss://nos.lol","wss://relay.primal.net","wss://nostr.mom","wss://relay.degmods.com"],ndkInstance=new NDK({explicitRelayUrls}),useNDKInit=()=>{const[n,t]=reactExports.useState(!1),[e,s]=reactExports.useState(null),[a,o]=reactExports.useState(0),f=reactExports.useRef(!1),p=y=>{const g=y.connectedRelays().length;o(g),t(g>0),g>0&&s(null)};return reactExports.useEffect(()=>{let y=!0;const g=S=>{console.log(`[useNDKInit] Relay CONNECTED: ${S.url}`),y&&p(ndkInstance.pool)},x=S=>{console.warn(`[useNDKInit] Relay DISCONNECTED: ${S.url}`),y&&setTimeout(()=>{y&&p(ndkInstance.pool)},100)},E=(S,I)=>{console.warn(`[useNDKInit] Relay NOTICE from ${S.url}: ${I}`)};return(()=>{f.current||(console.log("useNDKInit: Setting up NDK listeners..."),p(ndkInstance.pool),ndkInstance.pool.on("relay:connect",g),ndkInstance.pool.on("relay:disconnect",x),ndkInstance.pool.on("notice",E),f.current=!0,console.log("useNDKInit: Attached relay status listeners (connect, disconnect, notice)."),console.log("useNDKInit: Attempting NDK connection..."),ndkInstance.connect().catch(S=>{console.error("useNDKInit: Error during ndk.connect():",S),y&&(s(S instanceof Error?S:new Error("Failed to connect NDK")),t(!1),o(0))}))})(),()=>{y=!1,f.current&&(console.log("useNDKInit: Cleaning up relay status listeners."),ndkInstance.pool.off("relay:connect",g),ndkInstance.pool.off("relay:disconnect",x),ndkInstance.pool.off("notice",E),f.current=!1)}},[]),{isReady:n,connectionError:e,ndkInstance,connectedRelayCount:a}},urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let nanoid=(n=21)=>{let t="",e=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)t+=urlAlphabet[e[n]&63];return t};var buffer={},base64Js={},hasRequiredBase64Js;function requireBase64Js(){if(hasRequiredBase64Js)return base64Js;hasRequiredBase64Js=1,base64Js.byteLength=p,base64Js.toByteArray=g,base64Js.fromByteArray=A;for(var n=[],t=[],e=typeof Uint8Array<"u"?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)n[a]=s[a],t[s.charCodeAt(a)]=a;t[45]=62,t[95]=63;function f(S){var I=S.length;if(I%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var _=S.indexOf("=");_===-1&&(_=I);var R=_===I?0:4-_%4;return[_,R]}function p(S){var I=f(S),_=I[0],R=I[1];return(_+R)*3/4-R}function y(S,I,_){return(I+_)*3/4-_}function g(S){var I,_=f(S),R=_[0],N=_[1],D=new e(y(S,R,N)),M=0,W=N>0?R-4:R,B;for(B=0;B<W;B+=4)I=t[S.charCodeAt(B)]<<18|t[S.charCodeAt(B+1)]<<12|t[S.charCodeAt(B+2)]<<6|t[S.charCodeAt(B+3)],D[M++]=I>>16&255,D[M++]=I>>8&255,D[M++]=I&255;return N===2&&(I=t[S.charCodeAt(B)]<<2|t[S.charCodeAt(B+1)]>>4,D[M++]=I&255),N===1&&(I=t[S.charCodeAt(B)]<<10|t[S.charCodeAt(B+1)]<<4|t[S.charCodeAt(B+2)]>>2,D[M++]=I>>8&255,D[M++]=I&255),D}function x(S){return n[S>>18&63]+n[S>>12&63]+n[S>>6&63]+n[S&63]}function E(S,I,_){for(var R,N=[],D=I;D<_;D+=3)R=(S[D]<<16&16711680)+(S[D+1]<<8&65280)+(S[D+2]&255),N.push(x(R));return N.join("")}function A(S){for(var I,_=S.length,R=_%3,N=[],D=16383,M=0,W=_-R;M<W;M+=D)N.push(E(S,M,M+D>W?W:M+D));return R===1?(I=S[_-1],N.push(n[I>>2]+n[I<<4&63]+"==")):R===2&&(I=(S[_-2]<<8)+S[_-1],N.push(n[I>>10]+n[I>>4&63]+n[I<<2&63]+"=")),N.join("")}return base64Js}var ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var hasRequiredIeee754;function requireIeee754(){return hasRequiredIeee754||(hasRequiredIeee754=1,ieee754.read=function(n,t,e,s,a){var o,f,p=a*8-s-1,y=(1<<p)-1,g=y>>1,x=-7,E=e?a-1:0,A=e?-1:1,S=n[t+E];for(E+=A,o=S&(1<<-x)-1,S>>=-x,x+=p;x>0;o=o*256+n[t+E],E+=A,x-=8);for(f=o&(1<<-x)-1,o>>=-x,x+=s;x>0;f=f*256+n[t+E],E+=A,x-=8);if(o===0)o=1-g;else{if(o===y)return f?NaN:(S?-1:1)*(1/0);f=f+Math.pow(2,s),o=o-g}return(S?-1:1)*f*Math.pow(2,o-s)},ieee754.write=function(n,t,e,s,a,o){var f,p,y,g=o*8-a-1,x=(1<<g)-1,E=x>>1,A=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,S=s?0:o-1,I=s?1:-1,_=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(p=isNaN(t)?1:0,f=x):(f=Math.floor(Math.log(t)/Math.LN2),t*(y=Math.pow(2,-f))<1&&(f--,y*=2),f+E>=1?t+=A/y:t+=A*Math.pow(2,1-E),t*y>=2&&(f++,y/=2),f+E>=x?(p=0,f=x):f+E>=1?(p=(t*y-1)*Math.pow(2,a),f=f+E):(p=t*Math.pow(2,E-1)*Math.pow(2,a),f=0));a>=8;n[e+S]=p&255,S+=I,p/=256,a-=8);for(f=f<<a|p,g+=a;g>0;n[e+S]=f&255,S+=I,f/=256,g-=8);n[e+S-I]|=_*128}),ieee754}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var hasRequiredBuffer;function requireBuffer(){return hasRequiredBuffer||(hasRequiredBuffer=1,function(n){const t=requireBase64Js(),e=requireIeee754(),s=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=p,n.SlowBuffer=D,n.INSPECT_MAX_BYTES=50;const a=2147483647;n.kMaxLength=a,p.TYPED_ARRAY_SUPPORT=o(),!p.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function o(){try{const de=new Uint8Array(1),z={foo:function(){return 42}};return Object.setPrototypeOf(z,Uint8Array.prototype),Object.setPrototypeOf(de,z),de.foo()===42}catch{return!1}}Object.defineProperty(p.prototype,"parent",{enumerable:!0,get:function(){if(p.isBuffer(this))return this.buffer}}),Object.defineProperty(p.prototype,"offset",{enumerable:!0,get:function(){if(p.isBuffer(this))return this.byteOffset}});function f(de){if(de>a)throw new RangeError('The value "'+de+'" is invalid for option "size"');const z=new Uint8Array(de);return Object.setPrototypeOf(z,p.prototype),z}function p(de,z,Y){if(typeof de=="number"){if(typeof z=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return E(de)}return y(de,z,Y)}p.poolSize=8192;function y(de,z,Y){if(typeof de=="string")return A(de,z);if(ArrayBuffer.isView(de))return I(de);if(de==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof de);if(Et(de,ArrayBuffer)||de&&Et(de.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Et(de,SharedArrayBuffer)||de&&Et(de.buffer,SharedArrayBuffer)))return _(de,z,Y);if(typeof de=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const ye=de.valueOf&&de.valueOf();if(ye!=null&&ye!==de)return p.from(ye,z,Y);const Ae=R(de);if(Ae)return Ae;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof de[Symbol.toPrimitive]=="function")return p.from(de[Symbol.toPrimitive]("string"),z,Y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof de)}p.from=function(de,z,Y){return y(de,z,Y)},Object.setPrototypeOf(p.prototype,Uint8Array.prototype),Object.setPrototypeOf(p,Uint8Array);function g(de){if(typeof de!="number")throw new TypeError('"size" argument must be of type number');if(de<0)throw new RangeError('The value "'+de+'" is invalid for option "size"')}function x(de,z,Y){return g(de),de<=0?f(de):z!==void 0?typeof Y=="string"?f(de).fill(z,Y):f(de).fill(z):f(de)}p.alloc=function(de,z,Y){return x(de,z,Y)};function E(de){return g(de),f(de<0?0:N(de)|0)}p.allocUnsafe=function(de){return E(de)},p.allocUnsafeSlow=function(de){return E(de)};function A(de,z){if((typeof z!="string"||z==="")&&(z="utf8"),!p.isEncoding(z))throw new TypeError("Unknown encoding: "+z);const Y=M(de,z)|0;let ye=f(Y);const Ae=ye.write(de,z);return Ae!==Y&&(ye=ye.slice(0,Ae)),ye}function S(de){const z=de.length<0?0:N(de.length)|0,Y=f(z);for(let ye=0;ye<z;ye+=1)Y[ye]=de[ye]&255;return Y}function I(de){if(Et(de,Uint8Array)){const z=new Uint8Array(de);return _(z.buffer,z.byteOffset,z.byteLength)}return S(de)}function _(de,z,Y){if(z<0||de.byteLength<z)throw new RangeError('"offset" is outside of buffer bounds');if(de.byteLength<z+(Y||0))throw new RangeError('"length" is outside of buffer bounds');let ye;return z===void 0&&Y===void 0?ye=new Uint8Array(de):Y===void 0?ye=new Uint8Array(de,z):ye=new Uint8Array(de,z,Y),Object.setPrototypeOf(ye,p.prototype),ye}function R(de){if(p.isBuffer(de)){const z=N(de.length)|0,Y=f(z);return Y.length===0||de.copy(Y,0,0,z),Y}if(de.length!==void 0)return typeof de.length!="number"||$t(de.length)?f(0):S(de);if(de.type==="Buffer"&&Array.isArray(de.data))return S(de.data)}function N(de){if(de>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return de|0}function D(de){return+de!=de&&(de=0),p.alloc(+de)}p.isBuffer=function(z){return z!=null&&z._isBuffer===!0&&z!==p.prototype},p.compare=function(z,Y){if(Et(z,Uint8Array)&&(z=p.from(z,z.offset,z.byteLength)),Et(Y,Uint8Array)&&(Y=p.from(Y,Y.offset,Y.byteLength)),!p.isBuffer(z)||!p.isBuffer(Y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(z===Y)return 0;let ye=z.length,Ae=Y.length;for(let Be=0,Le=Math.min(ye,Ae);Be<Le;++Be)if(z[Be]!==Y[Be]){ye=z[Be],Ae=Y[Be];break}return ye<Ae?-1:Ae<ye?1:0},p.isEncoding=function(z){switch(String(z).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},p.concat=function(z,Y){if(!Array.isArray(z))throw new TypeError('"list" argument must be an Array of Buffers');if(z.length===0)return p.alloc(0);let ye;if(Y===void 0)for(Y=0,ye=0;ye<z.length;++ye)Y+=z[ye].length;const Ae=p.allocUnsafe(Y);let Be=0;for(ye=0;ye<z.length;++ye){let Le=z[ye];if(Et(Le,Uint8Array))Be+Le.length>Ae.length?(p.isBuffer(Le)||(Le=p.from(Le)),Le.copy(Ae,Be)):Uint8Array.prototype.set.call(Ae,Le,Be);else if(p.isBuffer(Le))Le.copy(Ae,Be);else throw new TypeError('"list" argument must be an Array of Buffers');Be+=Le.length}return Ae};function M(de,z){if(p.isBuffer(de))return de.length;if(ArrayBuffer.isView(de)||Et(de,ArrayBuffer))return de.byteLength;if(typeof de!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof de);const Y=de.length,ye=arguments.length>2&&arguments[2]===!0;if(!ye&&Y===0)return 0;let Ae=!1;for(;;)switch(z){case"ascii":case"latin1":case"binary":return Y;case"utf8":case"utf-8":return st(de).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y*2;case"hex":return Y>>>1;case"base64":return bt(de).length;default:if(Ae)return ye?-1:st(de).length;z=(""+z).toLowerCase(),Ae=!0}}p.byteLength=M;function W(de,z,Y){let ye=!1;if((z===void 0||z<0)&&(z=0),z>this.length||((Y===void 0||Y>this.length)&&(Y=this.length),Y<=0)||(Y>>>=0,z>>>=0,Y<=z))return"";for(de||(de="utf8");;)switch(de){case"hex":return ne(this,z,Y);case"utf8":case"utf-8":return se(this,z,Y);case"ascii":return K(this,z,Y);case"latin1":case"binary":return ie(this,z,Y);case"base64":return G(this,z,Y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return re(this,z,Y);default:if(ye)throw new TypeError("Unknown encoding: "+de);de=(de+"").toLowerCase(),ye=!0}}p.prototype._isBuffer=!0;function B(de,z,Y){const ye=de[z];de[z]=de[Y],de[Y]=ye}p.prototype.swap16=function(){const z=this.length;if(z%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let Y=0;Y<z;Y+=2)B(this,Y,Y+1);return this},p.prototype.swap32=function(){const z=this.length;if(z%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let Y=0;Y<z;Y+=4)B(this,Y,Y+3),B(this,Y+1,Y+2);return this},p.prototype.swap64=function(){const z=this.length;if(z%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let Y=0;Y<z;Y+=8)B(this,Y,Y+7),B(this,Y+1,Y+6),B(this,Y+2,Y+5),B(this,Y+3,Y+4);return this},p.prototype.toString=function(){const z=this.length;return z===0?"":arguments.length===0?se(this,0,z):W.apply(this,arguments)},p.prototype.toLocaleString=p.prototype.toString,p.prototype.equals=function(z){if(!p.isBuffer(z))throw new TypeError("Argument must be a Buffer");return this===z?!0:p.compare(this,z)===0},p.prototype.inspect=function(){let z="";const Y=n.INSPECT_MAX_BYTES;return z=this.toString("hex",0,Y).replace(/(.{2})/g,"$1 ").trim(),this.length>Y&&(z+=" ... "),"<Buffer "+z+">"},s&&(p.prototype[s]=p.prototype.inspect),p.prototype.compare=function(z,Y,ye,Ae,Be){if(Et(z,Uint8Array)&&(z=p.from(z,z.offset,z.byteLength)),!p.isBuffer(z))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof z);if(Y===void 0&&(Y=0),ye===void 0&&(ye=z?z.length:0),Ae===void 0&&(Ae=0),Be===void 0&&(Be=this.length),Y<0||ye>z.length||Ae<0||Be>this.length)throw new RangeError("out of range index");if(Ae>=Be&&Y>=ye)return 0;if(Ae>=Be)return-1;if(Y>=ye)return 1;if(Y>>>=0,ye>>>=0,Ae>>>=0,Be>>>=0,this===z)return 0;let Le=Be-Ae,Ve=ye-Y;const vt=Math.min(Le,Ve),ft=this.slice(Ae,Be),gt=z.slice(Y,ye);for(let Rt=0;Rt<vt;++Rt)if(ft[Rt]!==gt[Rt]){Le=ft[Rt],Ve=gt[Rt];break}return Le<Ve?-1:Ve<Le?1:0};function U(de,z,Y,ye,Ae){if(de.length===0)return-1;if(typeof Y=="string"?(ye=Y,Y=0):Y>2147483647?Y=2147483647:Y<-2147483648&&(Y=-2147483648),Y=+Y,$t(Y)&&(Y=Ae?0:de.length-1),Y<0&&(Y=de.length+Y),Y>=de.length){if(Ae)return-1;Y=de.length-1}else if(Y<0)if(Ae)Y=0;else return-1;if(typeof z=="string"&&(z=p.from(z,ye)),p.isBuffer(z))return z.length===0?-1:P(de,z,Y,ye,Ae);if(typeof z=="number")return z=z&255,typeof Uint8Array.prototype.indexOf=="function"?Ae?Uint8Array.prototype.indexOf.call(de,z,Y):Uint8Array.prototype.lastIndexOf.call(de,z,Y):P(de,[z],Y,ye,Ae);throw new TypeError("val must be string, number or Buffer")}function P(de,z,Y,ye,Ae){let Be=1,Le=de.length,Ve=z.length;if(ye!==void 0&&(ye=String(ye).toLowerCase(),ye==="ucs2"||ye==="ucs-2"||ye==="utf16le"||ye==="utf-16le")){if(de.length<2||z.length<2)return-1;Be=2,Le/=2,Ve/=2,Y/=2}function vt(gt,Rt){return Be===1?gt[Rt]:gt.readUInt16BE(Rt*Be)}let ft;if(Ae){let gt=-1;for(ft=Y;ft<Le;ft++)if(vt(de,ft)===vt(z,gt===-1?0:ft-gt)){if(gt===-1&&(gt=ft),ft-gt+1===Ve)return gt*Be}else gt!==-1&&(ft-=ft-gt),gt=-1}else for(Y+Ve>Le&&(Y=Le-Ve),ft=Y;ft>=0;ft--){let gt=!0;for(let Rt=0;Rt<Ve;Rt++)if(vt(de,ft+Rt)!==vt(z,Rt)){gt=!1;break}if(gt)return ft}return-1}p.prototype.includes=function(z,Y,ye){return this.indexOf(z,Y,ye)!==-1},p.prototype.indexOf=function(z,Y,ye){return U(this,z,Y,ye,!0)},p.prototype.lastIndexOf=function(z,Y,ye){return U(this,z,Y,ye,!1)};function F(de,z,Y,ye){Y=Number(Y)||0;const Ae=de.length-Y;ye?(ye=Number(ye),ye>Ae&&(ye=Ae)):ye=Ae;const Be=z.length;ye>Be/2&&(ye=Be/2);let Le;for(Le=0;Le<ye;++Le){const Ve=parseInt(z.substr(Le*2,2),16);if($t(Ve))return Le;de[Y+Le]=Ve}return Le}function j(de,z,Y,ye){return qe(st(z,de.length-Y),de,Y,ye)}function Q(de,z,Y,ye){return qe(nt(z),de,Y,ye)}function $(de,z,Y,ye){return qe(bt(z),de,Y,ye)}function V(de,z,Y,ye){return qe(tt(z,de.length-Y),de,Y,ye)}p.prototype.write=function(z,Y,ye,Ae){if(Y===void 0)Ae="utf8",ye=this.length,Y=0;else if(ye===void 0&&typeof Y=="string")Ae=Y,ye=this.length,Y=0;else if(isFinite(Y))Y=Y>>>0,isFinite(ye)?(ye=ye>>>0,Ae===void 0&&(Ae="utf8")):(Ae=ye,ye=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Be=this.length-Y;if((ye===void 0||ye>Be)&&(ye=Be),z.length>0&&(ye<0||Y<0)||Y>this.length)throw new RangeError("Attempt to write outside buffer bounds");Ae||(Ae="utf8");let Le=!1;for(;;)switch(Ae){case"hex":return F(this,z,Y,ye);case"utf8":case"utf-8":return j(this,z,Y,ye);case"ascii":case"latin1":case"binary":return Q(this,z,Y,ye);case"base64":return $(this,z,Y,ye);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,z,Y,ye);default:if(Le)throw new TypeError("Unknown encoding: "+Ae);Ae=(""+Ae).toLowerCase(),Le=!0}},p.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function G(de,z,Y){return z===0&&Y===de.length?t.fromByteArray(de):t.fromByteArray(de.slice(z,Y))}function se(de,z,Y){Y=Math.min(de.length,Y);const ye=[];let Ae=z;for(;Ae<Y;){const Be=de[Ae];let Le=null,Ve=Be>239?4:Be>223?3:Be>191?2:1;if(Ae+Ve<=Y){let vt,ft,gt,Rt;switch(Ve){case 1:Be<128&&(Le=Be);break;case 2:vt=de[Ae+1],(vt&192)===128&&(Rt=(Be&31)<<6|vt&63,Rt>127&&(Le=Rt));break;case 3:vt=de[Ae+1],ft=de[Ae+2],(vt&192)===128&&(ft&192)===128&&(Rt=(Be&15)<<12|(vt&63)<<6|ft&63,Rt>2047&&(Rt<55296||Rt>57343)&&(Le=Rt));break;case 4:vt=de[Ae+1],ft=de[Ae+2],gt=de[Ae+3],(vt&192)===128&&(ft&192)===128&&(gt&192)===128&&(Rt=(Be&15)<<18|(vt&63)<<12|(ft&63)<<6|gt&63,Rt>65535&&Rt<1114112&&(Le=Rt))}}Le===null?(Le=65533,Ve=1):Le>65535&&(Le-=65536,ye.push(Le>>>10&1023|55296),Le=56320|Le&1023),ye.push(Le),Ae+=Ve}return J(ye)}const H=4096;function J(de){const z=de.length;if(z<=H)return String.fromCharCode.apply(String,de);let Y="",ye=0;for(;ye<z;)Y+=String.fromCharCode.apply(String,de.slice(ye,ye+=H));return Y}function K(de,z,Y){let ye="";Y=Math.min(de.length,Y);for(let Ae=z;Ae<Y;++Ae)ye+=String.fromCharCode(de[Ae]&127);return ye}function ie(de,z,Y){let ye="";Y=Math.min(de.length,Y);for(let Ae=z;Ae<Y;++Ae)ye+=String.fromCharCode(de[Ae]);return ye}function ne(de,z,Y){const ye=de.length;(!z||z<0)&&(z=0),(!Y||Y<0||Y>ye)&&(Y=ye);let Ae="";for(let Be=z;Be<Y;++Be)Ae+=Vt[de[Be]];return Ae}function re(de,z,Y){const ye=de.slice(z,Y);let Ae="";for(let Be=0;Be<ye.length-1;Be+=2)Ae+=String.fromCharCode(ye[Be]+ye[Be+1]*256);return Ae}p.prototype.slice=function(z,Y){const ye=this.length;z=~~z,Y=Y===void 0?ye:~~Y,z<0?(z+=ye,z<0&&(z=0)):z>ye&&(z=ye),Y<0?(Y+=ye,Y<0&&(Y=0)):Y>ye&&(Y=ye),Y<z&&(Y=z);const Ae=this.subarray(z,Y);return Object.setPrototypeOf(Ae,p.prototype),Ae};function X(de,z,Y){if(de%1!==0||de<0)throw new RangeError("offset is not uint");if(de+z>Y)throw new RangeError("Trying to access beyond buffer length")}p.prototype.readUintLE=p.prototype.readUIntLE=function(z,Y,ye){z=z>>>0,Y=Y>>>0,ye||X(z,Y,this.length);let Ae=this[z],Be=1,Le=0;for(;++Le<Y&&(Be*=256);)Ae+=this[z+Le]*Be;return Ae},p.prototype.readUintBE=p.prototype.readUIntBE=function(z,Y,ye){z=z>>>0,Y=Y>>>0,ye||X(z,Y,this.length);let Ae=this[z+--Y],Be=1;for(;Y>0&&(Be*=256);)Ae+=this[z+--Y]*Be;return Ae},p.prototype.readUint8=p.prototype.readUInt8=function(z,Y){return z=z>>>0,Y||X(z,1,this.length),this[z]},p.prototype.readUint16LE=p.prototype.readUInt16LE=function(z,Y){return z=z>>>0,Y||X(z,2,this.length),this[z]|this[z+1]<<8},p.prototype.readUint16BE=p.prototype.readUInt16BE=function(z,Y){return z=z>>>0,Y||X(z,2,this.length),this[z]<<8|this[z+1]},p.prototype.readUint32LE=p.prototype.readUInt32LE=function(z,Y){return z=z>>>0,Y||X(z,4,this.length),(this[z]|this[z+1]<<8|this[z+2]<<16)+this[z+3]*16777216},p.prototype.readUint32BE=p.prototype.readUInt32BE=function(z,Y){return z=z>>>0,Y||X(z,4,this.length),this[z]*16777216+(this[z+1]<<16|this[z+2]<<8|this[z+3])},p.prototype.readBigUInt64LE=Dt(function(z){z=z>>>0,Pe(z,"offset");const Y=this[z],ye=this[z+7];(Y===void 0||ye===void 0)&&We(z,this.length-8);const Ae=Y+this[++z]*2**8+this[++z]*2**16+this[++z]*2**24,Be=this[++z]+this[++z]*2**8+this[++z]*2**16+ye*2**24;return BigInt(Ae)+(BigInt(Be)<<BigInt(32))}),p.prototype.readBigUInt64BE=Dt(function(z){z=z>>>0,Pe(z,"offset");const Y=this[z],ye=this[z+7];(Y===void 0||ye===void 0)&&We(z,this.length-8);const Ae=Y*2**24+this[++z]*2**16+this[++z]*2**8+this[++z],Be=this[++z]*2**24+this[++z]*2**16+this[++z]*2**8+ye;return(BigInt(Ae)<<BigInt(32))+BigInt(Be)}),p.prototype.readIntLE=function(z,Y,ye){z=z>>>0,Y=Y>>>0,ye||X(z,Y,this.length);let Ae=this[z],Be=1,Le=0;for(;++Le<Y&&(Be*=256);)Ae+=this[z+Le]*Be;return Be*=128,Ae>=Be&&(Ae-=Math.pow(2,8*Y)),Ae},p.prototype.readIntBE=function(z,Y,ye){z=z>>>0,Y=Y>>>0,ye||X(z,Y,this.length);let Ae=Y,Be=1,Le=this[z+--Ae];for(;Ae>0&&(Be*=256);)Le+=this[z+--Ae]*Be;return Be*=128,Le>=Be&&(Le-=Math.pow(2,8*Y)),Le},p.prototype.readInt8=function(z,Y){return z=z>>>0,Y||X(z,1,this.length),this[z]&128?(255-this[z]+1)*-1:this[z]},p.prototype.readInt16LE=function(z,Y){z=z>>>0,Y||X(z,2,this.length);const ye=this[z]|this[z+1]<<8;return ye&32768?ye|4294901760:ye},p.prototype.readInt16BE=function(z,Y){z=z>>>0,Y||X(z,2,this.length);const ye=this[z+1]|this[z]<<8;return ye&32768?ye|4294901760:ye},p.prototype.readInt32LE=function(z,Y){return z=z>>>0,Y||X(z,4,this.length),this[z]|this[z+1]<<8|this[z+2]<<16|this[z+3]<<24},p.prototype.readInt32BE=function(z,Y){return z=z>>>0,Y||X(z,4,this.length),this[z]<<24|this[z+1]<<16|this[z+2]<<8|this[z+3]},p.prototype.readBigInt64LE=Dt(function(z){z=z>>>0,Pe(z,"offset");const Y=this[z],ye=this[z+7];(Y===void 0||ye===void 0)&&We(z,this.length-8);const Ae=this[z+4]+this[z+5]*2**8+this[z+6]*2**16+(ye<<24);return(BigInt(Ae)<<BigInt(32))+BigInt(Y+this[++z]*2**8+this[++z]*2**16+this[++z]*2**24)}),p.prototype.readBigInt64BE=Dt(function(z){z=z>>>0,Pe(z,"offset");const Y=this[z],ye=this[z+7];(Y===void 0||ye===void 0)&&We(z,this.length-8);const Ae=(Y<<24)+this[++z]*2**16+this[++z]*2**8+this[++z];return(BigInt(Ae)<<BigInt(32))+BigInt(this[++z]*2**24+this[++z]*2**16+this[++z]*2**8+ye)}),p.prototype.readFloatLE=function(z,Y){return z=z>>>0,Y||X(z,4,this.length),e.read(this,z,!0,23,4)},p.prototype.readFloatBE=function(z,Y){return z=z>>>0,Y||X(z,4,this.length),e.read(this,z,!1,23,4)},p.prototype.readDoubleLE=function(z,Y){return z=z>>>0,Y||X(z,8,this.length),e.read(this,z,!0,52,8)},p.prototype.readDoubleBE=function(z,Y){return z=z>>>0,Y||X(z,8,this.length),e.read(this,z,!1,52,8)};function ae(de,z,Y,ye,Ae,Be){if(!p.isBuffer(de))throw new TypeError('"buffer" argument must be a Buffer instance');if(z>Ae||z<Be)throw new RangeError('"value" argument is out of bounds');if(Y+ye>de.length)throw new RangeError("Index out of range")}p.prototype.writeUintLE=p.prototype.writeUIntLE=function(z,Y,ye,Ae){if(z=+z,Y=Y>>>0,ye=ye>>>0,!Ae){const Ve=Math.pow(2,8*ye)-1;ae(this,z,Y,ye,Ve,0)}let Be=1,Le=0;for(this[Y]=z&255;++Le<ye&&(Be*=256);)this[Y+Le]=z/Be&255;return Y+ye},p.prototype.writeUintBE=p.prototype.writeUIntBE=function(z,Y,ye,Ae){if(z=+z,Y=Y>>>0,ye=ye>>>0,!Ae){const Ve=Math.pow(2,8*ye)-1;ae(this,z,Y,ye,Ve,0)}let Be=ye-1,Le=1;for(this[Y+Be]=z&255;--Be>=0&&(Le*=256);)this[Y+Be]=z/Le&255;return Y+ye},p.prototype.writeUint8=p.prototype.writeUInt8=function(z,Y,ye){return z=+z,Y=Y>>>0,ye||ae(this,z,Y,1,255,0),this[Y]=z&255,Y+1},p.prototype.writeUint16LE=p.prototype.writeUInt16LE=function(z,Y,ye){return z=+z,Y=Y>>>0,ye||ae(this,z,Y,2,65535,0),this[Y]=z&255,this[Y+1]=z>>>8,Y+2},p.prototype.writeUint16BE=p.prototype.writeUInt16BE=function(z,Y,ye){return z=+z,Y=Y>>>0,ye||ae(this,z,Y,2,65535,0),this[Y]=z>>>8,this[Y+1]=z&255,Y+2},p.prototype.writeUint32LE=p.prototype.writeUInt32LE=function(z,Y,ye){return z=+z,Y=Y>>>0,ye||ae(this,z,Y,4,4294967295,0),this[Y+3]=z>>>24,this[Y+2]=z>>>16,this[Y+1]=z>>>8,this[Y]=z&255,Y+4},p.prototype.writeUint32BE=p.prototype.writeUInt32BE=function(z,Y,ye){return z=+z,Y=Y>>>0,ye||ae(this,z,Y,4,4294967295,0),this[Y]=z>>>24,this[Y+1]=z>>>16,this[Y+2]=z>>>8,this[Y+3]=z&255,Y+4};function te(de,z,Y,ye,Ae){je(z,ye,Ae,de,Y,7);let Be=Number(z&BigInt(4294967295));de[Y++]=Be,Be=Be>>8,de[Y++]=Be,Be=Be>>8,de[Y++]=Be,Be=Be>>8,de[Y++]=Be;let Le=Number(z>>BigInt(32)&BigInt(4294967295));return de[Y++]=Le,Le=Le>>8,de[Y++]=Le,Le=Le>>8,de[Y++]=Le,Le=Le>>8,de[Y++]=Le,Y}function ce(de,z,Y,ye,Ae){je(z,ye,Ae,de,Y,7);let Be=Number(z&BigInt(4294967295));de[Y+7]=Be,Be=Be>>8,de[Y+6]=Be,Be=Be>>8,de[Y+5]=Be,Be=Be>>8,de[Y+4]=Be;let Le=Number(z>>BigInt(32)&BigInt(4294967295));return de[Y+3]=Le,Le=Le>>8,de[Y+2]=Le,Le=Le>>8,de[Y+1]=Le,Le=Le>>8,de[Y]=Le,Y+8}p.prototype.writeBigUInt64LE=Dt(function(z,Y=0){return te(this,z,Y,BigInt(0),BigInt("0xffffffffffffffff"))}),p.prototype.writeBigUInt64BE=Dt(function(z,Y=0){return ce(this,z,Y,BigInt(0),BigInt("0xffffffffffffffff"))}),p.prototype.writeIntLE=function(z,Y,ye,Ae){if(z=+z,Y=Y>>>0,!Ae){const vt=Math.pow(2,8*ye-1);ae(this,z,Y,ye,vt-1,-vt)}let Be=0,Le=1,Ve=0;for(this[Y]=z&255;++Be<ye&&(Le*=256);)z<0&&Ve===0&&this[Y+Be-1]!==0&&(Ve=1),this[Y+Be]=(z/Le>>0)-Ve&255;return Y+ye},p.prototype.writeIntBE=function(z,Y,ye,Ae){if(z=+z,Y=Y>>>0,!Ae){const vt=Math.pow(2,8*ye-1);ae(this,z,Y,ye,vt-1,-vt)}let Be=ye-1,Le=1,Ve=0;for(this[Y+Be]=z&255;--Be>=0&&(Le*=256);)z<0&&Ve===0&&this[Y+Be+1]!==0&&(Ve=1),this[Y+Be]=(z/Le>>0)-Ve&255;return Y+ye},p.prototype.writeInt8=function(z,Y,ye){return z=+z,Y=Y>>>0,ye||ae(this,z,Y,1,127,-128),z<0&&(z=255+z+1),this[Y]=z&255,Y+1},p.prototype.writeInt16LE=function(z,Y,ye){return z=+z,Y=Y>>>0,ye||ae(this,z,Y,2,32767,-32768),this[Y]=z&255,this[Y+1]=z>>>8,Y+2},p.prototype.writeInt16BE=function(z,Y,ye){return z=+z,Y=Y>>>0,ye||ae(this,z,Y,2,32767,-32768),this[Y]=z>>>8,this[Y+1]=z&255,Y+2},p.prototype.writeInt32LE=function(z,Y,ye){return z=+z,Y=Y>>>0,ye||ae(this,z,Y,4,2147483647,-2147483648),this[Y]=z&255,this[Y+1]=z>>>8,this[Y+2]=z>>>16,this[Y+3]=z>>>24,Y+4},p.prototype.writeInt32BE=function(z,Y,ye){return z=+z,Y=Y>>>0,ye||ae(this,z,Y,4,2147483647,-2147483648),z<0&&(z=4294967295+z+1),this[Y]=z>>>24,this[Y+1]=z>>>16,this[Y+2]=z>>>8,this[Y+3]=z&255,Y+4},p.prototype.writeBigInt64LE=Dt(function(z,Y=0){return te(this,z,Y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),p.prototype.writeBigInt64BE=Dt(function(z,Y=0){return ce(this,z,Y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function xe(de,z,Y,ye,Ae,Be){if(Y+ye>de.length)throw new RangeError("Index out of range");if(Y<0)throw new RangeError("Index out of range")}function me(de,z,Y,ye,Ae){return z=+z,Y=Y>>>0,Ae||xe(de,z,Y,4),e.write(de,z,Y,ye,23,4),Y+4}p.prototype.writeFloatLE=function(z,Y,ye){return me(this,z,Y,!0,ye)},p.prototype.writeFloatBE=function(z,Y,ye){return me(this,z,Y,!1,ye)};function Se(de,z,Y,ye,Ae){return z=+z,Y=Y>>>0,Ae||xe(de,z,Y,8),e.write(de,z,Y,ye,52,8),Y+8}p.prototype.writeDoubleLE=function(z,Y,ye){return Se(this,z,Y,!0,ye)},p.prototype.writeDoubleBE=function(z,Y,ye){return Se(this,z,Y,!1,ye)},p.prototype.copy=function(z,Y,ye,Ae){if(!p.isBuffer(z))throw new TypeError("argument should be a Buffer");if(ye||(ye=0),!Ae&&Ae!==0&&(Ae=this.length),Y>=z.length&&(Y=z.length),Y||(Y=0),Ae>0&&Ae<ye&&(Ae=ye),Ae===ye||z.length===0||this.length===0)return 0;if(Y<0)throw new RangeError("targetStart out of bounds");if(ye<0||ye>=this.length)throw new RangeError("Index out of range");if(Ae<0)throw new RangeError("sourceEnd out of bounds");Ae>this.length&&(Ae=this.length),z.length-Y<Ae-ye&&(Ae=z.length-Y+ye);const Be=Ae-ye;return this===z&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(Y,ye,Ae):Uint8Array.prototype.set.call(z,this.subarray(ye,Ae),Y),Be},p.prototype.fill=function(z,Y,ye,Ae){if(typeof z=="string"){if(typeof Y=="string"?(Ae=Y,Y=0,ye=this.length):typeof ye=="string"&&(Ae=ye,ye=this.length),Ae!==void 0&&typeof Ae!="string")throw new TypeError("encoding must be a string");if(typeof Ae=="string"&&!p.isEncoding(Ae))throw new TypeError("Unknown encoding: "+Ae);if(z.length===1){const Le=z.charCodeAt(0);(Ae==="utf8"&&Le<128||Ae==="latin1")&&(z=Le)}}else typeof z=="number"?z=z&255:typeof z=="boolean"&&(z=Number(z));if(Y<0||this.length<Y||this.length<ye)throw new RangeError("Out of range index");if(ye<=Y)return this;Y=Y>>>0,ye=ye===void 0?this.length:ye>>>0,z||(z=0);let Be;if(typeof z=="number")for(Be=Y;Be<ye;++Be)this[Be]=z;else{const Le=p.isBuffer(z)?z:p.from(z,Ae),Ve=Le.length;if(Ve===0)throw new TypeError('The value "'+z+'" is invalid for argument "value"');for(Be=0;Be<ye-Y;++Be)this[Be+Y]=Le[Be%Ve]}return this};const be={};function Me(de,z,Y){be[de]=class extends Y{constructor(){super(),Object.defineProperty(this,"message",{value:z.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${de}]`,this.stack,delete this.name}get code(){return de}set code(Ae){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:Ae,writable:!0})}toString(){return`${this.name} [${de}]: ${this.message}`}}}Me("ERR_BUFFER_OUT_OF_BOUNDS",function(de){return de?`${de} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Me("ERR_INVALID_ARG_TYPE",function(de,z){return`The "${de}" argument must be of type number. Received type ${typeof z}`},TypeError),Me("ERR_OUT_OF_RANGE",function(de,z,Y){let ye=`The value of "${de}" is out of range.`,Ae=Y;return Number.isInteger(Y)&&Math.abs(Y)>2**32?Ae=Oe(String(Y)):typeof Y=="bigint"&&(Ae=String(Y),(Y>BigInt(2)**BigInt(32)||Y<-(BigInt(2)**BigInt(32)))&&(Ae=Oe(Ae)),Ae+="n"),ye+=` It must be ${z}. Received ${Ae}`,ye},RangeError);function Oe(de){let z="",Y=de.length;const ye=de[0]==="-"?1:0;for(;Y>=ye+4;Y-=3)z=`_${de.slice(Y-3,Y)}${z}`;return`${de.slice(0,Y)}${z}`}function Ue(de,z,Y){Pe(z,"offset"),(de[z]===void 0||de[z+Y]===void 0)&&We(z,de.length-(Y+1))}function je(de,z,Y,ye,Ae,Be){if(de>Y||de<z){const Le=typeof z=="bigint"?"n":"";let Ve;throw z===0||z===BigInt(0)?Ve=`>= 0${Le} and < 2${Le} ** ${(Be+1)*8}${Le}`:Ve=`>= -(2${Le} ** ${(Be+1)*8-1}${Le}) and < 2 ** ${(Be+1)*8-1}${Le}`,new be.ERR_OUT_OF_RANGE("value",Ve,de)}Ue(ye,Ae,Be)}function Pe(de,z){if(typeof de!="number")throw new be.ERR_INVALID_ARG_TYPE(z,"number",de)}function We(de,z,Y){throw Math.floor(de)!==de?(Pe(de,Y),new be.ERR_OUT_OF_RANGE("offset","an integer",de)):z<0?new be.ERR_BUFFER_OUT_OF_BOUNDS:new be.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${z}`,de)}const Ze=/[^+/0-9A-Za-z-_]/g;function ot(de){if(de=de.split("=")[0],de=de.trim().replace(Ze,""),de.length<2)return"";for(;de.length%4!==0;)de=de+"=";return de}function st(de,z){z=z||1/0;let Y;const ye=de.length;let Ae=null;const Be=[];for(let Le=0;Le<ye;++Le){if(Y=de.charCodeAt(Le),Y>55295&&Y<57344){if(!Ae){if(Y>56319){(z-=3)>-1&&Be.push(239,191,189);continue}else if(Le+1===ye){(z-=3)>-1&&Be.push(239,191,189);continue}Ae=Y;continue}if(Y<56320){(z-=3)>-1&&Be.push(239,191,189),Ae=Y;continue}Y=(Ae-55296<<10|Y-56320)+65536}else Ae&&(z-=3)>-1&&Be.push(239,191,189);if(Ae=null,Y<128){if((z-=1)<0)break;Be.push(Y)}else if(Y<2048){if((z-=2)<0)break;Be.push(Y>>6|192,Y&63|128)}else if(Y<65536){if((z-=3)<0)break;Be.push(Y>>12|224,Y>>6&63|128,Y&63|128)}else if(Y<1114112){if((z-=4)<0)break;Be.push(Y>>18|240,Y>>12&63|128,Y>>6&63|128,Y&63|128)}else throw new Error("Invalid code point")}return Be}function nt(de){const z=[];for(let Y=0;Y<de.length;++Y)z.push(de.charCodeAt(Y)&255);return z}function tt(de,z){let Y,ye,Ae;const Be=[];for(let Le=0;Le<de.length&&!((z-=2)<0);++Le)Y=de.charCodeAt(Le),ye=Y>>8,Ae=Y%256,Be.push(Ae),Be.push(ye);return Be}function bt(de){return t.toByteArray(ot(de))}function qe(de,z,Y,ye){let Ae;for(Ae=0;Ae<ye&&!(Ae+Y>=z.length||Ae>=de.length);++Ae)z[Ae+Y]=de[Ae];return Ae}function Et(de,z){return de instanceof z||de!=null&&de.constructor!=null&&de.constructor.name!=null&&de.constructor.name===z.name}function $t(de){return de!==de}const Vt=function(){const de="0123456789abcdef",z=new Array(256);for(let Y=0;Y<16;++Y){const ye=Y*16;for(let Ae=0;Ae<16;++Ae)z[ye+Ae]=de[Y]+de[Ae]}return z}();function Dt(de){return typeof BigInt>"u"?Lt:de}function Lt(){throw new Error("BigInt not supported")}}(buffer)),buffer}var bufferExports=requireBuffer();class SimpleSigner{constructor(t){pe(this,"key");pe(this,"nip04",{encrypt:(t,e)=>Promise.resolve(nip04_exports.encrypt(this.key,t,e)),decrypt:(t,e)=>Promise.resolve(nip04_exports.decrypt(this.key,t,e))});pe(this,"nip44",{encrypt:(t,e)=>{const s=nip44_exports.v2.utils.getConversationKey(this.key,t);return Promise.resolve(nip44_exports.v2.encrypt(e,s))},decrypt:(t,e)=>{const s=nip44_exports.v2.utils.getConversationKey(this.key,t);return Promise.resolve(nip44_exports.v2.decrypt(e,s))}});if(typeof t=="string")if(t.match(/^[0-9a-f]{64}$/i))this.key=Uint8Array.from(bufferExports.Buffer.from(t,"hex"));else throw new Error("Invalid private key format");else this.key=t||generateSecretKey()}getPublicKey(){return Promise.resolve(getPublicKey(this.key))}signEvent(t){const e=finalizeEvent(t,this.key);return Promise.resolve(e)}}function isNIP04(n){const t=n.length;return t<28?!1:n[t-28]=="?"&&n[t-27]=="i"&&n[t-26]=="v"&&n[t-25]=="="}function createDefer(){let n,t;const e=new Promise((s,a)=>{n=s,t=a});return e.resolve=n,e.reject=t,e}function unixNow(){return Math.round(Date.now()/1e3)}function isHexKey(n){var t;return!!((t=n==null?void 0:n.toLowerCase())!=null&&t.match(/^[0-9a-f]{64}$/))}const logger$1=createDebug3("Zapslingers:applesauce-nip46");function isErrorResponse(n){return typeof n=="object"&&n!==null&&"error"in n&&typeof n.error=="string"}async function defaultHandleAuth(n){typeof window<"u"&&window.open?window.open(n,"auth","width=400,height=600,resizable=no,status=no,location=no,toolbar=no,menubar=no"):logger$1("Auth URL (cannot open window):",n)}class NostrConnectSigner{constructor(t){pe(this,"publishMethod");pe(this,"subscriptionMethod");pe(this,"log",logger$1.extend("NostrConnectSigner"));pe(this,"signer");pe(this,"subscriptionOpen",!1);pe(this,"isConnected",!1);pe(this,"pubkey");pe(this,"relays");pe(this,"remote");pe(this,"onAuth",defaultHandleAuth);pe(this,"verifyEvent",verifyEvent);pe(this,"clientSecret",nanoid(12));pe(this,"nip04");pe(this,"nip44");pe(this,"req");pe(this,"requests",new Map);pe(this,"auths",new Set);pe(this,"waitingPromise",null);if(this.relays=t.relays,this.pubkey=t.pubkey,this.remote=t.remote,!t.subscriptionMethod)throw new Error("Missing subscriptionMethod");if(!t.publishMethod)throw new Error("Missing publishMethod");this.subscriptionMethod=t.subscriptionMethod,this.publishMethod=t.publishMethod,t.onAuth&&(this.onAuth=t.onAuth),this.signer=(t==null?void 0:t.signer)||new SimpleSigner,this.nip04={encrypt:this.nip04Encrypt.bind(this),decrypt:this.nip04Decrypt.bind(this)},this.nip44={encrypt:this.nip44Encrypt.bind(this),decrypt:this.nip44Decrypt.bind(this)}}get clientPubkey(){return getPublicKey(this.signer.key)}async open(){if(this.subscriptionOpen)return;this.subscriptionOpen=!0;const t=this.clientPubkey;this.req=this.subscriptionMethod(this.relays,[{kinds:[kinds_exports.NostrConnect],"#p":[t]}]).subscribe({next:e=>this.handleEvent(e),error:e=>this.log("Subscription error:",e),complete:()=>this.log("Subscription complete")}),this.log("Opened subscription",this.relays)}async close(){var t,e;this.subscriptionOpen=!1,this.isConnected=!1,(t=this.req)==null||t.unsubscribe(),this.requests.forEach(s=>s.reject("Connection closed")),this.requests.clear(),(e=this.waitingPromise)==null||e.reject("Connection closed"),this.waitingPromise=null,this.log("Closed")}async handleEvent(t){var e,s;if(this.log("[handleEvent] Received event:",{id:t.id,kind:t.kind,pubkey:t.pubkey,tags:t.tags}),!this.verifyEvent(t)){this.log("[handleEvent] Ignoring invalid event",t.id);return}if(this.remote&&t.pubkey!==this.remote){this.log("[handleEvent] Ignoring event from unexpected pubkey",t.pubkey,"expected",this.remote);return}if(!t.tags.some(a=>a[0]==="p"&&a[1]===this.clientPubkey)){this.log("[handleEvent] Ignoring event not tagged to client",t.id,"client",this.clientPubkey);return}this.log("[handleEvent] Event passed checks, attempting decryption for event:",t.id,"from",t.pubkey);try{const a=isNIP04(t.content)?await this.signer.nip04.decrypt(t.pubkey,t.content):await this.signer.nip44.decrypt(t.pubkey,t.content);this.log("[handleEvent] Decrypted content for event:",t.id,"content:",a);const o=JSON.parse(a);if(typeof o!="object"||o===null){this.log("Ignoring non-object response",t.id);return}this.log("Received response:",o);const f="id"in o?String(o.id):void 0,p="result"in o?o.result:void 0;if(!this.remote&&p==="ack"){this.log("Got ack response from potential remote signer",t.pubkey),this.isConnected=!0,this.remote=t.pubkey,(e=this.waitingPromise)==null||e.resolve(),this.waitingPromise=null;return}if(!this.isConnected&&p===this.clientSecret){this.log("Got secret confirmation from remote signer",t.pubkey),this.isConnected=!0,this.remote||(this.remote=t.pubkey),(s=this.waitingPromise)==null||s.resolve(),this.waitingPromise=null;return}if(f&&this.requests.has(f)){const y=this.requests.get(f);isErrorResponse(o)?(this.log("Request error:",f,o.error),y==null||y.reject(new Error(o.error))):(this.log("Request success:",f,p),y==null||y.resolve(p)),this.requests.delete(f)}else f&&this.log("Received response for unknown/untracked request ID:",f)}catch(a){this.log("Failed to handle event",t.id,a)}}async createRequestEvent(t,e=this.remote,s=kinds_exports.NostrConnect){if(!e)throw new Error("Target pubkey not known for request");const a=await this.signer.nip44.encrypt(e,t),o={kind:s,created_at:unixNow(),content:a,tags:[["p",e]]};return this.signer.signEvent(o)}async makeRequest(t,e,s=kinds_exports.NostrConnect){const a=nanoid(8),o={id:a,method:t,params:e},f=await this.createRequestEvent(JSON.stringify(o),this.remote,s),p=createDefer();this.requests.set(a,p),this.log("Making request:",a,t,e),await this.publishMethod(this.relays,f);const y=setTimeout(()=>{var g;this.requests.has(a)&&(this.log("Request timeout:",a),(g=this.requests.get(a))==null||g.reject(new Error("Request timed out")),this.requests.delete(a))},3e4);try{const g=await p;return clearTimeout(y),g}catch(g){throw clearTimeout(y),this.requests.delete(a),g}}async connect(t,e){if(!this.remote&&this.pubkey&&(this.remote=this.pubkey),!this.remote)throw new Error("Missing remote signer pubkey");await this.open();try{const s=[this.clientPubkey];t&&s.push(t),e&&s.push(e.join(","));const a=await this.makeRequest("connect",s);if(a==="ack")return this.isConnected=!0,a;throw new Error(`Unexpected connect response: ${a}`)}catch(s){throw this.isConnected=!1,this.close(),s}}waitForSigner(){return this.isConnected?Promise.resolve():(this.open(),this.waitingPromise||(this.waitingPromise=createDefer()),this.waitingPromise)}async createAccount(t,e,s,a){if(!this.remote)throw new Error("Remote pubkey must be set");await this.open();try{const o=[t,e];s&&o.push(s),a&&o.push(a.join(","));const f=await this.makeRequest("create_account",o);return this.pubkey=f,this.isConnected=!0,f}catch(o){throw this.log("Create account failed",o),o}}async requireConnection(){if(!this.isConnected){if(this.log("Require connection: Not connected, attempting connect..."),!this.remote)throw new Error("Cannot require connection without remote pubkey");if(await this.waitForSigner(),!this.isConnected)throw new Error("Failed to establish connection");this.log("Require connection: Connection established.")}}async getPublicKey(){if(this.pubkey)return this.pubkey;await this.requireConnection();const t=await this.makeRequest("get_public_key",[]);return this.pubkey=t,t}async signEvent(t){await this.requireConnection(),t.pubkey||(t={...t,pubkey:await this.getPublicKey()});const e=await this.makeRequest("sign_event",[JSON.stringify(t)]),s=JSON.parse(e);if(!this.verifyEvent(s))throw new Error("Invalid event signature received from remote signer");return s}async nip04Encrypt(t,e){return await this.requireConnection(),this.makeRequest("nip04_encrypt",[t,e])}async nip04Decrypt(t,e){return await this.requireConnection(),await this.makeRequest("nip04_decrypt",[t,e])}async nip44Encrypt(t,e){return await this.requireConnection(),this.makeRequest("nip44_encrypt",[t,e])}async nip44Decrypt(t,e){return await this.requireConnection(),await this.makeRequest("nip44_decrypt",[t,e])}getNostrConnectURI(t){const e=new URLSearchParams;e.set("secret",this.clientSecret),t!=null&&t.name&&e.set("name",t.name),t!=null&&t.url&&e.set("url",String(t.url)),t!=null&&t.image&&e.set("image",t.image),t!=null&&t.permissions&&e.set("perms",t.permissions.join(","));for(const a of this.relays)e.append("relay",a);return`nostrconnect://${this.clientPubkey}?${e.toString()}`}static parseBunkerURI(t){if(!t.startsWith("bunker://"))throw new Error("Invalid bunker URI scheme");const e=new URL(t),s=e.host||e.pathname.replace(/^\/*/,"");if(!isHexKey(s))throw new Error(`Invalid remote pubkey in bunker URI: ${s}`);const a=e.searchParams.getAll("relay");if(a.length===0)throw new Error("Missing relays in bunker URI");const o=e.searchParams.get("secret")??void 0;return{remote:s,relays:a,secret:o}}static buildSigningPermissions(t){const e=new Set(["get_pubic_key","nip04_encrypt","nip04_decrypt","nip44_encrypt","nip44_decrypt"]);return t.forEach(s=>e.add(`sign_event:${s}`)),Array.from(e)}static async fromBunkerURI(t,e){const{remote:s,relays:a,secret:o}=NostrConnectSigner.parseBunkerURI(t),f=new NostrConnectSigner({relays:a,remote:s,...e});return await f.connect(o,e==null?void 0:e.permissions),f}}const logger=createDebug3("Zapslingers:applesauce-wrapper");class NostrConnectSignerWrapper{constructor(t){pe(this,"ndk");pe(this,"signer");pe(this,"userPromise");pe(this,"_user");pe(this,"options");pe(this,"log",logger.extend("Wrapper"));pe(this,"remotePubkey");pe(this,"isConnected",!1);this.ndk=t.ndk,this.options=t,this.log("Initializing wrapper with options:",{relays:t.relays,remote:t.remote,pubkey:t.pubkey,hasSigner:!!t.signer,hasOnAuth:!!t.onAuth,bunkerUri:t.bunkerUri});const e=(a,o)=>{this.log("NDK Subscribe called via wrapper:",o,a);const f=NDKRelaySet.fromRelayUrls(a,this.ndk),p=this.ndk.subscribe(o,{relaySet:f,closeOnEose:!1});return{subscribe:g=>(p.on("event",x=>{var E;(E=g.next)==null||E.call(g,x.rawEvent())}),p.on("eose",()=>{var x;(x=g.complete)==null||x.call(g)}),this.log("Subscribed to NDK relay events"),{unsubscribe:()=>{this.log("Unsubscribing from NDK relay events"),p.stop()}})}},s=async(a,o)=>{this.log("NDK Publish called via wrapper for event:",o.id,a),await new NDKEvent(this.ndk,o).publish(),this.log("NDK Publish call completed for event:",o.id)};this.signer=new NostrConnectSigner({relays:t.relays||this.ndk.pool.urls(),remote:t.remote,pubkey:t.pubkey,signer:t.signer,onAuth:t.onAuth,subscriptionMethod:e,publishMethod:s}),this.remotePubkey=this.signer.remote,this.isConnected=this.signer.isConnected,t.signal&&t.signal.addEventListener("abort",()=>{this.log("Abort signal received, closing connection."),this.close()},{once:!0}),this.userPromise=new Promise((a,o)=>{(async()=>{var p,y,g;if((p=t.signal)!=null&&p.aborted)return o(new DOMException("Aborted","AbortError"));try{if(this.signer.isConnected){const x=await this.signer.getPublicKey();this._user=this.ndk.getUser({hexpubkey:x}),this.isConnected=!0,this.log("Wrapper connected (pre-connected), user fetched:",x),a(this._user)}else if(this.signer.remote){if(this.log("Waiting for signer connection..."),await this.signer.waitForSigner(),(y=t.signal)!=null&&y.aborted)return o(new DOMException("Aborted","AbortError"));const x=await this.signer.getPublicKey();this._user=this.ndk.getUser({hexpubkey:x}),this.isConnected=!0,this.log("Wrapper connected (waited), user fetched:",x),a(this._user)}else{this.log("Waiting for nostrconnect:// connection...");try{if(await this.signer.waitForSigner(),(g=t.signal)!=null&&g.aborted)return o(new DOMException("Aborted","AbortError"));const x=await this.signer.getPublicKey();this._user=this.ndk.getUser({hexpubkey:x}),this.isConnected=!0,this.log("Wrapper connected (nostrconnect), user fetched:",x),a(this._user)}catch(x){this.log("Error waiting for nostrconnect connection:",x),this.isConnected=!1,this.close(),o(x)}}}catch(x){this.log("Error during initial user fetch/connection wait:",x),this.isConnected=!1,this.close(),o(x)}})()})}get pubkey(){var t;if(!((t=this._user)!=null&&t.pubkey))throw new Error("Signer not ready: User pubkey not available synchronously.");return this._user.pubkey}get nip04(){var t;return(t=this.signer)==null?void 0:t.nip04}get nip44(){var t;return(t=this.signer)==null?void 0:t.nip44}async blockUntilReady(){this.log("blockUntilReady called, awaiting userPromise...");const t=await this.userPromise;return this.log("blockUntilReady completed."),t}get userSync(){if(!this._user)throw new Error("Signer not ready: User not available synchronously.");return this._user}getNostrConnectURI(t){return this.log("Generating nostrconnect URI via underlying signer"),this.signer.getNostrConnectURI(t)}toPayload(){this.log("toPayload called");const t={type:"nostrconnect-wrapper",remotePubkey:this.signer.remote,relays:this.signer.relays,bunkerUri:this.options.bunkerUri};return JSON.stringify(t)}async user(){return this.userPromise}async authUrl(t){return this.signer.onAuth?this.signer.onAuth(t):(this.log("No onAuth handler configured for URL:",t),Promise.resolve())}async encrypt(t,e){var o;const a=(typeof t=="string"?this.ndk.getUser({hexpubkey:t}):t).pubkey;if(!a)throw new Error("Target user pubkey is not available for encryption");if(!((o=this.signer.nip04)!=null&&o.encrypt))throw this.log("NIP-04 encrypt method not found on underlying signer!"),new Error("NIP-04 encrypt not available on signer");return this.log(`Encrypting for ${a} using NIP-04`),this.signer.nip04.encrypt(a,e)}async decrypt(t,e){var f,p;const a=(typeof t=="string"?this.ndk.getUser({hexpubkey:t}):t).pubkey;if(!a)throw new Error("Target user pubkey is not available for decryption");if(!e.includes("?iv=")){if(!((f=this.signer.nip44)!=null&&f.decrypt))throw new Error("NIP-44 decrypt not available on signer");return this.log(`Decrypting from ${a} using NIP-44`),this.signer.nip44.decrypt(a,e)}else{if(!((p=this.signer.nip04)!=null&&p.decrypt))throw new Error("NIP-04 decrypt not available on signer");return this.log(`Decrypting from ${a} using NIP-04`),this.signer.nip04.decrypt(a,e)}}async sign(t){this.log(`Signing event kind: ${t.kind}`);const e={kind:t.kind,tags:t.tags,content:t.content,created_at:t.created_at||Math.floor(Date.now()/1e3)};await this.signer.requireConnection();const s=await this.signer.signEvent(e),a=await this.user();if(s.pubkey!==a.pubkey)throw this.log("Warning: Signed event pubkey mismatch!",{expected:a.pubkey,actual:s.pubkey}),new Error(`Signed event pubkey (${s.pubkey}) does not match expected signer pubkey (${a.pubkey})`);return this.log(`Event signed, id: ${s.id}, sig: ${s.sig}`),s.sig}async connect(t,e){if(!this.signer.remote)throw new Error("Cannot connect: Remote pubkey not specified.");if(this.isConnected){this.log("Connect called but already connected.");return}this.log("Attempting explicit connect call...");try{await this.signer.connect(t,e),this.isConnected=this.signer.isConnected;const s=await this.signer.getPublicKey();this._user=this.ndk.getUser({hexpubkey:s}),this.log("Explicit connect succeeded, user fetched:",s)}catch(s){throw this.log("Explicit connect failed:",s),this.isConnected=!1,this.close(),s}}close(){this.log("Closing wrapper and underlying signer connection."),this.signer.close(),this.isConnected=!1,this._user=void 0}static async fromBunkerURI(t,e){var y;const s=logger.extend("Wrapper:fromBunkerURI");s("Creating wrapper from bunker URI:",t);const{remote:a,relays:o}=NostrConnectSigner.parseBunkerURI(t),f={...e,remote:a,relays:o,bunkerUri:t},p=new NostrConnectSignerWrapper(f);try{if((y=e.signal)!=null&&y.aborted)throw new DOMException("Aborted","AbortError");await p.user(),s("Wrapper created successfully from bunker URI, connected:",p.isConnected)}catch(g){throw s("Failed to connect or fetch user during fromBunkerURI: %o",g),g}return p}}const DEFAULT_NIP46_BUNKER_IDENTIFIER="bunker://ed199f5e5ad67c6c907b0ac31fb28f3a3d199783d80886312b2984198f9aae8c?relay=wss%3A%2F%2Frelay.nsec.app",LOCALSTORAGE_NIP46_BUNKER_URI="nip46_bunker_uri",useAuth=()=>{const{ndkInstance:n,isReady:t,connectionError:e}=useNDKInit(),[s,a]=reactExports.useState(null),[o,f]=reactExports.useState("none"),[p,y]=reactExports.useState(null),[g,x]=reactExports.useState("idle"),[E,A]=reactExports.useState(null),[S,I]=reactExports.useState(!1),_=reactExports.useRef(null),R=reactExports.useRef(null),N=reactExports.useRef(null),D=S,M=s?s.npub:null,W=reactExports.useCallback(($=!1)=>{var V;if(console.log("[useAuth] Cleaning up NIP-46 state."),R.current&&(console.log("[useAuth] Aborting NIP-46 bunker connection attempt."),R.current.abort(),R.current=null),(V=_.current)!=null&&V.isConnected&&(console.log("[useAuth] Closing main NIP-46 signer wrapper."),_.current.close()),_.current=null,N.current&&(console.log("[useAuth] Closing temporary NIP-46 QR signer wrapper."),N.current.close(),N.current=null),(n==null?void 0:n.signer)instanceof NostrConnectSignerWrapper&&(console.log("[useAuth] Clearing NDK NIP-46 wrapper signer."),n.signer=void 0),x("idle"),I(!1),a(null),$){console.log("[useAuth] Clearing NIP-46 persistence (wrapper flow).");try{localStorage.removeItem(LOCALSTORAGE_NIP46_BUNKER_URI)}catch(G){console.error("Failed to clear NIP-46 localStorage:",G)}}},[n]),B=reactExports.useCallback(async()=>{console.log("[useAuth] Logging out..."),a(null),f("none"),A(null),I(!1),W(!0),n!=null&&n.signer&&!(n.signer instanceof NostrConnectSignerWrapper)&&(n.signer=void 0,console.log("[useAuth] Cleared non-NIP-46 NDK signer on logout."))},[n,W]),U=reactExports.useCallback(async()=>{if(!(!n||!t||D)){console.log("[useAuth] Attempting NIP-07 login..."),f("nip07"),A(null),W(!0);try{if(!window.nostr)throw new Error("NIP-07 extension (window.nostr) not found.");const $=new NDKNip07Signer;n.signer=$,await new Promise(G=>setTimeout(G,150));const V=await $.user();console.log(`[useAuth] NIP-07 logged in as: ${V.npub}`),a(V),f("nip07"),I(!0)}catch($){console.error("[useAuth] NIP-07 login failed:",$),A($ instanceof Error?$:new Error("NIP-07 login failed or rejected.")),f("none"),I(!1),n&&(n.signer=void 0)}}},[n,t,D,W]),P=reactExports.useCallback(async $=>{if(!n||!t){A(new Error("NDK not ready for NIP-46."));return}if(g==="connecting"||g==="connected"){console.warn("[useAuth] NIP-46 login already in progress or connected.");return}const V=($==null?void 0:$.trim())||DEFAULT_NIP46_BUNKER_IDENTIFIER;console.log(`[useAuth] Initiating NIP-46 login with wrapper for bunker URI: ${V}`),W(),f("nip46"),x("connecting"),A(null);const G=new AbortController;R.current=G;try{console.log("[useAuth] Attempting NIP-46 connection with wrapper using URI:",V);const se={ndk:n,signal:G.signal},H=await NostrConnectSignerWrapper.fromBunkerURI(V,se);if(_.current=H,G.signal.aborted){console.log("[useAuth] NIP-46 connection attempt aborted.");return}if(H.isConnected){console.log("[useAuth] NIP-46 Wrapper connected successfully. Remote pubkey:",H.remotePubkey),n.signer=H;const J=await H.user();try{localStorage.setItem(LOCALSTORAGE_NIP46_BUNKER_URI,V)}catch(K){console.warn("Failed to persist NIP-46 bunker URI:",K)}a(J),I(!0),f("nip46"),x("connected"),A(null)}else throw console.error("[useAuth] NostrConnectSignerWrapper failed to connect but didn't throw."),new Error("NostrConnectSignerWrapper failed to connect.")}catch(se){const H=se instanceof Error?se.message:String(se);se instanceof Error&&se.name==="AbortError"?console.log("[useAuth] NIP-46 connection explicitly aborted by user."):(console.error("[useAuth] NIP-46 connection using wrapper failed:",se),A(new Error(H||"Failed to connect via NIP-46.")),x("failed"),W(!0))}finally{R.current=null}},[n,t,g,W]);reactExports.useEffect(()=>{(async()=>{if(n&&t&&!D&&o==="none")try{const V=localStorage.getItem(LOCALSTORAGE_NIP46_BUNKER_URI);V&&(console.log("[useAuth] Found persisted NIP-46 bunker URI. Attempting reconnect:",V),f("nip46"),x("connecting"),await P(V))}catch(V){console.error("[useAuth] Failed to read persisted NIP-46 URI or reconnect:",V),localStorage.removeItem(LOCALSTORAGE_NIP46_BUNKER_URI),f("none"),x("idle"),I(!1)}})()},[n,t]);const F=reactExports.useCallback(async()=>{if(!n||!t){A(new Error("NDK not ready for NIP-46."));return}if(["connecting","connected","waiting_for_scan","waiting_for_mobile_approval"].includes(g)){console.warn("[useAuth] NIP-46 login already in progress or connected.");return}console.log("[useAuth] Initiating NIP-46 login with QR code..."),W(),f("nip46"),A(null),x("waiting_for_scan");try{const $=new NostrConnectSignerWrapper({ndk:n});N.current=$;const V={name:"Zapslingers"},G=$.getNostrConnectURI(V);console.log(`[useAuth QR Flow] Generated authUrl: ${G}, Type: ${typeof G}`),y(G),console.log("[useAuth] Generated NIP-46 Auth URL for QR code."),console.log("[useAuth] Waiting for QR code scan and connection...");const se=await $.blockUntilReady();console.log(`[useAuth] NIP-46 QR connection successful! User: ${se.npub}`),_.current=$,N.current=null,n.signer=$,a(se),I(!0),f("nip46"),x("connected"),y(null),A(null),console.log("[useAuth] QR flow connection complete. Persistence skipped for this method.")}catch($){console.error("[useAuth] NIP-46 QR connection failed:",$),A($ instanceof Error?$:new Error("Failed to connect via NIP-46 QR code.")),W()}},[n,t,g,W]),j=reactExports.useCallback(async()=>{if(!n||!t){A(new Error("NDK not ready for NIP-46."));return}if(["connecting","connected","waiting_for_scan","waiting_for_mobile_approval"].includes(g)){console.warn("[useAuth] NIP-46 login already in progress or connected.");return}console.log("[useAuth] Initiating NIP-46 mobile deeplink login..."),W(),f("nip46"),A(null),x("waiting_for_mobile_approval");try{const $=new NostrConnectSignerWrapper({ndk:n});N.current=$;const V={name:"Zapslingers"},G=$.getNostrConnectURI(V);if(console.log("[useAuth] Generated NIP-46 Auth URL for mobile deeplink:",G),console.log("[useAuth] Attempting to open mobile deeplink using window.open..."),!window.open(G,"_blank")){console.error("[useAuth] Failed to open deeplink window/tab. Pop-up blocker?"),A(new Error("Could not open signer app. Please ensure pop-ups are allowed or try manually copying the URI.")),x("failed");return}console.log("[useAuth] Waiting for mobile app approval and connection...");const H=await $.blockUntilReady();console.log(`[useAuth] NIP-46 mobile deeplink connection successful! User: ${H.npub}`),_.current=$,N.current=null,n.signer=$,a(H),I(!0),f("nip46"),x("connected"),A(null),console.log("[useAuth] Mobile deeplink flow connection complete. Persistence skipped.")}catch($){console.error("[useAuth] NIP-46 mobile deeplink connection failed:",$),A($ instanceof Error?$:new Error("Failed to connect via NIP-46 mobile app.")),W()}},[n,t,g,W]),Q=reactExports.useCallback(()=>{console.log("[useAuth] Attempting to cancel NIP-46 login..."),R.current?R.current.abort():N.current&&(N.current.close(),N.current=null),W(),A(new Error("NIP-46 connection cancelled by user."))},[W]);return{ndk:n,isNdkReady:t,ndkConnectionError:e,currentUser:s,currentUserNpub:M,isLoggedIn:D,loginMethod:o,nip46AuthUrl:p,nip46Status:g,authError:E,loginWithNip07:U,initiateNip46Login:P,initiateNip46QrCodeLogin:F,initiateNip46MobileDeepLinkLogin:j,logout:B,cancelNip46LoginAttempt:Q}},ZOOM_LERP_FACTOR=.08,MAX_ZOOM_FACTOR=1.5,MAX_VIEW_FACTOR=1.5,VIEWPORT_PADDING=100,useDynamicViewport=({engine:n,getDynamicBodies:t,virtualWidth:e,virtualHeight:s,designAspectRatio:a,canvasSize:o})=>{const f=reactExports.useRef(e),p=reactExports.useRef(s),y=reactExports.useRef(e/2),g=reactExports.useRef(s/2),x=reactExports.useRef(e),E=reactExports.useRef(s),A=reactExports.useRef(e/2),S=reactExports.useRef(s/2),[I,_]=reactExports.useState({scale:1,offsetX:0,offsetY:0}),R=reactExports.useCallback(()=>{if(!n)return;const N=t(),D=N.length>0;let M=e,W=0,B=s,U=0;D?(M=1/0,W=-1/0,B=1/0,U=-1/0,N.forEach($=>{const V=$.bounds;M=Math.min(M,V.min.x),W=Math.max(W,V.max.x),B=Math.min(B,V.min.y),U=Math.max(U,V.max.y)})):(M=e*.2,W=e*.8,B=s*.2,U=s*.8);let P=W-M+2*VIEWPORT_PADDING,F=U-B+2*VIEWPORT_PADDING;const j=(M+W)/2,Q=(B+U)/2;P/F>a?F=P/a:P=F*a,P=Math.max(P,e/MAX_ZOOM_FACTOR),F=Math.max(F,s/MAX_ZOOM_FACTOR),P=Math.min(P,e*MAX_VIEW_FACTOR),F=Math.min(F,s*MAX_VIEW_FACTOR),x.current=P,E.current=F,A.current=j,S.current=Q},[n,t,e,s,a]);return reactExports.useEffect(()=>{let N;const D=()=>{if(f.current+=(x.current-f.current)*ZOOM_LERP_FACTOR,p.current+=(E.current-p.current)*ZOOM_LERP_FACTOR,y.current+=(A.current-y.current)*ZOOM_LERP_FACTOR,g.current+=(S.current-g.current)*ZOOM_LERP_FACTOR,o.width>0&&o.height>0){const W=o.width/f.current,B=f.current*W,U=p.current*W,P=(o.width-B)/2-(y.current-f.current/2)*W,F=(o.height-U)/2-(g.current-p.current/2)*W;_({scale:W,offsetX:P,offsetY:F})}else _({scale:1,offsetX:0,offsetY:0});N=requestAnimationFrame(D)};return D(),()=>cancelAnimationFrame(N)},[o,x,E,A,S]),reactExports.useEffect(()=>{R();const N=setInterval(R,100);return()=>clearInterval(N)},[R]),I},drawBackground=(n,t)=>{const e=n.canvas,s=e.width,a=e.height;if(t&&t.naturalWidth&&t.naturalHeight){const o=t.naturalWidth/t.naturalHeight,f=n.getTransform(),p=new DOMPoint(0,0).matrixTransform(f.inverse()),y=new DOMPoint(s,a).matrixTransform(f.inverse()),g=p.x,x=p.y,E=y.x-p.x,A=y.y-p.y,S=E/A;let I,_,R,N;o>S?(_=A,I=_*o,R=g+(E-I)/2,N=x):(I=E,_=I/o,R=g,N=x+(A-_)/2),n.drawImage(t,R,N,I,_)}else{const o=n.getTransform(),f=new DOMPoint(0,0).matrixTransform(o.inverse()),p=new DOMPoint(s,a).matrixTransform(o.inverse());n.fillStyle="#000020",n.fillRect(f.x,f.y,p.x-f.x,p.y-f.y)}},drawBorder=(n,t,e)=>{n.strokeStyle="rgba(207, 145, 30, 0.76)",n.lineWidth=2/t;const s=-e.VIRTUAL_WIDTH/2,a=-e.VIRTUAL_HEIGHT,o=e.VIRTUAL_WIDTH*2,f=e.VIRTUAL_HEIGHT*3;n.strokeRect(s,a,o,f)},drawPlanet=(n,t,e)=>{var p,y;const{x:s,y:a}=t.position,o=((y=(p=t.plugin)==null?void 0:p.Zapslingers)==null?void 0:y.radius)||e.PLANET_MIN_RADIUS;let f;if(t.label==="orange-planet"){const g="#D97706",x="#F59E0B",I=Math.min(1,Math.max(0,o/250))<.5?x:"#FCD34D";f=n.createRadialGradient(s,a,o*.1,s,a,o),f.addColorStop(0,I),f.addColorStop(.7,x),f.addColorStop(1,g)}else{const g="#A0A0A0",x="#606060";f=n.createRadialGradient(s,a,o*.2,s,a,o),f.addColorStop(0,g),f.addColorStop(1,x)}n.beginPath(),n.arc(s,a,o,0,2*Math.PI),n.fillStyle=f,n.fill()},drawShip=(n,t,e,s,a)=>{const f=parseInt(t.label.split("-")[1],10)===0?e:s;if(!f||f.width===0)return;const p=a.SHIP_RADIUS*2,y=f.height/f.width,g=p,x=p*y;n.save(),n.translate(t.position.x,t.position.y),n.rotate(t.angle+Math.PI/2),n.drawImage(f,-g/2,-x/2,g,x),n.restore()},drawProjectile=(n,t,e)=>{var a;n.beginPath(),n.arc(t.position.x,t.position.y,e.STANDARD_PROJECTILE_RADIUS,0,2*Math.PI);const s=((a=t.custom)==null?void 0:a.firedByPlayerIndex)??0;n.fillStyle=s===0?"#add8e6":"#ffcccb",n.fill()},drawHistoricalTrace=(n,t)=>{if(!(t.length<2)){n.beginPath(),n.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;e++)n.lineTo(t[e].x,t[e].y);n.strokeStyle="#C0C0C0",n.lineWidth=2,n.setLineDash([8,4]),n.stroke(),n.setLineDash([])}},GameRenderer=({physicsHandles:n,shotTracerHandlers:t,settings:e,aimStates:s})=>{const a=reactExports.useRef(null),[o,f]=reactExports.useState(null),[p,y]=reactExports.useState(null),[g,x]=reactExports.useState(null),[E,A]=reactExports.useState({width:0,height:0}),{lastShotTraces:S}=t,I=useDynamicViewport({engine:(n==null?void 0:n.engine)??null,getDynamicBodies:(n==null?void 0:n.getDynamicBodies)??(()=>[]),virtualWidth:e.VIRTUAL_WIDTH,virtualHeight:e.VIRTUAL_HEIGHT,designAspectRatio:e.VIRTUAL_WIDTH/e.VIRTUAL_HEIGHT,canvasSize:E}),_=reactExports.useRef(S);return reactExports.useEffect(()=>{_.current=S},[S]),reactExports.useEffect(()=>{const R=new Image;R.onload=()=>f(R),R.onerror=()=>console.error("Failed to load background image."),R.src="/images/backdrop.png";const N=new Image;N.onload=()=>y(N),N.onerror=()=>console.error("Failed to load blue ship image."),N.src="/icons/spaceship_small_blue.png";const D=new Image;D.onload=()=>x(D),D.onerror=()=>console.error("Failed to load red ship image."),D.src="/icons/spaceship_small_red.png"},[]),reactExports.useEffect(()=>{const R=a.current;if(!R)return;const N=new ResizeObserver(W=>{for(const B of W){const{width:U,height:P}=B.contentRect;console.log(`[GameRenderer ResizeObserver] Canvas resized to: ${U}x${P}`),A({width:U,height:P}),R.width=U,R.height=P}});N.observe(R);const D=R.clientWidth,M=R.clientHeight;return D>0&&M>0&&(console.log(`[GameRenderer Resize] Setting initial canvas size: ${D}x${M}`),A({width:D,height:M}),R.width=D,R.height=M),()=>{N.disconnect()}},[]),reactExports.useEffect(()=>{let R;const N=()=>{const D=a.current,M=n==null?void 0:n.engine,W=n==null?void 0:n.getAllBodies;if(!D||!M||!W){R=requestAnimationFrame(N);return}const B=D.getContext("2d");if(!B){R=requestAnimationFrame(N);return}B.save(),B.clearRect(0,0,D.width,D.height),B.translate(I.offsetX,I.offsetY),B.scale(I.scale,I.scale),drawBackground(B,o),drawBorder(B,I.scale,e),W().forEach(F=>{var j;if(F.label==="planet"||F.label==="orange-planet")drawPlanet(B,F,e);else if(F.label.startsWith("ship-")){drawShip(B,F,p,g,e);const Q=parseInt(F.label.split("-")[1],10),$=((j=s[Q])==null?void 0:j.power)||0,V=e.SHIP_RADIUS*.5,G=e.SHIP_RADIUS*2.5,se=V+(G-V)*($/100),H=F.angle,J=e.SHIP_RADIUS*1,K=Math.cos(H)*J,ie=Math.sin(H)*J,ne=F.position.x+K,re=F.position.y+ie,X=ne+Math.cos(H)*se,ae=re+Math.sin(H)*se;B.beginPath(),B.moveTo(ne,re),B.lineTo(X,ae),B.strokeStyle="rgba(251, 126, 17, 0.86)",B.lineWidth=2/I.scale,B.setLineDash([8/I.scale,3/I.scale]),B.stroke(),B.setLineDash([])}else F.label.startsWith("projectile-")&&drawProjectile(B,F,e)});const P=_.current;P[0].forEach(F=>drawHistoricalTrace(B,F)),P[1].forEach(F=>drawHistoricalTrace(B,F)),B.restore(),R=requestAnimationFrame(N)};return R=requestAnimationFrame(N),()=>cancelAnimationFrame(R)},[I,n,o,p,g,e,s]),jsxRuntimeExports.jsx("canvas",{ref:a,className:"w-full h-full block bg-black"})},AimingInterface=({onAimChange:n,currentAngle:t,currentPower:e})=>{const s=reactExports.useRef(null),a=reactExports.useRef(null),[o,f]=reactExports.useState(!1),p=(S,I,_,R)=>{const N=S-_,D=I-R;let W=Math.atan2(D,N)*(180/Math.PI);return W=(W+360)%360,W},y=reactExports.useCallback(S=>{f(!0),S.preventDefault()},[]),g=reactExports.useCallback(S=>{if(!o||!s.current||!a.current)return;const I=s.current.getBoundingClientRect(),_=I.left+I.width/2,R=I.top+I.height/2;let N,D;if(typeof TouchEvent<"u"&&S instanceof TouchEvent)N=S.touches[0].clientX,D=S.touches[0].clientY;else if(S instanceof MouseEvent)N=S.clientX,D=S.clientY;else return;const M=p(N,D,_,R),W=M*(Math.PI/180),B=I.width/2-a.current.offsetWidth/2,U=Math.cos(W)*B,P=Math.sin(W)*B;a.current.style.transform=`translate(${U}px, ${P}px)`,n({angle:M,power:e})},[o,n,e]),x=reactExports.useCallback(()=>{o&&(f(!1),a.current&&(a.current.style.transform="translate(0px, 0px)"))},[o]),E=reactExports.useRef(null),A=reactExports.useCallback(S=>{if(!E.current)return;const I=E.current.getBoundingClientRect();let _;"touches"in S?_=S.touches[0].clientX:_=S.clientX;const R=_-I.left;let N=R/I.width*100;N=Math.max(0,Math.min(100,Math.round(N))),console.log(`[AimingInterface] Power bar interaction. X: ${R.toFixed(1)}, Width: ${I.width.toFixed(1)}, Calculated Power: ${N}`),n({angle:t,power:N})},[t,n]);return reactExports.useEffect(()=>(o&&(window.addEventListener("mousemove",g),window.addEventListener("touchmove",g),window.addEventListener("mouseup",x),window.addEventListener("touchend",x)),()=>{window.removeEventListener("mousemove",g),window.removeEventListener("touchmove",g),window.removeEventListener("mouseup",x),window.removeEventListener("touchend",x)}),[o,g,x]),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[jsxRuntimeExports.jsx("div",{ref:s,className:"w-28 h-28 bg-gray-800/50 rounded-full relative cursor-grab flex items-center justify-center touch-none",onMouseDown:y,onTouchStart:y,children:jsxRuntimeExports.jsx("div",{ref:a,className:`
            w-10 h-10 bg-purple-500 rounded-full 
            shadow-lg shadow-purple-500/50 ring-2 ring-purple-400/30 
            pointer-events-none transition-transform duration-100 ease-linear
            ${o?"opacity-100":"opacity-50"}
          `,style:{filter:"blur(1px)"}})}),jsxRuntimeExports.jsx("div",{ref:E,className:"w-40 h-5 bg-gradient-to-r from-red-800 via-red-600 to-red-500 rounded-lg cursor-pointer relative overflow-hidden mt-2",onClick:A,onTouchStart:A,onTouchMove:A,children:jsxRuntimeExports.jsx("div",{className:`absolute top-0 left-0 h-full transition-all duration-100 ease-linear ${e<34?"bg-green-500":e<67?"bg-yellow-500":"bg-red-600"}`,style:{width:`${e}%`}})})]})};function UserProfileDisplay({pubkey:n,ndk:t}){const[e,s]=reactExports.useState(null),[a,o]=reactExports.useState(""),[f,p]=reactExports.useState(!1);reactExports.useEffect(()=>{n&&t?(console.log(`[UserProfileDisplay] Fetching profile for pubkey: ${n}`),t.getUser({pubkey:n}).fetchProfile().then(A=>{console.log(`[UserProfileDisplay] Fetched profile for ${n}:`,A),s(A)}).catch(A=>{console.error(`[UserProfileDisplay] Error fetching profile for ${n}:`,A),s(null)})):s(null)},[n,t]),reactExports.useEffect(()=>{if(n)try{o(nip19_exports.npubEncode(n))}catch(E){console.error("Error encoding npub",n,E),o("invalid_npub")}else o("")},[n]),reactExports.useEffect(()=>{p(!1)},[n]);const y=(e==null?void 0:e.displayName)||(e==null?void 0:e.name)||(a?`${a.substring(0,10)}...${a.substring(a.length-4)}`:"..."),g=e==null?void 0:e.image,x=()=>jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-tr from-purple-400 via-pink-500 to-red-500 flex items-center justify-center text-white font-bold text-xs shrink-0",children:y&&y!=="..."?y.substring(0,2).toUpperCase():"??"});return jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2 min-w-0",children:[g&&!f?jsxRuntimeExports.jsx("img",{src:g,alt:`${y}'s avatar`,className:"w-10 h-10 rounded-full border-2 border-gray-600 shrink-0",onError:()=>p(!0)}):jsxRuntimeExports.jsx(x,{}),jsxRuntimeExports.jsx("span",{className:"font-semibold text-gray-200 truncate",children:y})]})}function HealthBar({currentHp:n,maxHp:t}){const e=t>0?n/t*100:0,s=e>60?"bg-green-500":e>30?"bg-yellow-500":"bg-red-500";return jsxRuntimeExports.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2.5 overflow-hidden border border-gray-600",children:jsxRuntimeExports.jsx("div",{className:`h-2.5 rounded-full transition-all duration-300 ease-in-out ${s}`,style:{width:`${e}%`}})})}function PlayerHUD({pubkey:n,currentHp:t,maxHp:e,isPlayer1:s=!0,ndk:a}){const o=s?"items-start":"items-end",f=s?"justify-start":"justify-end";return jsxRuntimeExports.jsxs("div",{className:`flex flex-col space-y-1 w-48 ${o}`,children:[" ",jsxRuntimeExports.jsxs("div",{className:`flex w-full ${f}`,children:[" ",jsxRuntimeExports.jsx(UserProfileDisplay,{pubkey:n,ndk:a})," "]}),jsxRuntimeExports.jsx(HealthBar,{currentHp:t,maxHp:e})]})}const ActionButtons=n=>{const{onFire:t,selectedAbility:e,onAbilitySelect:s,usedAbilities:a,currentHp:o,abilityCost:f,maxAbilityUsesTotal:p,maxAbilityUsesPerType:y,disabled:g,availableAbilities:x}=n,E=50,A=x.length,S=110,I=-10-S/2,_=A>1?S/(A-1):0,R=()=>{g||(console.log("[ActionButtons] Fire button clicked"),t())},N=D=>{g||s(D)};return jsxRuntimeExports.jsxs("div",{className:"relative w-full h-full",children:[jsxRuntimeExports.jsx("button",{onClick:R,disabled:g,className:`absolute bottom-1 right-1 z-20 px-5 py-2 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg shadow-lg transition-colors duration-150 focus:outline-none select-none bg-opacity-75 text-opacity-90 ${g?"opacity-50 cursor-not-allowed":""}`,children:"Fire!"}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-8 right-16 z-10 w-0 h-0",children:x.map((D,M)=>{const W=Array.from(a).filter(J=>J===D).length,B=W>=y,U=a.size>=p,P=o>=f,F=g||B||U||!P,j=e===D;let Q="bg-purple-600 hover:bg-purple-700 bg-opacity-75",$="border-transparent";j&&($="border-yellow-400 border-opacity-75"),F&&(Q="bg-gray-600 opacity-60",$="border-transparent");const G=(I+M*_)*(Math.PI/180),se=E*Math.sin(G),H=-50*Math.cos(G);return jsxRuntimeExports.jsx("button",{onClick:()=>N(D),disabled:F,className:`absolute w-10 h-10 ${Q} rounded-full flex items-center justify-center text-white text-opacity-90 text-lg font-bold shadow-md transition-all duration-150 focus:outline-none disabled:cursor-not-allowed border-2 ${$}`,style:{transform:`translate(${se}px, ${H}px) translate(-50%, -50%)`,top:"0px",left:"0px"},title:(D==="splitter"?"Splitter : Splits into 3 after a short time.":D==="gravity"?"Gravity : Projectile is attracted towards opponent ship.":D==="plastic"?"Plastic : Less affected by planet gravity.":D)+` (Cost: ${f} HP) - Used ${W}/${y} (Total: ${a.size}/${p}) - ${F?"Unavailable":"Available"}`,children:D==="splitter"?"":D==="gravity"?"":D==="plastic"?"":D.slice(0,3)},D)})})]})};var matter$1={exports:{}};/*!
 * matter-js 0.20.0 by @liabru
 * http://brm.io/matter-js/
 * License MIT
 * 
 * The MIT License (MIT)
 * 
 * Copyright (c) Liam Brummitt and contributors.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var matter=matter$1.exports,hasRequiredMatter;function requireMatter(){return hasRequiredMatter||(hasRequiredMatter=1,function(n,t){(function(s,a){n.exports=a()})(matter,function(){return function(e){var s={};function a(o){if(s[o])return s[o].exports;var f=s[o]={i:o,l:!1,exports:{}};return e[o].call(f.exports,f,f.exports,a),f.l=!0,f.exports}return a.m=e,a.c=s,a.d=function(o,f,p){a.o(o,f)||Object.defineProperty(o,f,{enumerable:!0,get:p})},a.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},a.t=function(o,f){if(f&1&&(o=a(o)),f&8||f&4&&typeof o=="object"&&o&&o.__esModule)return o;var p=Object.create(null);if(a.r(p),Object.defineProperty(p,"default",{enumerable:!0,value:o}),f&2&&typeof o!="string")for(var y in o)a.d(p,y,(function(g){return o[g]}).bind(null,y));return p},a.n=function(o){var f=o&&o.__esModule?function(){return o.default}:function(){return o};return a.d(f,"a",f),f},a.o=function(o,f){return Object.prototype.hasOwnProperty.call(o,f)},a.p="",a(a.s=20)}([function(e,s){var a={};e.exports=a,function(){a._baseDelta=1e3/60,a._nextId=0,a._seed=0,a._nowStartTime=+new Date,a._warnedOnce={},a._decomp=null,a.extend=function(f,p){var y,g;typeof p=="boolean"?(y=2,g=p):(y=1,g=!0);for(var x=y;x<arguments.length;x++){var E=arguments[x];if(E)for(var A in E)g&&E[A]&&E[A].constructor===Object&&(!f[A]||f[A].constructor===Object)?(f[A]=f[A]||{},a.extend(f[A],g,E[A])):f[A]=E[A]}return f},a.clone=function(f,p){return a.extend({},p,f)},a.keys=function(f){if(Object.keys)return Object.keys(f);var p=[];for(var y in f)p.push(y);return p},a.values=function(f){var p=[];if(Object.keys){for(var y=Object.keys(f),g=0;g<y.length;g++)p.push(f[y[g]]);return p}for(var x in f)p.push(f[x]);return p},a.get=function(f,p,y,g){p=p.split(".").slice(y,g);for(var x=0;x<p.length;x+=1)f=f[p[x]];return f},a.set=function(f,p,y,g,x){var E=p.split(".").slice(g,x);return a.get(f,p,0,-1)[E[E.length-1]]=y,y},a.shuffle=function(f){for(var p=f.length-1;p>0;p--){var y=Math.floor(a.random()*(p+1)),g=f[p];f[p]=f[y],f[y]=g}return f},a.choose=function(f){return f[Math.floor(a.random()*f.length)]},a.isElement=function(f){return typeof HTMLElement<"u"?f instanceof HTMLElement:!!(f&&f.nodeType&&f.nodeName)},a.isArray=function(f){return Object.prototype.toString.call(f)==="[object Array]"},a.isFunction=function(f){return typeof f=="function"},a.isPlainObject=function(f){return typeof f=="object"&&f.constructor===Object},a.isString=function(f){return toString.call(f)==="[object String]"},a.clamp=function(f,p,y){return f<p?p:f>y?y:f},a.sign=function(f){return f<0?-1:1},a.now=function(){if(typeof window<"u"&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-a._nowStartTime},a.random=function(f,p){return f=typeof f<"u"?f:0,p=typeof p<"u"?p:1,f+o()*(p-f)};var o=function(){return a._seed=(a._seed*9301+49297)%233280,a._seed/233280};a.colorToNumber=function(f){return f=f.replace("#",""),f.length==3&&(f=f.charAt(0)+f.charAt(0)+f.charAt(1)+f.charAt(1)+f.charAt(2)+f.charAt(2)),parseInt(f,16)},a.logLevel=1,a.log=function(){console&&a.logLevel>0&&a.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},a.info=function(){console&&a.logLevel>0&&a.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},a.warn=function(){console&&a.logLevel>0&&a.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},a.warnOnce=function(){var f=Array.prototype.slice.call(arguments).join(" ");a._warnedOnce[f]||(a.warn(f),a._warnedOnce[f]=!0)},a.deprecated=function(f,p,y){f[p]=a.chain(function(){a.warnOnce(" deprecated ",y)},f[p])},a.nextId=function(){return a._nextId++},a.indexOf=function(f,p){if(f.indexOf)return f.indexOf(p);for(var y=0;y<f.length;y++)if(f[y]===p)return y;return-1},a.map=function(f,p){if(f.map)return f.map(p);for(var y=[],g=0;g<f.length;g+=1)y.push(p(f[g]));return y},a.topologicalSort=function(f){var p=[],y=[],g=[];for(var x in f)!y[x]&&!g[x]&&a._topologicalSort(x,y,g,f,p);return p},a._topologicalSort=function(f,p,y,g,x){var E=g[f]||[];y[f]=!0;for(var A=0;A<E.length;A+=1){var S=E[A];y[S]||p[S]||a._topologicalSort(S,p,y,g,x)}y[f]=!1,p[f]=!0,x.push(f)},a.chain=function(){for(var f=[],p=0;p<arguments.length;p+=1){var y=arguments[p];y._chained?f.push.apply(f,y._chained):f.push(y)}var g=function(){for(var x,E=new Array(arguments.length),A=0,S=arguments.length;A<S;A++)E[A]=arguments[A];for(A=0;A<f.length;A+=1){var I=f[A].apply(x,E);typeof I<"u"&&(x=I)}return x};return g._chained=f,g},a.chainPathBefore=function(f,p,y){return a.set(f,p,a.chain(y,a.get(f,p)))},a.chainPathAfter=function(f,p,y){return a.set(f,p,a.chain(a.get(f,p),y))},a.setDecomp=function(f){a._decomp=f},a.getDecomp=function(){var f=a._decomp;try{!f&&typeof window<"u"&&(f=window.decomp),!f&&typeof commonjsGlobal<"u"&&(f=commonjsGlobal.decomp)}catch{f=null}return f}}()},function(e,s){var a={};e.exports=a,function(){a.create=function(o){var f={min:{x:0,y:0},max:{x:0,y:0}};return o&&a.update(f,o),f},a.update=function(o,f,p){o.min.x=1/0,o.max.x=-1/0,o.min.y=1/0,o.max.y=-1/0;for(var y=0;y<f.length;y++){var g=f[y];g.x>o.max.x&&(o.max.x=g.x),g.x<o.min.x&&(o.min.x=g.x),g.y>o.max.y&&(o.max.y=g.y),g.y<o.min.y&&(o.min.y=g.y)}p&&(p.x>0?o.max.x+=p.x:o.min.x+=p.x,p.y>0?o.max.y+=p.y:o.min.y+=p.y)},a.contains=function(o,f){return f.x>=o.min.x&&f.x<=o.max.x&&f.y>=o.min.y&&f.y<=o.max.y},a.overlaps=function(o,f){return o.min.x<=f.max.x&&o.max.x>=f.min.x&&o.max.y>=f.min.y&&o.min.y<=f.max.y},a.translate=function(o,f){o.min.x+=f.x,o.max.x+=f.x,o.min.y+=f.y,o.max.y+=f.y},a.shift=function(o,f){var p=o.max.x-o.min.x,y=o.max.y-o.min.y;o.min.x=f.x,o.max.x=f.x+p,o.min.y=f.y,o.max.y=f.y+y}}()},function(e,s){var a={};e.exports=a,function(){a.create=function(o,f){return{x:o||0,y:f||0}},a.clone=function(o){return{x:o.x,y:o.y}},a.magnitude=function(o){return Math.sqrt(o.x*o.x+o.y*o.y)},a.magnitudeSquared=function(o){return o.x*o.x+o.y*o.y},a.rotate=function(o,f,p){var y=Math.cos(f),g=Math.sin(f);p||(p={});var x=o.x*y-o.y*g;return p.y=o.x*g+o.y*y,p.x=x,p},a.rotateAbout=function(o,f,p,y){var g=Math.cos(f),x=Math.sin(f);y||(y={});var E=p.x+((o.x-p.x)*g-(o.y-p.y)*x);return y.y=p.y+((o.x-p.x)*x+(o.y-p.y)*g),y.x=E,y},a.normalise=function(o){var f=a.magnitude(o);return f===0?{x:0,y:0}:{x:o.x/f,y:o.y/f}},a.dot=function(o,f){return o.x*f.x+o.y*f.y},a.cross=function(o,f){return o.x*f.y-o.y*f.x},a.cross3=function(o,f,p){return(f.x-o.x)*(p.y-o.y)-(f.y-o.y)*(p.x-o.x)},a.add=function(o,f,p){return p||(p={}),p.x=o.x+f.x,p.y=o.y+f.y,p},a.sub=function(o,f,p){return p||(p={}),p.x=o.x-f.x,p.y=o.y-f.y,p},a.mult=function(o,f){return{x:o.x*f,y:o.y*f}},a.div=function(o,f){return{x:o.x/f,y:o.y/f}},a.perp=function(o,f){return f=f===!0?-1:1,{x:f*-o.y,y:f*o.x}},a.neg=function(o){return{x:-o.x,y:-o.y}},a.angle=function(o,f){return Math.atan2(f.y-o.y,f.x-o.x)},a._temp=[a.create(),a.create(),a.create(),a.create(),a.create(),a.create()]}()},function(e,s,a){var o={};e.exports=o;var f=a(2),p=a(0);(function(){o.create=function(y,g){for(var x=[],E=0;E<y.length;E++){var A=y[E],S={x:A.x,y:A.y,index:E,body:g,isInternal:!1};x.push(S)}return x},o.fromPath=function(y,g){var x=/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/ig,E=[];return y.replace(x,function(A,S,I){E.push({x:parseFloat(S),y:parseFloat(I)})}),o.create(E,g)},o.centre=function(y){for(var g=o.area(y,!0),x={x:0,y:0},E,A,S,I=0;I<y.length;I++)S=(I+1)%y.length,E=f.cross(y[I],y[S]),A=f.mult(f.add(y[I],y[S]),E),x=f.add(x,A);return f.div(x,6*g)},o.mean=function(y){for(var g={x:0,y:0},x=0;x<y.length;x++)g.x+=y[x].x,g.y+=y[x].y;return f.div(g,y.length)},o.area=function(y,g){for(var x=0,E=y.length-1,A=0;A<y.length;A++)x+=(y[E].x-y[A].x)*(y[E].y+y[A].y),E=A;return g?x/2:Math.abs(x)/2},o.inertia=function(y,g){for(var x=0,E=0,A=y,S,I,_=0;_<A.length;_++)I=(_+1)%A.length,S=Math.abs(f.cross(A[I],A[_])),x+=S*(f.dot(A[I],A[I])+f.dot(A[I],A[_])+f.dot(A[_],A[_])),E+=S;return g/6*(x/E)},o.translate=function(y,g,x){x=typeof x<"u"?x:1;var E=y.length,A=g.x*x,S=g.y*x,I;for(I=0;I<E;I++)y[I].x+=A,y[I].y+=S;return y},o.rotate=function(y,g,x){if(g!==0){var E=Math.cos(g),A=Math.sin(g),S=x.x,I=x.y,_=y.length,R,N,D,M;for(M=0;M<_;M++)R=y[M],N=R.x-S,D=R.y-I,R.x=S+(N*E-D*A),R.y=I+(N*A+D*E);return y}},o.contains=function(y,g){for(var x=g.x,E=g.y,A=y.length,S=y[A-1],I,_=0;_<A;_++){if(I=y[_],(x-S.x)*(I.y-S.y)+(E-S.y)*(S.x-I.x)>0)return!1;S=I}return!0},o.scale=function(y,g,x,E){if(g===1&&x===1)return y;E=E||o.centre(y);for(var A,S,I=0;I<y.length;I++)A=y[I],S=f.sub(A,E),y[I].x=E.x+S.x*g,y[I].y=E.y+S.y*x;return y},o.chamfer=function(y,g,x,E,A){typeof g=="number"?g=[g]:g=g||[8],x=typeof x<"u"?x:-1,E=E||2,A=A||14;for(var S=[],I=0;I<y.length;I++){var _=y[I-1>=0?I-1:y.length-1],R=y[I],N=y[(I+1)%y.length],D=g[I<g.length?I:g.length-1];if(D===0){S.push(R);continue}var M=f.normalise({x:R.y-_.y,y:_.x-R.x}),W=f.normalise({x:N.y-R.y,y:R.x-N.x}),B=Math.sqrt(2*Math.pow(D,2)),U=f.mult(p.clone(M),D),P=f.normalise(f.mult(f.add(M,W),.5)),F=f.sub(R,f.mult(P,B)),j=x;x===-1&&(j=Math.pow(D,.32)*1.75),j=p.clamp(j,E,A),j%2===1&&(j+=1);for(var Q=Math.acos(f.dot(M,W)),$=Q/j,V=0;V<j;V++)S.push(f.add(f.rotate(U,$*V),F))}return S},o.clockwiseSort=function(y){var g=o.mean(y);return y.sort(function(x,E){return f.angle(g,x)-f.angle(g,E)}),y},o.isConvex=function(y){var g=0,x=y.length,E,A,S,I;if(x<3)return null;for(E=0;E<x;E++)if(A=(E+1)%x,S=(E+2)%x,I=(y[A].x-y[E].x)*(y[S].y-y[A].y),I-=(y[A].y-y[E].y)*(y[S].x-y[A].x),I<0?g|=1:I>0&&(g|=2),g===3)return!1;return g!==0?!0:null},o.hull=function(y){var g=[],x=[],E,A;for(y=y.slice(0),y.sort(function(S,I){var _=S.x-I.x;return _!==0?_:S.y-I.y}),A=0;A<y.length;A+=1){for(E=y[A];x.length>=2&&f.cross3(x[x.length-2],x[x.length-1],E)<=0;)x.pop();x.push(E)}for(A=y.length-1;A>=0;A-=1){for(E=y[A];g.length>=2&&f.cross3(g[g.length-2],g[g.length-1],E)<=0;)g.pop();g.push(E)}return g.pop(),x.pop(),g.concat(x)}})()},function(e,s,a){var o={};e.exports=o;var f=a(3),p=a(2),y=a(7),g=a(0),x=a(1),E=a(11);(function(){o._timeCorrection=!0,o._inertiaScale=4,o._nextCollidingGroupId=1,o._nextNonCollidingGroupId=-1,o._nextCategory=1,o._baseDelta=1e3/60,o.create=function(S){var I={id:g.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:f.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,deltaTime:16.666666666666668,_original:null},_=g.extend(I,S);return A(_,S),_},o.nextGroup=function(S){return S?o._nextNonCollidingGroupId--:o._nextCollidingGroupId++},o.nextCategory=function(){return o._nextCategory=o._nextCategory<<1,o._nextCategory};var A=function(S,I){I=I||{},o.set(S,{bounds:S.bounds||x.create(S.vertices),positionPrev:S.positionPrev||p.clone(S.position),anglePrev:S.anglePrev||S.angle,vertices:S.vertices,parts:S.parts||[S],isStatic:S.isStatic,isSleeping:S.isSleeping,parent:S.parent||S}),f.rotate(S.vertices,S.angle,S.position),E.rotate(S.axes,S.angle),x.update(S.bounds,S.vertices,S.velocity),o.set(S,{axes:I.axes||S.axes,area:I.area||S.area,mass:I.mass||S.mass,inertia:I.inertia||S.inertia});var _=S.isStatic?"#14151f":g.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),R=S.isStatic?"#555":"#ccc",N=S.isStatic&&S.render.fillStyle===null?1:0;S.render.fillStyle=S.render.fillStyle||_,S.render.strokeStyle=S.render.strokeStyle||R,S.render.lineWidth=S.render.lineWidth||N,S.render.sprite.xOffset+=-(S.bounds.min.x-S.position.x)/(S.bounds.max.x-S.bounds.min.x),S.render.sprite.yOffset+=-(S.bounds.min.y-S.position.y)/(S.bounds.max.y-S.bounds.min.y)};o.set=function(S,I,_){var R;typeof I=="string"&&(R=I,I={},I[R]=_);for(R in I)if(Object.prototype.hasOwnProperty.call(I,R))switch(_=I[R],R){case"isStatic":o.setStatic(S,_);break;case"isSleeping":y.set(S,_);break;case"mass":o.setMass(S,_);break;case"density":o.setDensity(S,_);break;case"inertia":o.setInertia(S,_);break;case"vertices":o.setVertices(S,_);break;case"position":o.setPosition(S,_);break;case"angle":o.setAngle(S,_);break;case"velocity":o.setVelocity(S,_);break;case"angularVelocity":o.setAngularVelocity(S,_);break;case"speed":o.setSpeed(S,_);break;case"angularSpeed":o.setAngularSpeed(S,_);break;case"parts":o.setParts(S,_);break;case"centre":o.setCentre(S,_);break;default:S[R]=_}},o.setStatic=function(S,I){for(var _=0;_<S.parts.length;_++){var R=S.parts[_];I?(R.isStatic||(R._original={restitution:R.restitution,friction:R.friction,mass:R.mass,inertia:R.inertia,density:R.density,inverseMass:R.inverseMass,inverseInertia:R.inverseInertia}),R.restitution=0,R.friction=1,R.mass=R.inertia=R.density=1/0,R.inverseMass=R.inverseInertia=0,R.positionPrev.x=R.position.x,R.positionPrev.y=R.position.y,R.anglePrev=R.angle,R.angularVelocity=0,R.speed=0,R.angularSpeed=0,R.motion=0):R._original&&(R.restitution=R._original.restitution,R.friction=R._original.friction,R.mass=R._original.mass,R.inertia=R._original.inertia,R.density=R._original.density,R.inverseMass=R._original.inverseMass,R.inverseInertia=R._original.inverseInertia,R._original=null),R.isStatic=I}},o.setMass=function(S,I){var _=S.inertia/(S.mass/6);S.inertia=_*(I/6),S.inverseInertia=1/S.inertia,S.mass=I,S.inverseMass=1/S.mass,S.density=S.mass/S.area},o.setDensity=function(S,I){o.setMass(S,I*S.area),S.density=I},o.setInertia=function(S,I){S.inertia=I,S.inverseInertia=1/S.inertia},o.setVertices=function(S,I){I[0].body===S?S.vertices=I:S.vertices=f.create(I,S),S.axes=E.fromVertices(S.vertices),S.area=f.area(S.vertices),o.setMass(S,S.density*S.area);var _=f.centre(S.vertices);f.translate(S.vertices,_,-1),o.setInertia(S,o._inertiaScale*f.inertia(S.vertices,S.mass)),f.translate(S.vertices,S.position),x.update(S.bounds,S.vertices,S.velocity)},o.setParts=function(S,I,_){var R;for(I=I.slice(0),S.parts.length=0,S.parts.push(S),S.parent=S,R=0;R<I.length;R++){var N=I[R];N!==S&&(N.parent=S,S.parts.push(N))}if(S.parts.length!==1){if(_=typeof _<"u"?_:!0,_){var D=[];for(R=0;R<I.length;R++)D=D.concat(I[R].vertices);f.clockwiseSort(D);var M=f.hull(D),W=f.centre(M);o.setVertices(S,M),f.translate(S.vertices,W)}var B=o._totalProperties(S);S.area=B.area,S.parent=S,S.position.x=B.centre.x,S.position.y=B.centre.y,S.positionPrev.x=B.centre.x,S.positionPrev.y=B.centre.y,o.setMass(S,B.mass),o.setInertia(S,B.inertia),o.setPosition(S,B.centre)}},o.setCentre=function(S,I,_){_?(S.positionPrev.x+=I.x,S.positionPrev.y+=I.y,S.position.x+=I.x,S.position.y+=I.y):(S.positionPrev.x=I.x-(S.position.x-S.positionPrev.x),S.positionPrev.y=I.y-(S.position.y-S.positionPrev.y),S.position.x=I.x,S.position.y=I.y)},o.setPosition=function(S,I,_){var R=p.sub(I,S.position);_?(S.positionPrev.x=S.position.x,S.positionPrev.y=S.position.y,S.velocity.x=R.x,S.velocity.y=R.y,S.speed=p.magnitude(R)):(S.positionPrev.x+=R.x,S.positionPrev.y+=R.y);for(var N=0;N<S.parts.length;N++){var D=S.parts[N];D.position.x+=R.x,D.position.y+=R.y,f.translate(D.vertices,R),x.update(D.bounds,D.vertices,S.velocity)}},o.setAngle=function(S,I,_){var R=I-S.angle;_?(S.anglePrev=S.angle,S.angularVelocity=R,S.angularSpeed=Math.abs(R)):S.anglePrev+=R;for(var N=0;N<S.parts.length;N++){var D=S.parts[N];D.angle+=R,f.rotate(D.vertices,R,S.position),E.rotate(D.axes,R),x.update(D.bounds,D.vertices,S.velocity),N>0&&p.rotateAbout(D.position,R,S.position,D.position)}},o.setVelocity=function(S,I){var _=S.deltaTime/o._baseDelta;S.positionPrev.x=S.position.x-I.x*_,S.positionPrev.y=S.position.y-I.y*_,S.velocity.x=(S.position.x-S.positionPrev.x)/_,S.velocity.y=(S.position.y-S.positionPrev.y)/_,S.speed=p.magnitude(S.velocity)},o.getVelocity=function(S){var I=o._baseDelta/S.deltaTime;return{x:(S.position.x-S.positionPrev.x)*I,y:(S.position.y-S.positionPrev.y)*I}},o.getSpeed=function(S){return p.magnitude(o.getVelocity(S))},o.setSpeed=function(S,I){o.setVelocity(S,p.mult(p.normalise(o.getVelocity(S)),I))},o.setAngularVelocity=function(S,I){var _=S.deltaTime/o._baseDelta;S.anglePrev=S.angle-I*_,S.angularVelocity=(S.angle-S.anglePrev)/_,S.angularSpeed=Math.abs(S.angularVelocity)},o.getAngularVelocity=function(S){return(S.angle-S.anglePrev)*o._baseDelta/S.deltaTime},o.getAngularSpeed=function(S){return Math.abs(o.getAngularVelocity(S))},o.setAngularSpeed=function(S,I){o.setAngularVelocity(S,g.sign(o.getAngularVelocity(S))*I)},o.translate=function(S,I,_){o.setPosition(S,p.add(S.position,I),_)},o.rotate=function(S,I,_,R){if(!_)o.setAngle(S,S.angle+I,R);else{var N=Math.cos(I),D=Math.sin(I),M=S.position.x-_.x,W=S.position.y-_.y;o.setPosition(S,{x:_.x+(M*N-W*D),y:_.y+(M*D+W*N)},R),o.setAngle(S,S.angle+I,R)}},o.scale=function(S,I,_,R){var N=0,D=0;R=R||S.position;for(var M=0;M<S.parts.length;M++){var W=S.parts[M];f.scale(W.vertices,I,_,R),W.axes=E.fromVertices(W.vertices),W.area=f.area(W.vertices),o.setMass(W,S.density*W.area),f.translate(W.vertices,{x:-W.position.x,y:-W.position.y}),o.setInertia(W,o._inertiaScale*f.inertia(W.vertices,W.mass)),f.translate(W.vertices,{x:W.position.x,y:W.position.y}),M>0&&(N+=W.area,D+=W.inertia),W.position.x=R.x+(W.position.x-R.x)*I,W.position.y=R.y+(W.position.y-R.y)*_,x.update(W.bounds,W.vertices,S.velocity)}S.parts.length>1&&(S.area=N,S.isStatic||(o.setMass(S,S.density*N),o.setInertia(S,D))),S.circleRadius&&(I===_?S.circleRadius*=I:S.circleRadius=null)},o.update=function(S,I){I=(typeof I<"u"?I:1e3/60)*S.timeScale;var _=I*I,R=o._timeCorrection?I/(S.deltaTime||I):1,N=1-S.frictionAir*(I/g._baseDelta),D=(S.position.x-S.positionPrev.x)*R,M=(S.position.y-S.positionPrev.y)*R;S.velocity.x=D*N+S.force.x/S.mass*_,S.velocity.y=M*N+S.force.y/S.mass*_,S.positionPrev.x=S.position.x,S.positionPrev.y=S.position.y,S.position.x+=S.velocity.x,S.position.y+=S.velocity.y,S.deltaTime=I,S.angularVelocity=(S.angle-S.anglePrev)*N*R+S.torque/S.inertia*_,S.anglePrev=S.angle,S.angle+=S.angularVelocity;for(var W=0;W<S.parts.length;W++){var B=S.parts[W];f.translate(B.vertices,S.velocity),W>0&&(B.position.x+=S.velocity.x,B.position.y+=S.velocity.y),S.angularVelocity!==0&&(f.rotate(B.vertices,S.angularVelocity,S.position),E.rotate(B.axes,S.angularVelocity),W>0&&p.rotateAbout(B.position,S.angularVelocity,S.position,B.position)),x.update(B.bounds,B.vertices,S.velocity)}},o.updateVelocities=function(S){var I=o._baseDelta/S.deltaTime,_=S.velocity;_.x=(S.position.x-S.positionPrev.x)*I,_.y=(S.position.y-S.positionPrev.y)*I,S.speed=Math.sqrt(_.x*_.x+_.y*_.y),S.angularVelocity=(S.angle-S.anglePrev)*I,S.angularSpeed=Math.abs(S.angularVelocity)},o.applyForce=function(S,I,_){var R={x:I.x-S.position.x,y:I.y-S.position.y};S.force.x+=_.x,S.force.y+=_.y,S.torque+=R.x*_.y-R.y*_.x},o._totalProperties=function(S){for(var I={mass:0,area:0,inertia:0,centre:{x:0,y:0}},_=S.parts.length===1?0:1;_<S.parts.length;_++){var R=S.parts[_],N=R.mass!==1/0?R.mass:1;I.mass+=N,I.area+=R.area,I.inertia+=R.inertia,I.centre=p.add(I.centre,p.mult(R.position,N))}return I.centre=p.div(I.centre,I.mass),I}})()},function(e,s,a){var o={};e.exports=o;var f=a(0);(function(){o.on=function(p,y,g){for(var x=y.split(" "),E,A=0;A<x.length;A++)E=x[A],p.events=p.events||{},p.events[E]=p.events[E]||[],p.events[E].push(g);return g},o.off=function(p,y,g){if(!y){p.events={};return}typeof y=="function"&&(g=y,y=f.keys(p.events).join(" "));for(var x=y.split(" "),E=0;E<x.length;E++){var A=p.events[x[E]],S=[];if(g&&A)for(var I=0;I<A.length;I++)A[I]!==g&&S.push(A[I]);p.events[x[E]]=S}},o.trigger=function(p,y,g){var x,E,A,S,I=p.events;if(I&&f.keys(I).length>0){g||(g={}),x=y.split(" ");for(var _=0;_<x.length;_++)if(E=x[_],A=I[E],A){S=f.clone(g,!1),S.name=E,S.source=p;for(var R=0;R<A.length;R++)A[R].apply(p,[S])}}}})()},function(e,s,a){var o={};e.exports=o;var f=a(5),p=a(0),y=a(1),g=a(4);(function(){o.create=function(x){return p.extend({id:p.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},x)},o.setModified=function(x,E,A,S){if(x.isModified=E,E&&x.cache&&(x.cache.allBodies=null,x.cache.allConstraints=null,x.cache.allComposites=null),A&&x.parent&&o.setModified(x.parent,E,A,S),S)for(var I=0;I<x.composites.length;I++){var _=x.composites[I];o.setModified(_,E,A,S)}},o.add=function(x,E){var A=[].concat(E);f.trigger(x,"beforeAdd",{object:E});for(var S=0;S<A.length;S++){var I=A[S];switch(I.type){case"body":if(I.parent!==I){p.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}o.addBody(x,I);break;case"constraint":o.addConstraint(x,I);break;case"composite":o.addComposite(x,I);break;case"mouseConstraint":o.addConstraint(x,I.constraint);break}}return f.trigger(x,"afterAdd",{object:E}),x},o.remove=function(x,E,A){var S=[].concat(E);f.trigger(x,"beforeRemove",{object:E});for(var I=0;I<S.length;I++){var _=S[I];switch(_.type){case"body":o.removeBody(x,_,A);break;case"constraint":o.removeConstraint(x,_,A);break;case"composite":o.removeComposite(x,_,A);break;case"mouseConstraint":o.removeConstraint(x,_.constraint);break}}return f.trigger(x,"afterRemove",{object:E}),x},o.addComposite=function(x,E){return x.composites.push(E),E.parent=x,o.setModified(x,!0,!0,!1),x},o.removeComposite=function(x,E,A){var S=p.indexOf(x.composites,E);if(S!==-1){var I=o.allBodies(E);o.removeCompositeAt(x,S);for(var _=0;_<I.length;_++)I[_].sleepCounter=0}if(A)for(var _=0;_<x.composites.length;_++)o.removeComposite(x.composites[_],E,!0);return x},o.removeCompositeAt=function(x,E){return x.composites.splice(E,1),o.setModified(x,!0,!0,!1),x},o.addBody=function(x,E){return x.bodies.push(E),o.setModified(x,!0,!0,!1),x},o.removeBody=function(x,E,A){var S=p.indexOf(x.bodies,E);if(S!==-1&&(o.removeBodyAt(x,S),E.sleepCounter=0),A)for(var I=0;I<x.composites.length;I++)o.removeBody(x.composites[I],E,!0);return x},o.removeBodyAt=function(x,E){return x.bodies.splice(E,1),o.setModified(x,!0,!0,!1),x},o.addConstraint=function(x,E){return x.constraints.push(E),o.setModified(x,!0,!0,!1),x},o.removeConstraint=function(x,E,A){var S=p.indexOf(x.constraints,E);if(S!==-1&&o.removeConstraintAt(x,S),A)for(var I=0;I<x.composites.length;I++)o.removeConstraint(x.composites[I],E,!0);return x},o.removeConstraintAt=function(x,E){return x.constraints.splice(E,1),o.setModified(x,!0,!0,!1),x},o.clear=function(x,E,A){if(A)for(var S=0;S<x.composites.length;S++)o.clear(x.composites[S],E,!0);return E?x.bodies=x.bodies.filter(function(I){return I.isStatic}):x.bodies.length=0,x.constraints.length=0,x.composites.length=0,o.setModified(x,!0,!0,!1),x},o.allBodies=function(x){if(x.cache&&x.cache.allBodies)return x.cache.allBodies;for(var E=[].concat(x.bodies),A=0;A<x.composites.length;A++)E=E.concat(o.allBodies(x.composites[A]));return x.cache&&(x.cache.allBodies=E),E},o.allConstraints=function(x){if(x.cache&&x.cache.allConstraints)return x.cache.allConstraints;for(var E=[].concat(x.constraints),A=0;A<x.composites.length;A++)E=E.concat(o.allConstraints(x.composites[A]));return x.cache&&(x.cache.allConstraints=E),E},o.allComposites=function(x){if(x.cache&&x.cache.allComposites)return x.cache.allComposites;for(var E=[].concat(x.composites),A=0;A<x.composites.length;A++)E=E.concat(o.allComposites(x.composites[A]));return x.cache&&(x.cache.allComposites=E),E},o.get=function(x,E,A){var S,I;switch(A){case"body":S=o.allBodies(x);break;case"constraint":S=o.allConstraints(x);break;case"composite":S=o.allComposites(x).concat(x);break}return S?(I=S.filter(function(_){return _.id.toString()===E.toString()}),I.length===0?null:I[0]):null},o.move=function(x,E,A){return o.remove(x,E),o.add(A,E),x},o.rebase=function(x){for(var E=o.allBodies(x).concat(o.allConstraints(x)).concat(o.allComposites(x)),A=0;A<E.length;A++)E[A].id=p.nextId();return x},o.translate=function(x,E,A){for(var S=A?o.allBodies(x):x.bodies,I=0;I<S.length;I++)g.translate(S[I],E);return x},o.rotate=function(x,E,A,S){for(var I=Math.cos(E),_=Math.sin(E),R=S?o.allBodies(x):x.bodies,N=0;N<R.length;N++){var D=R[N],M=D.position.x-A.x,W=D.position.y-A.y;g.setPosition(D,{x:A.x+(M*I-W*_),y:A.y+(M*_+W*I)}),g.rotate(D,E)}return x},o.scale=function(x,E,A,S,I){for(var _=I?o.allBodies(x):x.bodies,R=0;R<_.length;R++){var N=_[R],D=N.position.x-S.x,M=N.position.y-S.y;g.setPosition(N,{x:S.x+D*E,y:S.y+M*A}),g.scale(N,E,A)}return x},o.bounds=function(x){for(var E=o.allBodies(x),A=[],S=0;S<E.length;S+=1){var I=E[S];A.push(I.bounds.min,I.bounds.max)}return y.create(A)}})()},function(e,s,a){var o={};e.exports=o;var f=a(4),p=a(5),y=a(0);(function(){o._motionWakeThreshold=.18,o._motionSleepThreshold=.08,o._minBias=.9,o.update=function(g,x){for(var E=x/y._baseDelta,A=o._motionSleepThreshold,S=0;S<g.length;S++){var I=g[S],_=f.getSpeed(I),R=f.getAngularSpeed(I),N=_*_+R*R;if(I.force.x!==0||I.force.y!==0){o.set(I,!1);continue}var D=Math.min(I.motion,N),M=Math.max(I.motion,N);I.motion=o._minBias*D+(1-o._minBias)*M,I.sleepThreshold>0&&I.motion<A?(I.sleepCounter+=1,I.sleepCounter>=I.sleepThreshold/E&&o.set(I,!0)):I.sleepCounter>0&&(I.sleepCounter-=1)}},o.afterCollisions=function(g){for(var x=o._motionSleepThreshold,E=0;E<g.length;E++){var A=g[E];if(A.isActive){var S=A.collision,I=S.bodyA.parent,_=S.bodyB.parent;if(!(I.isSleeping&&_.isSleeping||I.isStatic||_.isStatic)&&(I.isSleeping||_.isSleeping)){var R=I.isSleeping&&!I.isStatic?I:_,N=R===I?_:I;!R.isStatic&&N.motion>x&&o.set(R,!1)}}}},o.set=function(g,x){var E=g.isSleeping;x?(g.isSleeping=!0,g.sleepCounter=g.sleepThreshold,g.positionImpulse.x=0,g.positionImpulse.y=0,g.positionPrev.x=g.position.x,g.positionPrev.y=g.position.y,g.anglePrev=g.angle,g.speed=0,g.angularSpeed=0,g.motion=0,E||p.trigger(g,"sleepStart")):(g.isSleeping=!1,g.sleepCounter=0,E&&p.trigger(g,"sleepEnd"))}})()},function(e,s,a){var o={};e.exports=o;var f=a(3),p=a(9);(function(){var y=[],g={overlap:0,axis:null},x={overlap:0,axis:null};o.create=function(E,A){return{pair:null,collided:!1,bodyA:E,bodyB:A,parentA:E.parent,parentB:A.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[null,null],supportCount:0}},o.collides=function(E,A,S){if(o._overlapAxes(g,E.vertices,A.vertices,E.axes),g.overlap<=0||(o._overlapAxes(x,A.vertices,E.vertices,A.axes),x.overlap<=0))return null;var I=S&&S.table[p.id(E,A)],_;I?_=I.collision:(_=o.create(E,A),_.collided=!0,_.bodyA=E.id<A.id?E:A,_.bodyB=E.id<A.id?A:E,_.parentA=_.bodyA.parent,_.parentB=_.bodyB.parent),E=_.bodyA,A=_.bodyB;var R;g.overlap<x.overlap?R=g:R=x;var N=_.normal,D=_.tangent,M=_.penetration,W=_.supports,B=R.overlap,U=R.axis,P=U.x,F=U.y,j=A.position.x-E.position.x,Q=A.position.y-E.position.y;P*j+F*Q>=0&&(P=-P,F=-F),N.x=P,N.y=F,D.x=-F,D.y=P,M.x=P*B,M.y=F*B,_.depth=B;var $=o._findSupports(E,A,N,1),V=0;if(f.contains(E.vertices,$[0])&&(W[V++]=$[0]),f.contains(E.vertices,$[1])&&(W[V++]=$[1]),V<2){var G=o._findSupports(A,E,N,-1);f.contains(A.vertices,G[0])&&(W[V++]=G[0]),V<2&&f.contains(A.vertices,G[1])&&(W[V++]=G[1])}return V===0&&(W[V++]=$[0]),_.supportCount=V,_},o._overlapAxes=function(E,A,S,I){var _=A.length,R=S.length,N=A[0].x,D=A[0].y,M=S[0].x,W=S[0].y,B=I.length,U=Number.MAX_VALUE,P=0,F,j,Q,$,V,G;for(V=0;V<B;V++){var se=I[V],H=se.x,J=se.y,K=N*H+D*J,ie=M*H+W*J,ne=K,re=ie;for(G=1;G<_;G+=1)$=A[G].x*H+A[G].y*J,$>ne?ne=$:$<K&&(K=$);for(G=1;G<R;G+=1)$=S[G].x*H+S[G].y*J,$>re?re=$:$<ie&&(ie=$);if(j=ne-ie,Q=re-K,F=j<Q?j:Q,F<U&&(U=F,P=V,F<=0))break}E.axis=I[P],E.overlap=U},o._findSupports=function(E,A,S,I){var _=A.vertices,R=_.length,N=E.position.x,D=E.position.y,M=S.x*I,W=S.y*I,B=_[0],U=B,P=M*(N-U.x)+W*(D-U.y),F,j,Q;for(Q=1;Q<R;Q+=1)U=_[Q],j=M*(N-U.x)+W*(D-U.y),j<P&&(P=j,B=U);return F=_[(R+B.index-1)%R],P=M*(N-F.x)+W*(D-F.y),U=_[(B.index+1)%R],M*(N-U.x)+W*(D-U.y)<P?(y[0]=B,y[1]=U,y):(y[0]=B,y[1]=F,y)}})()},function(e,s,a){var o={};e.exports=o;var f=a(16);(function(){o.create=function(p,y){var g=p.bodyA,x=p.bodyB,E={id:o.id(g,x),bodyA:g,bodyB:x,collision:p,contacts:[f.create(),f.create()],contactCount:0,separation:0,isActive:!0,isSensor:g.isSensor||x.isSensor,timeCreated:y,timeUpdated:y,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return o.update(E,p,y),E},o.update=function(p,y,g){var x=y.supports,E=y.supportCount,A=p.contacts,S=y.parentA,I=y.parentB;p.isActive=!0,p.timeUpdated=g,p.collision=y,p.separation=y.depth,p.inverseMass=S.inverseMass+I.inverseMass,p.friction=S.friction<I.friction?S.friction:I.friction,p.frictionStatic=S.frictionStatic>I.frictionStatic?S.frictionStatic:I.frictionStatic,p.restitution=S.restitution>I.restitution?S.restitution:I.restitution,p.slop=S.slop>I.slop?S.slop:I.slop,p.contactCount=E,y.pair=p;var _=x[0],R=A[0],N=x[1],D=A[1];(D.vertex===_||R.vertex===N)&&(A[1]=R,A[0]=R=D,D=A[1]),R.vertex=_,D.vertex=N},o.setActive=function(p,y,g){y?(p.isActive=!0,p.timeUpdated=g):(p.isActive=!1,p.contactCount=0)},o.id=function(p,y){return p.id<y.id?p.id.toString(36)+":"+y.id.toString(36):y.id.toString(36)+":"+p.id.toString(36)}})()},function(e,s,a){var o={};e.exports=o;var f=a(3),p=a(2),y=a(7),g=a(1),x=a(11),E=a(0);(function(){o._warming=.4,o._torqueDampen=1,o._minLength=1e-6,o.create=function(A){var S=A;S.bodyA&&!S.pointA&&(S.pointA={x:0,y:0}),S.bodyB&&!S.pointB&&(S.pointB={x:0,y:0});var I=S.bodyA?p.add(S.bodyA.position,S.pointA):S.pointA,_=S.bodyB?p.add(S.bodyB.position,S.pointB):S.pointB,R=p.magnitude(p.sub(I,_));S.length=typeof S.length<"u"?S.length:R,S.id=S.id||E.nextId(),S.label=S.label||"Constraint",S.type="constraint",S.stiffness=S.stiffness||(S.length>0?1:.7),S.damping=S.damping||0,S.angularStiffness=S.angularStiffness||0,S.angleA=S.bodyA?S.bodyA.angle:S.angleA,S.angleB=S.bodyB?S.bodyB.angle:S.angleB,S.plugin={};var N={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return S.length===0&&S.stiffness>.1?(N.type="pin",N.anchors=!1):S.stiffness<.9&&(N.type="spring"),S.render=E.extend(N,S.render),S},o.preSolveAll=function(A){for(var S=0;S<A.length;S+=1){var I=A[S],_=I.constraintImpulse;I.isStatic||_.x===0&&_.y===0&&_.angle===0||(I.position.x+=_.x,I.position.y+=_.y,I.angle+=_.angle)}},o.solveAll=function(A,S){for(var I=E.clamp(S/E._baseDelta,0,1),_=0;_<A.length;_+=1){var R=A[_],N=!R.bodyA||R.bodyA&&R.bodyA.isStatic,D=!R.bodyB||R.bodyB&&R.bodyB.isStatic;(N||D)&&o.solve(A[_],I)}for(_=0;_<A.length;_+=1)R=A[_],N=!R.bodyA||R.bodyA&&R.bodyA.isStatic,D=!R.bodyB||R.bodyB&&R.bodyB.isStatic,!N&&!D&&o.solve(A[_],I)},o.solve=function(A,S){var I=A.bodyA,_=A.bodyB,R=A.pointA,N=A.pointB;if(!(!I&&!_)){I&&!I.isStatic&&(p.rotate(R,I.angle-A.angleA,R),A.angleA=I.angle),_&&!_.isStatic&&(p.rotate(N,_.angle-A.angleB,N),A.angleB=_.angle);var D=R,M=N;if(I&&(D=p.add(I.position,R)),_&&(M=p.add(_.position,N)),!(!D||!M)){var W=p.sub(D,M),B=p.magnitude(W);B<o._minLength&&(B=o._minLength);var U=(B-A.length)/B,P=A.stiffness>=1||A.length===0,F=P?A.stiffness*S:A.stiffness*S*S,j=A.damping*S,Q=p.mult(W,U*F),$=(I?I.inverseMass:0)+(_?_.inverseMass:0),V=(I?I.inverseInertia:0)+(_?_.inverseInertia:0),G=$+V,se,H,J,K,ie;if(j>0){var ne=p.create();J=p.div(W,B),ie=p.sub(_&&p.sub(_.position,_.positionPrev)||ne,I&&p.sub(I.position,I.positionPrev)||ne),K=p.dot(J,ie)}I&&!I.isStatic&&(H=I.inverseMass/$,I.constraintImpulse.x-=Q.x*H,I.constraintImpulse.y-=Q.y*H,I.position.x-=Q.x*H,I.position.y-=Q.y*H,j>0&&(I.positionPrev.x-=j*J.x*K*H,I.positionPrev.y-=j*J.y*K*H),se=p.cross(R,Q)/G*o._torqueDampen*I.inverseInertia*(1-A.angularStiffness),I.constraintImpulse.angle-=se,I.angle-=se),_&&!_.isStatic&&(H=_.inverseMass/$,_.constraintImpulse.x+=Q.x*H,_.constraintImpulse.y+=Q.y*H,_.position.x+=Q.x*H,_.position.y+=Q.y*H,j>0&&(_.positionPrev.x+=j*J.x*K*H,_.positionPrev.y+=j*J.y*K*H),se=p.cross(N,Q)/G*o._torqueDampen*_.inverseInertia*(1-A.angularStiffness),_.constraintImpulse.angle+=se,_.angle+=se)}}},o.postSolveAll=function(A){for(var S=0;S<A.length;S++){var I=A[S],_=I.constraintImpulse;if(!(I.isStatic||_.x===0&&_.y===0&&_.angle===0)){y.set(I,!1);for(var R=0;R<I.parts.length;R++){var N=I.parts[R];f.translate(N.vertices,_),R>0&&(N.position.x+=_.x,N.position.y+=_.y),_.angle!==0&&(f.rotate(N.vertices,_.angle,I.position),x.rotate(N.axes,_.angle),R>0&&p.rotateAbout(N.position,_.angle,I.position,N.position)),g.update(N.bounds,N.vertices,I.velocity)}_.angle*=o._warming,_.x*=o._warming,_.y*=o._warming}}},o.pointAWorld=function(A){return{x:(A.bodyA?A.bodyA.position.x:0)+(A.pointA?A.pointA.x:0),y:(A.bodyA?A.bodyA.position.y:0)+(A.pointA?A.pointA.y:0)}},o.pointBWorld=function(A){return{x:(A.bodyB?A.bodyB.position.x:0)+(A.pointB?A.pointB.x:0),y:(A.bodyB?A.bodyB.position.y:0)+(A.pointB?A.pointB.y:0)}},o.currentLength=function(A){var S=(A.bodyA?A.bodyA.position.x:0)+(A.pointA?A.pointA.x:0),I=(A.bodyA?A.bodyA.position.y:0)+(A.pointA?A.pointA.y:0),_=(A.bodyB?A.bodyB.position.x:0)+(A.pointB?A.pointB.x:0),R=(A.bodyB?A.bodyB.position.y:0)+(A.pointB?A.pointB.y:0),N=S-_,D=I-R;return Math.sqrt(N*N+D*D)}})()},function(e,s,a){var o={};e.exports=o;var f=a(2),p=a(0);(function(){o.fromVertices=function(y){for(var g={},x=0;x<y.length;x++){var E=(x+1)%y.length,A=f.normalise({x:y[E].y-y[x].y,y:y[x].x-y[E].x}),S=A.y===0?1/0:A.x/A.y;S=S.toFixed(3).toString(),g[S]=A}return p.values(g)},o.rotate=function(y,g){if(g!==0)for(var x=Math.cos(g),E=Math.sin(g),A=0;A<y.length;A++){var S=y[A],I;I=S.x*x-S.y*E,S.y=S.x*E+S.y*x,S.x=I}}})()},function(e,s,a){var o={};e.exports=o;var f=a(3),p=a(0),y=a(4),g=a(1),x=a(2);(function(){o.rectangle=function(E,A,S,I,_){_=_||{};var R={label:"Rectangle Body",position:{x:E,y:A},vertices:f.fromPath("L 0 0 L "+S+" 0 L "+S+" "+I+" L 0 "+I)};if(_.chamfer){var N=_.chamfer;R.vertices=f.chamfer(R.vertices,N.radius,N.quality,N.qualityMin,N.qualityMax),delete _.chamfer}return y.create(p.extend({},R,_))},o.trapezoid=function(E,A,S,I,_,R){R=R||{},_>=1&&p.warn("Bodies.trapezoid: slope parameter must be < 1."),_*=.5;var N=(1-_*2)*S,D=S*_,M=D+N,W=M+D,B;_<.5?B="L 0 0 L "+D+" "+-I+" L "+M+" "+-I+" L "+W+" 0":B="L 0 0 L "+M+" "+-I+" L "+W+" 0";var U={label:"Trapezoid Body",position:{x:E,y:A},vertices:f.fromPath(B)};if(R.chamfer){var P=R.chamfer;U.vertices=f.chamfer(U.vertices,P.radius,P.quality,P.qualityMin,P.qualityMax),delete R.chamfer}return y.create(p.extend({},U,R))},o.circle=function(E,A,S,I,_){I=I||{};var R={label:"Circle Body",circleRadius:S};_=_||25;var N=Math.ceil(Math.max(10,Math.min(_,S)));return N%2===1&&(N+=1),o.polygon(E,A,N,S,p.extend({},R,I))},o.polygon=function(E,A,S,I,_){if(_=_||{},S<3)return o.circle(E,A,I,_);for(var R=2*Math.PI/S,N="",D=R*.5,M=0;M<S;M+=1){var W=D+M*R,B=Math.cos(W)*I,U=Math.sin(W)*I;N+="L "+B.toFixed(3)+" "+U.toFixed(3)+" "}var P={label:"Polygon Body",position:{x:E,y:A},vertices:f.fromPath(N)};if(_.chamfer){var F=_.chamfer;P.vertices=f.chamfer(P.vertices,F.radius,F.quality,F.qualityMin,F.qualityMax),delete _.chamfer}return y.create(p.extend({},P,_))},o.fromVertices=function(E,A,S,I,_,R,N,D){var M=p.getDecomp(),W,B,U,P,F,j,Q,$,V,G,se;for(W=!!(M&&M.quickDecomp),I=I||{},U=[],_=typeof _<"u"?_:!1,R=typeof R<"u"?R:.01,N=typeof N<"u"?N:10,D=typeof D<"u"?D:.01,p.isArray(S[0])||(S=[S]),G=0;G<S.length;G+=1)if(j=S[G],P=f.isConvex(j),F=!P,F&&!W&&p.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),P||!W)P?j=f.clockwiseSort(j):j=f.hull(j),U.push({position:{x:E,y:A},vertices:j});else{var H=j.map(function(me){return[me.x,me.y]});M.makeCCW(H),R!==!1&&M.removeCollinearPoints(H,R),D!==!1&&M.removeDuplicatePoints&&M.removeDuplicatePoints(H,D);var J=M.quickDecomp(H);for(Q=0;Q<J.length;Q++){var K=J[Q],ie=K.map(function(me){return{x:me[0],y:me[1]}});N>0&&f.area(ie)<N||U.push({position:f.centre(ie),vertices:ie})}}for(Q=0;Q<U.length;Q++)U[Q]=y.create(p.extend(U[Q],I));if(_){var ne=5;for(Q=0;Q<U.length;Q++){var re=U[Q];for($=Q+1;$<U.length;$++){var X=U[$];if(g.overlaps(re.bounds,X.bounds)){var ae=re.vertices,te=X.vertices;for(V=0;V<re.vertices.length;V++)for(se=0;se<X.vertices.length;se++){var ce=x.magnitudeSquared(x.sub(ae[(V+1)%ae.length],te[se])),xe=x.magnitudeSquared(x.sub(ae[V],te[(se+1)%te.length]));ce<ne&&xe<ne&&(ae[V].isInternal=!0,te[se].isInternal=!0)}}}}}return U.length>1?(B=y.create(p.extend({parts:U.slice(0)},I)),y.setPosition(B,{x:E,y:A}),B):U[0]}})()},function(e,s,a){var o={};e.exports=o;var f=a(0),p=a(8);(function(){o.create=function(y){var g={bodies:[],collisions:[],pairs:null};return f.extend(g,y)},o.setBodies=function(y,g){y.bodies=g.slice(0)},o.clear=function(y){y.bodies=[],y.collisions=[]},o.collisions=function(y){var g=y.pairs,x=y.bodies,E=x.length,A=o.canCollide,S=p.collides,I=y.collisions,_=0,R,N;for(x.sort(o._compareBoundsX),R=0;R<E;R++){var D=x[R],M=D.bounds,W=D.bounds.max.x,B=D.bounds.max.y,U=D.bounds.min.y,P=D.isStatic||D.isSleeping,F=D.parts.length,j=F===1;for(N=R+1;N<E;N++){var Q=x[N],$=Q.bounds;if($.min.x>W)break;if(!(B<$.min.y||U>$.max.y)&&!(P&&(Q.isStatic||Q.isSleeping))&&A(D.collisionFilter,Q.collisionFilter)){var V=Q.parts.length;if(j&&V===1){var G=S(D,Q,g);G&&(I[_++]=G)}else for(var se=F>1?1:0,H=V>1?1:0,J=se;J<F;J++)for(var K=D.parts[J],M=K.bounds,ie=H;ie<V;ie++){var ne=Q.parts[ie],$=ne.bounds;if(!(M.min.x>$.max.x||M.max.x<$.min.x||M.max.y<$.min.y||M.min.y>$.max.y)){var G=S(K,ne,g);G&&(I[_++]=G)}}}}}return I.length!==_&&(I.length=_),I},o.canCollide=function(y,g){return y.group===g.group&&y.group!==0?y.group>0:(y.mask&g.category)!==0&&(g.mask&y.category)!==0},o._compareBoundsX=function(y,g){return y.bounds.min.x-g.bounds.min.x}})()},function(e,s,a){var o={};e.exports=o;var f=a(0);(function(){o.create=function(p){var y={};return p||f.log("Mouse.create: element was undefined, defaulting to document.body","warn"),y.element=p||document.body,y.absolute={x:0,y:0},y.position={x:0,y:0},y.mousedownPosition={x:0,y:0},y.mouseupPosition={x:0,y:0},y.offset={x:0,y:0},y.scale={x:1,y:1},y.wheelDelta=0,y.button=-1,y.pixelRatio=parseInt(y.element.getAttribute("data-pixel-ratio"),10)||1,y.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},y.mousemove=function(g){var x=o._getRelativeMousePosition(g,y.element,y.pixelRatio),E=g.changedTouches;E&&(y.button=0,g.preventDefault()),y.absolute.x=x.x,y.absolute.y=x.y,y.position.x=y.absolute.x*y.scale.x+y.offset.x,y.position.y=y.absolute.y*y.scale.y+y.offset.y,y.sourceEvents.mousemove=g},y.mousedown=function(g){var x=o._getRelativeMousePosition(g,y.element,y.pixelRatio),E=g.changedTouches;E?(y.button=0,g.preventDefault()):y.button=g.button,y.absolute.x=x.x,y.absolute.y=x.y,y.position.x=y.absolute.x*y.scale.x+y.offset.x,y.position.y=y.absolute.y*y.scale.y+y.offset.y,y.mousedownPosition.x=y.position.x,y.mousedownPosition.y=y.position.y,y.sourceEvents.mousedown=g},y.mouseup=function(g){var x=o._getRelativeMousePosition(g,y.element,y.pixelRatio),E=g.changedTouches;E&&g.preventDefault(),y.button=-1,y.absolute.x=x.x,y.absolute.y=x.y,y.position.x=y.absolute.x*y.scale.x+y.offset.x,y.position.y=y.absolute.y*y.scale.y+y.offset.y,y.mouseupPosition.x=y.position.x,y.mouseupPosition.y=y.position.y,y.sourceEvents.mouseup=g},y.mousewheel=function(g){y.wheelDelta=Math.max(-1,Math.min(1,g.wheelDelta||-g.detail)),g.preventDefault(),y.sourceEvents.mousewheel=g},o.setElement(y,y.element),y},o.setElement=function(p,y){p.element=y,y.addEventListener("mousemove",p.mousemove,{passive:!0}),y.addEventListener("mousedown",p.mousedown,{passive:!0}),y.addEventListener("mouseup",p.mouseup,{passive:!0}),y.addEventListener("wheel",p.mousewheel,{passive:!1}),y.addEventListener("touchmove",p.mousemove,{passive:!1}),y.addEventListener("touchstart",p.mousedown,{passive:!1}),y.addEventListener("touchend",p.mouseup,{passive:!1})},o.clearSourceEvents=function(p){p.sourceEvents.mousemove=null,p.sourceEvents.mousedown=null,p.sourceEvents.mouseup=null,p.sourceEvents.mousewheel=null,p.wheelDelta=0},o.setOffset=function(p,y){p.offset.x=y.x,p.offset.y=y.y,p.position.x=p.absolute.x*p.scale.x+p.offset.x,p.position.y=p.absolute.y*p.scale.y+p.offset.y},o.setScale=function(p,y){p.scale.x=y.x,p.scale.y=y.y,p.position.x=p.absolute.x*p.scale.x+p.offset.x,p.position.y=p.absolute.y*p.scale.y+p.offset.y},o._getRelativeMousePosition=function(p,y,g){var x=y.getBoundingClientRect(),E=document.documentElement||document.body.parentNode||document.body,A=window.pageXOffset!==void 0?window.pageXOffset:E.scrollLeft,S=window.pageYOffset!==void 0?window.pageYOffset:E.scrollTop,I=p.changedTouches,_,R;return I?(_=I[0].pageX-x.left-A,R=I[0].pageY-x.top-S):(_=p.pageX-x.left-A,R=p.pageY-x.top-S),{x:_/(y.clientWidth/(y.width||y.clientWidth)*g),y:R/(y.clientHeight/(y.height||y.clientHeight)*g)}}})()},function(e,s,a){var o={};e.exports=o;var f=a(0);(function(){o._registry={},o.register=function(p){if(o.isPlugin(p)||f.warn("Plugin.register:",o.toString(p),"does not implement all required fields."),p.name in o._registry){var y=o._registry[p.name],g=o.versionParse(p.version).number,x=o.versionParse(y.version).number;g>x?(f.warn("Plugin.register:",o.toString(y),"was upgraded to",o.toString(p)),o._registry[p.name]=p):g<x?f.warn("Plugin.register:",o.toString(y),"can not be downgraded to",o.toString(p)):p!==y&&f.warn("Plugin.register:",o.toString(p),"is already registered to different plugin object")}else o._registry[p.name]=p;return p},o.resolve=function(p){return o._registry[o.dependencyParse(p).name]},o.toString=function(p){return typeof p=="string"?p:(p.name||"anonymous")+"@"+(p.version||p.range||"0.0.0")},o.isPlugin=function(p){return p&&p.name&&p.version&&p.install},o.isUsed=function(p,y){return p.used.indexOf(y)>-1},o.isFor=function(p,y){var g=p.for&&o.dependencyParse(p.for);return!p.for||y.name===g.name&&o.versionSatisfies(y.version,g.range)},o.use=function(p,y){if(p.uses=(p.uses||[]).concat(y||[]),p.uses.length===0){f.warn("Plugin.use:",o.toString(p),"does not specify any dependencies to install.");return}for(var g=o.dependencies(p),x=f.topologicalSort(g),E=[],A=0;A<x.length;A+=1)if(x[A]!==p.name){var S=o.resolve(x[A]);if(!S){E.push(" "+x[A]);continue}o.isUsed(p,S.name)||(o.isFor(S,p)||(f.warn("Plugin.use:",o.toString(S),"is for",S.for,"but installed on",o.toString(p)+"."),S._warned=!0),S.install?S.install(p):(f.warn("Plugin.use:",o.toString(S),"does not specify an install function."),S._warned=!0),S._warned?(E.push(" "+o.toString(S)),delete S._warned):E.push(" "+o.toString(S)),p.used.push(S.name))}E.length>0&&f.info(E.join("  "))},o.dependencies=function(p,y){var g=o.dependencyParse(p),x=g.name;if(y=y||{},!(x in y)){p=o.resolve(p)||p,y[x]=f.map(p.uses||[],function(A){o.isPlugin(A)&&o.register(A);var S=o.dependencyParse(A),I=o.resolve(A);return I&&!o.versionSatisfies(I.version,S.range)?(f.warn("Plugin.dependencies:",o.toString(I),"does not satisfy",o.toString(S),"used by",o.toString(g)+"."),I._warned=!0,p._warned=!0):I||(f.warn("Plugin.dependencies:",o.toString(A),"used by",o.toString(g),"could not be resolved."),p._warned=!0),S.name});for(var E=0;E<y[x].length;E+=1)o.dependencies(y[x][E],y);return y}},o.dependencyParse=function(p){if(f.isString(p)){var y=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/;return y.test(p)||f.warn("Plugin.dependencyParse:",p,"is not a valid dependency string."),{name:p.split("@")[0],range:p.split("@")[1]||"*"}}return{name:p.name,range:p.range||p.version}},o.versionParse=function(p){var y=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;y.test(p)||f.warn("Plugin.versionParse:",p,"is not a valid version or range.");var g=y.exec(p),x=Number(g[4]),E=Number(g[5]),A=Number(g[6]);return{isRange:!!(g[1]||g[2]),version:g[3],range:p,operator:g[1]||g[2]||"",major:x,minor:E,patch:A,parts:[x,E,A],prerelease:g[7],number:x*1e8+E*1e4+A}},o.versionSatisfies=function(p,y){y=y||"*";var g=o.versionParse(y),x=o.versionParse(p);if(g.isRange){if(g.operator==="*"||p==="*")return!0;if(g.operator===">")return x.number>g.number;if(g.operator===">=")return x.number>=g.number;if(g.operator==="~")return x.major===g.major&&x.minor===g.minor&&x.patch>=g.patch;if(g.operator==="^")return g.major>0?x.major===g.major&&x.number>=g.number:g.minor>0?x.minor===g.minor&&x.patch>=g.patch:x.patch===g.patch}return p===y||p==="*"}})()},function(e,s){var a={};e.exports=a,function(){a.create=function(o){return{vertex:o,normalImpulse:0,tangentImpulse:0}}}()},function(e,s,a){var o={};e.exports=o;var f=a(7),p=a(18),y=a(13),g=a(19),x=a(5),E=a(6),A=a(10),S=a(0),I=a(4);(function(){o._deltaMax=1e3/60,o.create=function(_){_=_||{};var R={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0,lastUpdatesPerFrame:0}},N=S.extend(R,_);return N.world=_.world||E.create({label:"World"}),N.pairs=_.pairs||g.create(),N.detector=_.detector||y.create(),N.detector.pairs=N.pairs,N.grid={buckets:[]},N.world.gravity=N.gravity,N.broadphase=N.grid,N.metrics={},N},o.update=function(_,R){var N=S.now(),D=_.world,M=_.detector,W=_.pairs,B=_.timing,U=B.timestamp,P;R>o._deltaMax&&S.warnOnce("Matter.Engine.update: delta argument is recommended to be less than or equal to",o._deltaMax.toFixed(3),"ms."),R=typeof R<"u"?R:S._baseDelta,R*=B.timeScale,B.timestamp+=R,B.lastDelta=R;var F={timestamp:B.timestamp,delta:R};x.trigger(_,"beforeUpdate",F);var j=E.allBodies(D),Q=E.allConstraints(D);for(D.isModified&&(y.setBodies(M,j),E.setModified(D,!1,!1,!0)),_.enableSleeping&&f.update(j,R),o._bodiesApplyGravity(j,_.gravity),R>0&&o._bodiesUpdate(j,R),x.trigger(_,"beforeSolve",F),A.preSolveAll(j),P=0;P<_.constraintIterations;P++)A.solveAll(Q,R);A.postSolveAll(j);var $=y.collisions(M);g.update(W,$,U),_.enableSleeping&&f.afterCollisions(W.list),W.collisionStart.length>0&&x.trigger(_,"collisionStart",{pairs:W.collisionStart,timestamp:B.timestamp,delta:R});var V=S.clamp(20/_.positionIterations,0,1);for(p.preSolvePosition(W.list),P=0;P<_.positionIterations;P++)p.solvePosition(W.list,R,V);for(p.postSolvePosition(j),A.preSolveAll(j),P=0;P<_.constraintIterations;P++)A.solveAll(Q,R);for(A.postSolveAll(j),p.preSolveVelocity(W.list),P=0;P<_.velocityIterations;P++)p.solveVelocity(W.list,R);return o._bodiesUpdateVelocities(j),W.collisionActive.length>0&&x.trigger(_,"collisionActive",{pairs:W.collisionActive,timestamp:B.timestamp,delta:R}),W.collisionEnd.length>0&&x.trigger(_,"collisionEnd",{pairs:W.collisionEnd,timestamp:B.timestamp,delta:R}),o._bodiesClearForces(j),x.trigger(_,"afterUpdate",F),_.timing.lastElapsed=S.now()-N,_},o.merge=function(_,R){if(S.extend(_,R),R.world){_.world=R.world,o.clear(_);for(var N=E.allBodies(_.world),D=0;D<N.length;D++){var M=N[D];f.set(M,!1),M.id=S.nextId()}}},o.clear=function(_){g.clear(_.pairs),y.clear(_.detector)},o._bodiesClearForces=function(_){for(var R=_.length,N=0;N<R;N++){var D=_[N];D.force.x=0,D.force.y=0,D.torque=0}},o._bodiesApplyGravity=function(_,R){var N=typeof R.scale<"u"?R.scale:.001,D=_.length;if(!(R.x===0&&R.y===0||N===0))for(var M=0;M<D;M++){var W=_[M];W.isStatic||W.isSleeping||(W.force.y+=W.mass*R.y*N,W.force.x+=W.mass*R.x*N)}},o._bodiesUpdate=function(_,R){for(var N=_.length,D=0;D<N;D++){var M=_[D];M.isStatic||M.isSleeping||I.update(M,R)}},o._bodiesUpdateVelocities=function(_){for(var R=_.length,N=0;N<R;N++)I.updateVelocities(_[N])}})()},function(e,s,a){var o={};e.exports=o;var f=a(3),p=a(0),y=a(1);(function(){o._restingThresh=2,o._restingThreshTangent=Math.sqrt(6),o._positionDampen=.9,o._positionWarming=.8,o._frictionNormalMultiplier=5,o._frictionMaxStatic=Number.MAX_VALUE,o.preSolvePosition=function(g){var x,E,A,S=g.length;for(x=0;x<S;x++)E=g[x],E.isActive&&(A=E.contactCount,E.collision.parentA.totalContacts+=A,E.collision.parentB.totalContacts+=A)},o.solvePosition=function(g,x,E){var A,S,I,_,R,N,D,M,W=o._positionDampen*(E||1),B=p.clamp(x/p._baseDelta,0,1),U=g.length;for(A=0;A<U;A++)S=g[A],!(!S.isActive||S.isSensor)&&(I=S.collision,_=I.parentA,R=I.parentB,N=I.normal,S.separation=I.depth+N.x*(R.positionImpulse.x-_.positionImpulse.x)+N.y*(R.positionImpulse.y-_.positionImpulse.y));for(A=0;A<U;A++)S=g[A],!(!S.isActive||S.isSensor)&&(I=S.collision,_=I.parentA,R=I.parentB,N=I.normal,M=S.separation-S.slop*B,(_.isStatic||R.isStatic)&&(M*=2),_.isStatic||_.isSleeping||(D=W/_.totalContacts,_.positionImpulse.x+=N.x*M*D,_.positionImpulse.y+=N.y*M*D),R.isStatic||R.isSleeping||(D=W/R.totalContacts,R.positionImpulse.x-=N.x*M*D,R.positionImpulse.y-=N.y*M*D))},o.postSolvePosition=function(g){for(var x=o._positionWarming,E=g.length,A=f.translate,S=y.update,I=0;I<E;I++){var _=g[I],R=_.positionImpulse,N=R.x,D=R.y,M=_.velocity;if(_.totalContacts=0,N!==0||D!==0){for(var W=0;W<_.parts.length;W++){var B=_.parts[W];A(B.vertices,R),S(B.bounds,B.vertices,M),B.position.x+=N,B.position.y+=D}_.positionPrev.x+=N,_.positionPrev.y+=D,N*M.x+D*M.y<0?(R.x=0,R.y=0):(R.x*=x,R.y*=x)}}},o.preSolveVelocity=function(g){var x=g.length,E,A;for(E=0;E<x;E++){var S=g[E];if(!(!S.isActive||S.isSensor)){var I=S.contacts,_=S.contactCount,R=S.collision,N=R.parentA,D=R.parentB,M=R.normal,W=R.tangent;for(A=0;A<_;A++){var B=I[A],U=B.vertex,P=B.normalImpulse,F=B.tangentImpulse;if(P!==0||F!==0){var j=M.x*P+W.x*F,Q=M.y*P+W.y*F;N.isStatic||N.isSleeping||(N.positionPrev.x+=j*N.inverseMass,N.positionPrev.y+=Q*N.inverseMass,N.anglePrev+=N.inverseInertia*((U.x-N.position.x)*Q-(U.y-N.position.y)*j)),D.isStatic||D.isSleeping||(D.positionPrev.x-=j*D.inverseMass,D.positionPrev.y-=Q*D.inverseMass,D.anglePrev-=D.inverseInertia*((U.x-D.position.x)*Q-(U.y-D.position.y)*j))}}}}},o.solveVelocity=function(g,x){var E=x/p._baseDelta,A=E*E,S=A*E,I=-o._restingThresh*E,_=o._restingThreshTangent,R=o._frictionNormalMultiplier*E,N=o._frictionMaxStatic,D=g.length,M,W,B,U;for(B=0;B<D;B++){var P=g[B];if(!(!P.isActive||P.isSensor)){var F=P.collision,j=F.parentA,Q=F.parentB,$=F.normal.x,V=F.normal.y,G=F.tangent.x,se=F.tangent.y,H=P.inverseMass,J=P.friction*P.frictionStatic*R,K=P.contacts,ie=P.contactCount,ne=1/ie,re=j.position.x-j.positionPrev.x,X=j.position.y-j.positionPrev.y,ae=j.angle-j.anglePrev,te=Q.position.x-Q.positionPrev.x,ce=Q.position.y-Q.positionPrev.y,xe=Q.angle-Q.anglePrev;for(U=0;U<ie;U++){var me=K[U],Se=me.vertex,be=Se.x-j.position.x,Me=Se.y-j.position.y,Oe=Se.x-Q.position.x,Ue=Se.y-Q.position.y,je=re-Me*ae,Pe=X+be*ae,We=te-Ue*xe,Ze=ce+Oe*xe,ot=je-We,st=Pe-Ze,nt=$*ot+V*st,tt=G*ot+se*st,bt=P.separation+nt,qe=Math.min(bt,1);qe=bt<0?0:qe;var Et=qe*J;tt<-Et||tt>Et?(W=tt>0?tt:-tt,M=P.friction*(tt>0?1:-1)*S,M<-W?M=-W:M>W&&(M=W)):(M=tt,W=N);var $t=be*V-Me*$,Vt=Oe*V-Ue*$,Dt=ne/(H+j.inverseInertia*$t*$t+Q.inverseInertia*Vt*Vt),Lt=(1+P.restitution)*nt*Dt;if(M*=Dt,nt<I)me.normalImpulse=0;else{var de=me.normalImpulse;me.normalImpulse+=Lt,me.normalImpulse>0&&(me.normalImpulse=0),Lt=me.normalImpulse-de}if(tt<-_||tt>_)me.tangentImpulse=0;else{var z=me.tangentImpulse;me.tangentImpulse+=M,me.tangentImpulse<-W&&(me.tangentImpulse=-W),me.tangentImpulse>W&&(me.tangentImpulse=W),M=me.tangentImpulse-z}var Y=$*Lt+G*M,ye=V*Lt+se*M;j.isStatic||j.isSleeping||(j.positionPrev.x+=Y*j.inverseMass,j.positionPrev.y+=ye*j.inverseMass,j.anglePrev+=(be*ye-Me*Y)*j.inverseInertia),Q.isStatic||Q.isSleeping||(Q.positionPrev.x-=Y*Q.inverseMass,Q.positionPrev.y-=ye*Q.inverseMass,Q.anglePrev-=(Oe*ye-Ue*Y)*Q.inverseInertia)}}}}})()},function(e,s,a){var o={};e.exports=o;var f=a(9),p=a(0);(function(){o.create=function(y){return p.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},y)},o.update=function(y,g,x){var E=f.update,A=f.create,S=f.setActive,I=y.table,_=y.list,R=_.length,N=R,D=y.collisionStart,M=y.collisionEnd,W=y.collisionActive,B=g.length,U=0,P=0,F=0,j,Q,$;for($=0;$<B;$++)j=g[$],Q=j.pair,Q?(Q.isActive&&(W[F++]=Q),E(Q,j,x)):(Q=A(j,x),I[Q.id]=Q,D[U++]=Q,_[N++]=Q);for(N=0,R=_.length,$=0;$<R;$++)Q=_[$],Q.timeUpdated>=x?_[N++]=Q:(S(Q,!1,x),Q.collision.bodyA.sleepCounter>0&&Q.collision.bodyB.sleepCounter>0?_[N++]=Q:(M[P++]=Q,delete I[Q.id]));_.length!==N&&(_.length=N),D.length!==U&&(D.length=U),M.length!==P&&(M.length=P),W.length!==F&&(W.length=F)},o.clear=function(y){return y.table={},y.list.length=0,y.collisionStart.length=0,y.collisionActive.length=0,y.collisionEnd.length=0,y}})()},function(e,s,a){var o=e.exports=a(21);o.Axes=a(11),o.Bodies=a(12),o.Body=a(4),o.Bounds=a(1),o.Collision=a(8),o.Common=a(0),o.Composite=a(6),o.Composites=a(22),o.Constraint=a(10),o.Contact=a(16),o.Detector=a(13),o.Engine=a(17),o.Events=a(5),o.Grid=a(23),o.Mouse=a(14),o.MouseConstraint=a(24),o.Pair=a(9),o.Pairs=a(19),o.Plugin=a(15),o.Query=a(25),o.Render=a(26),o.Resolver=a(18),o.Runner=a(27),o.SAT=a(28),o.Sleeping=a(7),o.Svg=a(29),o.Vector=a(2),o.Vertices=a(3),o.World=a(30),o.Engine.run=o.Runner.run,o.Common.deprecated(o.Engine,"run","Engine.run  use Matter.Runner.run(engine) instead")},function(e,s,a){var o={};e.exports=o;var f=a(15),p=a(0);(function(){o.name="matter-js",o.version="0.20.0",o.uses=[],o.used=[],o.use=function(){f.use(o,Array.prototype.slice.call(arguments))},o.before=function(y,g){return y=y.replace(/^Matter./,""),p.chainPathBefore(o,y,g)},o.after=function(y,g){return y=y.replace(/^Matter./,""),p.chainPathAfter(o,y,g)}})()},function(e,s,a){var o={};e.exports=o;var f=a(6),p=a(10),y=a(0),g=a(4),x=a(12),E=y.deprecated;(function(){o.stack=function(A,S,I,_,R,N,D){for(var M=f.create({label:"Stack"}),W=A,B=S,U,P=0,F=0;F<_;F++){for(var j=0,Q=0;Q<I;Q++){var $=D(W,B,Q,F,U,P);if($){var V=$.bounds.max.y-$.bounds.min.y,G=$.bounds.max.x-$.bounds.min.x;V>j&&(j=V),g.translate($,{x:G*.5,y:V*.5}),W=$.bounds.max.x+R,f.addBody(M,$),U=$,P+=1}else W+=R}B+=j+N,W=A}return M},o.chain=function(A,S,I,_,R,N){for(var D=A.bodies,M=1;M<D.length;M++){var W=D[M-1],B=D[M],U=W.bounds.max.y-W.bounds.min.y,P=W.bounds.max.x-W.bounds.min.x,F=B.bounds.max.y-B.bounds.min.y,j=B.bounds.max.x-B.bounds.min.x,Q={bodyA:W,pointA:{x:P*S,y:U*I},bodyB:B,pointB:{x:j*_,y:F*R}},$=y.extend(Q,N);f.addConstraint(A,p.create($))}return A.label+=" Chain",A},o.mesh=function(A,S,I,_,R){var N=A.bodies,D,M,W,B,U;for(D=0;D<I;D++){for(M=1;M<S;M++)W=N[M-1+D*S],B=N[M+D*S],f.addConstraint(A,p.create(y.extend({bodyA:W,bodyB:B},R)));if(D>0)for(M=0;M<S;M++)W=N[M+(D-1)*S],B=N[M+D*S],f.addConstraint(A,p.create(y.extend({bodyA:W,bodyB:B},R))),_&&M>0&&(U=N[M-1+(D-1)*S],f.addConstraint(A,p.create(y.extend({bodyA:U,bodyB:B},R)))),_&&M<S-1&&(U=N[M+1+(D-1)*S],f.addConstraint(A,p.create(y.extend({bodyA:U,bodyB:B},R))))}return A.label+=" Mesh",A},o.pyramid=function(A,S,I,_,R,N,D){return o.stack(A,S,I,_,R,N,function(M,W,B,U,P,F){var j=Math.min(_,Math.ceil(I/2)),Q=P?P.bounds.max.x-P.bounds.min.x:0;if(!(U>j)){U=j-U;var $=U,V=I-1-U;if(!(B<$||B>V)){F===1&&g.translate(P,{x:(B+(I%2===1?1:-1))*Q,y:0});var G=P?B*Q:0;return D(A+G+B*R,W,B,U,P,F)}}})},o.newtonsCradle=function(A,S,I,_,R){for(var N=f.create({label:"Newtons Cradle"}),D=0;D<I;D++){var M=1.9,W=x.circle(A+D*(_*M),S+R,_,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),B=p.create({pointA:{x:A+D*(_*M),y:S},bodyB:W});f.addBody(N,W),f.addConstraint(N,B)}return N},E(o,"newtonsCradle","Composites.newtonsCradle  moved to newtonsCradle example"),o.car=function(A,S,I,_,R){var N=g.nextGroup(!0),D=20,M=-I*.5+D,W=I*.5-D,B=0,U=f.create({label:"Car"}),P=x.rectangle(A,S,I,_,{collisionFilter:{group:N},chamfer:{radius:_*.5},density:2e-4}),F=x.circle(A+M,S+B,R,{collisionFilter:{group:N},friction:.8}),j=x.circle(A+W,S+B,R,{collisionFilter:{group:N},friction:.8}),Q=p.create({bodyB:P,pointB:{x:M,y:B},bodyA:F,stiffness:1,length:0}),$=p.create({bodyB:P,pointB:{x:W,y:B},bodyA:j,stiffness:1,length:0});return f.addBody(U,P),f.addBody(U,F),f.addBody(U,j),f.addConstraint(U,Q),f.addConstraint(U,$),U},E(o,"car","Composites.car  moved to car example"),o.softBody=function(A,S,I,_,R,N,D,M,W,B){W=y.extend({inertia:1/0},W),B=y.extend({stiffness:.2,render:{type:"line",anchors:!1}},B);var U=o.stack(A,S,I,_,R,N,function(P,F){return x.circle(P,F,M,W)});return o.mesh(U,I,_,D,B),U.label="Soft Body",U},E(o,"softBody","Composites.softBody  moved to softBody and cloth examples")})()},function(e,s,a){var o={};e.exports=o;var f=a(9),p=a(0),y=p.deprecated;(function(){o.create=function(g){var x={buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return p.extend(x,g)},o.update=function(g,x,E,A){var S,I,_,R=E.world,N=g.buckets,D,M,W=!1;for(S=0;S<x.length;S++){var B=x[S];if(!(B.isSleeping&&!A)&&!(R.bounds&&(B.bounds.max.x<R.bounds.min.x||B.bounds.min.x>R.bounds.max.x||B.bounds.max.y<R.bounds.min.y||B.bounds.min.y>R.bounds.max.y))){var U=o._getRegion(g,B);if(!B.region||U.id!==B.region.id||A){(!B.region||A)&&(B.region=U);var P=o._regionUnion(U,B.region);for(I=P.startCol;I<=P.endCol;I++)for(_=P.startRow;_<=P.endRow;_++){M=o._getBucketId(I,_),D=N[M];var F=I>=U.startCol&&I<=U.endCol&&_>=U.startRow&&_<=U.endRow,j=I>=B.region.startCol&&I<=B.region.endCol&&_>=B.region.startRow&&_<=B.region.endRow;!F&&j&&j&&D&&o._bucketRemoveBody(g,D,B),(B.region===U||F&&!j||A)&&(D||(D=o._createBucket(N,M)),o._bucketAddBody(g,D,B))}B.region=U,W=!0}}}W&&(g.pairsList=o._createActivePairsList(g))},y(o,"update","Grid.update  replaced by Matter.Detector"),o.clear=function(g){g.buckets={},g.pairs={},g.pairsList=[]},y(o,"clear","Grid.clear  replaced by Matter.Detector"),o._regionUnion=function(g,x){var E=Math.min(g.startCol,x.startCol),A=Math.max(g.endCol,x.endCol),S=Math.min(g.startRow,x.startRow),I=Math.max(g.endRow,x.endRow);return o._createRegion(E,A,S,I)},o._getRegion=function(g,x){var E=x.bounds,A=Math.floor(E.min.x/g.bucketWidth),S=Math.floor(E.max.x/g.bucketWidth),I=Math.floor(E.min.y/g.bucketHeight),_=Math.floor(E.max.y/g.bucketHeight);return o._createRegion(A,S,I,_)},o._createRegion=function(g,x,E,A){return{id:g+","+x+","+E+","+A,startCol:g,endCol:x,startRow:E,endRow:A}},o._getBucketId=function(g,x){return"C"+g+"R"+x},o._createBucket=function(g,x){var E=g[x]=[];return E},o._bucketAddBody=function(g,x,E){var A=g.pairs,S=f.id,I=x.length,_;for(_=0;_<I;_++){var R=x[_];if(!(E.id===R.id||E.isStatic&&R.isStatic)){var N=S(E,R),D=A[N];D?D[2]+=1:A[N]=[E,R,1]}}x.push(E)},o._bucketRemoveBody=function(g,x,E){var A=g.pairs,S=f.id,I;x.splice(p.indexOf(x,E),1);var _=x.length;for(I=0;I<_;I++){var R=A[S(E,x[I])];R&&(R[2]-=1)}},o._createActivePairsList=function(g){var x,E=g.pairs,A=p.keys(E),S=A.length,I=[],_;for(_=0;_<S;_++)x=E[A[_]],x[2]>0?I.push(x):delete E[A[_]];return I}})()},function(e,s,a){var o={};e.exports=o;var f=a(3),p=a(7),y=a(14),g=a(5),x=a(13),E=a(10),A=a(6),S=a(0),I=a(1);(function(){o.create=function(_,R){var N=(_?_.mouse:null)||(R?R.mouse:null);N||(_&&_.render&&_.render.canvas?N=y.create(_.render.canvas):R&&R.element?N=y.create(R.element):(N=y.create(),S.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var D=E.create({label:"Mouse Constraint",pointA:N.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),M={type:"mouseConstraint",mouse:N,element:null,body:null,constraint:D,collisionFilter:{category:1,mask:4294967295,group:0}},W=S.extend(M,R);return g.on(_,"beforeUpdate",function(){var B=A.allBodies(_.world);o.update(W,B),o._triggerEvents(W)}),W},o.update=function(_,R){var N=_.mouse,D=_.constraint,M=_.body;if(N.button===0){if(D.bodyB)p.set(D.bodyB,!1),D.pointA=N.position;else for(var W=0;W<R.length;W++)if(M=R[W],I.contains(M.bounds,N.position)&&x.canCollide(M.collisionFilter,_.collisionFilter))for(var B=M.parts.length>1?1:0;B<M.parts.length;B++){var U=M.parts[B];if(f.contains(U.vertices,N.position)){D.pointA=N.position,D.bodyB=_.body=M,D.pointB={x:N.position.x-M.position.x,y:N.position.y-M.position.y},D.angleB=M.angle,p.set(M,!1),g.trigger(_,"startdrag",{mouse:N,body:M});break}}}else D.bodyB=_.body=null,D.pointB=null,M&&g.trigger(_,"enddrag",{mouse:N,body:M})},o._triggerEvents=function(_){var R=_.mouse,N=R.sourceEvents;N.mousemove&&g.trigger(_,"mousemove",{mouse:R}),N.mousedown&&g.trigger(_,"mousedown",{mouse:R}),N.mouseup&&g.trigger(_,"mouseup",{mouse:R}),y.clearSourceEvents(R)}})()},function(e,s,a){var o={};e.exports=o;var f=a(2),p=a(8),y=a(1),g=a(12),x=a(3);(function(){o.collides=function(E,A){for(var S=[],I=A.length,_=E.bounds,R=p.collides,N=y.overlaps,D=0;D<I;D++){var M=A[D],W=M.parts.length,B=W===1?0:1;if(N(M.bounds,_))for(var U=B;U<W;U++){var P=M.parts[U];if(N(P.bounds,_)){var F=R(P,E);if(F){S.push(F);break}}}}return S},o.ray=function(E,A,S,I){I=I||1e-100;for(var _=f.angle(A,S),R=f.magnitude(f.sub(A,S)),N=(S.x+A.x)*.5,D=(S.y+A.y)*.5,M=g.rectangle(N,D,R,I,{angle:_}),W=o.collides(M,E),B=0;B<W.length;B+=1){var U=W[B];U.body=U.bodyB=U.bodyA}return W},o.region=function(E,A,S){for(var I=[],_=0;_<E.length;_++){var R=E[_],N=y.overlaps(R.bounds,A);(N&&!S||!N&&S)&&I.push(R)}return I},o.point=function(E,A){for(var S=[],I=0;I<E.length;I++){var _=E[I];if(y.contains(_.bounds,A))for(var R=_.parts.length===1?0:1;R<_.parts.length;R++){var N=_.parts[R];if(y.contains(N.bounds,A)&&x.contains(N.vertices,A)){S.push(_);break}}}return S}})()},function(e,s,a){var o={};e.exports=o;var f=a(4),p=a(0),y=a(6),g=a(1),x=a(5),E=a(2),A=a(14);(function(){var S,I;typeof window<"u"&&(S=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(B){window.setTimeout(function(){B(p.now())},1e3/60)},I=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),o._goodFps=30,o._goodDelta=1e3/60,o.create=function(B){var U={engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],engineUpdatesHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",wireframeStrokeStyle:"#bbb",hasBounds:!!B.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},P=p.extend(U,B);return P.canvas&&(P.canvas.width=P.options.width||P.canvas.width,P.canvas.height=P.options.height||P.canvas.height),P.mouse=B.mouse,P.engine=B.engine,P.canvas=P.canvas||N(P.options.width,P.options.height),P.context=P.canvas.getContext("2d"),P.textures={},P.bounds=P.bounds||{min:{x:0,y:0},max:{x:P.canvas.width,y:P.canvas.height}},P.controller=o,P.options.showBroadphase=!1,P.options.pixelRatio!==1&&o.setPixelRatio(P,P.options.pixelRatio),p.isElement(P.element)&&P.element.appendChild(P.canvas),P},o.run=function(B){(function U(P){B.frameRequestId=S(U),_(B,P),o.world(B,P),B.context.setTransform(B.options.pixelRatio,0,0,B.options.pixelRatio,0,0),(B.options.showStats||B.options.showDebug)&&o.stats(B,B.context,P),(B.options.showPerformance||B.options.showDebug)&&o.performance(B,B.context,P),B.context.setTransform(1,0,0,1,0,0)})()},o.stop=function(B){I(B.frameRequestId)},o.setPixelRatio=function(B,U){var P=B.options,F=B.canvas;U==="auto"&&(U=D(F)),P.pixelRatio=U,F.setAttribute("data-pixel-ratio",U),F.width=P.width*U,F.height=P.height*U,F.style.width=P.width+"px",F.style.height=P.height+"px"},o.setSize=function(B,U,P){B.options.width=U,B.options.height=P,B.bounds.max.x=B.bounds.min.x+U,B.bounds.max.y=B.bounds.min.y+P,B.options.pixelRatio!==1?o.setPixelRatio(B,B.options.pixelRatio):(B.canvas.width=U,B.canvas.height=P)},o.lookAt=function(B,U,P,F){F=typeof F<"u"?F:!0,U=p.isArray(U)?U:[U],P=P||{x:0,y:0};for(var j={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},Q=0;Q<U.length;Q+=1){var $=U[Q],V=$.bounds?$.bounds.min:$.min||$.position||$,G=$.bounds?$.bounds.max:$.max||$.position||$;V&&G&&(V.x<j.min.x&&(j.min.x=V.x),G.x>j.max.x&&(j.max.x=G.x),V.y<j.min.y&&(j.min.y=V.y),G.y>j.max.y&&(j.max.y=G.y))}var se=j.max.x-j.min.x+2*P.x,H=j.max.y-j.min.y+2*P.y,J=B.canvas.height,K=B.canvas.width,ie=K/J,ne=se/H,re=1,X=1;ne>ie?X=ne/ie:re=ie/ne,B.options.hasBounds=!0,B.bounds.min.x=j.min.x,B.bounds.max.x=j.min.x+se*re,B.bounds.min.y=j.min.y,B.bounds.max.y=j.min.y+H*X,F&&(B.bounds.min.x+=se*.5-se*re*.5,B.bounds.max.x+=se*.5-se*re*.5,B.bounds.min.y+=H*.5-H*X*.5,B.bounds.max.y+=H*.5-H*X*.5),B.bounds.min.x-=P.x,B.bounds.max.x-=P.x,B.bounds.min.y-=P.y,B.bounds.max.y-=P.y,B.mouse&&(A.setScale(B.mouse,{x:(B.bounds.max.x-B.bounds.min.x)/B.canvas.width,y:(B.bounds.max.y-B.bounds.min.y)/B.canvas.height}),A.setOffset(B.mouse,B.bounds.min))},o.startViewTransform=function(B){var U=B.bounds.max.x-B.bounds.min.x,P=B.bounds.max.y-B.bounds.min.y,F=U/B.options.width,j=P/B.options.height;B.context.setTransform(B.options.pixelRatio/F,0,0,B.options.pixelRatio/j,0,0),B.context.translate(-B.bounds.min.x,-B.bounds.min.y)},o.endViewTransform=function(B){B.context.setTransform(B.options.pixelRatio,0,0,B.options.pixelRatio,0,0)},o.world=function(B,U){var P=p.now(),F=B.engine,j=F.world,Q=B.canvas,$=B.context,V=B.options,G=B.timing,se=y.allBodies(j),H=y.allConstraints(j),J=V.wireframes?V.wireframeBackground:V.background,K=[],ie=[],ne,re={timestamp:F.timing.timestamp};if(x.trigger(B,"beforeRender",re),B.currentBackground!==J&&W(B,J),$.globalCompositeOperation="source-in",$.fillStyle="transparent",$.fillRect(0,0,Q.width,Q.height),$.globalCompositeOperation="source-over",V.hasBounds){for(ne=0;ne<se.length;ne++){var X=se[ne];g.overlaps(X.bounds,B.bounds)&&K.push(X)}for(ne=0;ne<H.length;ne++){var ae=H[ne],te=ae.bodyA,ce=ae.bodyB,xe=ae.pointA,me=ae.pointB;te&&(xe=E.add(te.position,ae.pointA)),ce&&(me=E.add(ce.position,ae.pointB)),!(!xe||!me)&&(g.contains(B.bounds,xe)||g.contains(B.bounds,me))&&ie.push(ae)}o.startViewTransform(B),B.mouse&&(A.setScale(B.mouse,{x:(B.bounds.max.x-B.bounds.min.x)/B.options.width,y:(B.bounds.max.y-B.bounds.min.y)/B.options.height}),A.setOffset(B.mouse,B.bounds.min))}else ie=H,K=se,B.options.pixelRatio!==1&&B.context.setTransform(B.options.pixelRatio,0,0,B.options.pixelRatio,0,0);!V.wireframes||F.enableSleeping&&V.showSleeping?o.bodies(B,K,$):(V.showConvexHulls&&o.bodyConvexHulls(B,K,$),o.bodyWireframes(B,K,$)),V.showBounds&&o.bodyBounds(B,K,$),(V.showAxes||V.showAngleIndicator)&&o.bodyAxes(B,K,$),V.showPositions&&o.bodyPositions(B,K,$),V.showVelocity&&o.bodyVelocity(B,K,$),V.showIds&&o.bodyIds(B,K,$),V.showSeparations&&o.separations(B,F.pairs.list,$),V.showCollisions&&o.collisions(B,F.pairs.list,$),V.showVertexNumbers&&o.vertexNumbers(B,K,$),V.showMousePosition&&o.mousePosition(B,B.mouse,$),o.constraints(ie,$),V.hasBounds&&o.endViewTransform(B),x.trigger(B,"afterRender",re),G.lastElapsed=p.now()-P},o.stats=function(B,U,P){for(var F=B.engine,j=F.world,Q=y.allBodies(j),$=0,V=55,G=44,se=0,H=0,J=0;J<Q.length;J+=1)$+=Q[J].parts.length;var K={Part:$,Body:Q.length,Cons:y.allConstraints(j).length,Comp:y.allComposites(j).length,Pair:F.pairs.list.length};U.fillStyle="#0e0f19",U.fillRect(se,H,V*5.5,G),U.font="12px Arial",U.textBaseline="top",U.textAlign="right";for(var ie in K){var ne=K[ie];U.fillStyle="#aaa",U.fillText(ie,se+V,H+8),U.fillStyle="#eee",U.fillText(ne,se+V,H+26),se+=V}},o.performance=function(B,U){var P=B.engine,F=B.timing,j=F.deltaHistory,Q=F.elapsedHistory,$=F.timestampElapsedHistory,V=F.engineDeltaHistory,G=F.engineUpdatesHistory,se=F.engineElapsedHistory,H=P.timing.lastUpdatesPerFrame,J=P.timing.lastDelta,K=R(j),ie=R(Q),ne=R(V),re=R(G),X=R(se),ae=R($),te=ae/K||0,ce=Math.round(K/J),xe=1e3/K||0,me=4,Se=12,be=60,Me=34,Oe=10,Ue=69;U.fillStyle="#0e0f19",U.fillRect(0,50,Se*5+be*6+22,Me),o.status(U,Oe,Ue,be,me,j.length,Math.round(xe)+" fps",xe/o._goodFps,function(je){return j[je]/K-1}),o.status(U,Oe+Se+be,Ue,be,me,V.length,J.toFixed(2)+" dt",o._goodDelta/J,function(je){return V[je]/ne-1}),o.status(U,Oe+(Se+be)*2,Ue,be,me,G.length,H+" upf",Math.pow(p.clamp(re/ce||1,0,1),4),function(je){return G[je]/re-1}),o.status(U,Oe+(Se+be)*3,Ue,be,me,se.length,X.toFixed(2)+" ut",1-H*X/o._goodFps,function(je){return se[je]/X-1}),o.status(U,Oe+(Se+be)*4,Ue,be,me,Q.length,ie.toFixed(2)+" rt",1-ie/o._goodFps,function(je){return Q[je]/ie-1}),o.status(U,Oe+(Se+be)*5,Ue,be,me,$.length,te.toFixed(2)+" x",te*te*te,function(je){return($[je]/j[je]/te||0)-1})},o.status=function(B,U,P,F,j,Q,$,V,G){B.strokeStyle="#888",B.fillStyle="#444",B.lineWidth=1,B.fillRect(U,P+7,F,1),B.beginPath(),B.moveTo(U,P+7-j*p.clamp(.4*G(0),-2,2));for(var se=0;se<F;se+=1)B.lineTo(U+se,P+7-(se<Q?j*p.clamp(.4*G(se),-2,2):0));B.stroke(),B.fillStyle="hsl("+p.clamp(25+95*V,0,120)+",100%,60%)",B.fillRect(U,P-7,4,4),B.font="12px Arial",B.textBaseline="middle",B.textAlign="right",B.fillStyle="#eee",B.fillText($,U+F,P-5)},o.constraints=function(B,U){for(var P=U,F=0;F<B.length;F++){var j=B[F];if(!(!j.render.visible||!j.pointA||!j.pointB)){var Q=j.bodyA,$=j.bodyB,V,G;if(Q?V=E.add(Q.position,j.pointA):V=j.pointA,j.render.type==="pin")P.beginPath(),P.arc(V.x,V.y,3,0,2*Math.PI),P.closePath();else{if($?G=E.add($.position,j.pointB):G=j.pointB,P.beginPath(),P.moveTo(V.x,V.y),j.render.type==="spring")for(var se=E.sub(G,V),H=E.perp(E.normalise(se)),J=Math.ceil(p.clamp(j.length/5,12,20)),K,ie=1;ie<J;ie+=1)K=ie%2===0?1:-1,P.lineTo(V.x+se.x*(ie/J)+H.x*K*4,V.y+se.y*(ie/J)+H.y*K*4);P.lineTo(G.x,G.y)}j.render.lineWidth&&(P.lineWidth=j.render.lineWidth,P.strokeStyle=j.render.strokeStyle,P.stroke()),j.render.anchors&&(P.fillStyle=j.render.strokeStyle,P.beginPath(),P.arc(V.x,V.y,3,0,2*Math.PI),P.arc(G.x,G.y,3,0,2*Math.PI),P.closePath(),P.fill())}}},o.bodies=function(B,U,P){var F=P;B.engine;var j=B.options,Q=j.showInternalEdges||!j.wireframes,$,V,G,se;for(G=0;G<U.length;G++)if($=U[G],!!$.render.visible){for(se=$.parts.length>1?1:0;se<$.parts.length;se++)if(V=$.parts[se],!!V.render.visible){if(j.showSleeping&&$.isSleeping?F.globalAlpha=.5*V.render.opacity:V.render.opacity!==1&&(F.globalAlpha=V.render.opacity),V.render.sprite&&V.render.sprite.texture&&!j.wireframes){var H=V.render.sprite,J=M(B,H.texture);F.translate(V.position.x,V.position.y),F.rotate(V.angle),F.drawImage(J,J.width*-H.xOffset*H.xScale,J.height*-H.yOffset*H.yScale,J.width*H.xScale,J.height*H.yScale),F.rotate(-V.angle),F.translate(-V.position.x,-V.position.y)}else{if(V.circleRadius)F.beginPath(),F.arc(V.position.x,V.position.y,V.circleRadius,0,2*Math.PI);else{F.beginPath(),F.moveTo(V.vertices[0].x,V.vertices[0].y);for(var K=1;K<V.vertices.length;K++)!V.vertices[K-1].isInternal||Q?F.lineTo(V.vertices[K].x,V.vertices[K].y):F.moveTo(V.vertices[K].x,V.vertices[K].y),V.vertices[K].isInternal&&!Q&&F.moveTo(V.vertices[(K+1)%V.vertices.length].x,V.vertices[(K+1)%V.vertices.length].y);F.lineTo(V.vertices[0].x,V.vertices[0].y),F.closePath()}j.wireframes?(F.lineWidth=1,F.strokeStyle=B.options.wireframeStrokeStyle,F.stroke()):(F.fillStyle=V.render.fillStyle,V.render.lineWidth&&(F.lineWidth=V.render.lineWidth,F.strokeStyle=V.render.strokeStyle,F.stroke()),F.fill())}F.globalAlpha=1}}},o.bodyWireframes=function(B,U,P){var F=P,j=B.options.showInternalEdges,Q,$,V,G,se;for(F.beginPath(),V=0;V<U.length;V++)if(Q=U[V],!!Q.render.visible)for(se=Q.parts.length>1?1:0;se<Q.parts.length;se++){for($=Q.parts[se],F.moveTo($.vertices[0].x,$.vertices[0].y),G=1;G<$.vertices.length;G++)!$.vertices[G-1].isInternal||j?F.lineTo($.vertices[G].x,$.vertices[G].y):F.moveTo($.vertices[G].x,$.vertices[G].y),$.vertices[G].isInternal&&!j&&F.moveTo($.vertices[(G+1)%$.vertices.length].x,$.vertices[(G+1)%$.vertices.length].y);F.lineTo($.vertices[0].x,$.vertices[0].y)}F.lineWidth=1,F.strokeStyle=B.options.wireframeStrokeStyle,F.stroke()},o.bodyConvexHulls=function(B,U,P){var F=P,j,Q,$;for(F.beginPath(),Q=0;Q<U.length;Q++)if(j=U[Q],!(!j.render.visible||j.parts.length===1)){for(F.moveTo(j.vertices[0].x,j.vertices[0].y),$=1;$<j.vertices.length;$++)F.lineTo(j.vertices[$].x,j.vertices[$].y);F.lineTo(j.vertices[0].x,j.vertices[0].y)}F.lineWidth=1,F.strokeStyle="rgba(255,255,255,0.2)",F.stroke()},o.vertexNumbers=function(B,U,P){var F=P,j,Q,$;for(j=0;j<U.length;j++){var V=U[j].parts;for($=V.length>1?1:0;$<V.length;$++){var G=V[$];for(Q=0;Q<G.vertices.length;Q++)F.fillStyle="rgba(255,255,255,0.2)",F.fillText(j+"_"+Q,G.position.x+(G.vertices[Q].x-G.position.x)*.8,G.position.y+(G.vertices[Q].y-G.position.y)*.8)}}},o.mousePosition=function(B,U,P){var F=P;F.fillStyle="rgba(255,255,255,0.8)",F.fillText(U.position.x+"  "+U.position.y,U.position.x+5,U.position.y-5)},o.bodyBounds=function(B,U,P){var F=P;B.engine;var j=B.options;F.beginPath();for(var Q=0;Q<U.length;Q++){var $=U[Q];if($.render.visible)for(var V=U[Q].parts,G=V.length>1?1:0;G<V.length;G++){var se=V[G];F.rect(se.bounds.min.x,se.bounds.min.y,se.bounds.max.x-se.bounds.min.x,se.bounds.max.y-se.bounds.min.y)}}j.wireframes?F.strokeStyle="rgba(255,255,255,0.08)":F.strokeStyle="rgba(0,0,0,0.1)",F.lineWidth=1,F.stroke()},o.bodyAxes=function(B,U,P){var F=P;B.engine;var j=B.options,Q,$,V,G;for(F.beginPath(),$=0;$<U.length;$++){var se=U[$],H=se.parts;if(se.render.visible)if(j.showAxes)for(V=H.length>1?1:0;V<H.length;V++)for(Q=H[V],G=0;G<Q.axes.length;G++){var J=Q.axes[G];F.moveTo(Q.position.x,Q.position.y),F.lineTo(Q.position.x+J.x*20,Q.position.y+J.y*20)}else for(V=H.length>1?1:0;V<H.length;V++)for(Q=H[V],G=0;G<Q.axes.length;G++)F.moveTo(Q.position.x,Q.position.y),F.lineTo((Q.vertices[0].x+Q.vertices[Q.vertices.length-1].x)/2,(Q.vertices[0].y+Q.vertices[Q.vertices.length-1].y)/2)}j.wireframes?(F.strokeStyle="indianred",F.lineWidth=1):(F.strokeStyle="rgba(255, 255, 255, 0.4)",F.globalCompositeOperation="overlay",F.lineWidth=2),F.stroke(),F.globalCompositeOperation="source-over"},o.bodyPositions=function(B,U,P){var F=P;B.engine;var j=B.options,Q,$,V,G;for(F.beginPath(),V=0;V<U.length;V++)if(Q=U[V],!!Q.render.visible)for(G=0;G<Q.parts.length;G++)$=Q.parts[G],F.arc($.position.x,$.position.y,3,0,2*Math.PI,!1),F.closePath();for(j.wireframes?F.fillStyle="indianred":F.fillStyle="rgba(0,0,0,0.5)",F.fill(),F.beginPath(),V=0;V<U.length;V++)Q=U[V],Q.render.visible&&(F.arc(Q.positionPrev.x,Q.positionPrev.y,2,0,2*Math.PI,!1),F.closePath());F.fillStyle="rgba(255,165,0,0.8)",F.fill()},o.bodyVelocity=function(B,U,P){var F=P;F.beginPath();for(var j=0;j<U.length;j++){var Q=U[j];if(Q.render.visible){var $=f.getVelocity(Q);F.moveTo(Q.position.x,Q.position.y),F.lineTo(Q.position.x+$.x,Q.position.y+$.y)}}F.lineWidth=3,F.strokeStyle="cornflowerblue",F.stroke()},o.bodyIds=function(B,U,P){var F=P,j,Q;for(j=0;j<U.length;j++)if(U[j].render.visible){var $=U[j].parts;for(Q=$.length>1?1:0;Q<$.length;Q++){var V=$[Q];F.font="12px Arial",F.fillStyle="rgba(255,255,255,0.5)",F.fillText(V.id,V.position.x+10,V.position.y-10)}}},o.collisions=function(B,U,P){var F=P,j=B.options,Q,$,V,G;for(F.beginPath(),V=0;V<U.length;V++)if(Q=U[V],!!Q.isActive)for($=Q.collision,G=0;G<Q.contactCount;G++){var se=Q.contacts[G],H=se.vertex;F.rect(H.x-1.5,H.y-1.5,3.5,3.5)}for(j.wireframes?F.fillStyle="rgba(255,255,255,0.7)":F.fillStyle="orange",F.fill(),F.beginPath(),V=0;V<U.length;V++)if(Q=U[V],!!Q.isActive&&($=Q.collision,Q.contactCount>0)){var J=Q.contacts[0].vertex.x,K=Q.contacts[0].vertex.y;Q.contactCount===2&&(J=(Q.contacts[0].vertex.x+Q.contacts[1].vertex.x)/2,K=(Q.contacts[0].vertex.y+Q.contacts[1].vertex.y)/2),$.bodyB===$.supports[0].body||$.bodyA.isStatic===!0?F.moveTo(J-$.normal.x*8,K-$.normal.y*8):F.moveTo(J+$.normal.x*8,K+$.normal.y*8),F.lineTo(J,K)}j.wireframes?F.strokeStyle="rgba(255,165,0,0.7)":F.strokeStyle="orange",F.lineWidth=1,F.stroke()},o.separations=function(B,U,P){var F=P,j=B.options,Q,$,V,G,se;for(F.beginPath(),se=0;se<U.length;se++)if(Q=U[se],!!Q.isActive){$=Q.collision,V=$.bodyA,G=$.bodyB;var H=1;!G.isStatic&&!V.isStatic&&(H=.5),G.isStatic&&(H=0),F.moveTo(G.position.x,G.position.y),F.lineTo(G.position.x-$.penetration.x*H,G.position.y-$.penetration.y*H),H=1,!G.isStatic&&!V.isStatic&&(H=.5),V.isStatic&&(H=0),F.moveTo(V.position.x,V.position.y),F.lineTo(V.position.x+$.penetration.x*H,V.position.y+$.penetration.y*H)}j.wireframes?F.strokeStyle="rgba(255,165,0,0.5)":F.strokeStyle="orange",F.stroke()},o.inspector=function(B,U){B.engine;var P=B.selected,F=B.render,j=F.options,Q;if(j.hasBounds){var $=F.bounds.max.x-F.bounds.min.x,V=F.bounds.max.y-F.bounds.min.y,G=$/F.options.width,se=V/F.options.height;U.scale(1/G,1/se),U.translate(-F.bounds.min.x,-F.bounds.min.y)}for(var H=0;H<P.length;H++){var J=P[H].data;switch(U.translate(.5,.5),U.lineWidth=1,U.strokeStyle="rgba(255,165,0,0.9)",U.setLineDash([1,2]),J.type){case"body":Q=J.bounds,U.beginPath(),U.rect(Math.floor(Q.min.x-3),Math.floor(Q.min.y-3),Math.floor(Q.max.x-Q.min.x+6),Math.floor(Q.max.y-Q.min.y+6)),U.closePath(),U.stroke();break;case"constraint":var K=J.pointA;J.bodyA&&(K=J.pointB),U.beginPath(),U.arc(K.x,K.y,10,0,2*Math.PI),U.closePath(),U.stroke();break}U.setLineDash([]),U.translate(-.5,-.5)}B.selectStart!==null&&(U.translate(.5,.5),U.lineWidth=1,U.strokeStyle="rgba(255,165,0,0.6)",U.fillStyle="rgba(255,165,0,0.1)",Q=B.selectBounds,U.beginPath(),U.rect(Math.floor(Q.min.x),Math.floor(Q.min.y),Math.floor(Q.max.x-Q.min.x),Math.floor(Q.max.y-Q.min.y)),U.closePath(),U.stroke(),U.fill(),U.translate(-.5,-.5)),j.hasBounds&&U.setTransform(1,0,0,1,0,0)};var _=function(B,U){var P=B.engine,F=B.timing,j=F.historySize,Q=P.timing.timestamp;F.delta=U-F.lastTime||o._goodDelta,F.lastTime=U,F.timestampElapsed=Q-F.lastTimestamp||0,F.lastTimestamp=Q,F.deltaHistory.unshift(F.delta),F.deltaHistory.length=Math.min(F.deltaHistory.length,j),F.engineDeltaHistory.unshift(P.timing.lastDelta),F.engineDeltaHistory.length=Math.min(F.engineDeltaHistory.length,j),F.timestampElapsedHistory.unshift(F.timestampElapsed),F.timestampElapsedHistory.length=Math.min(F.timestampElapsedHistory.length,j),F.engineUpdatesHistory.unshift(P.timing.lastUpdatesPerFrame),F.engineUpdatesHistory.length=Math.min(F.engineUpdatesHistory.length,j),F.engineElapsedHistory.unshift(P.timing.lastElapsed),F.engineElapsedHistory.length=Math.min(F.engineElapsedHistory.length,j),F.elapsedHistory.unshift(F.lastElapsed),F.elapsedHistory.length=Math.min(F.elapsedHistory.length,j)},R=function(B){for(var U=0,P=0;P<B.length;P+=1)U+=B[P];return U/B.length||0},N=function(B,U){var P=document.createElement("canvas");return P.width=B,P.height=U,P.oncontextmenu=function(){return!1},P.onselectstart=function(){return!1},P},D=function(B){var U=B.getContext("2d"),P=window.devicePixelRatio||1,F=U.webkitBackingStorePixelRatio||U.mozBackingStorePixelRatio||U.msBackingStorePixelRatio||U.oBackingStorePixelRatio||U.backingStorePixelRatio||1;return P/F},M=function(B,U){var P=B.textures[U];return P||(P=B.textures[U]=new Image,P.src=U,P)},W=function(B,U){var P=U;/(jpg|gif|png)$/.test(U)&&(P="url("+U+")"),B.canvas.style.background=P,B.canvas.style.backgroundSize="contain",B.currentBackground=U}})()},function(e,s,a){var o={};e.exports=o;var f=a(5),p=a(17),y=a(0);(function(){o._maxFrameDelta=1e3/15,o._frameDeltaFallback=1e3/60,o._timeBufferMargin=1.5,o._elapsedNextEstimate=1,o._smoothingLowerBound=.1,o._smoothingUpperBound=.9,o.create=function(x){var E={delta:16.666666666666668,frameDelta:null,frameDeltaSmoothing:!0,frameDeltaSnapping:!0,frameDeltaHistory:[],frameDeltaHistorySize:100,frameRequestId:null,timeBuffer:0,timeLastTick:null,maxUpdates:null,maxFrameTime:33.333333333333336,lastUpdatesDeferred:0,enabled:!0},A=y.extend(E,x);return A.fps=0,A},o.run=function(x,E){return x.timeBuffer=o._frameDeltaFallback,function A(S){x.frameRequestId=o._onNextFrame(x,A),S&&x.enabled&&o.tick(x,E,S)}(),x},o.tick=function(x,E,A){var S=y.now(),I=x.delta,_=0,R=A-x.timeLastTick;if((!R||!x.timeLastTick||R>Math.max(o._maxFrameDelta,x.maxFrameTime))&&(R=x.frameDelta||o._frameDeltaFallback),x.frameDeltaSmoothing){x.frameDeltaHistory.push(R),x.frameDeltaHistory=x.frameDeltaHistory.slice(-x.frameDeltaHistorySize);var N=x.frameDeltaHistory.slice(0).sort(),D=x.frameDeltaHistory.slice(N.length*o._smoothingLowerBound,N.length*o._smoothingUpperBound),M=g(D);R=M||R}x.frameDeltaSnapping&&(R=1e3/Math.round(1e3/R)),x.frameDelta=R,x.timeLastTick=A,x.timeBuffer+=x.frameDelta,x.timeBuffer=y.clamp(x.timeBuffer,0,x.frameDelta+I*o._timeBufferMargin),x.lastUpdatesDeferred=0;var W=x.maxUpdates||Math.ceil(x.maxFrameTime/I),B={timestamp:E.timing.timestamp};f.trigger(x,"beforeTick",B),f.trigger(x,"tick",B);for(var U=y.now();I>0&&x.timeBuffer>=I*o._timeBufferMargin;){f.trigger(x,"beforeUpdate",B),p.update(E,I),f.trigger(x,"afterUpdate",B),x.timeBuffer-=I,_+=1;var P=y.now()-S,F=y.now()-U,j=P+o._elapsedNextEstimate*F/_;if(_>=W||j>x.maxFrameTime){x.lastUpdatesDeferred=Math.round(Math.max(0,x.timeBuffer/I-o._timeBufferMargin));break}}E.timing.lastUpdatesPerFrame=_,f.trigger(x,"afterTick",B),x.frameDeltaHistory.length>=100&&(x.lastUpdatesDeferred&&Math.round(x.frameDelta/I)>W?y.warnOnce("Matter.Runner: runner reached runner.maxUpdates, see docs."):x.lastUpdatesDeferred&&y.warnOnce("Matter.Runner: runner reached runner.maxFrameTime, see docs."),typeof x.isFixed<"u"&&y.warnOnce("Matter.Runner: runner.isFixed is now redundant, see docs."),(x.deltaMin||x.deltaMax)&&y.warnOnce("Matter.Runner: runner.deltaMin and runner.deltaMax were removed, see docs."),x.fps!==0&&y.warnOnce("Matter.Runner: runner.fps was replaced by runner.delta, see docs."))},o.stop=function(x){o._cancelNextFrame(x)},o._onNextFrame=function(x,E){if(typeof window<"u"&&window.requestAnimationFrame)x.frameRequestId=window.requestAnimationFrame(E);else throw new Error("Matter.Runner: missing required global window.requestAnimationFrame.");return x.frameRequestId},o._cancelNextFrame=function(x){if(typeof window<"u"&&window.cancelAnimationFrame)window.cancelAnimationFrame(x.frameRequestId);else throw new Error("Matter.Runner: missing required global window.cancelAnimationFrame.")};var g=function(x){for(var E=0,A=x.length,S=0;S<A;S+=1)E+=x[S];return E/A||0}})()},function(e,s,a){var o={};e.exports=o;var f=a(8),p=a(0),y=p.deprecated;(function(){o.collides=function(g,x){return f.collides(g,x)},y(o,"collides","SAT.collides  replaced by Collision.collides")})()},function(e,s,a){var o={};e.exports=o,a(1);var f=a(0);(function(){o.pathToVertices=function(p,y){typeof window<"u"&&!("SVGPathSeg"in window)&&f.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var g,x,E,A,S,I,_,R,N,D,M=[],W,B,U=0,P=0,F=0;y=y||15;var j=function($,V,G){var se=G%2===1&&G>1;if(!N||$!=N.x||V!=N.y){N&&se?(W=N.x,B=N.y):(W=0,B=0);var H={x:W+$,y:B+V};(se||!N)&&(N=H),M.push(H),P=W+$,F=B+V}},Q=function($){var V=$.pathSegTypeAsLetter.toUpperCase();if(V!=="Z"){switch(V){case"M":case"L":case"T":case"C":case"S":case"Q":P=$.x,F=$.y;break;case"H":P=$.x;break;case"V":F=$.y;break}j(P,F,$.pathSegType)}};for(o._svgPathToAbsolute(p),E=p.getTotalLength(),I=[],g=0;g<p.pathSegList.numberOfItems;g+=1)I.push(p.pathSegList.getItem(g));for(_=I.concat();U<E;){if(D=p.getPathSegAtLength(U),S=I[D],S!=R){for(;_.length&&_[0]!=S;)Q(_.shift());R=S}switch(S.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":A=p.getPointAtLength(U),j(A.x,A.y,0);break}U+=y}for(g=0,x=_.length;g<x;++g)Q(_[g]);return M},o._svgPathToAbsolute=function(p){for(var y,g,x,E,A,S,I=p.pathSegList,_=0,R=0,N=I.numberOfItems,D=0;D<N;++D){var M=I.getItem(D),W=M.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(W))"x"in M&&(_=M.x),"y"in M&&(R=M.y);else switch("x1"in M&&(x=_+M.x1),"x2"in M&&(A=_+M.x2),"y1"in M&&(E=R+M.y1),"y2"in M&&(S=R+M.y2),"x"in M&&(_+=M.x),"y"in M&&(R+=M.y),W){case"m":I.replaceItem(p.createSVGPathSegMovetoAbs(_,R),D);break;case"l":I.replaceItem(p.createSVGPathSegLinetoAbs(_,R),D);break;case"h":I.replaceItem(p.createSVGPathSegLinetoHorizontalAbs(_),D);break;case"v":I.replaceItem(p.createSVGPathSegLinetoVerticalAbs(R),D);break;case"c":I.replaceItem(p.createSVGPathSegCurvetoCubicAbs(_,R,x,E,A,S),D);break;case"s":I.replaceItem(p.createSVGPathSegCurvetoCubicSmoothAbs(_,R,A,S),D);break;case"q":I.replaceItem(p.createSVGPathSegCurvetoQuadraticAbs(_,R,x,E),D);break;case"t":I.replaceItem(p.createSVGPathSegCurvetoQuadraticSmoothAbs(_,R),D);break;case"a":I.replaceItem(p.createSVGPathSegArcAbs(_,R,M.r1,M.r2,M.angle,M.largeArcFlag,M.sweepFlag),D);break;case"z":case"Z":_=y,R=g;break}(W=="M"||W=="m")&&(y=_,g=R)}}})()},function(e,s,a){var o={};e.exports=o;var f=a(6);a(0),function(){o.create=f.create,o.add=f.add,o.remove=f.remove,o.clear=f.clear,o.addComposite=f.addComposite,o.addBody=f.addBody,o.addConstraint=f.addConstraint}()}])})}(matter$1)),matter$1.exports}var matterExports=requireMatter();const Matter=getDefaultExportFromCjs(matterExports),{Bodies:Bodies$1}=Matter,calculateDistance=(n,t)=>Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2)),generateInitialPositions=n=>{var Pe,We,Ze,ot;console.log("[generateInitialPositions] Generating new level layout with provided settings...");const{VIRTUAL_WIDTH:t,VIRTUAL_HEIGHT:e,SHIP_RADIUS:s,PLANET_MIN_RADIUS:a,PLANET_MAX_RADIUS:o,NUM_PLANETS:f,NUM_SLINGGER_PLANETS:p,SLINGGER_PLANET_MAX_RADIUS:y,SLINGGER_PLANET_CORE_RADIUS_FACTOR:g,GAME_VIEW_WIDTH_FACTOR:x,GAME_VIEW_HEIGHT_FACTOR:E,SHIP_ZONE_WIDTH_FACTOR:A,PLANET_SPAWN_AREA_FACTOR:S,MIN_SHIP_SEPARATION_FACTOR:I,MIN_PLANET_SHIP_DISTANCE:_,MIN_PLANET_PLANET_DISTANCE:R}=n,N=t*x,D=e*E,M=(t-N)/2,W=M+N,B=(e-D)/2,U=B+D,P=N*A,F=s+20,j=M+F,Q=M+P-F,$=W-P+F,V=W-F,G=B+F,se=U-F;let H,J;const K=Math.pow(N*I,2);let ie=0;const ne=200;do{const st=Math.random()*(Q-j)+j,nt=Math.random()*(se-G)+G;H={x:st,y:nt};const tt=Math.random()*(V-$)+$,bt=Math.random()*(se-G)+G;J={x:tt,y:bt},ie++;const qe=J.x-H.x,Et=J.y-H.y;if(qe*qe+Et*Et>=K)break}while(ie<ne);ie>=ne&&console.warn(`Could not place ships with minimum separation after ${ne} attempts, using last attempt.`);const re=[H,J],X=N*S,ae=D*S,te=M+(N-X)/2,ce=te+X,xe=B+(D-ae)/2,me=xe+ae,Se=[];let be=0;const Me=750;let Oe=0,Ue=0;const je=f+p;for(;Se.length<je&&be<Me;){be++;const st=Ue<p,nt=Oe<f,tt=st&&(!nt||Math.random()<.5),bt=tt?y:o,qe=Math.min(a,bt),Et=Math.random()*(bt-qe)+qe;let $t=0,Vt=0,Dt=!1,Lt=!1;const de=50;if(tt){let Y=0,ye=!1;const Ae=Et+de;do{const Be=Math.floor(Math.random()*4);let Le=0,Ve=0;switch(Be){case 0:Le=Math.random()*(M-de*2)+de,Ve=Math.random()*(e-Ae*2)+Ae;break;case 1:Le=Math.random()*(t-W-de*2)+W+de,Ve=Math.random()*(e-Ae*2)+Ae;break;case 2:Ve=Math.random()*(B-de*2)+de,Le=Math.random()*(W-M-Ae*2)+M+Ae;break;case 3:Ve=Math.random()*(e-U-de*2)+U+de,Le=Math.random()*(W-M-Ae*2)+M+Ae;break}const vt={x:Le,y:Ve};let ft=!1;for(const gt of re)if(calculateDistance(vt,gt)<Et+s+_){ft=!0;break}if(ft){Y++;continue}for(const gt of Se){const Rt=((We=(Pe=gt.plugin)==null?void 0:Pe.Zapslingers)==null?void 0:We.radius)||a;if(calculateDistance(vt,gt.position)<Et+Rt+R){ft=!0;break}}if(ft){Y++;continue}$t=Le,Vt=Ve,Lt=!0,Dt=!0,ye=!0;break}while(Y<50);if(!ye&&!nt)continue}if(!Dt&&nt){let Y=0;do{const ye=Math.random()*(ce-te)+te,Ae=Math.random()*(me-xe)+xe,Be={x:ye,y:Ae};let Le=!1;for(const Ve of re)if(calculateDistance(Be,Ve)<Et+s+_){Le=!0;break}if(Le){Y++;continue}for(const Ve of Se){const vt=((ot=(Ze=Ve.plugin)==null?void 0:Ze.Zapslingers)==null?void 0:ot.radius)||a;if(calculateDistance(Be,Ve.position)<Et+vt+R){Le=!0;break}}if(Le){Y++;continue}$t=ye,Vt=Ae,Lt=!1,Dt=!0;break}while(Y<50)}if(!Dt)continue;let z;if(Lt){const Y=Et*g;z=Bodies$1.circle($t,Vt,Et,{isStatic:!0,label:"orange-planet",friction:.5,restitution:.5,plugin:{Zapslingers:{radius:Et,coreRadius:Y}}}),Ue++,console.log(`Placed Orange Planet ${Ue}/${p} at (${$t.toFixed(0)}, ${Vt.toFixed(0)})`)}else{const ye=(Math.floor(Math.random()*81)+80).toString(16).padStart(2,"0"),Ae=`#${ye}${ye}${ye}`;z=Bodies$1.circle($t,Vt,Et,{isStatic:!0,label:"planet",friction:.5,restitution:.5,render:{fillStyle:Ae},plugin:{Zapslingers:{radius:Et}}}),Oe++}Se.push(z)}return Se.length<je&&console.warn(`[generateInitialPositions] Could only place ${Se.length}/${je} total planets after ${Me} attempts.`),console.log("[generateInitialPositions] Level generation complete."),{ships:re,planets:Se}},useGameInitialization=n=>{const[t,e]=reactExports.useState(null),s=reactExports.useRef(n);reactExports.useEffect(()=>{s.current=n},[n]);const a=reactExports.useCallback(()=>{if(!s.current){console.error("[useGameInitialization] Settings are required for level generation");return}const o=generateInitialPositions(s.current);e(o)},[]);return reactExports.useEffect(()=>{if(!s.current){console.error("[useGameInitialization] Settings are required for initial level generation");return}a()},[a]),{levelData:t,regenerateLevel:a}},createStoreImpl=n=>{let t;const e=new Set,s=(g,x)=>{const E=typeof g=="function"?g(t):g;if(!Object.is(E,t)){const A=t;t=x??(typeof E!="object"||E===null)?E:Object.assign({},t,E),e.forEach(S=>S(t,A))}},a=()=>t,p={setState:s,getState:a,getInitialState:()=>y,subscribe:g=>(e.add(g),()=>e.delete(g))},y=t=n(s,a,p);return p},createStore=n=>n?createStoreImpl(n):createStoreImpl,identity=n=>n;function useStore(n,t=identity){const e=React.useSyncExternalStore(n.subscribe,()=>t(n.getState()),()=>t(n.getInitialState()));return React.useDebugValue(e),e}const createImpl=n=>{const t=createStore(n),e=s=>useStore(t,s);return Object.assign(e,t),e},create=n=>n?createImpl(n):createImpl;var CheckStateEnum;(function(n){n.UNSPENT="UNSPENT",n.PENDING="PENDING",n.SPENT="SPENT"})(CheckStateEnum||(CheckStateEnum={}));var MeltQuoteState;(function(n){n.UNPAID="UNPAID",n.PENDING="PENDING",n.PAID="PAID"})(MeltQuoteState||(MeltQuoteState={}));var MintQuoteState;(function(n){n.UNPAID="UNPAID",n.PAID="PAID",n.ISSUED="ISSUED"})(MintQuoteState||(MintQuoteState={}));var PaymentRequestTransportType;(function(n){n.POST="post",n.NOSTR="nostr"})(PaymentRequestTransportType||(PaymentRequestTransportType={}));var __extends$2=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,a){s.__proto__=a}||function(s,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(s[o]=a[o])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function s(){this.constructor=t}t.prototype=e===null?Object.create(e):(s.prototype=e.prototype,new s)}}(),HttpResponseError=function(n){__extends$2(t,n);function t(e,s){var a=n.call(this,e)||this;return a.status=s,a}return t}(Error),__assign=function(){return __assign=Object.assign||function(n){for(var t,e=1,s=arguments.length;e<s;e++){t=arguments[e];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=t[a])}return n},__assign.apply(this,arguments)},__awaiter$9=function(n,t,e,s){function a(o){return o instanceof e?o:new e(function(f){f(o)})}return new(e||(e=Promise))(function(o,f){function p(x){try{g(s.next(x))}catch(E){f(E)}}function y(x){try{g(s.throw(x))}catch(E){f(E)}}function g(x){x.done?o(x.value):a(x.value).then(p,y)}g((s=s.apply(n,t||[])).next())})},__generator$9=function(n,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,a,o,f;return f={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function p(g){return function(x){return y([g,x])}}function y(g){if(s)throw new TypeError("Generator is already executing.");for(;f&&(f=0,g[0]&&(e=0)),e;)try{if(s=1,a&&(o=g[0]&2?a.return:g[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,g[1])).done)return o;switch(a=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return e.label++,{value:g[1],done:!1};case 5:e.label++,a=g[1],g=[0];continue;case 7:g=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){e=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){e.label=g[1];break}if(g[0]===6&&e.label<o[1]){e.label=o[1],o=g;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(g);break}o[2]&&e.ops.pop(),e.trys.pop();continue}g=t.call(n,e)}catch(x){g=[6,x],a=0}finally{s=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},__rest=function(n,t){var e={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&t.indexOf(s)<0&&(e[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(n);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(n,s[a])&&(e[s[a]]=n[s[a]]);return e},globalRequestOptions={};function _request(n){var t=n.endpoint,e=n.requestBody,s=n.headers,a=__rest(n,["endpoint","requestBody","headers"]);return __awaiter$9(this,void 0,void 0,function(){var o,f,p,y,g,x,E;return __generator$9(this,function(A){switch(A.label){case 0:return o=e?JSON.stringify(e):void 0,f=__assign(__assign({Accept:"application/json, text/plain, */*"},o?{"Content-Type":"application/json"}:void 0),s),[4,fetch(t,__assign({body:o,headers:f},a))];case 1:return p=A.sent(),p.ok?[3,3]:[4,p.json().catch(function(){return{error:"bad response"}})];case 2:throw y=A.sent(),g=y.error,x=y.detail,new HttpResponseError(g||x||"bad response",p.status);case 3:return A.trys.push([3,5,,6]),[4,p.json()];case 4:return[2,A.sent()];case 5:throw E=A.sent(),console.error("Failed to parse HTTP response",E),new HttpResponseError("bad response",p.status);case 6:return[2]}})})}function request(n){return __awaiter$9(this,void 0,void 0,function(){var t;return __generator$9(this,function(e){switch(e.label){case 0:return[4,_request(__assign(__assign({},n),globalRequestOptions))];case 1:return t=e.sent(),[2,t]}})})}function encodeBase64toUint8(n){return bufferExports.Buffer.from(n,"base64")}function encodeBase64ToJson(n){var t=bufferExports.Buffer.from(base64urlToBase64(n),"base64").toString(),e=JSON.parse(t);return e}function base64urlToBase64(n){return n.replace(/-/g,"+").replace(/_/g,"/").split("=")[0]}function isResultKeyType(n){return typeof n=="number"||typeof n=="string"}function decodeCBOR(n){var t=new DataView(n.buffer,n.byteOffset,n.byteLength),e=decodeItem(t,0);return e.value}function decodeItem(n,t){if(t>=n.byteLength)throw new Error("Unexpected end of data");var e=n.getUint8(t++),s=e>>5,a=e&31;switch(s){case 0:return decodeUnsigned(n,t,a);case 1:return decodeSigned(n,t,a);case 2:return decodeByteString(n,t,a);case 3:return decodeString(n,t,a);case 4:return decodeArray(n,t,a);case 5:return decodeMap(n,t,a);case 7:return decodeSimpleAndFloat(n,t,a);default:throw new Error("Unsupported major type: ".concat(s))}}function decodeLength(n,t,e){if(e<24)return{value:e,offset:t};if(e===24)return{value:n.getUint8(t++),offset:t};if(e===25){var s=n.getUint16(t,!1);return t+=2,{value:s,offset:t}}if(e===26){var s=n.getUint32(t,!1);return t+=4,{value:s,offset:t}}if(e===27){var a=n.getUint32(t,!1),o=n.getUint32(t+4,!1);return t+=8,{value:a*Math.pow(2,32)+o,offset:t}}throw new Error("Unsupported length: ".concat(e))}function decodeUnsigned(n,t,e){var s=decodeLength(n,t,e),a=s.value,o=s.offset;return{value:a,offset:o}}function decodeSigned(n,t,e){var s=decodeLength(n,t,e),a=s.value,o=s.offset;return{value:-1-a,offset:o}}function decodeByteString(n,t,e){var s=decodeLength(n,t,e),a=s.value,o=s.offset;if(o+a>n.byteLength)throw new Error("Byte string length exceeds data length");var f=new Uint8Array(n.buffer,n.byteOffset+o,a);return{value:f,offset:o+a}}function decodeString(n,t,e){var s=decodeLength(n,t,e),a=s.value,o=s.offset;if(o+a>n.byteLength)throw new Error("String length exceeds data length");var f=new Uint8Array(n.buffer,n.byteOffset+o,a),p=new TextDecoder().decode(f);return{value:p,offset:o+a}}function decodeArray(n,t,e){for(var s=decodeLength(n,t,e),a=s.value,o=s.offset,f=[],p=o,y=0;y<a;y++){var g=decodeItem(n,p);f.push(g.value),p=g.offset}return{value:f,offset:p}}function decodeMap(n,t,e){for(var s=decodeLength(n,t,e),a=s.value,o=s.offset,f={},p=o,y=0;y<a;y++){var g=decodeItem(n,p);if(!isResultKeyType(g.value))throw new Error("Invalid key type");var x=decodeItem(n,g.offset);f[g.value]=x.value,p=x.offset}return{value:f,offset:p}}function decodeFloat16(n){var t=(n&31744)>>10,e=n&1023,s=n&32768?-1:1;return t===0?s*Math.pow(2,-14)*(e/1024):t===31?e?NaN:s*(1/0):s*Math.pow(2,t-15)*(1+e/1024)}function decodeSimpleAndFloat(n,t,e){if(e<24)switch(e){case 20:return{value:!1,offset:t};case 21:return{value:!0,offset:t};case 22:return{value:null,offset:t};case 23:return{value:void 0,offset:t};default:throw new Error("Unknown simple value: ".concat(e))}if(e===24)return{value:n.getUint8(t++),offset:t};if(e===25){var s=decodeFloat16(n.getUint16(t,!1));return t+=2,{value:s,offset:t}}if(e===26){var s=n.getFloat32(t,!1);return t+=4,{value:s,offset:t}}if(e===27){var s=n.getFloat64(t,!1);return t+=8,{value:s,offset:t}}throw new Error("Unknown simple or float value: ".concat(e))}function splitAmount(n,t,e,s){if(e){if(e.reduce(function(o,f){return o+f},0)>n)throw new Error("Split is greater than total amount: ".concat(e.reduce(function(o,f){return o+f},0)," > ").concat(n));e.forEach(function(o){if(!hasCorrespondingKey(o,t))throw new Error("Provided amount preferences do not match the amounts of the mint keyset.")}),n=n-e.reduce(function(o,f){return o+f},0)}else e=[];var a=getKeysetAmounts(t);return a.forEach(function(o){for(var f=Math.floor(n/o),p=0;p<f;++p)e==null||e.push(o);n%=o}),e.sort(function(o,f){return o-f})}function getKeepAmounts(n,t,e,s){var a=[],o=n.map(function(x){return x.amount}),f=getKeysetAmounts(e,"asc");f.forEach(function(x){for(var E=o.filter(function(I){return I===x}).length,A=Math.max(s-E,0),S=0;S<A&&!(a.reduce(function(I,_){return I+_},0)+x>t);++S)a.push(x)});var p=t-a.reduce(function(x,E){return x+E},0);if(p){var y=splitAmount(p,e);y.forEach(function(x){a.push(x)})}var g=a.sort(function(x,E){return x-E});return g}function getKeysetAmounts(n,t){return t===void 0&&(t="desc"),t=="desc"?Object.keys(n).map(function(e){return parseInt(e)}).sort(function(e,s){return s-e}):Object.keys(n).map(function(e){return parseInt(e)}).sort(function(e,s){return e-s})}function hasCorrespondingKey(n,t){return n in t}function bytesToNumber(n){return hexToNumber(bytesToHex(n))}function hexToNumber(n){return BigInt("0x".concat(n))}function getDecodedToken(n){var t=["web+cashu://","cashu://","cashu:","cashu"];return t.forEach(function(e){n.startsWith(e)&&(n=n.slice(e.length))}),handleTokens(n)}function handleTokens(n){var t=n.slice(0,1),e=n.slice(1);if(t==="A"){var s=encodeBase64ToJson(e);if(s.token.length>1)throw new Error("Multi entry token are not supported");var a=s.token[0],o={mint:a.mint,proofs:a.proofs,unit:s.unit||"sat"};return s.memo&&(o.memo=s.memo),o}else if(t==="B"){var f=encodeBase64toUint8(e),p=decodeCBOR(f),y=[];p.t.forEach(function(x){return x.p.forEach(function(E){y.push({secret:E.s,C:bytesToHex(E.c),amount:E.a,id:bytesToHex(x.i)})})});var g={mint:p.m,proofs:y,unit:p.u||"sat"};return p.d&&(g.memo=p.d),g}throw new Error("Token version is not supported")}function isObj(n){return typeof n=="object"}function joinUrls(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return n.map(function(e){return e.replace(/(^\/+|\/+$)/g,"")}).join("/")}function sanitizeUrl(n){return n.replace(/\/$/,"")}function sumProofs(n){return n.reduce(function(t,e){return t+e.amount},0)}function handleMeltQuoteResponseDeprecated(n){return n.state||(console.warn("Field 'state' not found in MeltQuoteResponse. Update NUT-05 of mint: https://github.com/cashubtc/nuts/pull/136)"),typeof n.paid=="boolean"&&(n.state=n.paid?MeltQuoteState.PAID:MeltQuoteState.UNPAID)),n}function handleMintQuoteResponseDeprecated(n){return n.state||(console.warn("Field 'state' not found in MintQuoteResponse. Update NUT-04 of mint: https://github.com/cashubtc/nuts/pull/141)"),typeof n.paid=="boolean"&&(n.state=n.paid?MintQuoteState.PAID:MintQuoteState.UNPAID)),n}function handleMintInfoContactFieldDeprecated(n){return Array.isArray(n==null?void 0:n.contact)&&(n==null?void 0:n.contact.length)>0&&(n.contact=n.contact.map(function(t){return Array.isArray(t)&&t.length===2&&typeof t[0]=="string"&&typeof t[1]=="string"?(console.warn("Mint returned deprecated 'contact' field: Update NUT-06: https://github.com/cashubtc/nuts/pull/117"),{method:t[0],info:t[1]}):t})),n}var __awaiter$8=function(n,t,e,s){function a(o){return o instanceof e?o:new e(function(f){f(o)})}return new(e||(e=Promise))(function(o,f){function p(x){try{g(s.next(x))}catch(E){f(E)}}function y(x){try{g(s.throw(x))}catch(E){f(E)}}function g(x){x.done?o(x.value):a(x.value).then(p,y)}g((s=s.apply(n,t||[])).next())})},__generator$8=function(n,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,a,o,f;return f={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function p(g){return function(x){return y([g,x])}}function y(g){if(s)throw new TypeError("Generator is already executing.");for(;f&&(f=0,g[0]&&(e=0)),e;)try{if(s=1,a&&(o=g[0]&2?a.return:g[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,g[1])).done)return o;switch(a=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return e.label++,{value:g[1],done:!1};case 5:e.label++,a=g[1],g=[0];continue;case 7:g=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){e=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){e.label=g[1];break}if(g[0]===6&&e.label<o[1]){e.label=o[1],o=g;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(g);break}o[2]&&e.ops.pop(),e.trys.pop();continue}g=t.call(n,e)}catch(x){g=[6,x],a=0}finally{s=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},CashuMint=function(){function n(t,e){this._mintUrl=t,this._customRequest=e,this._mintUrl=sanitizeUrl(t),this._customRequest=e}return Object.defineProperty(n.prototype,"mintUrl",{get:function(){return this._mintUrl},enumerable:!1,configurable:!0}),n.getInfo=function(t,e){return __awaiter$8(this,void 0,void 0,function(){var s,a,o;return __generator$8(this,function(f){switch(f.label){case 0:return s=e||request,[4,s({endpoint:joinUrls(t,"/v1/info")})];case 1:return a=f.sent(),o=handleMintInfoContactFieldDeprecated(a),[2,o]}})})},n.prototype.getInfo=function(){return __awaiter$8(this,void 0,void 0,function(){return __generator$8(this,function(t){return[2,n.getInfo(this._mintUrl,this._customRequest)]})})},n.swap=function(t,e,s){var a;return __awaiter$8(this,void 0,void 0,function(){var o,f;return __generator$8(this,function(p){switch(p.label){case 0:return o=s||request,[4,o({endpoint:joinUrls(t,"/v1/swap"),method:"POST",requestBody:e})];case 1:if(f=p.sent(),!isObj(f)||!Array.isArray(f==null?void 0:f.signatures))throw new Error((a=f.detail)!==null&&a!==void 0?a:"bad response");return[2,f]}})})},n.prototype.swap=function(t){return __awaiter$8(this,void 0,void 0,function(){return __generator$8(this,function(e){return[2,n.swap(this._mintUrl,t,this._customRequest)]})})},n.createMintQuote=function(t,e,s){return __awaiter$8(this,void 0,void 0,function(){var a,o,f;return __generator$8(this,function(p){switch(p.label){case 0:return a=s||request,[4,a({endpoint:joinUrls(t,"/v1/mint/quote/bolt11"),method:"POST",requestBody:e})];case 1:return o=p.sent(),f=handleMintQuoteResponseDeprecated(o),[2,f]}})})},n.prototype.createMintQuote=function(t){return __awaiter$8(this,void 0,void 0,function(){return __generator$8(this,function(e){return[2,n.createMintQuote(this._mintUrl,t,this._customRequest)]})})},n.checkMintQuote=function(t,e,s){return __awaiter$8(this,void 0,void 0,function(){var a,o,f;return __generator$8(this,function(p){switch(p.label){case 0:return a=s||request,[4,a({endpoint:joinUrls(t,"/v1/mint/quote/bolt11",e),method:"GET"})];case 1:return o=p.sent(),f=handleMintQuoteResponseDeprecated(o),[2,f]}})})},n.prototype.checkMintQuote=function(t){return __awaiter$8(this,void 0,void 0,function(){return __generator$8(this,function(e){return[2,n.checkMintQuote(this._mintUrl,t,this._customRequest)]})})},n.mint=function(t,e,s){return __awaiter$8(this,void 0,void 0,function(){var a,o;return __generator$8(this,function(f){switch(f.label){case 0:return a=s||request,[4,a({endpoint:joinUrls(t,"/v1/mint/bolt11"),method:"POST",requestBody:e})];case 1:if(o=f.sent(),!isObj(o)||!Array.isArray(o==null?void 0:o.signatures))throw new Error("bad response");return[2,o]}})})},n.prototype.mint=function(t){return __awaiter$8(this,void 0,void 0,function(){return __generator$8(this,function(e){return[2,n.mint(this._mintUrl,t,this._customRequest)]})})},n.createMeltQuote=function(t,e,s){return __awaiter$8(this,void 0,void 0,function(){var a,o,f;return __generator$8(this,function(p){switch(p.label){case 0:return a=s||request,[4,a({endpoint:joinUrls(t,"/v1/melt/quote/bolt11"),method:"POST",requestBody:e})];case 1:if(o=p.sent(),f=handleMeltQuoteResponseDeprecated(o),!isObj(f)||typeof(f==null?void 0:f.amount)!="number"||typeof(f==null?void 0:f.fee_reserve)!="number"||typeof(f==null?void 0:f.quote)!="string")throw new Error("bad response");return[2,f]}})})},n.prototype.createMeltQuote=function(t){return __awaiter$8(this,void 0,void 0,function(){return __generator$8(this,function(e){return[2,n.createMeltQuote(this._mintUrl,t,this._customRequest)]})})},n.checkMeltQuote=function(t,e,s){return __awaiter$8(this,void 0,void 0,function(){var a,o,f;return __generator$8(this,function(p){switch(p.label){case 0:return a=s||request,[4,a({endpoint:joinUrls(t,"/v1/melt/quote/bolt11",e),method:"GET"})];case 1:if(o=p.sent(),f=handleMeltQuoteResponseDeprecated(o),!isObj(f)||typeof(f==null?void 0:f.amount)!="number"||typeof(f==null?void 0:f.fee_reserve)!="number"||typeof(f==null?void 0:f.quote)!="string"||typeof(f==null?void 0:f.state)!="string"||!Object.values(MeltQuoteState).includes(f.state))throw new Error("bad response");return[2,f]}})})},n.prototype.checkMeltQuote=function(t){return __awaiter$8(this,void 0,void 0,function(){return __generator$8(this,function(e){return[2,n.checkMeltQuote(this._mintUrl,t,this._customRequest)]})})},n.melt=function(t,e,s){return __awaiter$8(this,void 0,void 0,function(){var a,o,f;return __generator$8(this,function(p){switch(p.label){case 0:return a=s||request,[4,a({endpoint:joinUrls(t,"/v1/melt/bolt11"),method:"POST",requestBody:e})];case 1:if(o=p.sent(),f=handleMeltQuoteResponseDeprecated(o),!isObj(f)||typeof(f==null?void 0:f.state)!="string"||!Object.values(MeltQuoteState).includes(f.state))throw new Error("bad response");return[2,f]}})})},n.prototype.melt=function(t){return __awaiter$8(this,void 0,void 0,function(){return __generator$8(this,function(e){return[2,n.melt(this._mintUrl,t,this._customRequest)]})})},n.check=function(t,e,s){return __awaiter$8(this,void 0,void 0,function(){var a,o;return __generator$8(this,function(f){switch(f.label){case 0:return a=s||request,[4,a({endpoint:joinUrls(t,"/v1/checkstate"),method:"POST",requestBody:e})];case 1:if(o=f.sent(),!isObj(o)||!Array.isArray(o==null?void 0:o.states))throw new Error("bad response");return[2,o]}})})},n.getKeys=function(t,e,s){return __awaiter$8(this,void 0,void 0,function(){var a,o;return __generator$8(this,function(f){switch(f.label){case 0:return e&&(e=e.replace(/\//g,"_").replace(/\+/g,"-")),a=s||request,[4,a({endpoint:e?joinUrls(t,"/v1/keys",e):joinUrls(t,"/v1/keys")})];case 1:if(o=f.sent(),!isObj(o)||!Array.isArray(o.keysets))throw new Error("bad response");return[2,o]}})})},n.prototype.getKeys=function(t,e){return __awaiter$8(this,void 0,void 0,function(){var s;return __generator$8(this,function(a){switch(a.label){case 0:return[4,n.getKeys(e||this._mintUrl,t,this._customRequest)];case 1:return s=a.sent(),[2,s]}})})},n.getKeySets=function(t,e){return __awaiter$8(this,void 0,void 0,function(){var s;return __generator$8(this,function(a){return s=e||request,[2,s({endpoint:joinUrls(t,"/v1/keysets")})]})})},n.prototype.getKeySets=function(){return __awaiter$8(this,void 0,void 0,function(){return __generator$8(this,function(t){return[2,n.getKeySets(this._mintUrl,this._customRequest)]})})},n.prototype.check=function(t){return __awaiter$8(this,void 0,void 0,function(){return __generator$8(this,function(e){return[2,n.check(this._mintUrl,t,this._customRequest)]})})},n.restore=function(t,e,s){return __awaiter$8(this,void 0,void 0,function(){var a,o;return __generator$8(this,function(f){switch(f.label){case 0:return a=s||request,[4,a({endpoint:joinUrls(t,"/v1/restore"),method:"POST",requestBody:e})];case 1:if(o=f.sent(),!isObj(o)||!Array.isArray(o==null?void 0:o.outputs)||!Array.isArray(o==null?void 0:o.promises))throw new Error("bad response");return[2,o]}})})},n.prototype.restore=function(t){return __awaiter$8(this,void 0,void 0,function(){return __generator$8(this,function(e){return[2,n.restore(this._mintUrl,t,this._customRequest)]})})},n}(),BlindedMessage=function(){function n(t,e,s){this.amount=t,this.B_=e,this.id=s}return n.prototype.getSerializedBlindedMessage=function(){return{amount:this.amount,B_:this.B_.toHex(!0),id:this.id}},n}(),common={},secp256k1={},sha2={},_md={},utils$2={},crypto$1={},hasRequiredCrypto;function requireCrypto(){return hasRequiredCrypto||(hasRequiredCrypto=1,Object.defineProperty(crypto$1,"__esModule",{value:!0}),crypto$1.crypto=void 0,crypto$1.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0),crypto$1}var hasRequiredUtils$2;function requireUtils$2(){return hasRequiredUtils$2||(hasRequiredUtils$2=1,function(n){/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(n,"__esModule",{value:!0}),n.wrapXOFConstructorWithOpts=n.wrapConstructorWithOpts=n.wrapConstructor=n.Hash=n.nextTick=n.swap32IfBE=n.byteSwapIfBE=n.swap8IfBE=n.isLE=void 0,n.isBytes=e,n.anumber=s,n.abytes=a,n.ahash=o,n.aexists=f,n.aoutput=p,n.u8=y,n.u32=g,n.clean=x,n.createView=E,n.rotr=A,n.rotl=S,n.byteSwap=I,n.byteSwap32=_,n.bytesToHex=D,n.hexToBytes=B,n.asyncLoop=P,n.utf8ToBytes=F,n.bytesToUtf8=j,n.toBytes=Q,n.kdfInputToBytes=$,n.concatBytes=V,n.checkOpts=G,n.createHasher=H,n.createOptHasher=J,n.createXOFer=K,n.randomBytes=ie;const t=requireCrypto();function e(ne){return ne instanceof Uint8Array||ArrayBuffer.isView(ne)&&ne.constructor.name==="Uint8Array"}function s(ne){if(!Number.isSafeInteger(ne)||ne<0)throw new Error("positive integer expected, got "+ne)}function a(ne,...re){if(!e(ne))throw new Error("Uint8Array expected");if(re.length>0&&!re.includes(ne.length))throw new Error("Uint8Array expected of length "+re+", got length="+ne.length)}function o(ne){if(typeof ne!="function"||typeof ne.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");s(ne.outputLen),s(ne.blockLen)}function f(ne,re=!0){if(ne.destroyed)throw new Error("Hash instance has been destroyed");if(re&&ne.finished)throw new Error("Hash#digest() has already been called")}function p(ne,re){a(ne);const X=re.outputLen;if(ne.length<X)throw new Error("digestInto() expects output buffer of length at least "+X)}function y(ne){return new Uint8Array(ne.buffer,ne.byteOffset,ne.byteLength)}function g(ne){return new Uint32Array(ne.buffer,ne.byteOffset,Math.floor(ne.byteLength/4))}function x(...ne){for(let re=0;re<ne.length;re++)ne[re].fill(0)}function E(ne){return new DataView(ne.buffer,ne.byteOffset,ne.byteLength)}function A(ne,re){return ne<<32-re|ne>>>re}function S(ne,re){return ne<<re|ne>>>32-re>>>0}n.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function I(ne){return ne<<24&4278190080|ne<<8&16711680|ne>>>8&65280|ne>>>24&255}n.swap8IfBE=n.isLE?ne=>ne:ne=>I(ne),n.byteSwapIfBE=n.swap8IfBE;function _(ne){for(let re=0;re<ne.length;re++)ne[re]=I(ne[re]);return ne}n.swap32IfBE=n.isLE?ne=>ne:_;const R=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",N=Array.from({length:256},(ne,re)=>re.toString(16).padStart(2,"0"));function D(ne){if(a(ne),R)return ne.toHex();let re="";for(let X=0;X<ne.length;X++)re+=N[ne[X]];return re}const M={_0:48,_9:57,A:65,F:70,a:97,f:102};function W(ne){if(ne>=M._0&&ne<=M._9)return ne-M._0;if(ne>=M.A&&ne<=M.F)return ne-(M.A-10);if(ne>=M.a&&ne<=M.f)return ne-(M.a-10)}function B(ne){if(typeof ne!="string")throw new Error("hex string expected, got "+typeof ne);if(R)return Uint8Array.fromHex(ne);const re=ne.length,X=re/2;if(re%2)throw new Error("hex string expected, got unpadded hex of length "+re);const ae=new Uint8Array(X);for(let te=0,ce=0;te<X;te++,ce+=2){const xe=W(ne.charCodeAt(ce)),me=W(ne.charCodeAt(ce+1));if(xe===void 0||me===void 0){const Se=ne[ce]+ne[ce+1];throw new Error('hex string expected, got non-hex character "'+Se+'" at index '+ce)}ae[te]=xe*16+me}return ae}const U=async()=>{};n.nextTick=U;async function P(ne,re,X){let ae=Date.now();for(let te=0;te<ne;te++){X(te);const ce=Date.now()-ae;ce>=0&&ce<re||(await(0,n.nextTick)(),ae+=ce)}}function F(ne){if(typeof ne!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(ne))}function j(ne){return new TextDecoder().decode(ne)}function Q(ne){return typeof ne=="string"&&(ne=F(ne)),a(ne),ne}function $(ne){return typeof ne=="string"&&(ne=F(ne)),a(ne),ne}function V(...ne){let re=0;for(let ae=0;ae<ne.length;ae++){const te=ne[ae];a(te),re+=te.length}const X=new Uint8Array(re);for(let ae=0,te=0;ae<ne.length;ae++){const ce=ne[ae];X.set(ce,te),te+=ce.length}return X}function G(ne,re){if(re!==void 0&&{}.toString.call(re)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(ne,re)}class se{}n.Hash=se;function H(ne){const re=ae=>ne().update(Q(ae)).digest(),X=ne();return re.outputLen=X.outputLen,re.blockLen=X.blockLen,re.create=()=>ne(),re}function J(ne){const re=(ae,te)=>ne(te).update(Q(ae)).digest(),X=ne({});return re.outputLen=X.outputLen,re.blockLen=X.blockLen,re.create=ae=>ne(ae),re}function K(ne){const re=(ae,te)=>ne(te).update(Q(ae)).digest(),X=ne({});return re.outputLen=X.outputLen,re.blockLen=X.blockLen,re.create=ae=>ne(ae),re}n.wrapConstructor=H,n.wrapConstructorWithOpts=J,n.wrapXOFConstructorWithOpts=K;function ie(ne=32){if(t.crypto&&typeof t.crypto.getRandomValues=="function")return t.crypto.getRandomValues(new Uint8Array(ne));if(t.crypto&&typeof t.crypto.randomBytes=="function")return Uint8Array.from(t.crypto.randomBytes(ne));throw new Error("crypto.getRandomValues must be defined")}}(utils$2)),utils$2}var hasRequired_md;function require_md(){if(hasRequired_md)return _md;hasRequired_md=1,Object.defineProperty(_md,"__esModule",{value:!0}),_md.SHA512_IV=_md.SHA384_IV=_md.SHA224_IV=_md.SHA256_IV=_md.HashMD=void 0,_md.setBigUint64=t,_md.Chi=e,_md.Maj=s;const n=requireUtils$2();function t(o,f,p,y){if(typeof o.setBigUint64=="function")return o.setBigUint64(f,p,y);const g=BigInt(32),x=BigInt(4294967295),E=Number(p>>g&x),A=Number(p&x),S=y?4:0,I=y?0:4;o.setUint32(f+S,E,y),o.setUint32(f+I,A,y)}function e(o,f,p){return o&f^~o&p}function s(o,f,p){return o&f^o&p^f&p}class a extends n.Hash{constructor(f,p,y,g){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=f,this.outputLen=p,this.padOffset=y,this.isLE=g,this.buffer=new Uint8Array(f),this.view=(0,n.createView)(this.buffer)}update(f){(0,n.aexists)(this),f=(0,n.toBytes)(f),(0,n.abytes)(f);const{view:p,buffer:y,blockLen:g}=this,x=f.length;for(let E=0;E<x;){const A=Math.min(g-this.pos,x-E);if(A===g){const S=(0,n.createView)(f);for(;g<=x-E;E+=g)this.process(S,E);continue}y.set(f.subarray(E,E+A),this.pos),this.pos+=A,E+=A,this.pos===g&&(this.process(p,0),this.pos=0)}return this.length+=f.length,this.roundClean(),this}digestInto(f){(0,n.aexists)(this),(0,n.aoutput)(f,this),this.finished=!0;const{buffer:p,view:y,blockLen:g,isLE:x}=this;let{pos:E}=this;p[E++]=128,(0,n.clean)(this.buffer.subarray(E)),this.padOffset>g-E&&(this.process(y,0),E=0);for(let R=E;R<g;R++)p[R]=0;t(y,g-8,BigInt(this.length*8),x),this.process(y,0);const A=(0,n.createView)(f),S=this.outputLen;if(S%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const I=S/4,_=this.get();if(I>_.length)throw new Error("_sha2: outputLen bigger than state");for(let R=0;R<I;R++)A.setUint32(4*R,_[R],x)}digest(){const{buffer:f,outputLen:p}=this;this.digestInto(f);const y=f.slice(0,p);return this.destroy(),y}_cloneInto(f){f||(f=new this.constructor),f.set(...this.get());const{blockLen:p,buffer:y,length:g,finished:x,destroyed:E,pos:A}=this;return f.destroyed=E,f.finished=x,f.length=g,f.pos=A,g%p&&f.buffer.set(y),f}clone(){return this._cloneInto()}}return _md.HashMD=a,_md.SHA256_IV=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),_md.SHA224_IV=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),_md.SHA384_IV=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),_md.SHA512_IV=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),_md}var _u64={},hasRequired_u64;function require_u64(){if(hasRequired_u64)return _u64;hasRequired_u64=1,Object.defineProperty(_u64,"__esModule",{value:!0}),_u64.toBig=_u64.shrSL=_u64.shrSH=_u64.rotrSL=_u64.rotrSH=_u64.rotrBL=_u64.rotrBH=_u64.rotr32L=_u64.rotr32H=_u64.rotlSL=_u64.rotlSH=_u64.rotlBL=_u64.rotlBH=_u64.add5L=_u64.add5H=_u64.add4L=_u64.add4H=_u64.add3L=_u64.add3H=void 0,_u64.add=N,_u64.fromBig=e,_u64.split=s;const n=BigInt(2**32-1),t=BigInt(32);function e(j,Q=!1){return Q?{h:Number(j&n),l:Number(j>>t&n)}:{h:Number(j>>t&n)|0,l:Number(j&n)|0}}function s(j,Q=!1){const $=j.length;let V=new Uint32Array($),G=new Uint32Array($);for(let se=0;se<$;se++){const{h:H,l:J}=e(j[se],Q);[V[se],G[se]]=[H,J]}return[V,G]}const a=(j,Q)=>BigInt(j>>>0)<<t|BigInt(Q>>>0);_u64.toBig=a;const o=(j,Q,$)=>j>>>$;_u64.shrSH=o;const f=(j,Q,$)=>j<<32-$|Q>>>$;_u64.shrSL=f;const p=(j,Q,$)=>j>>>$|Q<<32-$;_u64.rotrSH=p;const y=(j,Q,$)=>j<<32-$|Q>>>$;_u64.rotrSL=y;const g=(j,Q,$)=>j<<64-$|Q>>>$-32;_u64.rotrBH=g;const x=(j,Q,$)=>j>>>$-32|Q<<64-$;_u64.rotrBL=x;const E=(j,Q)=>Q;_u64.rotr32H=E;const A=(j,Q)=>j;_u64.rotr32L=A;const S=(j,Q,$)=>j<<$|Q>>>32-$;_u64.rotlSH=S;const I=(j,Q,$)=>Q<<$|j>>>32-$;_u64.rotlSL=I;const _=(j,Q,$)=>Q<<$-32|j>>>64-$;_u64.rotlBH=_;const R=(j,Q,$)=>j<<$-32|Q>>>64-$;_u64.rotlBL=R;function N(j,Q,$,V){const G=(Q>>>0)+(V>>>0);return{h:j+$+(G/2**32|0)|0,l:G|0}}const D=(j,Q,$)=>(j>>>0)+(Q>>>0)+($>>>0);_u64.add3L=D;const M=(j,Q,$,V)=>Q+$+V+(j/2**32|0)|0;_u64.add3H=M;const W=(j,Q,$,V)=>(j>>>0)+(Q>>>0)+($>>>0)+(V>>>0);_u64.add4L=W;const B=(j,Q,$,V,G)=>Q+$+V+G+(j/2**32|0)|0;_u64.add4H=B;const U=(j,Q,$,V,G)=>(j>>>0)+(Q>>>0)+($>>>0)+(V>>>0)+(G>>>0);_u64.add5L=U;const P=(j,Q,$,V,G,se)=>Q+$+V+G+se+(j/2**32|0)|0;_u64.add5H=P;const F={fromBig:e,split:s,toBig:a,shrSH:o,shrSL:f,rotrSH:p,rotrSL:y,rotrBH:g,rotrBL:x,rotr32H:E,rotr32L:A,rotlSH:S,rotlSL:I,rotlBH:_,rotlBL:R,add:N,add3L:D,add3H:M,add4L:W,add4H:B,add5H:P,add5L:U};return _u64.default=F,_u64}var hasRequiredSha2;function requireSha2(){if(hasRequiredSha2)return sha2;hasRequiredSha2=1,Object.defineProperty(sha2,"__esModule",{value:!0}),sha2.sha512_224=sha2.sha512_256=sha2.sha384=sha2.sha512=sha2.sha224=sha2.sha256=sha2.SHA512_256=sha2.SHA512_224=sha2.SHA384=sha2.SHA512=sha2.SHA224=sha2.SHA256=void 0;const n=require_md(),t=require_u64(),e=requireUtils$2(),s=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),a=new Uint32Array(64);class o extends n.HashMD{constructor(M=32){super(64,M,8,!1),this.A=n.SHA256_IV[0]|0,this.B=n.SHA256_IV[1]|0,this.C=n.SHA256_IV[2]|0,this.D=n.SHA256_IV[3]|0,this.E=n.SHA256_IV[4]|0,this.F=n.SHA256_IV[5]|0,this.G=n.SHA256_IV[6]|0,this.H=n.SHA256_IV[7]|0}get(){const{A:M,B:W,C:B,D:U,E:P,F,G:j,H:Q}=this;return[M,W,B,U,P,F,j,Q]}set(M,W,B,U,P,F,j,Q){this.A=M|0,this.B=W|0,this.C=B|0,this.D=U|0,this.E=P|0,this.F=F|0,this.G=j|0,this.H=Q|0}process(M,W){for(let G=0;G<16;G++,W+=4)a[G]=M.getUint32(W,!1);for(let G=16;G<64;G++){const se=a[G-15],H=a[G-2],J=(0,e.rotr)(se,7)^(0,e.rotr)(se,18)^se>>>3,K=(0,e.rotr)(H,17)^(0,e.rotr)(H,19)^H>>>10;a[G]=K+a[G-7]+J+a[G-16]|0}let{A:B,B:U,C:P,D:F,E:j,F:Q,G:$,H:V}=this;for(let G=0;G<64;G++){const se=(0,e.rotr)(j,6)^(0,e.rotr)(j,11)^(0,e.rotr)(j,25),H=V+se+(0,n.Chi)(j,Q,$)+s[G]+a[G]|0,K=((0,e.rotr)(B,2)^(0,e.rotr)(B,13)^(0,e.rotr)(B,22))+(0,n.Maj)(B,U,P)|0;V=$,$=Q,Q=j,j=F+H|0,F=P,P=U,U=B,B=H+K|0}B=B+this.A|0,U=U+this.B|0,P=P+this.C|0,F=F+this.D|0,j=j+this.E|0,Q=Q+this.F|0,$=$+this.G|0,V=V+this.H|0,this.set(B,U,P,F,j,Q,$,V)}roundClean(){(0,e.clean)(a)}destroy(){this.set(0,0,0,0,0,0,0,0),(0,e.clean)(this.buffer)}}sha2.SHA256=o;class f extends o{constructor(){super(28),this.A=n.SHA224_IV[0]|0,this.B=n.SHA224_IV[1]|0,this.C=n.SHA224_IV[2]|0,this.D=n.SHA224_IV[3]|0,this.E=n.SHA224_IV[4]|0,this.F=n.SHA224_IV[5]|0,this.G=n.SHA224_IV[6]|0,this.H=n.SHA224_IV[7]|0}}sha2.SHA224=f;const p=t.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(D=>BigInt(D))),y=p[0],g=p[1],x=new Uint32Array(80),E=new Uint32Array(80);class A extends n.HashMD{constructor(M=64){super(128,M,16,!1),this.Ah=n.SHA512_IV[0]|0,this.Al=n.SHA512_IV[1]|0,this.Bh=n.SHA512_IV[2]|0,this.Bl=n.SHA512_IV[3]|0,this.Ch=n.SHA512_IV[4]|0,this.Cl=n.SHA512_IV[5]|0,this.Dh=n.SHA512_IV[6]|0,this.Dl=n.SHA512_IV[7]|0,this.Eh=n.SHA512_IV[8]|0,this.El=n.SHA512_IV[9]|0,this.Fh=n.SHA512_IV[10]|0,this.Fl=n.SHA512_IV[11]|0,this.Gh=n.SHA512_IV[12]|0,this.Gl=n.SHA512_IV[13]|0,this.Hh=n.SHA512_IV[14]|0,this.Hl=n.SHA512_IV[15]|0}get(){const{Ah:M,Al:W,Bh:B,Bl:U,Ch:P,Cl:F,Dh:j,Dl:Q,Eh:$,El:V,Fh:G,Fl:se,Gh:H,Gl:J,Hh:K,Hl:ie}=this;return[M,W,B,U,P,F,j,Q,$,V,G,se,H,J,K,ie]}set(M,W,B,U,P,F,j,Q,$,V,G,se,H,J,K,ie){this.Ah=M|0,this.Al=W|0,this.Bh=B|0,this.Bl=U|0,this.Ch=P|0,this.Cl=F|0,this.Dh=j|0,this.Dl=Q|0,this.Eh=$|0,this.El=V|0,this.Fh=G|0,this.Fl=se|0,this.Gh=H|0,this.Gl=J|0,this.Hh=K|0,this.Hl=ie|0}process(M,W){for(let X=0;X<16;X++,W+=4)x[X]=M.getUint32(W),E[X]=M.getUint32(W+=4);for(let X=16;X<80;X++){const ae=x[X-15]|0,te=E[X-15]|0,ce=t.rotrSH(ae,te,1)^t.rotrSH(ae,te,8)^t.shrSH(ae,te,7),xe=t.rotrSL(ae,te,1)^t.rotrSL(ae,te,8)^t.shrSL(ae,te,7),me=x[X-2]|0,Se=E[X-2]|0,be=t.rotrSH(me,Se,19)^t.rotrBH(me,Se,61)^t.shrSH(me,Se,6),Me=t.rotrSL(me,Se,19)^t.rotrBL(me,Se,61)^t.shrSL(me,Se,6),Oe=t.add4L(xe,Me,E[X-7],E[X-16]),Ue=t.add4H(Oe,ce,be,x[X-7],x[X-16]);x[X]=Ue|0,E[X]=Oe|0}let{Ah:B,Al:U,Bh:P,Bl:F,Ch:j,Cl:Q,Dh:$,Dl:V,Eh:G,El:se,Fh:H,Fl:J,Gh:K,Gl:ie,Hh:ne,Hl:re}=this;for(let X=0;X<80;X++){const ae=t.rotrSH(G,se,14)^t.rotrSH(G,se,18)^t.rotrBH(G,se,41),te=t.rotrSL(G,se,14)^t.rotrSL(G,se,18)^t.rotrBL(G,se,41),ce=G&H^~G&K,xe=se&J^~se&ie,me=t.add5L(re,te,xe,g[X],E[X]),Se=t.add5H(me,ne,ae,ce,y[X],x[X]),be=me|0,Me=t.rotrSH(B,U,28)^t.rotrBH(B,U,34)^t.rotrBH(B,U,39),Oe=t.rotrSL(B,U,28)^t.rotrBL(B,U,34)^t.rotrBL(B,U,39),Ue=B&P^B&j^P&j,je=U&F^U&Q^F&Q;ne=K|0,re=ie|0,K=H|0,ie=J|0,H=G|0,J=se|0,{h:G,l:se}=t.add($|0,V|0,Se|0,be|0),$=j|0,V=Q|0,j=P|0,Q=F|0,P=B|0,F=U|0;const Pe=t.add3L(be,Oe,je);B=t.add3H(Pe,Se,Me,Ue),U=Pe|0}({h:B,l:U}=t.add(this.Ah|0,this.Al|0,B|0,U|0)),{h:P,l:F}=t.add(this.Bh|0,this.Bl|0,P|0,F|0),{h:j,l:Q}=t.add(this.Ch|0,this.Cl|0,j|0,Q|0),{h:$,l:V}=t.add(this.Dh|0,this.Dl|0,$|0,V|0),{h:G,l:se}=t.add(this.Eh|0,this.El|0,G|0,se|0),{h:H,l:J}=t.add(this.Fh|0,this.Fl|0,H|0,J|0),{h:K,l:ie}=t.add(this.Gh|0,this.Gl|0,K|0,ie|0),{h:ne,l:re}=t.add(this.Hh|0,this.Hl|0,ne|0,re|0),this.set(B,U,P,F,j,Q,$,V,G,se,H,J,K,ie,ne,re)}roundClean(){(0,e.clean)(x,E)}destroy(){(0,e.clean)(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}sha2.SHA512=A;class S extends A{constructor(){super(48),this.Ah=n.SHA384_IV[0]|0,this.Al=n.SHA384_IV[1]|0,this.Bh=n.SHA384_IV[2]|0,this.Bl=n.SHA384_IV[3]|0,this.Ch=n.SHA384_IV[4]|0,this.Cl=n.SHA384_IV[5]|0,this.Dh=n.SHA384_IV[6]|0,this.Dl=n.SHA384_IV[7]|0,this.Eh=n.SHA384_IV[8]|0,this.El=n.SHA384_IV[9]|0,this.Fh=n.SHA384_IV[10]|0,this.Fl=n.SHA384_IV[11]|0,this.Gh=n.SHA384_IV[12]|0,this.Gl=n.SHA384_IV[13]|0,this.Hh=n.SHA384_IV[14]|0,this.Hl=n.SHA384_IV[15]|0}}sha2.SHA384=S;const I=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),_=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class R extends A{constructor(){super(28),this.Ah=I[0]|0,this.Al=I[1]|0,this.Bh=I[2]|0,this.Bl=I[3]|0,this.Ch=I[4]|0,this.Cl=I[5]|0,this.Dh=I[6]|0,this.Dl=I[7]|0,this.Eh=I[8]|0,this.El=I[9]|0,this.Fh=I[10]|0,this.Fl=I[11]|0,this.Gh=I[12]|0,this.Gl=I[13]|0,this.Hh=I[14]|0,this.Hl=I[15]|0}}sha2.SHA512_224=R;class N extends A{constructor(){super(32),this.Ah=_[0]|0,this.Al=_[1]|0,this.Bh=_[2]|0,this.Bl=_[3]|0,this.Ch=_[4]|0,this.Cl=_[5]|0,this.Dh=_[6]|0,this.Dl=_[7]|0,this.Eh=_[8]|0,this.El=_[9]|0,this.Fh=_[10]|0,this.Fl=_[11]|0,this.Gh=_[12]|0,this.Gl=_[13]|0,this.Hh=_[14]|0,this.Hl=_[15]|0}}return sha2.SHA512_256=N,sha2.sha256=(0,e.createHasher)(()=>new o),sha2.sha224=(0,e.createHasher)(()=>new f),sha2.sha512=(0,e.createHasher)(()=>new A),sha2.sha384=(0,e.createHasher)(()=>new S),sha2.sha512_256=(0,e.createHasher)(()=>new N),sha2.sha512_224=(0,e.createHasher)(()=>new R),sha2}var _shortw_utils={},hmac={},hasRequiredHmac;function requireHmac(){return hasRequiredHmac||(hasRequiredHmac=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.hmac=n.HMAC=void 0;const t=requireUtils$2();class e extends t.Hash{constructor(o,f){super(),this.finished=!1,this.destroyed=!1,(0,t.ahash)(o);const p=(0,t.toBytes)(f);if(this.iHash=o.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const y=this.blockLen,g=new Uint8Array(y);g.set(p.length>y?o.create().update(p).digest():p);for(let x=0;x<g.length;x++)g[x]^=54;this.iHash.update(g),this.oHash=o.create();for(let x=0;x<g.length;x++)g[x]^=106;this.oHash.update(g),(0,t.clean)(g)}update(o){return(0,t.aexists)(this),this.iHash.update(o),this}digestInto(o){(0,t.aexists)(this),(0,t.abytes)(o,this.outputLen),this.finished=!0,this.iHash.digestInto(o),this.oHash.update(o),this.oHash.digestInto(o),this.destroy()}digest(){const o=new Uint8Array(this.oHash.outputLen);return this.digestInto(o),o}_cloneInto(o){o||(o=Object.create(Object.getPrototypeOf(this),{}));const{oHash:f,iHash:p,finished:y,destroyed:g,blockLen:x,outputLen:E}=this;return o=o,o.finished=y,o.destroyed=g,o.blockLen=x,o.outputLen=E,o.oHash=f._cloneInto(o.oHash),o.iHash=p._cloneInto(o.iHash),o}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}n.HMAC=e;const s=(a,o,f)=>new e(a,o).update(f).digest();n.hmac=s,n.hmac.create=(a,o)=>new e(a,o)}(hmac)),hmac}var weierstrass={},curve={},modular={},utils$1={},hasRequiredUtils$1;function requireUtils$1(){if(hasRequiredUtils$1)return utils$1;hasRequiredUtils$1=1;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(utils$1,"__esModule",{value:!0}),utils$1.notImplemented=utils$1.bitMask=void 0,utils$1.isBytes=e,utils$1.abytes=s,utils$1.abool=a,utils$1.numberToHexUnpadded=o,utils$1.hexToNumber=f,utils$1.bytesToHex=g,utils$1.hexToBytes=A,utils$1.bytesToNumberBE=S,utils$1.bytesToNumberLE=I,utils$1.numberToBytesBE=_,utils$1.numberToBytesLE=R,utils$1.numberToVarBytesBE=N,utils$1.ensureBytes=D,utils$1.concatBytes=M,utils$1.equalBytes=W,utils$1.utf8ToBytes=B,utils$1.inRange=P,utils$1.aInRange=F,utils$1.bitLen=j,utils$1.bitGet=Q,utils$1.bitSet=$,utils$1.createHmacDrbg=H,utils$1.validateObject=K,utils$1.memoized=ne;const n=BigInt(0),t=BigInt(1);function e(re){return re instanceof Uint8Array||ArrayBuffer.isView(re)&&re.constructor.name==="Uint8Array"}function s(re){if(!e(re))throw new Error("Uint8Array expected")}function a(re,X){if(typeof X!="boolean")throw new Error(re+" boolean expected, got "+X)}function o(re){const X=re.toString(16);return X.length&1?"0"+X:X}function f(re){if(typeof re!="string")throw new Error("hex string expected, got "+typeof re);return re===""?n:BigInt("0x"+re)}const p=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",y=Array.from({length:256},(re,X)=>X.toString(16).padStart(2,"0"));function g(re){if(s(re),p)return re.toHex();let X="";for(let ae=0;ae<re.length;ae++)X+=y[re[ae]];return X}const x={_0:48,_9:57,A:65,F:70,a:97,f:102};function E(re){if(re>=x._0&&re<=x._9)return re-x._0;if(re>=x.A&&re<=x.F)return re-(x.A-10);if(re>=x.a&&re<=x.f)return re-(x.a-10)}function A(re){if(typeof re!="string")throw new Error("hex string expected, got "+typeof re);if(p)return Uint8Array.fromHex(re);const X=re.length,ae=X/2;if(X%2)throw new Error("hex string expected, got unpadded hex of length "+X);const te=new Uint8Array(ae);for(let ce=0,xe=0;ce<ae;ce++,xe+=2){const me=E(re.charCodeAt(xe)),Se=E(re.charCodeAt(xe+1));if(me===void 0||Se===void 0){const be=re[xe]+re[xe+1];throw new Error('hex string expected, got non-hex character "'+be+'" at index '+xe)}te[ce]=me*16+Se}return te}function S(re){return f(g(re))}function I(re){return s(re),f(g(Uint8Array.from(re).reverse()))}function _(re,X){return A(re.toString(16).padStart(X*2,"0"))}function R(re,X){return _(re,X).reverse()}function N(re){return A(o(re))}function D(re,X,ae){let te;if(typeof X=="string")try{te=A(X)}catch(xe){throw new Error(re+" must be hex string or Uint8Array, cause: "+xe)}else if(e(X))te=Uint8Array.from(X);else throw new Error(re+" must be hex string or Uint8Array");const ce=te.length;if(typeof ae=="number"&&ce!==ae)throw new Error(re+" of length "+ae+" expected, got "+ce);return te}function M(...re){let X=0;for(let te=0;te<re.length;te++){const ce=re[te];s(ce),X+=ce.length}const ae=new Uint8Array(X);for(let te=0,ce=0;te<re.length;te++){const xe=re[te];ae.set(xe,ce),ce+=xe.length}return ae}function W(re,X){if(re.length!==X.length)return!1;let ae=0;for(let te=0;te<re.length;te++)ae|=re[te]^X[te];return ae===0}function B(re){if(typeof re!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(re))}const U=re=>typeof re=="bigint"&&n<=re;function P(re,X,ae){return U(re)&&U(X)&&U(ae)&&X<=re&&re<ae}function F(re,X,ae,te){if(!P(X,ae,te))throw new Error("expected valid "+re+": "+ae+" <= n < "+te+", got "+X)}function j(re){let X;for(X=0;re>n;re>>=t,X+=1);return X}function Q(re,X){return re>>BigInt(X)&t}function $(re,X,ae){return re|(ae?t:n)<<BigInt(X)}const V=re=>(t<<BigInt(re))-t;utils$1.bitMask=V;const G=re=>new Uint8Array(re),se=re=>Uint8Array.from(re);function H(re,X,ae){if(typeof re!="number"||re<2)throw new Error("hashLen must be a number");if(typeof X!="number"||X<2)throw new Error("qByteLen must be a number");if(typeof ae!="function")throw new Error("hmacFn must be a function");let te=G(re),ce=G(re),xe=0;const me=()=>{te.fill(1),ce.fill(0),xe=0},Se=(...Ue)=>ae(ce,te,...Ue),be=(Ue=G(0))=>{ce=Se(se([0]),Ue),te=Se(),Ue.length!==0&&(ce=Se(se([1]),Ue),te=Se())},Me=()=>{if(xe++>=1e3)throw new Error("drbg: tried 1000 values");let Ue=0;const je=[];for(;Ue<X;){te=Se();const Pe=te.slice();je.push(Pe),Ue+=te.length}return M(...je)};return(Ue,je)=>{me(),be(Ue);let Pe;for(;!(Pe=je(Me()));)be();return me(),Pe}}const J={bigint:re=>typeof re=="bigint",function:re=>typeof re=="function",boolean:re=>typeof re=="boolean",string:re=>typeof re=="string",stringOrUint8Array:re=>typeof re=="string"||e(re),isSafeInteger:re=>Number.isSafeInteger(re),array:re=>Array.isArray(re),field:(re,X)=>X.Fp.isValid(re),hash:re=>typeof re=="function"&&Number.isSafeInteger(re.outputLen)};function K(re,X,ae={}){const te=(ce,xe,me)=>{const Se=J[xe];if(typeof Se!="function")throw new Error("invalid validator function");const be=re[ce];if(!(me&&be===void 0)&&!Se(be,re))throw new Error("param "+String(ce)+" is invalid. Expected "+xe+", got "+be)};for(const[ce,xe]of Object.entries(X))te(ce,xe,!1);for(const[ce,xe]of Object.entries(ae))te(ce,xe,!0);return re}const ie=()=>{throw new Error("not implemented")};utils$1.notImplemented=ie;function ne(re){const X=new WeakMap;return(ae,...te)=>{const ce=X.get(ae);if(ce!==void 0)return ce;const xe=re(ae,...te);return X.set(ae,xe),xe}}return utils$1}var hasRequiredModular;function requireModular(){if(hasRequiredModular)return modular;hasRequiredModular=1,Object.defineProperty(modular,"__esModule",{value:!0}),modular.isNegativeLE=void 0,modular.mod=g,modular.pow=x,modular.pow2=E,modular.invert=A,modular.tonelliShanks=S,modular.FpSqrt=I,modular.validateField=N,modular.FpPow=D,modular.FpInvertBatch=M,modular.FpDiv=W,modular.FpLegendre=B,modular.FpIsSquare=U,modular.nLength=P,modular.Field=F,modular.FpSqrtOdd=j,modular.FpSqrtEven=Q,modular.hashToPrivateScalar=$,modular.getFieldBytesLength=V,modular.getMinHashLength=G,modular.mapHashToField=se;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const n=requireUtils$2(),t=requireUtils$1(),e=BigInt(0),s=BigInt(1),a=BigInt(2),o=BigInt(3),f=BigInt(4),p=BigInt(5),y=BigInt(8);function g(H,J){const K=H%J;return K>=e?K:J+K}function x(H,J,K){if(J<e)throw new Error("invalid exponent, negatives unsupported");if(K<=e)throw new Error("invalid modulus");if(K===s)return e;let ie=s;for(;J>e;)J&s&&(ie=ie*H%K),H=H*H%K,J>>=s;return ie}function E(H,J,K){let ie=H;for(;J-- >e;)ie*=ie,ie%=K;return ie}function A(H,J){if(H===e)throw new Error("invert: expected non-zero number");if(J<=e)throw new Error("invert: expected positive modulus, got "+J);let K=g(H,J),ie=J,ne=e,re=s;for(;K!==e;){const ae=ie/K,te=ie%K,ce=ne-re*ae;ie=K,K=te,ne=re,re=ce}if(ie!==s)throw new Error("invert: does not exist");return g(ne,J)}function S(H){let J=H-s,K=0;for(;J%a===e;)J/=a,K++;let ie=a;const ne=F(H);for(;ie<H&&U(ne,ie);)if(ie++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(K===1){const X=(H+s)/f;return function(te,ce){const xe=te.pow(ce,X);if(!te.eql(te.sqr(xe),ce))throw new Error("Cannot find square root");return xe}}const re=(J+s)/a;return function(ae,te){if(!U(ae,te))throw new Error("Cannot find square root");let ce=K,xe=ae.pow(ae.mul(ae.ONE,ie),J),me=ae.pow(te,re),Se=ae.pow(te,J);for(;!ae.eql(Se,ae.ONE);){if(ae.eql(Se,ae.ZERO))return ae.ZERO;let be=1;for(let Oe=ae.sqr(Se);be<ce&&!ae.eql(Oe,ae.ONE);be++)Oe=ae.sqr(Oe);const Me=ae.pow(xe,s<<BigInt(ce-be-1));xe=ae.sqr(Me),me=ae.mul(me,Me),Se=ae.mul(Se,xe),ce=be}return me}}function I(H){return H%f===o?function(K,ie){const ne=(H+s)/f,re=K.pow(ie,ne);if(!K.eql(K.sqr(re),ie))throw new Error("Cannot find square root");return re}:H%y===p?function(K,ie){const ne=K.mul(ie,a),re=(H-p)/y,X=K.pow(ne,re),ae=K.mul(ie,X),te=K.mul(K.mul(ae,a),X),ce=K.mul(ae,K.sub(te,K.ONE));if(!K.eql(K.sqr(ce),ie))throw new Error("Cannot find square root");return ce}:S(H)}const _=(H,J)=>(g(H,J)&s)===s;modular.isNegativeLE=_;const R=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function N(H){const J={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},K=R.reduce((ie,ne)=>(ie[ne]="function",ie),J);return(0,t.validateObject)(H,K)}function D(H,J,K){if(K<e)throw new Error("invalid exponent, negatives unsupported");if(K===e)return H.ONE;if(K===s)return J;let ie=H.ONE,ne=J;for(;K>e;)K&s&&(ie=H.mul(ie,ne)),ne=H.sqr(ne),K>>=s;return ie}function M(H,J,K=!1){const ie=new Array(J.length).fill(K?H.ZERO:void 0),ne=J.reduce((X,ae,te)=>H.is0(ae)?X:(ie[te]=X,H.mul(X,ae)),H.ONE),re=H.inv(ne);return J.reduceRight((X,ae,te)=>H.is0(ae)?X:(ie[te]=H.mul(X,ie[te]),H.mul(X,ae)),re),ie}function W(H,J,K){return H.mul(J,typeof K=="bigint"?A(K,H.ORDER):H.inv(K))}function B(H,J){const K=(H.ORDER-s)/a,ie=H.pow(J,K),ne=H.eql(ie,H.ONE),re=H.eql(ie,H.ZERO),X=H.eql(ie,H.neg(H.ONE));if(!ne&&!re&&!X)throw new Error("Cannot find square root: probably non-prime P");return ne?1:re?0:-1}function U(H,J){const K=B(H,J);return K===0||K===1}function P(H,J){J!==void 0&&(0,n.anumber)(J);const K=J!==void 0?J:H.toString(2).length,ie=Math.ceil(K/8);return{nBitLength:K,nByteLength:ie}}function F(H,J,K=!1,ie={}){if(H<=e)throw new Error("invalid field: expected ORDER > 0, got "+H);const{nBitLength:ne,nByteLength:re}=P(H,J);if(re>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let X;const ae=Object.freeze({ORDER:H,isLE:K,BITS:ne,BYTES:re,MASK:(0,t.bitMask)(ne),ZERO:e,ONE:s,create:te=>g(te,H),isValid:te=>{if(typeof te!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof te);return e<=te&&te<H},is0:te=>te===e,isOdd:te=>(te&s)===s,neg:te=>g(-te,H),eql:(te,ce)=>te===ce,sqr:te=>g(te*te,H),add:(te,ce)=>g(te+ce,H),sub:(te,ce)=>g(te-ce,H),mul:(te,ce)=>g(te*ce,H),pow:(te,ce)=>D(ae,te,ce),div:(te,ce)=>g(te*A(ce,H),H),sqrN:te=>te*te,addN:(te,ce)=>te+ce,subN:(te,ce)=>te-ce,mulN:(te,ce)=>te*ce,inv:te=>A(te,H),sqrt:ie.sqrt||(te=>(X||(X=I(H)),X(ae,te))),toBytes:te=>K?(0,t.numberToBytesLE)(te,re):(0,t.numberToBytesBE)(te,re),fromBytes:te=>{if(te.length!==re)throw new Error("Field.fromBytes: expected "+re+" bytes, got "+te.length);return K?(0,t.bytesToNumberLE)(te):(0,t.bytesToNumberBE)(te)},invertBatch:te=>M(ae,te),cmov:(te,ce,xe)=>xe?ce:te});return Object.freeze(ae)}function j(H,J){if(!H.isOdd)throw new Error("Field doesn't have isOdd");const K=H.sqrt(J);return H.isOdd(K)?K:H.neg(K)}function Q(H,J){if(!H.isOdd)throw new Error("Field doesn't have isOdd");const K=H.sqrt(J);return H.isOdd(K)?H.neg(K):K}function $(H,J,K=!1){H=(0,t.ensureBytes)("privateHash",H);const ie=H.length,ne=P(J).nByteLength+8;if(ne<24||ie<ne||ie>1024)throw new Error("hashToPrivateScalar: expected "+ne+"-1024 bytes of input, got "+ie);const re=K?(0,t.bytesToNumberLE)(H):(0,t.bytesToNumberBE)(H);return g(re,J-s)+s}function V(H){if(typeof H!="bigint")throw new Error("field order must be bigint");const J=H.toString(2).length;return Math.ceil(J/8)}function G(H){const J=V(H);return J+Math.ceil(J/2)}function se(H,J,K=!1){const ie=H.length,ne=V(J),re=G(J);if(ie<16||ie<re||ie>1024)throw new Error("expected "+re+"-1024 bytes of input, got "+ie);const X=K?(0,t.bytesToNumberLE)(H):(0,t.bytesToNumberBE)(H),ae=g(X,J-s)+s;return K?(0,t.numberToBytesLE)(ae,ne):(0,t.numberToBytesBE)(ae,ne)}return modular}var hasRequiredCurve;function requireCurve(){if(hasRequiredCurve)return curve;hasRequiredCurve=1,Object.defineProperty(curve,"__esModule",{value:!0}),curve.wNAF=S,curve.pippenger=I,curve.precomputeMSMUnsafe=_,curve.validateBasic=R;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const n=requireModular(),t=requireUtils$1(),e=BigInt(0),s=BigInt(1);function a(N,D){const M=D.negate();return N?M:D}function o(N,D){if(!Number.isSafeInteger(N)||N<=0||N>D)throw new Error("invalid window size, expected [1.."+D+"], got W="+N)}function f(N,D){o(N,D);const M=Math.ceil(D/N)+1,W=2**(N-1),B=2**N,U=(0,t.bitMask)(N),P=BigInt(N);return{windows:M,windowSize:W,mask:U,maxNumber:B,shiftBy:P}}function p(N,D,M){const{windowSize:W,mask:B,maxNumber:U,shiftBy:P}=M;let F=Number(N&B),j=N>>P;F>W&&(F-=U,j+=s);const Q=D*W,$=Q+Math.abs(F)-1,V=F===0,G=F<0,se=D%2!==0;return{nextN:j,offset:$,isZero:V,isNeg:G,isNegF:se,offsetF:Q}}function y(N,D){if(!Array.isArray(N))throw new Error("array expected");N.forEach((M,W)=>{if(!(M instanceof D))throw new Error("invalid point at index "+W)})}function g(N,D){if(!Array.isArray(N))throw new Error("array of scalars expected");N.forEach((M,W)=>{if(!D.isValid(M))throw new Error("invalid scalar at index "+W)})}const x=new WeakMap,E=new WeakMap;function A(N){return E.get(N)||1}function S(N,D){return{constTimeNegate:a,hasPrecomputes(M){return A(M)!==1},unsafeLadder(M,W,B=N.ZERO){let U=M;for(;W>e;)W&s&&(B=B.add(U)),U=U.double(),W>>=s;return B},precomputeWindow(M,W){const{windows:B,windowSize:U}=f(W,D),P=[];let F=M,j=F;for(let Q=0;Q<B;Q++){j=F,P.push(j);for(let $=1;$<U;$++)j=j.add(F),P.push(j);F=j.double()}return P},wNAF(M,W,B){let U=N.ZERO,P=N.BASE;const F=f(M,D);for(let j=0;j<F.windows;j++){const{nextN:Q,offset:$,isZero:V,isNeg:G,isNegF:se,offsetF:H}=p(B,j,F);B=Q,V?P=P.add(a(se,W[H])):U=U.add(a(G,W[$]))}return{p:U,f:P}},wNAFUnsafe(M,W,B,U=N.ZERO){const P=f(M,D);for(let F=0;F<P.windows&&B!==e;F++){const{nextN:j,offset:Q,isZero:$,isNeg:V}=p(B,F,P);if(B=j,!$){const G=W[Q];U=U.add(V?G.negate():G)}}return U},getPrecomputes(M,W,B){let U=x.get(W);return U||(U=this.precomputeWindow(W,M),M!==1&&x.set(W,B(U))),U},wNAFCached(M,W,B){const U=A(M);return this.wNAF(U,this.getPrecomputes(U,M,B),W)},wNAFCachedUnsafe(M,W,B,U){const P=A(M);return P===1?this.unsafeLadder(M,W,U):this.wNAFUnsafe(P,this.getPrecomputes(P,M,B),W,U)},setWindowSize(M,W){o(W,D),E.set(M,W),x.delete(M)}}}function I(N,D,M,W){if(y(M,N),g(W,D),M.length!==W.length)throw new Error("arrays of points and scalars must have equal length");const B=N.ZERO,U=(0,t.bitLen)(BigInt(M.length)),P=U>12?U-3:U>4?U-2:U?2:1,F=(0,t.bitMask)(P),j=new Array(Number(F)+1).fill(B),Q=Math.floor((D.BITS-1)/P)*P;let $=B;for(let V=Q;V>=0;V-=P){j.fill(B);for(let se=0;se<W.length;se++){const H=W[se],J=Number(H>>BigInt(V)&F);j[J]=j[J].add(M[se])}let G=B;for(let se=j.length-1,H=B;se>0;se--)H=H.add(j[se]),G=G.add(H);if($=$.add(G),V!==0)for(let se=0;se<P;se++)$=$.double()}return $}function _(N,D,M,W){o(W,D.BITS),y(M,N);const B=N.ZERO,U=2**W-1,P=Math.ceil(D.BITS/W),F=(0,t.bitMask)(W),j=M.map(Q=>{const $=[];for(let V=0,G=Q;V<U;V++)$.push(G),G=G.add(Q);return $});return Q=>{if(g(Q,D),Q.length>M.length)throw new Error("array of scalars must be smaller than array of points");let $=B;for(let V=0;V<P;V++){if($!==B)for(let se=0;se<W;se++)$=$.double();const G=BigInt(P*W-(V+1)*W);for(let se=0;se<Q.length;se++){const H=Q[se],J=Number(H>>G&F);J&&($=$.add(j[se][J-1]))}}return $}}function R(N){return(0,n.validateField)(N.Fp),(0,t.validateObject)(N,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...(0,n.nLength)(N.n,N.nBitLength),...N,p:N.Fp.ORDER})}return curve}var hasRequiredWeierstrass;function requireWeierstrass(){return hasRequiredWeierstrass||(hasRequiredWeierstrass=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.DER=n.DERErr=void 0,n.weierstrassPoints=A,n.weierstrass=I,n.SWUFpSqrtRatio=_,n.mapToCurveSimpleSWU=R;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const t=requireCurve(),e=requireModular(),s=requireUtils$1();function a(N){N.lowS!==void 0&&(0,s.abool)("lowS",N.lowS),N.prehash!==void 0&&(0,s.abool)("prehash",N.prehash)}function o(N){const D=(0,t.validateBasic)(N);(0,s.validateObject)(D,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:M,Fp:W,a:B}=D;if(M){if(!W.eql(B,W.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof M!="object"||typeof M.beta!="bigint"||typeof M.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...D})}class f extends Error{constructor(D=""){super(D)}}n.DERErr=f,n.DER={Err:f,_tlv:{encode:(N,D)=>{const{Err:M}=n.DER;if(N<0||N>256)throw new M("tlv.encode: wrong tag");if(D.length&1)throw new M("tlv.encode: unpadded data");const W=D.length/2,B=(0,s.numberToHexUnpadded)(W);if(B.length/2&128)throw new M("tlv.encode: long form length too big");const U=W>127?(0,s.numberToHexUnpadded)(B.length/2|128):"";return(0,s.numberToHexUnpadded)(N)+U+B+D},decode(N,D){const{Err:M}=n.DER;let W=0;if(N<0||N>256)throw new M("tlv.encode: wrong tag");if(D.length<2||D[W++]!==N)throw new M("tlv.decode: wrong tlv");const B=D[W++],U=!!(B&128);let P=0;if(!U)P=B;else{const j=B&127;if(!j)throw new M("tlv.decode(long): indefinite length not supported");if(j>4)throw new M("tlv.decode(long): byte length is too big");const Q=D.subarray(W,W+j);if(Q.length!==j)throw new M("tlv.decode: length bytes not complete");if(Q[0]===0)throw new M("tlv.decode(long): zero leftmost byte");for(const $ of Q)P=P<<8|$;if(W+=j,P<128)throw new M("tlv.decode(long): not minimal encoding")}const F=D.subarray(W,W+P);if(F.length!==P)throw new M("tlv.decode: wrong value length");return{v:F,l:D.subarray(W+P)}}},_int:{encode(N){const{Err:D}=n.DER;if(N<p)throw new D("integer: negative integers are not allowed");let M=(0,s.numberToHexUnpadded)(N);if(Number.parseInt(M[0],16)&8&&(M="00"+M),M.length&1)throw new D("unexpected DER parsing assertion: unpadded hex");return M},decode(N){const{Err:D}=n.DER;if(N[0]&128)throw new D("invalid signature integer: negative");if(N[0]===0&&!(N[1]&128))throw new D("invalid signature integer: unnecessary leading zero");return(0,s.bytesToNumberBE)(N)}},toSig(N){const{Err:D,_int:M,_tlv:W}=n.DER,B=(0,s.ensureBytes)("signature",N),{v:U,l:P}=W.decode(48,B);if(P.length)throw new D("invalid signature: left bytes after parsing");const{v:F,l:j}=W.decode(2,U),{v:Q,l:$}=W.decode(2,j);if($.length)throw new D("invalid signature: left bytes after parsing");return{r:M.decode(F),s:M.decode(Q)}},hexFromSig(N){const{_tlv:D,_int:M}=n.DER,W=D.encode(2,M.encode(N.r)),B=D.encode(2,M.encode(N.s)),U=W+B;return D.encode(48,U)}};const p=BigInt(0),y=BigInt(1),g=BigInt(2),x=BigInt(3),E=BigInt(4);function A(N){const D=o(N),{Fp:M}=D,W=(0,e.Field)(D.n,D.nBitLength),B=D.toBytes||((J,K,ie)=>{const ne=K.toAffine();return(0,s.concatBytes)(Uint8Array.from([4]),M.toBytes(ne.x),M.toBytes(ne.y))}),U=D.fromBytes||(J=>{const K=J.subarray(1),ie=M.fromBytes(K.subarray(0,M.BYTES)),ne=M.fromBytes(K.subarray(M.BYTES,2*M.BYTES));return{x:ie,y:ne}});function P(J){const{a:K,b:ie}=D,ne=M.sqr(J),re=M.mul(ne,J);return M.add(M.add(re,M.mul(J,K)),ie)}if(!M.eql(M.sqr(D.Gy),P(D.Gx)))throw new Error("bad generator point: equation left != right");function F(J){return(0,s.inRange)(J,y,D.n)}function j(J){const{allowedPrivateKeyLengths:K,nByteLength:ie,wrapPrivateKey:ne,n:re}=D;if(K&&typeof J!="bigint"){if((0,s.isBytes)(J)&&(J=(0,s.bytesToHex)(J)),typeof J!="string"||!K.includes(J.length))throw new Error("invalid private key");J=J.padStart(ie*2,"0")}let X;try{X=typeof J=="bigint"?J:(0,s.bytesToNumberBE)((0,s.ensureBytes)("private key",J,ie))}catch{throw new Error("invalid private key, expected hex or "+ie+" bytes, got "+typeof J)}return ne&&(X=(0,e.mod)(X,re)),(0,s.aInRange)("private key",X,y,re),X}function Q(J){if(!(J instanceof G))throw new Error("ProjectivePoint expected")}const $=(0,s.memoized)((J,K)=>{const{px:ie,py:ne,pz:re}=J;if(M.eql(re,M.ONE))return{x:ie,y:ne};const X=J.is0();K==null&&(K=X?M.ONE:M.inv(re));const ae=M.mul(ie,K),te=M.mul(ne,K),ce=M.mul(re,K);if(X)return{x:M.ZERO,y:M.ZERO};if(!M.eql(ce,M.ONE))throw new Error("invZ was invalid");return{x:ae,y:te}}),V=(0,s.memoized)(J=>{if(J.is0()){if(D.allowInfinityPoint&&!M.is0(J.py))return;throw new Error("bad point: ZERO")}const{x:K,y:ie}=J.toAffine();if(!M.isValid(K)||!M.isValid(ie))throw new Error("bad point: x or y not FE");const ne=M.sqr(ie),re=P(K);if(!M.eql(ne,re))throw new Error("bad point: equation left != right");if(!J.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class G{constructor(K,ie,ne){if(K==null||!M.isValid(K))throw new Error("x required");if(ie==null||!M.isValid(ie)||M.is0(ie))throw new Error("y required");if(ne==null||!M.isValid(ne))throw new Error("z required");this.px=K,this.py=ie,this.pz=ne,Object.freeze(this)}static fromAffine(K){const{x:ie,y:ne}=K||{};if(!K||!M.isValid(ie)||!M.isValid(ne))throw new Error("invalid affine point");if(K instanceof G)throw new Error("projective point not allowed");const re=X=>M.eql(X,M.ZERO);return re(ie)&&re(ne)?G.ZERO:new G(ie,ne,M.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(K){const ie=(0,e.FpInvertBatch)(M,K.map(ne=>ne.pz));return K.map((ne,re)=>ne.toAffine(ie[re])).map(G.fromAffine)}static fromHex(K){const ie=G.fromAffine(U((0,s.ensureBytes)("pointHex",K)));return ie.assertValidity(),ie}static fromPrivateKey(K){return G.BASE.multiply(j(K))}static msm(K,ie){return(0,t.pippenger)(G,W,K,ie)}_setWindowSize(K){H.setWindowSize(this,K)}assertValidity(){V(this)}hasEvenY(){const{y:K}=this.toAffine();if(M.isOdd)return!M.isOdd(K);throw new Error("Field doesn't support isOdd")}equals(K){Q(K);const{px:ie,py:ne,pz:re}=this,{px:X,py:ae,pz:te}=K,ce=M.eql(M.mul(ie,te),M.mul(X,re)),xe=M.eql(M.mul(ne,te),M.mul(ae,re));return ce&&xe}negate(){return new G(this.px,M.neg(this.py),this.pz)}double(){const{a:K,b:ie}=D,ne=M.mul(ie,x),{px:re,py:X,pz:ae}=this;let te=M.ZERO,ce=M.ZERO,xe=M.ZERO,me=M.mul(re,re),Se=M.mul(X,X),be=M.mul(ae,ae),Me=M.mul(re,X);return Me=M.add(Me,Me),xe=M.mul(re,ae),xe=M.add(xe,xe),te=M.mul(K,xe),ce=M.mul(ne,be),ce=M.add(te,ce),te=M.sub(Se,ce),ce=M.add(Se,ce),ce=M.mul(te,ce),te=M.mul(Me,te),xe=M.mul(ne,xe),be=M.mul(K,be),Me=M.sub(me,be),Me=M.mul(K,Me),Me=M.add(Me,xe),xe=M.add(me,me),me=M.add(xe,me),me=M.add(me,be),me=M.mul(me,Me),ce=M.add(ce,me),be=M.mul(X,ae),be=M.add(be,be),me=M.mul(be,Me),te=M.sub(te,me),xe=M.mul(be,Se),xe=M.add(xe,xe),xe=M.add(xe,xe),new G(te,ce,xe)}add(K){Q(K);const{px:ie,py:ne,pz:re}=this,{px:X,py:ae,pz:te}=K;let ce=M.ZERO,xe=M.ZERO,me=M.ZERO;const Se=D.a,be=M.mul(D.b,x);let Me=M.mul(ie,X),Oe=M.mul(ne,ae),Ue=M.mul(re,te),je=M.add(ie,ne),Pe=M.add(X,ae);je=M.mul(je,Pe),Pe=M.add(Me,Oe),je=M.sub(je,Pe),Pe=M.add(ie,re);let We=M.add(X,te);return Pe=M.mul(Pe,We),We=M.add(Me,Ue),Pe=M.sub(Pe,We),We=M.add(ne,re),ce=M.add(ae,te),We=M.mul(We,ce),ce=M.add(Oe,Ue),We=M.sub(We,ce),me=M.mul(Se,Pe),ce=M.mul(be,Ue),me=M.add(ce,me),ce=M.sub(Oe,me),me=M.add(Oe,me),xe=M.mul(ce,me),Oe=M.add(Me,Me),Oe=M.add(Oe,Me),Ue=M.mul(Se,Ue),Pe=M.mul(be,Pe),Oe=M.add(Oe,Ue),Ue=M.sub(Me,Ue),Ue=M.mul(Se,Ue),Pe=M.add(Pe,Ue),Me=M.mul(Oe,Pe),xe=M.add(xe,Me),Me=M.mul(We,Pe),ce=M.mul(je,ce),ce=M.sub(ce,Me),Me=M.mul(je,Oe),me=M.mul(We,me),me=M.add(me,Me),new G(ce,xe,me)}subtract(K){return this.add(K.negate())}is0(){return this.equals(G.ZERO)}wNAF(K){return H.wNAFCached(this,K,G.normalizeZ)}multiplyUnsafe(K){const{endo:ie,n:ne}=D;(0,s.aInRange)("scalar",K,p,ne);const re=G.ZERO;if(K===p)return re;if(this.is0()||K===y)return this;if(!ie||H.hasPrecomputes(this))return H.wNAFCachedUnsafe(this,K,G.normalizeZ);let{k1neg:X,k1:ae,k2neg:te,k2:ce}=ie.splitScalar(K),xe=re,me=re,Se=this;for(;ae>p||ce>p;)ae&y&&(xe=xe.add(Se)),ce&y&&(me=me.add(Se)),Se=Se.double(),ae>>=y,ce>>=y;return X&&(xe=xe.negate()),te&&(me=me.negate()),me=new G(M.mul(me.px,ie.beta),me.py,me.pz),xe.add(me)}multiply(K){const{endo:ie,n:ne}=D;(0,s.aInRange)("scalar",K,y,ne);let re,X;if(ie){const{k1neg:ae,k1:te,k2neg:ce,k2:xe}=ie.splitScalar(K);let{p:me,f:Se}=this.wNAF(te),{p:be,f:Me}=this.wNAF(xe);me=H.constTimeNegate(ae,me),be=H.constTimeNegate(ce,be),be=new G(M.mul(be.px,ie.beta),be.py,be.pz),re=me.add(be),X=Se.add(Me)}else{const{p:ae,f:te}=this.wNAF(K);re=ae,X=te}return G.normalizeZ([re,X])[0]}multiplyAndAddUnsafe(K,ie,ne){const re=G.BASE,X=(te,ce)=>ce===p||ce===y||!te.equals(re)?te.multiplyUnsafe(ce):te.multiply(ce),ae=X(this,ie).add(X(K,ne));return ae.is0()?void 0:ae}toAffine(K){return $(this,K)}isTorsionFree(){const{h:K,isTorsionFree:ie}=D;if(K===y)return!0;if(ie)return ie(G,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:K,clearCofactor:ie}=D;return K===y?this:ie?ie(G,this):this.multiplyUnsafe(D.h)}toRawBytes(K=!0){return(0,s.abool)("isCompressed",K),this.assertValidity(),B(G,this,K)}toHex(K=!0){return(0,s.abool)("isCompressed",K),(0,s.bytesToHex)(this.toRawBytes(K))}}G.BASE=new G(D.Gx,D.Gy,M.ONE),G.ZERO=new G(M.ZERO,M.ONE,M.ZERO);const se=D.nBitLength,H=(0,t.wNAF)(G,D.endo?Math.ceil(se/2):se);return{CURVE:D,ProjectivePoint:G,normPrivateKeyToScalar:j,weierstrassEquation:P,isWithinCurveOrder:F}}function S(N){const D=(0,t.validateBasic)(N);return(0,s.validateObject)(D,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...D})}function I(N){const D=S(N),{Fp:M,n:W}=D,B=M.BYTES+1,U=2*M.BYTES+1;function P(Ue){return(0,e.mod)(Ue,W)}function F(Ue){return(0,e.invert)(Ue,W)}const{ProjectivePoint:j,normPrivateKeyToScalar:Q,weierstrassEquation:$,isWithinCurveOrder:V}=A({...D,toBytes(Ue,je,Pe){const We=je.toAffine(),Ze=M.toBytes(We.x),ot=s.concatBytes;return(0,s.abool)("isCompressed",Pe),Pe?ot(Uint8Array.from([je.hasEvenY()?2:3]),Ze):ot(Uint8Array.from([4]),Ze,M.toBytes(We.y))},fromBytes(Ue){const je=Ue.length,Pe=Ue[0],We=Ue.subarray(1);if(je===B&&(Pe===2||Pe===3)){const Ze=(0,s.bytesToNumberBE)(We);if(!(0,s.inRange)(Ze,y,M.ORDER))throw new Error("Point is not on curve");const ot=$(Ze);let st;try{st=M.sqrt(ot)}catch(bt){const qe=bt instanceof Error?": "+bt.message:"";throw new Error("Point is not on curve"+qe)}const nt=(st&y)===y;return(Pe&1)===1!==nt&&(st=M.neg(st)),{x:Ze,y:st}}else if(je===U&&Pe===4){const Ze=M.fromBytes(We.subarray(0,M.BYTES)),ot=M.fromBytes(We.subarray(M.BYTES,2*M.BYTES));return{x:Ze,y:ot}}else{const Ze=B,ot=U;throw new Error("invalid Point, expected length of "+Ze+", or uncompressed "+ot+", got "+je)}}}),G=Ue=>(0,s.bytesToHex)((0,s.numberToBytesBE)(Ue,D.nByteLength));function se(Ue){const je=W>>y;return Ue>je}function H(Ue){return se(Ue)?P(-Ue):Ue}const J=(Ue,je,Pe)=>(0,s.bytesToNumberBE)(Ue.slice(je,Pe));class K{constructor(je,Pe,We){(0,s.aInRange)("r",je,y,W),(0,s.aInRange)("s",Pe,y,W),this.r=je,this.s=Pe,We!=null&&(this.recovery=We),Object.freeze(this)}static fromCompact(je){const Pe=D.nByteLength;return je=(0,s.ensureBytes)("compactSignature",je,Pe*2),new K(J(je,0,Pe),J(je,Pe,2*Pe))}static fromDER(je){const{r:Pe,s:We}=n.DER.toSig((0,s.ensureBytes)("DER",je));return new K(Pe,We)}assertValidity(){}addRecoveryBit(je){return new K(this.r,this.s,je)}recoverPublicKey(je){const{r:Pe,s:We,recovery:Ze}=this,ot=te((0,s.ensureBytes)("msgHash",je));if(Ze==null||![0,1,2,3].includes(Ze))throw new Error("recovery id invalid");const st=Ze===2||Ze===3?Pe+D.n:Pe;if(st>=M.ORDER)throw new Error("recovery id 2 or 3 invalid");const nt=(Ze&1)===0?"02":"03",tt=j.fromHex(nt+G(st)),bt=F(st),qe=P(-ot*bt),Et=P(We*bt),$t=j.BASE.multiplyAndAddUnsafe(tt,qe,Et);if(!$t)throw new Error("point at infinify");return $t.assertValidity(),$t}hasHighS(){return se(this.s)}normalizeS(){return this.hasHighS()?new K(this.r,P(-this.s),this.recovery):this}toDERRawBytes(){return(0,s.hexToBytes)(this.toDERHex())}toDERHex(){return n.DER.hexFromSig(this)}toCompactRawBytes(){return(0,s.hexToBytes)(this.toCompactHex())}toCompactHex(){return G(this.r)+G(this.s)}}const ie={isValidPrivateKey(Ue){try{return Q(Ue),!0}catch{return!1}},normPrivateKeyToScalar:Q,randomPrivateKey:()=>{const Ue=(0,e.getMinHashLength)(D.n);return(0,e.mapHashToField)(D.randomBytes(Ue),D.n)},precompute(Ue=8,je=j.BASE){return je._setWindowSize(Ue),je.multiply(BigInt(3)),je}};function ne(Ue,je=!0){return j.fromPrivateKey(Ue).toRawBytes(je)}function re(Ue){const je=(0,s.isBytes)(Ue),Pe=typeof Ue=="string",We=(je||Pe)&&Ue.length;return je?We===B||We===U:Pe?We===2*B||We===2*U:Ue instanceof j}function X(Ue,je,Pe=!0){if(re(Ue))throw new Error("first arg must be private key");if(!re(je))throw new Error("second arg must be public key");return j.fromHex(je).multiply(Q(Ue)).toRawBytes(Pe)}const ae=D.bits2int||function(Ue){if(Ue.length>8192)throw new Error("input is too large");const je=(0,s.bytesToNumberBE)(Ue),Pe=Ue.length*8-D.nBitLength;return Pe>0?je>>BigInt(Pe):je},te=D.bits2int_modN||function(Ue){return P(ae(Ue))},ce=(0,s.bitMask)(D.nBitLength);function xe(Ue){return(0,s.aInRange)("num < 2^"+D.nBitLength,Ue,p,ce),(0,s.numberToBytesBE)(Ue,D.nByteLength)}function me(Ue,je,Pe=Se){if(["recovered","canonical"].some(Dt=>Dt in Pe))throw new Error("sign() legacy options not supported");const{hash:We,randomBytes:Ze}=D;let{lowS:ot,prehash:st,extraEntropy:nt}=Pe;ot==null&&(ot=!0),Ue=(0,s.ensureBytes)("msgHash",Ue),a(Pe),st&&(Ue=(0,s.ensureBytes)("prehashed msgHash",We(Ue)));const tt=te(Ue),bt=Q(je),qe=[xe(bt),xe(tt)];if(nt!=null&&nt!==!1){const Dt=nt===!0?Ze(M.BYTES):nt;qe.push((0,s.ensureBytes)("extraEntropy",Dt))}const Et=(0,s.concatBytes)(...qe),$t=tt;function Vt(Dt){const Lt=ae(Dt);if(!V(Lt))return;const de=F(Lt),z=j.BASE.multiply(Lt).toAffine(),Y=P(z.x);if(Y===p)return;const ye=P(de*P($t+Y*bt));if(ye===p)return;let Ae=(z.x===Y?0:2)|Number(z.y&y),Be=ye;return ot&&se(ye)&&(Be=H(ye),Ae^=1),new K(Y,Be,Ae)}return{seed:Et,k2sig:Vt}}const Se={lowS:D.lowS,prehash:!1},be={lowS:D.lowS,prehash:!1};function Me(Ue,je,Pe=Se){const{seed:We,k2sig:Ze}=me(Ue,je,Pe),ot=D;return(0,s.createHmacDrbg)(ot.hash.outputLen,ot.nByteLength,ot.hmac)(We,Ze)}j.BASE._setWindowSize(8);function Oe(Ue,je,Pe,We=be){var Ae;const Ze=Ue;je=(0,s.ensureBytes)("msgHash",je),Pe=(0,s.ensureBytes)("publicKey",Pe);const{lowS:ot,prehash:st,format:nt}=We;if(a(We),"strict"in We)throw new Error("options.strict was renamed to lowS");if(nt!==void 0&&nt!=="compact"&&nt!=="der")throw new Error("format must be compact or der");const tt=typeof Ze=="string"||(0,s.isBytes)(Ze),bt=!tt&&!nt&&typeof Ze=="object"&&Ze!==null&&typeof Ze.r=="bigint"&&typeof Ze.s=="bigint";if(!tt&&!bt)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let qe,Et;try{if(bt&&(qe=new K(Ze.r,Ze.s)),tt){try{nt!=="compact"&&(qe=K.fromDER(Ze))}catch(Be){if(!(Be instanceof n.DER.Err))throw Be}!qe&&nt!=="der"&&(qe=K.fromCompact(Ze))}Et=j.fromHex(Pe)}catch{return!1}if(!qe||ot&&qe.hasHighS())return!1;st&&(je=D.hash(je));const{r:$t,s:Vt}=qe,Dt=te(je),Lt=F(Vt),de=P(Dt*Lt),z=P($t*Lt),Y=(Ae=j.BASE.multiplyAndAddUnsafe(Et,de,z))==null?void 0:Ae.toAffine();return Y?P(Y.x)===$t:!1}return{CURVE:D,getPublicKey:ne,getSharedSecret:X,sign:Me,verify:Oe,ProjectivePoint:j,Signature:K,utils:ie}}function _(N,D){const M=N.ORDER;let W=p;for(let H=M-y;H%g===p;H/=g)W+=y;const B=W,U=g<<B-y-y,P=U*g,F=(M-y)/P,j=(F-y)/g,Q=P-y,$=U,V=N.pow(D,F),G=N.pow(D,(F+y)/g);let se=(H,J)=>{let K=V,ie=N.pow(J,Q),ne=N.sqr(ie);ne=N.mul(ne,J);let re=N.mul(H,ne);re=N.pow(re,j),re=N.mul(re,ie),ie=N.mul(re,J),ne=N.mul(re,H);let X=N.mul(ne,ie);re=N.pow(X,$);let ae=N.eql(re,N.ONE);ie=N.mul(ne,G),re=N.mul(X,K),ne=N.cmov(ie,ne,ae),X=N.cmov(re,X,ae);for(let te=B;te>y;te--){let ce=te-g;ce=g<<ce-y;let xe=N.pow(X,ce);const me=N.eql(xe,N.ONE);ie=N.mul(ne,K),K=N.mul(K,K),xe=N.mul(X,K),ne=N.cmov(ie,ne,me),X=N.cmov(xe,X,me)}return{isValid:ae,value:ne}};if(N.ORDER%E===x){const H=(N.ORDER-x)/E,J=N.sqrt(N.neg(D));se=(K,ie)=>{let ne=N.sqr(ie);const re=N.mul(K,ie);ne=N.mul(ne,re);let X=N.pow(ne,H);X=N.mul(X,re);const ae=N.mul(X,J),te=N.mul(N.sqr(X),ie),ce=N.eql(te,K);let xe=N.cmov(ae,X,ce);return{isValid:ce,value:xe}}}return se}function R(N,D){if((0,e.validateField)(N),!N.isValid(D.A)||!N.isValid(D.B)||!N.isValid(D.Z))throw new Error("mapToCurveSimpleSWU: invalid opts");const M=_(N,D.Z);if(!N.isOdd)throw new Error("Fp.isOdd is not implemented!");return W=>{let B,U,P,F,j,Q,$,V;B=N.sqr(W),B=N.mul(B,D.Z),U=N.sqr(B),U=N.add(U,B),P=N.add(U,N.ONE),P=N.mul(P,D.B),F=N.cmov(D.Z,N.neg(U),!N.eql(U,N.ZERO)),F=N.mul(F,D.A),U=N.sqr(P),Q=N.sqr(F),j=N.mul(Q,D.A),U=N.add(U,j),U=N.mul(U,P),Q=N.mul(Q,F),j=N.mul(Q,D.B),U=N.add(U,j),$=N.mul(B,P);const{isValid:G,value:se}=M(U,Q);V=N.mul(B,W),V=N.mul(V,se),$=N.cmov($,P,G),V=N.cmov(V,se,G);const H=N.isOdd(W)===N.isOdd(V);V=N.cmov(N.neg(V),V,H);const J=(0,e.FpInvertBatch)(N,[F],!0)[0];return $=N.mul($,J),{x:$,y:V}}}}(weierstrass)),weierstrass}var hasRequired_shortw_utils;function require_shortw_utils(){if(hasRequired_shortw_utils)return _shortw_utils;hasRequired_shortw_utils=1,Object.defineProperty(_shortw_utils,"__esModule",{value:!0}),_shortw_utils.getHash=s,_shortw_utils.createCurve=a;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const n=requireHmac(),t=requireUtils$2(),e=requireWeierstrass();function s(o){return{hash:o,hmac:(f,...p)=>(0,n.hmac)(o,f,(0,t.concatBytes)(...p)),randomBytes:t.randomBytes}}function a(o,f){const p=y=>(0,e.weierstrass)({...o,...s(y)});return{...p(f),create:p}}return _shortw_utils}var hashToCurve={},hasRequiredHashToCurve;function requireHashToCurve(){if(hasRequiredHashToCurve)return hashToCurve;hasRequiredHashToCurve=1,Object.defineProperty(hashToCurve,"__esModule",{value:!0}),hashToCurve.expand_message_xmd=f,hashToCurve.expand_message_xof=p,hashToCurve.hash_to_field=y,hashToCurve.isogenyMap=g,hashToCurve.createHasher=x;const n=requireModular(),t=requireUtils$1(),e=t.bytesToNumberBE;function s(E,A){if(o(E),o(A),E<0||E>=1<<8*A)throw new Error("invalid I2OSP input: "+E);const S=Array.from({length:A}).fill(0);for(let I=A-1;I>=0;I--)S[I]=E&255,E>>>=8;return new Uint8Array(S)}function a(E,A){const S=new Uint8Array(E.length);for(let I=0;I<E.length;I++)S[I]=E[I]^A[I];return S}function o(E){if(!Number.isSafeInteger(E))throw new Error("number expected")}function f(E,A,S,I){(0,t.abytes)(E),(0,t.abytes)(A),o(S),A.length>255&&(A=I((0,t.concatBytes)((0,t.utf8ToBytes)("H2C-OVERSIZE-DST-"),A)));const{outputLen:_,blockLen:R}=I,N=Math.ceil(S/_);if(S>65535||N>255)throw new Error("expand_message_xmd: invalid lenInBytes");const D=(0,t.concatBytes)(A,s(A.length,1)),M=s(0,R),W=s(S,2),B=new Array(N),U=I((0,t.concatBytes)(M,E,W,s(0,1),D));B[0]=I((0,t.concatBytes)(U,s(1,1),D));for(let F=1;F<=N;F++){const j=[a(U,B[F-1]),s(F+1,1),D];B[F]=I((0,t.concatBytes)(...j))}return(0,t.concatBytes)(...B).slice(0,S)}function p(E,A,S,I,_){if((0,t.abytes)(E),(0,t.abytes)(A),o(S),A.length>255){const R=Math.ceil(2*I/8);A=_.create({dkLen:R}).update((0,t.utf8ToBytes)("H2C-OVERSIZE-DST-")).update(A).digest()}if(S>65535||A.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return _.create({dkLen:S}).update(E).update(s(S,2)).update(A).update(s(A.length,1)).digest()}function y(E,A,S){(0,t.validateObject)(S,{DST:"stringOrUint8Array",p:"bigint",m:"isSafeInteger",k:"isSafeInteger",hash:"hash"});const{p:I,k:_,m:R,hash:N,expand:D,DST:M}=S;(0,t.abytes)(E),o(A);const W=typeof M=="string"?(0,t.utf8ToBytes)(M):M,B=I.toString(2).length,U=Math.ceil((B+_)/8),P=A*R*U;let F;if(D==="xmd")F=f(E,W,P,N);else if(D==="xof")F=p(E,W,P,_,N);else if(D==="_internal_pass")F=E;else throw new Error('expand must be "xmd" or "xof"');const j=new Array(A);for(let Q=0;Q<A;Q++){const $=new Array(R);for(let V=0;V<R;V++){const G=U*(V+Q*R),se=F.subarray(G,G+U);$[V]=(0,n.mod)(e(se),I)}j[Q]=$}return j}function g(E,A){const S=A.map(I=>Array.from(I).reverse());return(I,_)=>{const[R,N,D,M]=S.map(U=>U.reduce((P,F)=>E.add(E.mul(P,I),F))),[W,B]=(0,n.FpInvertBatch)(E,[N,M],!0);return I=E.mul(R,W),_=E.mul(_,E.mul(D,B)),{x:I,y:_}}}function x(E,A,S){if(typeof A!="function")throw new Error("mapToCurve() must be defined");function I(R){return E.fromAffine(A(R))}function _(R){const N=R.clearCofactor();return N.equals(E.ZERO)?E.ZERO:(N.assertValidity(),N)}return{defaults:S,hashToCurve(R,N){const D=y(R,2,{...S,DST:S.DST,...N}),M=I(D[0]),W=I(D[1]);return _(M.add(W))},encodeToCurve(R,N){const D=y(R,1,{...S,DST:S.encodeDST,...N});return _(I(D[0]))},mapToCurve(R){if(!Array.isArray(R))throw new Error("expected array of bigints");for(const N of R)if(typeof N!="bigint")throw new Error("expected array of bigints");return _(I(R))}}}return hashToCurve}var hasRequiredSecp256k1;function requireSecp256k1(){return hasRequiredSecp256k1||(hasRequiredSecp256k1=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.encodeToCurve=n.hashToCurve=n.secp256k1_hasher=n.schnorr=n.secp256k1=void 0;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const t=requireSha2(),e=requireUtils$2(),s=require_shortw_utils(),a=requireHashToCurve(),o=requireModular(),f=requireUtils$1(),p=requireWeierstrass(),y=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),g=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),x=BigInt(1),E=BigInt(2),A=(K,ie)=>(K+ie/E)/ie;function S(K){const ie=y,ne=BigInt(3),re=BigInt(6),X=BigInt(11),ae=BigInt(22),te=BigInt(23),ce=BigInt(44),xe=BigInt(88),me=K*K*K%ie,Se=me*me*K%ie,be=(0,o.pow2)(Se,ne,ie)*Se%ie,Me=(0,o.pow2)(be,ne,ie)*Se%ie,Oe=(0,o.pow2)(Me,E,ie)*me%ie,Ue=(0,o.pow2)(Oe,X,ie)*Oe%ie,je=(0,o.pow2)(Ue,ae,ie)*Ue%ie,Pe=(0,o.pow2)(je,ce,ie)*je%ie,We=(0,o.pow2)(Pe,xe,ie)*Pe%ie,Ze=(0,o.pow2)(We,ce,ie)*je%ie,ot=(0,o.pow2)(Ze,ne,ie)*Se%ie,st=(0,o.pow2)(ot,te,ie)*Ue%ie,nt=(0,o.pow2)(st,re,ie)*me%ie,tt=(0,o.pow2)(nt,E,ie);if(!I.eql(I.sqr(tt),K))throw new Error("Cannot find square root");return tt}const I=(0,o.Field)(y,void 0,void 0,{sqrt:S});n.secp256k1=(0,s.createCurve)({a:BigInt(0),b:BigInt(7),Fp:I,n:g,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:K=>{const ie=g,ne=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),re=-x*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),X=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),ae=ne,te=BigInt("0x100000000000000000000000000000000"),ce=A(ae*K,ie),xe=A(-re*K,ie);let me=(0,o.mod)(K-ce*ne-xe*X,ie),Se=(0,o.mod)(-ce*re-xe*ae,ie);const be=me>te,Me=Se>te;if(be&&(me=ie-me),Me&&(Se=ie-Se),me>te||Se>te)throw new Error("splitScalar: Endomorphism failed, k="+K);return{k1neg:be,k1:me,k2neg:Me,k2:Se}}}},t.sha256);const _=BigInt(0),R={};function N(K,...ie){let ne=R[K];if(ne===void 0){const re=(0,t.sha256)(Uint8Array.from(K,X=>X.charCodeAt(0)));ne=(0,f.concatBytes)(re,re),R[K]=ne}return(0,t.sha256)((0,f.concatBytes)(ne,...ie))}const D=K=>K.toRawBytes(!0).slice(1),M=K=>(0,f.numberToBytesBE)(K,32),W=K=>(0,o.mod)(K,y),B=K=>(0,o.mod)(K,g),U=n.secp256k1.ProjectivePoint,P=(K,ie,ne)=>U.BASE.multiplyAndAddUnsafe(K,ie,ne);function F(K){let ie=n.secp256k1.utils.normPrivateKeyToScalar(K),ne=U.fromPrivateKey(ie);return{scalar:ne.hasEvenY()?ie:B(-ie),bytes:D(ne)}}function j(K){(0,f.aInRange)("x",K,x,y);const ie=W(K*K),ne=W(ie*K+BigInt(7));let re=S(ne);re%E!==_&&(re=W(-re));const X=new U(K,re,x);return X.assertValidity(),X}const Q=f.bytesToNumberBE;function $(...K){return B(Q(N("BIP0340/challenge",...K)))}function V(K){return F(K).bytes}function G(K,ie,ne=(0,e.randomBytes)(32)){const re=(0,f.ensureBytes)("message",K),{bytes:X,scalar:ae}=F(ie),te=(0,f.ensureBytes)("auxRand",ne,32),ce=M(ae^Q(N("BIP0340/aux",te))),xe=N("BIP0340/nonce",ce,X,re),me=B(Q(xe));if(me===_)throw new Error("sign failed: k is zero");const{bytes:Se,scalar:be}=F(me),Me=$(Se,X,re),Oe=new Uint8Array(64);if(Oe.set(Se,0),Oe.set(M(B(be+Me*ae)),32),!se(Oe,re,X))throw new Error("sign: Invalid signature produced");return Oe}function se(K,ie,ne){const re=(0,f.ensureBytes)("signature",K,64),X=(0,f.ensureBytes)("message",ie),ae=(0,f.ensureBytes)("publicKey",ne,32);try{const te=j(Q(ae)),ce=Q(re.subarray(0,32));if(!(0,f.inRange)(ce,x,y))return!1;const xe=Q(re.subarray(32,64));if(!(0,f.inRange)(xe,x,g))return!1;const me=$(M(ce),D(te),X),Se=P(te,xe,B(-me));return!(!Se||!Se.hasEvenY()||Se.toAffine().x!==ce)}catch{return!1}}n.schnorr={getPublicKey:V,sign:G,verify:se,utils:{randomPrivateKey:n.secp256k1.utils.randomPrivateKey,lift_x:j,pointToBytes:D,numberToBytesBE:f.numberToBytesBE,bytesToNumberBE:f.bytesToNumberBE,taggedHash:N,mod:o.mod}};const H=(0,a.isogenyMap)(I,[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(K=>K.map(ie=>BigInt(ie)))),J=(0,p.mapToCurveSimpleSWU)(I,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:I.create(BigInt("-11"))});n.secp256k1_hasher=(0,a.createHasher)(n.secp256k1.ProjectivePoint,K=>{const{x:ie,y:ne}=J(I.create(K[0]));return H(ie,ne)},{DST:"secp256k1_XMD:SHA-256_SSWU_RO_",encodeDST:"secp256k1_XMD:SHA-256_SSWU_NU_",p:I.ORDER,m:1,k:128,expand:"xmd",hash:t.sha256}),n.hashToCurve=n.secp256k1_hasher.hashToCurve,n.encodeToCurve=n.secp256k1_hasher.encodeToCurve}(secp256k1)),secp256k1}var sha256={},hasRequiredSha256;function requireSha256(){if(hasRequiredSha256)return sha256;hasRequiredSha256=1,Object.defineProperty(sha256,"__esModule",{value:!0}),sha256.sha224=sha256.SHA224=sha256.sha256=sha256.SHA256=void 0;const n=requireSha2();return sha256.SHA256=n.SHA256,sha256.sha256=n.sha256,sha256.SHA224=n.SHA224,sha256.sha224=n.sha224,sha256}var utils={},hasRequiredUtils;function requireUtils(){if(hasRequiredUtils)return utils;hasRequiredUtils=1,Object.defineProperty(utils,"__esModule",{value:!0}),utils.encodeBase64toUint8=utils.hexToNumber=utils.bytesToNumber=void 0;const n=requireUtils$1(),t=requireBuffer();function e(o){return s((0,n.bytesToHex)(o))}utils.bytesToNumber=e;function s(o){return BigInt(`0x${o}`)}utils.hexToNumber=s;function a(o){return t.Buffer.from(o,"base64")}return utils.encodeBase64toUint8=a,utils}var hasRequiredCommon;function requireCommon(){if(hasRequiredCommon)return common;hasRequiredCommon=1,Object.defineProperty(common,"__esModule",{value:!0}),common.deriveKeysetId=common.deserializeMintKeys=common.serializeMintKeys=common.createRandomPrivateKey=common.getKeysetIdInt=common.pointFromHex=common.hashToCurve=void 0;const n=requireSecp256k1(),t=requireSha256(),e=requireUtils$1(),s=requireUtils(),a=requireBuffer(),o=(0,e.hexToBytes)("536563703235366b315f48617368546f43757276655f43617368755f");function f(I){const _=(0,t.sha256)(a.Buffer.concat([o,I])),R=new Uint32Array(1),N=2**16;for(let D=0;D<N;D++){const M=new Uint8Array(R.buffer),W=(0,t.sha256)(a.Buffer.concat([_,M]));try{return p((0,e.bytesToHex)(a.Buffer.concat([new Uint8Array([2]),W])))}catch{R[0]++}}throw new Error("No valid point found")}common.hashToCurve=f;function p(I){return n.secp256k1.ProjectivePoint.fromHex(I)}common.pointFromHex=p;const y=I=>{let _;return/^[a-fA-F0-9]+$/.test(I)?_=(0,s.hexToNumber)(I)%BigInt(2**31-1):_=(0,s.bytesToNumber)((0,s.encodeBase64toUint8)(I))%BigInt(2**31-1),_};common.getKeysetIdInt=y;function g(){return n.secp256k1.utils.randomPrivateKey()}common.createRandomPrivateKey=g;function x(I){const _={};return Object.keys(I).forEach(R=>{_[R]=(0,e.bytesToHex)(I[R])}),_}common.serializeMintKeys=x;function E(I){const _={};return Object.keys(I).forEach(R=>{_[R]=(0,e.hexToBytes)(I[R])}),_}common.deserializeMintKeys=E;function A(I){const _=M=>[BigInt(M[0]),M[1]],R=Object.entries(x(I)).map(_).sort((M,W)=>M[0]<W[0]?-1:M[0]>W[0]?1:0).map(([,M])=>(0,e.hexToBytes)(M)).reduce((M,W)=>S(M,W),new Uint8Array),N=(0,t.sha256)(R);return"00"+a.Buffer.from(N).toString("hex").slice(0,14)}common.deriveKeysetId=A;function S(I,_){const R=new Uint8Array(I.length+_.length);return R.set(I),R.set(_,I.length),R}return common}var commonExports=requireCommon(),client={},hasRequiredClient;function requireClient(){if(hasRequiredClient)return client;hasRequiredClient=1,Object.defineProperty(client,"__esModule",{value:!0}),client.serializeBlindedMessage=client.deserializeProof=client.serializeProof=client.constructProofFromPromise=client.unblindSignature=client.blindMessage=client.createRandomBlindedMessage=void 0;const n=requireSecp256k1(),t=requireUtils$2(),e=requireUtils(),s=requireCommon();function a(){return o((0,t.randomBytes)(32))}client.createRandomBlindedMessage=a;function o(E,A){const S=(0,s.hashToCurve)(E);A||(A=(0,e.bytesToNumber)(n.secp256k1.utils.randomPrivateKey()));const I=n.secp256k1.ProjectivePoint.BASE.multiply(A);return{B_:S.add(I),r:A,secret:E}}client.blindMessage=o;function f(E,A,S){return E.subtract(S.multiply(A))}client.unblindSignature=f;function p(E,A,S,I){const _=I,R=f(E.C_,A,_);return{id:E.id,amount:E.amount,secret:S,C:R}}client.constructProofFromPromise=p;const y=E=>({amount:E.amount,C:E.C.toHex(!0),id:E.id,secret:new TextDecoder().decode(E.secret),witness:JSON.stringify(E.witness)});client.serializeProof=y;const g=E=>({amount:E.amount,C:(0,s.pointFromHex)(E.C),id:E.id,secret:new TextEncoder().encode(E.secret),witness:E.witness?JSON.parse(E.witness):void 0});client.deserializeProof=g;const x=(E,A)=>({B_:E.B_.toHex(!0),amount:A});return client.serializeBlindedMessage=x,client}var clientExports=requireClient(),NUT09={},lib$1={},legacy={},hasRequiredLegacy;function requireLegacy(){if(hasRequiredLegacy)return legacy;hasRequiredLegacy=1,Object.defineProperty(legacy,"__esModule",{value:!0}),legacy.ripemd160=legacy.RIPEMD160=legacy.md5=legacy.MD5=legacy.sha1=legacy.SHA1=void 0;const n=require_md(),t=requireUtils$2(),e=Uint32Array.from([1732584193,4023233417,2562383102,271733878,3285377520]),s=new Uint32Array(80);class a extends n.HashMD{constructor(){super(64,20,8,!1),this.A=e[0]|0,this.B=e[1]|0,this.C=e[2]|0,this.D=e[3]|0,this.E=e[4]|0}get(){const{A:j,B:Q,C:$,D:V,E:G}=this;return[j,Q,$,V,G]}set(j,Q,$,V,G){this.A=j|0,this.B=Q|0,this.C=$|0,this.D=V|0,this.E=G|0}process(j,Q){for(let J=0;J<16;J++,Q+=4)s[J]=j.getUint32(Q,!1);for(let J=16;J<80;J++)s[J]=(0,t.rotl)(s[J-3]^s[J-8]^s[J-14]^s[J-16],1);let{A:$,B:V,C:G,D:se,E:H}=this;for(let J=0;J<80;J++){let K,ie;J<20?(K=(0,n.Chi)(V,G,se),ie=1518500249):J<40?(K=V^G^se,ie=1859775393):J<60?(K=(0,n.Maj)(V,G,se),ie=2400959708):(K=V^G^se,ie=3395469782);const ne=(0,t.rotl)($,5)+K+H+ie+s[J]|0;H=se,se=G,G=(0,t.rotl)(V,30),V=$,$=ne}$=$+this.A|0,V=V+this.B|0,G=G+this.C|0,se=se+this.D|0,H=H+this.E|0,this.set($,V,G,se,H)}roundClean(){(0,t.clean)(s)}destroy(){this.set(0,0,0,0,0),(0,t.clean)(this.buffer)}}legacy.SHA1=a,legacy.sha1=(0,t.createHasher)(()=>new a);const o=Math.pow(2,32),f=Array.from({length:64},(F,j)=>Math.floor(o*Math.abs(Math.sin(j+1)))),p=e.slice(0,4),y=new Uint32Array(16);class g extends n.HashMD{constructor(){super(64,16,8,!0),this.A=p[0]|0,this.B=p[1]|0,this.C=p[2]|0,this.D=p[3]|0}get(){const{A:j,B:Q,C:$,D:V}=this;return[j,Q,$,V]}set(j,Q,$,V){this.A=j|0,this.B=Q|0,this.C=$|0,this.D=V|0}process(j,Q){for(let H=0;H<16;H++,Q+=4)y[H]=j.getUint32(Q,!0);let{A:$,B:V,C:G,D:se}=this;for(let H=0;H<64;H++){let J,K,ie;H<16?(J=(0,n.Chi)(V,G,se),K=H,ie=[7,12,17,22]):H<32?(J=(0,n.Chi)(se,V,G),K=(5*H+1)%16,ie=[5,9,14,20]):H<48?(J=V^G^se,K=(3*H+5)%16,ie=[4,11,16,23]):(J=G^(V|~se),K=7*H%16,ie=[6,10,15,21]),J=J+$+f[H]+y[K],$=se,se=G,G=V,V=V+(0,t.rotl)(J,ie[H%4])}$=$+this.A|0,V=V+this.B|0,G=G+this.C|0,se=se+this.D|0,this.set($,V,G,se)}roundClean(){(0,t.clean)(y)}destroy(){this.set(0,0,0,0),(0,t.clean)(this.buffer)}}legacy.MD5=g,legacy.md5=(0,t.createHasher)(()=>new g);const x=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),E=Uint8Array.from(new Array(16).fill(0).map((F,j)=>j)),A=E.map(F=>(9*F+5)%16),S=(()=>{const Q=[[E],[A]];for(let $=0;$<4;$++)for(let V of Q)V.push(V[$].map(G=>x[G]));return Q})(),I=S[0],_=S[1],R=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(F=>Uint8Array.from(F)),N=I.map((F,j)=>F.map(Q=>R[j][Q])),D=_.map((F,j)=>F.map(Q=>R[j][Q])),M=Uint32Array.from([0,1518500249,1859775393,2400959708,2840853838]),W=Uint32Array.from([1352829926,1548603684,1836072691,2053994217,0]);function B(F,j,Q,$){return F===0?j^Q^$:F===1?j&Q|~j&$:F===2?(j|~Q)^$:F===3?j&$|Q&~$:j^(Q|~$)}const U=new Uint32Array(16);class P extends n.HashMD{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:j,h1:Q,h2:$,h3:V,h4:G}=this;return[j,Q,$,V,G]}set(j,Q,$,V,G){this.h0=j|0,this.h1=Q|0,this.h2=$|0,this.h3=V|0,this.h4=G|0}process(j,Q){for(let X=0;X<16;X++,Q+=4)U[X]=j.getUint32(Q,!0);let $=this.h0|0,V=$,G=this.h1|0,se=G,H=this.h2|0,J=H,K=this.h3|0,ie=K,ne=this.h4|0,re=ne;for(let X=0;X<5;X++){const ae=4-X,te=M[X],ce=W[X],xe=I[X],me=_[X],Se=N[X],be=D[X];for(let Me=0;Me<16;Me++){const Oe=(0,t.rotl)($+B(X,G,H,K)+U[xe[Me]]+te,Se[Me])+ne|0;$=ne,ne=K,K=(0,t.rotl)(H,10)|0,H=G,G=Oe}for(let Me=0;Me<16;Me++){const Oe=(0,t.rotl)(V+B(ae,se,J,ie)+U[me[Me]]+ce,be[Me])+re|0;V=re,re=ie,ie=(0,t.rotl)(J,10)|0,J=se,se=Oe}}this.set(this.h1+H+ie|0,this.h2+K+re|0,this.h3+ne+V|0,this.h4+$+se|0,this.h0+G+J|0)}roundClean(){(0,t.clean)(U)}destroy(){this.destroyed=!0,(0,t.clean)(this.buffer),this.set(0,0,0,0,0)}}return legacy.RIPEMD160=P,legacy.ripemd160=(0,t.createHasher)(()=>new P),legacy}var lib={},hasRequiredLib$1;function requireLib$1(){return hasRequiredLib$1||(hasRequiredLib$1=1,function(n){/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(n,"__esModule",{value:!0}),n.bytes=n.stringToBytes=n.str=n.bytesToString=n.hex=n.utf8=n.bech32m=n.bech32=n.base58check=n.createBase58check=n.base58xmr=n.base58xrp=n.base58flickr=n.base58=n.base64urlnopad=n.base64url=n.base64nopad=n.base64=n.base32crockford=n.base32hexnopad=n.base32hex=n.base32nopad=n.base32=n.base16=n.utils=void 0;function t(te){return te instanceof Uint8Array||ArrayBuffer.isView(te)&&te.constructor.name==="Uint8Array"}function e(te,...ce){if(!t(te))throw new Error("Uint8Array expected");if(ce.length>0&&!ce.includes(te.length))throw new Error("Uint8Array expected of length "+ce+", got length="+te.length)}function s(te,ce){return Array.isArray(ce)?ce.length===0?!0:te?ce.every(xe=>typeof xe=="string"):ce.every(xe=>Number.isSafeInteger(xe)):!1}function a(te){if(typeof te!="function")throw new Error("function expected");return!0}function o(te,ce){if(typeof ce!="string")throw new Error(`${te}: string expected`);return!0}function f(te){if(!Number.isSafeInteger(te))throw new Error(`invalid integer: ${te}`)}function p(te){if(!Array.isArray(te))throw new Error("array expected")}function y(te,ce){if(!s(!0,ce))throw new Error(`${te}: array of strings expected`)}function g(te,ce){if(!s(!1,ce))throw new Error(`${te}: array of numbers expected`)}function x(...te){const ce=be=>be,xe=(be,Me)=>Oe=>be(Me(Oe)),me=te.map(be=>be.encode).reduceRight(xe,ce),Se=te.map(be=>be.decode).reduce(xe,ce);return{encode:me,decode:Se}}function E(te){const ce=typeof te=="string"?te.split(""):te,xe=ce.length;y("alphabet",ce);const me=new Map(ce.map((Se,be)=>[Se,be]));return{encode:Se=>(p(Se),Se.map(be=>{if(!Number.isSafeInteger(be)||be<0||be>=xe)throw new Error(`alphabet.encode: digit index outside alphabet "${be}". Allowed: ${te}`);return ce[be]})),decode:Se=>(p(Se),Se.map(be=>{o("alphabet.decode",be);const Me=me.get(be);if(Me===void 0)throw new Error(`Unknown letter: "${be}". Allowed: ${te}`);return Me}))}}function A(te=""){return o("join",te),{encode:ce=>(y("join.decode",ce),ce.join(te)),decode:ce=>(o("join.decode",ce),ce.split(te))}}function S(te,ce="="){return f(te),o("padding",ce),{encode(xe){for(y("padding.encode",xe);xe.length*te%8;)xe.push(ce);return xe},decode(xe){y("padding.decode",xe);let me=xe.length;if(me*te%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;me>0&&xe[me-1]===ce;me--)if((me-1)*te%8===0)throw new Error("padding: invalid, string has too much padding");return xe.slice(0,me)}}}function I(te){return a(te),{encode:ce=>ce,decode:ce=>te(ce)}}function _(te,ce,xe){if(ce<2)throw new Error(`convertRadix: invalid from=${ce}, base cannot be less than 2`);if(xe<2)throw new Error(`convertRadix: invalid to=${xe}, base cannot be less than 2`);if(p(te),!te.length)return[];let me=0;const Se=[],be=Array.from(te,Oe=>{if(f(Oe),Oe<0||Oe>=ce)throw new Error(`invalid integer: ${Oe}`);return Oe}),Me=be.length;for(;;){let Oe=0,Ue=!0;for(let je=me;je<Me;je++){const Pe=be[je],We=ce*Oe,Ze=We+Pe;if(!Number.isSafeInteger(Ze)||We/ce!==Oe||Ze-Pe!==We)throw new Error("convertRadix: carry overflow");const ot=Ze/xe;Oe=Ze%xe;const st=Math.floor(ot);if(be[je]=st,!Number.isSafeInteger(st)||st*xe+Oe!==Ze)throw new Error("convertRadix: carry overflow");if(Ue)st?Ue=!1:me=je;else continue}if(Se.push(Oe),Ue)break}for(let Oe=0;Oe<te.length-1&&te[Oe]===0;Oe++)Se.push(0);return Se.reverse()}const R=(te,ce)=>ce===0?te:R(ce,te%ce),N=(te,ce)=>te+(ce-R(te,ce)),D=(()=>{let te=[];for(let ce=0;ce<40;ce++)te.push(2**ce);return te})();function M(te,ce,xe,me){if(p(te),ce<=0||ce>32)throw new Error(`convertRadix2: wrong from=${ce}`);if(xe<=0||xe>32)throw new Error(`convertRadix2: wrong to=${xe}`);if(N(ce,xe)>32)throw new Error(`convertRadix2: carry overflow from=${ce} to=${xe} carryBits=${N(ce,xe)}`);let Se=0,be=0;const Me=D[ce],Oe=D[xe]-1,Ue=[];for(const je of te){if(f(je),je>=Me)throw new Error(`convertRadix2: invalid data word=${je} from=${ce}`);if(Se=Se<<ce|je,be+ce>32)throw new Error(`convertRadix2: carry overflow pos=${be} from=${ce}`);for(be+=ce;be>=xe;be-=xe)Ue.push((Se>>be-xe&Oe)>>>0);const Pe=D[be];if(Pe===void 0)throw new Error("invalid carry");Se&=Pe-1}if(Se=Se<<xe-be&Oe,!me&&be>=ce)throw new Error("Excess padding");if(!me&&Se>0)throw new Error(`Non-zero padding: ${Se}`);return me&&be>0&&Ue.push(Se>>>0),Ue}function W(te){f(te);const ce=2**8;return{encode:xe=>{if(!t(xe))throw new Error("radix.encode input should be Uint8Array");return _(Array.from(xe),ce,te)},decode:xe=>(g("radix.decode",xe),Uint8Array.from(_(xe,te,ce)))}}function B(te,ce=!1){if(f(te),te<=0||te>32)throw new Error("radix2: bits should be in (0..32]");if(N(8,te)>32||N(te,8)>32)throw new Error("radix2: carry overflow");return{encode:xe=>{if(!t(xe))throw new Error("radix2.encode input should be Uint8Array");return M(Array.from(xe),8,te,!ce)},decode:xe=>(g("radix2.decode",xe),Uint8Array.from(M(xe,te,8,ce)))}}function U(te){return a(te),function(...ce){try{return te.apply(null,ce)}catch{}}}function P(te,ce){return f(te),a(ce),{encode(xe){if(!t(xe))throw new Error("checksum.encode: input should be Uint8Array");const me=ce(xe).slice(0,te),Se=new Uint8Array(xe.length+te);return Se.set(xe),Se.set(me,xe.length),Se},decode(xe){if(!t(xe))throw new Error("checksum.decode: input should be Uint8Array");const me=xe.slice(0,-te),Se=xe.slice(-te),be=ce(me).slice(0,te);for(let Me=0;Me<te;Me++)if(be[Me]!==Se[Me])throw new Error("Invalid checksum");return me}}}n.utils={alphabet:E,chain:x,checksum:P,convertRadix:_,convertRadix2:M,radix:W,radix2:B,join:A,padding:S},n.base16=x(B(4),E("0123456789ABCDEF"),A("")),n.base32=x(B(5),E("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),S(5),A("")),n.base32nopad=x(B(5),E("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),A("")),n.base32hex=x(B(5),E("0123456789ABCDEFGHIJKLMNOPQRSTUV"),S(5),A("")),n.base32hexnopad=x(B(5),E("0123456789ABCDEFGHIJKLMNOPQRSTUV"),A("")),n.base32crockford=x(B(5),E("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),A(""),I(te=>te.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const F=typeof Uint8Array.from([]).toBase64=="function"&&typeof Uint8Array.fromBase64=="function";n.base64=F?{encode(te){return e(te),te.toBase64()},decode(te){return o("base64",te),Uint8Array.fromBase64(te,{lastChunkHandling:"strict"})}}:x(B(6),E("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),S(6),A("")),n.base64nopad=x(B(6),E("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),A("")),n.base64url=F?{encode(te){return e(te),te.toBase64({alphabet:"base64url"})},decode(te){return o("base64",te),Uint8Array.fromBase64(te,{alphabet:"base64url"})}}:x(B(6),E("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),S(6),A("")),n.base64urlnopad=x(B(6),E("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),A(""));const j=te=>x(W(58),E(te),A(""));n.base58=j("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),n.base58flickr=j("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),n.base58xrp=j("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Q=[0,2,3,5,6,7,9,10,11];n.base58xmr={encode(te){let ce="";for(let xe=0;xe<te.length;xe+=8){const me=te.subarray(xe,xe+8);ce+=n.base58.encode(me).padStart(Q[me.length],"1")}return ce},decode(te){let ce=[];for(let xe=0;xe<te.length;xe+=11){const me=te.slice(xe,xe+11),Se=Q.indexOf(me.length),be=n.base58.decode(me);for(let Me=0;Me<be.length-Se;Me++)if(be[Me]!==0)throw new Error("base58xmr: wrong padding");ce=ce.concat(Array.from(be.slice(be.length-Se)))}return Uint8Array.from(ce)}};const $=te=>x(P(4,ce=>te(te(ce))),n.base58);n.createBase58check=$,n.base58check=n.createBase58check;const V=x(E("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),A("")),G=[996825010,642813549,513874426,1027748829,705979059];function se(te){const ce=te>>25;let xe=(te&33554431)<<5;for(let me=0;me<G.length;me++)(ce>>me&1)===1&&(xe^=G[me]);return xe}function H(te,ce,xe=1){const me=te.length;let Se=1;for(let be=0;be<me;be++){const Me=te.charCodeAt(be);if(Me<33||Me>126)throw new Error(`Invalid prefix (${te})`);Se=se(Se)^Me>>5}Se=se(Se);for(let be=0;be<me;be++)Se=se(Se)^te.charCodeAt(be)&31;for(let be of ce)Se=se(Se)^be;for(let be=0;be<6;be++)Se=se(Se);return Se^=xe,V.encode(M([Se%D[30]],30,5,!1))}function J(te){const ce=te==="bech32"?1:734539939,xe=B(5),me=xe.decode,Se=xe.encode,be=U(me);function Me(We,Ze,ot=90){o("bech32.encode prefix",We),t(Ze)&&(Ze=Array.from(Ze)),g("bech32.encode",Ze);const st=We.length;if(st===0)throw new TypeError(`Invalid prefix length ${st}`);const nt=st+7+Ze.length;if(ot!==!1&&nt>ot)throw new TypeError(`Length ${nt} exceeds limit ${ot}`);const tt=We.toLowerCase(),bt=H(tt,Ze,ce);return`${tt}1${V.encode(Ze)}${bt}`}function Oe(We,Ze=90){o("bech32.decode input",We);const ot=We.length;if(ot<8||Ze!==!1&&ot>Ze)throw new TypeError(`invalid string length: ${ot} (${We}). Expected (8..${Ze})`);const st=We.toLowerCase();if(We!==st&&We!==We.toUpperCase())throw new Error("String must be lowercase or uppercase");const nt=st.lastIndexOf("1");if(nt===0||nt===-1)throw new Error('Letter "1" must be present between prefix and data only');const tt=st.slice(0,nt),bt=st.slice(nt+1);if(bt.length<6)throw new Error("Data must be at least 6 characters long");const qe=V.decode(bt).slice(0,-6),Et=H(tt,qe,ce);if(!bt.endsWith(Et))throw new Error(`Invalid checksum in ${We}: expected "${Et}"`);return{prefix:tt,words:qe}}const Ue=U(Oe);function je(We){const{prefix:Ze,words:ot}=Oe(We,!1);return{prefix:Ze,words:ot,bytes:me(ot)}}function Pe(We,Ze){return Me(We,Se(Ze))}return{encode:Me,decode:Oe,encodeFromBytes:Pe,decodeToBytes:je,decodeUnsafe:Ue,fromWords:me,fromWordsUnsafe:be,toWords:Se}}n.bech32=J("bech32"),n.bech32m=J("bech32m"),n.utf8={encode:te=>new TextDecoder().decode(te),decode:te=>new TextEncoder().encode(te)};const K=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",ie={encode(te){return e(te),te.toHex()},decode(te){return o("hex",te),Uint8Array.fromHex(te)}};n.hex=K?ie:x(B(4),E("0123456789abcdef"),A(""),I(te=>{if(typeof te!="string"||te.length%2!==0)throw new TypeError(`hex.decode: expected string, got ${typeof te} with length ${te.length}`);return te.toLowerCase()}));const ne={utf8:n.utf8,hex:n.hex,base16:n.base16,base32:n.base32,base64:n.base64,base64url:n.base64url,base58:n.base58,base58xmr:n.base58xmr},re="Invalid encoding type. Available types: utf8, hex, base16, base32, base64, base64url, base58, base58xmr",X=(te,ce)=>{if(typeof te!="string"||!ne.hasOwnProperty(te))throw new TypeError(re);if(!t(ce))throw new TypeError("bytesToString() expects Uint8Array");return ne[te].encode(ce)};n.bytesToString=X,n.str=n.bytesToString;const ae=(te,ce)=>{if(!ne.hasOwnProperty(te))throw new TypeError(re);if(typeof ce!="string")throw new TypeError("stringToBytes() expects string");return ne[te].decode(ce)};n.stringToBytes=ae,n.bytes=n.stringToBytes}(lib)),lib}var hasRequiredLib;function requireLib(){return hasRequiredLib||(hasRequiredLib=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.HDKey=n.HARDENED_OFFSET=void 0;/*! scure-bip32 - MIT License (c) 2022 Patricio Palladino, Paul Miller (paulmillr.com) */const t=requireModular(),e=requireSecp256k1(),s=requireHmac(),a=requireLegacy(),o=requireSha2(),f=requireUtils$2(),p=requireLib$1(),y=e.secp256k1.ProjectivePoint,g=(0,p.createBase58check)(o.sha256);function x(D){(0,f.abytes)(D);const M=D.length===0?"0":(0,f.bytesToHex)(D);return BigInt("0x"+M)}function E(D){if(typeof D!="bigint")throw new Error("bigint expected");return(0,f.hexToBytes)(D.toString(16).padStart(64,"0"))}const A=(0,f.utf8ToBytes)("Bitcoin seed"),S={private:76066276,public:76067358};n.HARDENED_OFFSET=2147483648;const I=D=>(0,a.ripemd160)((0,o.sha256)(D)),_=D=>(0,f.createView)(D).getUint32(0,!1),R=D=>{if(!Number.isSafeInteger(D)||D<0||D>2**32-1)throw new Error("invalid number, should be from 0 to 2**32-1, got "+D);const M=new Uint8Array(4);return(0,f.createView)(M).setUint32(0,D,!1),M};class N{get fingerprint(){if(!this.pubHash)throw new Error("No publicKey set!");return _(this.pubHash)}get identifier(){return this.pubHash}get pubKeyHash(){return this.pubHash}get privateKey(){return this.privKeyBytes||null}get publicKey(){return this.pubKey||null}get privateExtendedKey(){const M=this.privateKey;if(!M)throw new Error("No private key");return g.encode(this.serialize(this.versions.private,(0,f.concatBytes)(new Uint8Array([0]),M)))}get publicExtendedKey(){if(!this.pubKey)throw new Error("No public key");return g.encode(this.serialize(this.versions.public,this.pubKey))}static fromMasterSeed(M,W=S){if((0,f.abytes)(M),8*M.length<128||8*M.length>512)throw new Error("HDKey: seed length must be between 128 and 512 bits; 256 bits is advised, got "+M.length);const B=(0,s.hmac)(o.sha512,A,M);return new N({versions:W,chainCode:B.slice(32),privateKey:B.slice(0,32)})}static fromExtendedKey(M,W=S){const B=g.decode(M),U=(0,f.createView)(B),P=U.getUint32(0,!1),F={versions:W,depth:B[4],parentFingerprint:U.getUint32(5,!1),index:U.getUint32(9,!1),chainCode:B.slice(13,45)},j=B.slice(45),Q=j[0]===0;if(P!==W[Q?"private":"public"])throw new Error("Version mismatch");return Q?new N({...F,privateKey:j.slice(1)}):new N({...F,publicKey:j})}static fromJSON(M){return N.fromExtendedKey(M.xpriv)}constructor(M){if(this.depth=0,this.index=0,this.chainCode=null,this.parentFingerprint=0,!M||typeof M!="object")throw new Error("HDKey.constructor must not be called directly");if(this.versions=M.versions||S,this.depth=M.depth||0,this.chainCode=M.chainCode||null,this.index=M.index||0,this.parentFingerprint=M.parentFingerprint||0,!this.depth&&(this.parentFingerprint||this.index))throw new Error("HDKey: zero depth with non-zero index/parent fingerprint");if(M.publicKey&&M.privateKey)throw new Error("HDKey: publicKey and privateKey at same time.");if(M.privateKey){if(!e.secp256k1.utils.isValidPrivateKey(M.privateKey))throw new Error("Invalid private key");this.privKey=typeof M.privateKey=="bigint"?M.privateKey:x(M.privateKey),this.privKeyBytes=E(this.privKey),this.pubKey=e.secp256k1.getPublicKey(M.privateKey,!0)}else if(M.publicKey)this.pubKey=y.fromHex(M.publicKey).toRawBytes(!0);else throw new Error("HDKey: no public or private key provided");this.pubHash=I(this.pubKey)}derive(M){if(!/^[mM]'?/.test(M))throw new Error('Path must start with "m" or "M"');if(/^[mM]'?$/.test(M))return this;const W=M.replace(/^[mM]'?\//,"").split("/");let B=this;for(const U of W){const P=/^(\d+)('?)$/.exec(U),F=P&&P[1];if(!P||P.length!==3||typeof F!="string")throw new Error("invalid child index: "+U);let j=+F;if(!Number.isSafeInteger(j)||j>=n.HARDENED_OFFSET)throw new Error("Invalid index");P[2]==="'"&&(j+=n.HARDENED_OFFSET),B=B.deriveChild(j)}return B}deriveChild(M){if(!this.pubKey||!this.chainCode)throw new Error("No publicKey or chainCode set");let W=R(M);if(M>=n.HARDENED_OFFSET){const j=this.privateKey;if(!j)throw new Error("Could not derive hardened child key");W=(0,f.concatBytes)(new Uint8Array([0]),j,W)}else W=(0,f.concatBytes)(this.pubKey,W);const B=(0,s.hmac)(o.sha512,this.chainCode,W),U=x(B.slice(0,32)),P=B.slice(32);if(!e.secp256k1.utils.isValidPrivateKey(U))throw new Error("Tweak bigger than curve order");const F={versions:this.versions,chainCode:P,depth:this.depth+1,parentFingerprint:this.fingerprint,index:M};try{if(this.privateKey){const j=(0,t.mod)(this.privKey+U,e.secp256k1.CURVE.n);if(!e.secp256k1.utils.isValidPrivateKey(j))throw new Error("The tweak was out of range or the resulted private key is invalid");F.privateKey=j}else{const j=y.fromHex(this.pubKey).add(y.fromPrivateKey(U));if(j.equals(y.ZERO))throw new Error("The tweak was equal to negative P, which made the result key invalid");F.publicKey=j.toRawBytes(!0)}return new N(F)}catch{return this.deriveChild(M+1)}}sign(M){if(!this.privateKey)throw new Error("No privateKey set!");return(0,f.abytes)(M,32),e.secp256k1.sign(M,this.privKey).toCompactRawBytes()}verify(M,W){if((0,f.abytes)(M,32),(0,f.abytes)(W,64),!this.publicKey)throw new Error("No publicKey set!");let B;try{B=e.secp256k1.Signature.fromCompact(W)}catch{return!1}return e.secp256k1.verify(B,M,this.publicKey)}wipePrivateData(){return this.privKey=void 0,this.privKeyBytes&&(this.privKeyBytes.fill(0),this.privKeyBytes=void 0),this}toJSON(){return{xpriv:this.privateExtendedKey,xpub:this.publicExtendedKey}}serialize(M,W){if(!this.chainCode)throw new Error("No chainCode set");return(0,f.abytes)(W,33),(0,f.concatBytes)(R(M),new Uint8Array([this.depth]),R(this.parentFingerprint),R(this.index),this.chainCode,W)}}n.HDKey=N}(lib$1)),lib$1}var bip39={},pbkdf2={},hasRequiredPbkdf2;function requirePbkdf2(){if(hasRequiredPbkdf2)return pbkdf2;hasRequiredPbkdf2=1,Object.defineProperty(pbkdf2,"__esModule",{value:!0}),pbkdf2.pbkdf2=a,pbkdf2.pbkdf2Async=o;const n=requireHmac(),t=requireUtils$2();function e(f,p,y,g){(0,t.ahash)(f);const x=(0,t.checkOpts)({dkLen:32,asyncTick:10},g),{c:E,dkLen:A,asyncTick:S}=x;if((0,t.anumber)(E),(0,t.anumber)(A),(0,t.anumber)(S),E<1)throw new Error("iterations (c) should be >= 1");const I=(0,t.kdfInputToBytes)(p),_=(0,t.kdfInputToBytes)(y),R=new Uint8Array(A),N=n.hmac.create(f,I),D=N._cloneInto().update(_);return{c:E,dkLen:A,asyncTick:S,DK:R,PRF:N,PRFSalt:D}}function s(f,p,y,g,x){return f.destroy(),p.destroy(),g&&g.destroy(),(0,t.clean)(x),y}function a(f,p,y,g){const{c:x,dkLen:E,DK:A,PRF:S,PRFSalt:I}=e(f,p,y,g);let _;const R=new Uint8Array(4),N=(0,t.createView)(R),D=new Uint8Array(S.outputLen);for(let M=1,W=0;W<E;M++,W+=S.outputLen){const B=A.subarray(W,W+S.outputLen);N.setInt32(0,M,!1),(_=I._cloneInto(_)).update(R).digestInto(D),B.set(D.subarray(0,B.length));for(let U=1;U<x;U++){S._cloneInto(_).update(D).digestInto(D);for(let P=0;P<B.length;P++)B[P]^=D[P]}}return s(S,I,A,_,D)}async function o(f,p,y,g){const{c:x,dkLen:E,asyncTick:A,DK:S,PRF:I,PRFSalt:_}=e(f,p,y,g);let R;const N=new Uint8Array(4),D=(0,t.createView)(N),M=new Uint8Array(I.outputLen);for(let W=1,B=0;B<E;W++,B+=I.outputLen){const U=S.subarray(B,B+I.outputLen);D.setInt32(0,W,!1),(R=_._cloneInto(R)).update(N).digestInto(M),U.set(M.subarray(0,U.length)),await(0,t.asyncLoop)(x-1,A,()=>{I._cloneInto(R).update(M).digestInto(M);for(let P=0;P<U.length;P++)U[P]^=M[P]})}return s(I,_,S,R,M)}return pbkdf2}var hasRequiredBip39;function requireBip39(){if(hasRequiredBip39)return bip39;hasRequiredBip39=1,Object.defineProperty(bip39,"__esModule",{value:!0}),bip39.generateMnemonic=y,bip39.mnemonicToEntropy=E,bip39.entropyToMnemonic=A,bip39.validateMnemonic=S,bip39.mnemonicToSeed=_,bip39.mnemonicToSeedSync=R;/*! scure-bip39 - MIT License (c) 2022 Patricio Palladino, Paul Miller (paulmillr.com) */const n=requirePbkdf2(),t=requireSha2(),e=requireUtils$2(),s=requireLib$1(),a=N=>N[0]==="";function o(N){if(typeof N!="string")throw new TypeError("invalid mnemonic type: "+typeof N);return N.normalize("NFKD")}function f(N){const D=o(N),M=D.split(" ");if(![12,15,18,21,24].includes(M.length))throw new Error("Invalid mnemonic");return{nfkd:D,words:M}}function p(N){(0,e.abytes)(N,16,20,24,28,32)}function y(N,D=128){if((0,e.anumber)(D),D%32!==0||D>256)throw new TypeError("Invalid entropy");return A((0,e.randomBytes)(D/8),N)}const g=N=>{const D=8-N.length/4;return new Uint8Array([(0,t.sha256)(N)[0]>>D<<D])};function x(N){if(!Array.isArray(N)||N.length!==2048||typeof N[0]!="string")throw new Error("Wordlist: expected array of 2048 strings");return N.forEach(D=>{if(typeof D!="string")throw new Error("wordlist: non-string element: "+D)}),s.utils.chain(s.utils.checksum(1,g),s.utils.radix2(11,!0),s.utils.alphabet(N))}function E(N,D){const{words:M}=f(N),W=x(D).decode(M);return p(W),W}function A(N,D){return p(N),x(D).encode(N).join(a(D)?"":" ")}function S(N,D){try{E(N,D)}catch{return!1}return!0}const I=N=>o("mnemonic"+N);function _(N,D=""){return(0,n.pbkdf2Async)(t.sha512,f(N).nfkd,I(D),{c:2048,dkLen:64})}function R(N,D=""){return(0,n.pbkdf2)(t.sha512,f(N).nfkd,I(D),{c:2048,dkLen:64})}return bip39}var english={},hasRequiredEnglish;function requireEnglish(){return hasRequiredEnglish||(hasRequiredEnglish=1,Object.defineProperty(english,"__esModule",{value:!0}),english.wordlist=void 0,english.wordlist=`abandon
ability
able
about
above
absent
absorb
abstract
absurd
abuse
access
accident
account
accuse
achieve
acid
acoustic
acquire
across
act
action
actor
actress
actual
adapt
add
addict
address
adjust
admit
adult
advance
advice
aerobic
affair
afford
afraid
again
age
agent
agree
ahead
aim
air
airport
aisle
alarm
album
alcohol
alert
alien
all
alley
allow
almost
alone
alpha
already
also
alter
always
amateur
amazing
among
amount
amused
analyst
anchor
ancient
anger
angle
angry
animal
ankle
announce
annual
another
answer
antenna
antique
anxiety
any
apart
apology
appear
apple
approve
april
arch
arctic
area
arena
argue
arm
armed
armor
army
around
arrange
arrest
arrive
arrow
art
artefact
artist
artwork
ask
aspect
assault
asset
assist
assume
asthma
athlete
atom
attack
attend
attitude
attract
auction
audit
august
aunt
author
auto
autumn
average
avocado
avoid
awake
aware
away
awesome
awful
awkward
axis
baby
bachelor
bacon
badge
bag
balance
balcony
ball
bamboo
banana
banner
bar
barely
bargain
barrel
base
basic
basket
battle
beach
bean
beauty
because
become
beef
before
begin
behave
behind
believe
below
belt
bench
benefit
best
betray
better
between
beyond
bicycle
bid
bike
bind
biology
bird
birth
bitter
black
blade
blame
blanket
blast
bleak
bless
blind
blood
blossom
blouse
blue
blur
blush
board
boat
body
boil
bomb
bone
bonus
book
boost
border
boring
borrow
boss
bottom
bounce
box
boy
bracket
brain
brand
brass
brave
bread
breeze
brick
bridge
brief
bright
bring
brisk
broccoli
broken
bronze
broom
brother
brown
brush
bubble
buddy
budget
buffalo
build
bulb
bulk
bullet
bundle
bunker
burden
burger
burst
bus
business
busy
butter
buyer
buzz
cabbage
cabin
cable
cactus
cage
cake
call
calm
camera
camp
can
canal
cancel
candy
cannon
canoe
canvas
canyon
capable
capital
captain
car
carbon
card
cargo
carpet
carry
cart
case
cash
casino
castle
casual
cat
catalog
catch
category
cattle
caught
cause
caution
cave
ceiling
celery
cement
census
century
cereal
certain
chair
chalk
champion
change
chaos
chapter
charge
chase
chat
cheap
check
cheese
chef
cherry
chest
chicken
chief
child
chimney
choice
choose
chronic
chuckle
chunk
churn
cigar
cinnamon
circle
citizen
city
civil
claim
clap
clarify
claw
clay
clean
clerk
clever
click
client
cliff
climb
clinic
clip
clock
clog
close
cloth
cloud
clown
club
clump
cluster
clutch
coach
coast
coconut
code
coffee
coil
coin
collect
color
column
combine
come
comfort
comic
common
company
concert
conduct
confirm
congress
connect
consider
control
convince
cook
cool
copper
copy
coral
core
corn
correct
cost
cotton
couch
country
couple
course
cousin
cover
coyote
crack
cradle
craft
cram
crane
crash
crater
crawl
crazy
cream
credit
creek
crew
cricket
crime
crisp
critic
crop
cross
crouch
crowd
crucial
cruel
cruise
crumble
crunch
crush
cry
crystal
cube
culture
cup
cupboard
curious
current
curtain
curve
cushion
custom
cute
cycle
dad
damage
damp
dance
danger
daring
dash
daughter
dawn
day
deal
debate
debris
decade
december
decide
decline
decorate
decrease
deer
defense
define
defy
degree
delay
deliver
demand
demise
denial
dentist
deny
depart
depend
deposit
depth
deputy
derive
describe
desert
design
desk
despair
destroy
detail
detect
develop
device
devote
diagram
dial
diamond
diary
dice
diesel
diet
differ
digital
dignity
dilemma
dinner
dinosaur
direct
dirt
disagree
discover
disease
dish
dismiss
disorder
display
distance
divert
divide
divorce
dizzy
doctor
document
dog
doll
dolphin
domain
donate
donkey
donor
door
dose
double
dove
draft
dragon
drama
drastic
draw
dream
dress
drift
drill
drink
drip
drive
drop
drum
dry
duck
dumb
dune
during
dust
dutch
duty
dwarf
dynamic
eager
eagle
early
earn
earth
easily
east
easy
echo
ecology
economy
edge
edit
educate
effort
egg
eight
either
elbow
elder
electric
elegant
element
elephant
elevator
elite
else
embark
embody
embrace
emerge
emotion
employ
empower
empty
enable
enact
end
endless
endorse
enemy
energy
enforce
engage
engine
enhance
enjoy
enlist
enough
enrich
enroll
ensure
enter
entire
entry
envelope
episode
equal
equip
era
erase
erode
erosion
error
erupt
escape
essay
essence
estate
eternal
ethics
evidence
evil
evoke
evolve
exact
example
excess
exchange
excite
exclude
excuse
execute
exercise
exhaust
exhibit
exile
exist
exit
exotic
expand
expect
expire
explain
expose
express
extend
extra
eye
eyebrow
fabric
face
faculty
fade
faint
faith
fall
false
fame
family
famous
fan
fancy
fantasy
farm
fashion
fat
fatal
father
fatigue
fault
favorite
feature
february
federal
fee
feed
feel
female
fence
festival
fetch
fever
few
fiber
fiction
field
figure
file
film
filter
final
find
fine
finger
finish
fire
firm
first
fiscal
fish
fit
fitness
fix
flag
flame
flash
flat
flavor
flee
flight
flip
float
flock
floor
flower
fluid
flush
fly
foam
focus
fog
foil
fold
follow
food
foot
force
forest
forget
fork
fortune
forum
forward
fossil
foster
found
fox
fragile
frame
frequent
fresh
friend
fringe
frog
front
frost
frown
frozen
fruit
fuel
fun
funny
furnace
fury
future
gadget
gain
galaxy
gallery
game
gap
garage
garbage
garden
garlic
garment
gas
gasp
gate
gather
gauge
gaze
general
genius
genre
gentle
genuine
gesture
ghost
giant
gift
giggle
ginger
giraffe
girl
give
glad
glance
glare
glass
glide
glimpse
globe
gloom
glory
glove
glow
glue
goat
goddess
gold
good
goose
gorilla
gospel
gossip
govern
gown
grab
grace
grain
grant
grape
grass
gravity
great
green
grid
grief
grit
grocery
group
grow
grunt
guard
guess
guide
guilt
guitar
gun
gym
habit
hair
half
hammer
hamster
hand
happy
harbor
hard
harsh
harvest
hat
have
hawk
hazard
head
health
heart
heavy
hedgehog
height
hello
helmet
help
hen
hero
hidden
high
hill
hint
hip
hire
history
hobby
hockey
hold
hole
holiday
hollow
home
honey
hood
hope
horn
horror
horse
hospital
host
hotel
hour
hover
hub
huge
human
humble
humor
hundred
hungry
hunt
hurdle
hurry
hurt
husband
hybrid
ice
icon
idea
identify
idle
ignore
ill
illegal
illness
image
imitate
immense
immune
impact
impose
improve
impulse
inch
include
income
increase
index
indicate
indoor
industry
infant
inflict
inform
inhale
inherit
initial
inject
injury
inmate
inner
innocent
input
inquiry
insane
insect
inside
inspire
install
intact
interest
into
invest
invite
involve
iron
island
isolate
issue
item
ivory
jacket
jaguar
jar
jazz
jealous
jeans
jelly
jewel
job
join
joke
journey
joy
judge
juice
jump
jungle
junior
junk
just
kangaroo
keen
keep
ketchup
key
kick
kid
kidney
kind
kingdom
kiss
kit
kitchen
kite
kitten
kiwi
knee
knife
knock
know
lab
label
labor
ladder
lady
lake
lamp
language
laptop
large
later
latin
laugh
laundry
lava
law
lawn
lawsuit
layer
lazy
leader
leaf
learn
leave
lecture
left
leg
legal
legend
leisure
lemon
lend
length
lens
leopard
lesson
letter
level
liar
liberty
library
license
life
lift
light
like
limb
limit
link
lion
liquid
list
little
live
lizard
load
loan
lobster
local
lock
logic
lonely
long
loop
lottery
loud
lounge
love
loyal
lucky
luggage
lumber
lunar
lunch
luxury
lyrics
machine
mad
magic
magnet
maid
mail
main
major
make
mammal
man
manage
mandate
mango
mansion
manual
maple
marble
march
margin
marine
market
marriage
mask
mass
master
match
material
math
matrix
matter
maximum
maze
meadow
mean
measure
meat
mechanic
medal
media
melody
melt
member
memory
mention
menu
mercy
merge
merit
merry
mesh
message
metal
method
middle
midnight
milk
million
mimic
mind
minimum
minor
minute
miracle
mirror
misery
miss
mistake
mix
mixed
mixture
mobile
model
modify
mom
moment
monitor
monkey
monster
month
moon
moral
more
morning
mosquito
mother
motion
motor
mountain
mouse
move
movie
much
muffin
mule
multiply
muscle
museum
mushroom
music
must
mutual
myself
mystery
myth
naive
name
napkin
narrow
nasty
nation
nature
near
neck
need
negative
neglect
neither
nephew
nerve
nest
net
network
neutral
never
news
next
nice
night
noble
noise
nominee
noodle
normal
north
nose
notable
note
nothing
notice
novel
now
nuclear
number
nurse
nut
oak
obey
object
oblige
obscure
observe
obtain
obvious
occur
ocean
october
odor
off
offer
office
often
oil
okay
old
olive
olympic
omit
once
one
onion
online
only
open
opera
opinion
oppose
option
orange
orbit
orchard
order
ordinary
organ
orient
original
orphan
ostrich
other
outdoor
outer
output
outside
oval
oven
over
own
owner
oxygen
oyster
ozone
pact
paddle
page
pair
palace
palm
panda
panel
panic
panther
paper
parade
parent
park
parrot
party
pass
patch
path
patient
patrol
pattern
pause
pave
payment
peace
peanut
pear
peasant
pelican
pen
penalty
pencil
people
pepper
perfect
permit
person
pet
phone
photo
phrase
physical
piano
picnic
picture
piece
pig
pigeon
pill
pilot
pink
pioneer
pipe
pistol
pitch
pizza
place
planet
plastic
plate
play
please
pledge
pluck
plug
plunge
poem
poet
point
polar
pole
police
pond
pony
pool
popular
portion
position
possible
post
potato
pottery
poverty
powder
power
practice
praise
predict
prefer
prepare
present
pretty
prevent
price
pride
primary
print
priority
prison
private
prize
problem
process
produce
profit
program
project
promote
proof
property
prosper
protect
proud
provide
public
pudding
pull
pulp
pulse
pumpkin
punch
pupil
puppy
purchase
purity
purpose
purse
push
put
puzzle
pyramid
quality
quantum
quarter
question
quick
quit
quiz
quote
rabbit
raccoon
race
rack
radar
radio
rail
rain
raise
rally
ramp
ranch
random
range
rapid
rare
rate
rather
raven
raw
razor
ready
real
reason
rebel
rebuild
recall
receive
recipe
record
recycle
reduce
reflect
reform
refuse
region
regret
regular
reject
relax
release
relief
rely
remain
remember
remind
remove
render
renew
rent
reopen
repair
repeat
replace
report
require
rescue
resemble
resist
resource
response
result
retire
retreat
return
reunion
reveal
review
reward
rhythm
rib
ribbon
rice
rich
ride
ridge
rifle
right
rigid
ring
riot
ripple
risk
ritual
rival
river
road
roast
robot
robust
rocket
romance
roof
rookie
room
rose
rotate
rough
round
route
royal
rubber
rude
rug
rule
run
runway
rural
sad
saddle
sadness
safe
sail
salad
salmon
salon
salt
salute
same
sample
sand
satisfy
satoshi
sauce
sausage
save
say
scale
scan
scare
scatter
scene
scheme
school
science
scissors
scorpion
scout
scrap
screen
script
scrub
sea
search
season
seat
second
secret
section
security
seed
seek
segment
select
sell
seminar
senior
sense
sentence
series
service
session
settle
setup
seven
shadow
shaft
shallow
share
shed
shell
sheriff
shield
shift
shine
ship
shiver
shock
shoe
shoot
shop
short
shoulder
shove
shrimp
shrug
shuffle
shy
sibling
sick
side
siege
sight
sign
silent
silk
silly
silver
similar
simple
since
sing
siren
sister
situate
six
size
skate
sketch
ski
skill
skin
skirt
skull
slab
slam
sleep
slender
slice
slide
slight
slim
slogan
slot
slow
slush
small
smart
smile
smoke
smooth
snack
snake
snap
sniff
snow
soap
soccer
social
sock
soda
soft
solar
soldier
solid
solution
solve
someone
song
soon
sorry
sort
soul
sound
soup
source
south
space
spare
spatial
spawn
speak
special
speed
spell
spend
sphere
spice
spider
spike
spin
spirit
split
spoil
sponsor
spoon
sport
spot
spray
spread
spring
spy
square
squeeze
squirrel
stable
stadium
staff
stage
stairs
stamp
stand
start
state
stay
steak
steel
stem
step
stereo
stick
still
sting
stock
stomach
stone
stool
story
stove
strategy
street
strike
strong
struggle
student
stuff
stumble
style
subject
submit
subway
success
such
sudden
suffer
sugar
suggest
suit
summer
sun
sunny
sunset
super
supply
supreme
sure
surface
surge
surprise
surround
survey
suspect
sustain
swallow
swamp
swap
swarm
swear
sweet
swift
swim
swing
switch
sword
symbol
symptom
syrup
system
table
tackle
tag
tail
talent
talk
tank
tape
target
task
taste
tattoo
taxi
teach
team
tell
ten
tenant
tennis
tent
term
test
text
thank
that
theme
then
theory
there
they
thing
this
thought
three
thrive
throw
thumb
thunder
ticket
tide
tiger
tilt
timber
time
tiny
tip
tired
tissue
title
toast
tobacco
today
toddler
toe
together
toilet
token
tomato
tomorrow
tone
tongue
tonight
tool
tooth
top
topic
topple
torch
tornado
tortoise
toss
total
tourist
toward
tower
town
toy
track
trade
traffic
tragic
train
transfer
trap
trash
travel
tray
treat
tree
trend
trial
tribe
trick
trigger
trim
trip
trophy
trouble
truck
true
truly
trumpet
trust
truth
try
tube
tuition
tumble
tuna
tunnel
turkey
turn
turtle
twelve
twenty
twice
twin
twist
two
type
typical
ugly
umbrella
unable
unaware
uncle
uncover
under
undo
unfair
unfold
unhappy
uniform
unique
unit
universe
unknown
unlock
until
unusual
unveil
update
upgrade
uphold
upon
upper
upset
urban
urge
usage
use
used
useful
useless
usual
utility
vacant
vacuum
vague
valid
valley
valve
van
vanish
vapor
various
vast
vault
vehicle
velvet
vendor
venture
venue
verb
verify
version
very
vessel
veteran
viable
vibrant
vicious
victory
video
view
village
vintage
violin
virtual
virus
visa
visit
visual
vital
vivid
vocal
voice
void
volcano
volume
vote
voyage
wage
wagon
wait
walk
wall
walnut
want
warfare
warm
warrior
wash
wasp
waste
water
wave
way
wealth
weapon
wear
weasel
weather
web
wedding
weekend
weird
welcome
west
wet
whale
what
wheat
wheel
when
where
whip
whisper
wide
width
wife
wild
will
win
window
wine
wing
wink
winner
winter
wire
wisdom
wise
wish
witness
wolf
woman
wonder
wood
wool
word
work
world
worry
worth
wrap
wreck
wrestle
wrist
write
wrong
yard
year
yellow
you
young
youth
zebra
zero
zone
zoo`.split(`
`)),english}var hasRequiredNUT09;function requireNUT09(){if(hasRequiredNUT09)return NUT09;hasRequiredNUT09=1,Object.defineProperty(NUT09,"__esModule",{value:!0}),NUT09.deriveSeedFromMnemonic=NUT09.generateNewMnemonic=NUT09.deriveBlindingFactor=NUT09.deriveSecret=void 0;const n=requireLib(),t=requireCommon(),e=requireBip39(),s=requireEnglish(),a="m/129372'/0'";var o;(function(E){E[E.SECRET=0]="SECRET",E[E.BLINDING_FACTOR=1]="BLINDING_FACTOR"})(o||(o={}));const f=(E,A,S)=>y(E,A,S,o.SECRET);NUT09.deriveSecret=f;const p=(E,A,S)=>y(E,A,S,o.BLINDING_FACTOR);NUT09.deriveBlindingFactor=p;const y=(E,A,S,I)=>{const _=n.HDKey.fromMasterSeed(E),R=(0,t.getKeysetIdInt)(A),N=`${a}/${R}'/${S}'/${I}`,D=_.derive(N);if(D.privateKey===null)throw new Error("Could not derive private key");return D.privateKey},g=()=>(0,e.generateMnemonic)(s.wordlist,128);NUT09.generateNewMnemonic=g;const x=E=>(0,e.mnemonicToSeedSync)(E);return NUT09.deriveSeedFromMnemonic=x,NUT09}var NUT09Exports=requireNUT09(),NUT11$1={},NUT11={},hasRequiredNUT11$1;function requireNUT11$1(){if(hasRequiredNUT11$1)return NUT11;hasRequiredNUT11$1=1,Object.defineProperty(NUT11,"__esModule",{value:!0}),NUT11.parseSecret=void 0;const n=t=>{try{return t instanceof Uint8Array&&(t=new TextDecoder().decode(t)),JSON.parse(t)}catch{throw new Error("can't parse secret")}};return NUT11.parseSecret=n,NUT11}var hasRequiredNUT11;function requireNUT11(){return hasRequiredNUT11||(hasRequiredNUT11=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSignedProof=n.getSignedProofs=n.signP2PKsecret=n.createP2PKsecret=void 0;const t=requireUtils$1(),e=requireSha256(),s=requireSecp256k1(),a=requireUtils$2(),o=requireNUT11$1(),f=x=>{const E=["P2PK",{nonce:(0,t.bytesToHex)((0,a.randomBytes)(32)),data:x}],A=JSON.stringify(E);return new TextEncoder().encode(A)};n.createP2PKsecret=f;const p=(x,E)=>{const A=(0,e.sha256)(new TextDecoder().decode(x));return s.schnorr.sign(A,E)};n.signP2PKsecret=p;const y=(x,E)=>x.map(A=>{try{if((0,o.parseSecret)(A.secret)[0]!=="P2PK")throw new Error("unknown secret type");return(0,n.getSignedProof)(A,(0,t.hexToBytes)(E))}catch{return A}});n.getSignedProofs=y;const g=(x,E)=>(x.witness||(x.witness={signatures:[(0,t.bytesToHex)((0,n.signP2PKsecret)(x.secret,E))]}),x);n.getSignedProof=g}(NUT11$1)),NUT11$1}var NUT11Exports=requireNUT11(),__awaiter$7=function(n,t,e,s){function a(o){return o instanceof e?o:new e(function(f){f(o)})}return new(e||(e=Promise))(function(o,f){function p(x){try{g(s.next(x))}catch(E){f(E)}}function y(x){try{g(s.throw(x))}catch(E){f(E)}}function g(x){x.done?o(x.value):a(x.value).then(p,y)}g((s=s.apply(n,t||[])).next())})},__generator$7=function(n,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,a,o,f;return f={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function p(g){return function(x){return y([g,x])}}function y(g){if(s)throw new TypeError("Generator is already executing.");for(;f&&(f=0,g[0]&&(e=0)),e;)try{if(s=1,a&&(o=g[0]&2?a.return:g[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,g[1])).done)return o;switch(a=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return e.label++,{value:g[1],done:!1};case 5:e.label++,a=g[1],g=[0];continue;case 7:g=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){e=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){e.label=g[1];break}if(g[0]===6&&e.label<o[1]){e.label=o[1],o=g;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(g);break}o[2]&&e.ops.pop(),e.trys.pop();continue}g=t.call(n,e)}catch(x){g=[6,x],a=0}finally{s=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},__spreadArray=function(n,t,e){if(e||arguments.length===2)for(var s=0,a=t.length,o;s<a;s++)(o||!(s in t))&&(o||(o=Array.prototype.slice.call(t,0,s)),o[s]=t[s]);return n.concat(o||Array.prototype.slice.call(t))},DEFAULT_DENOMINATION_TARGET=3,DEFAULT_UNIT="sat",CashuWallet=function(){function n(t,e){var s=this;this._keys=new Map,this._keysets=[],this._seed=void 0,this._unit=DEFAULT_UNIT,this._mintInfo=void 0,this._denominationTarget=DEFAULT_DENOMINATION_TARGET,this.mint=t;var a=[];if(e!=null&&e.keys&&!Array.isArray(e.keys)?a=[e.keys]:e!=null&&e.keys&&Array.isArray(e==null?void 0:e.keys)&&(a=e==null?void 0:e.keys),a&&a.forEach(function(o){return s._keys.set(o.id,o)}),e!=null&&e.unit&&(this._unit=e==null?void 0:e.unit),e!=null&&e.keysets&&(this._keysets=e.keysets),e!=null&&e.denominationTarget&&(this._denominationTarget=e.denominationTarget),e!=null&&e.bip39seed){if(e.bip39seed instanceof Uint8Array){this._seed=e.bip39seed;return}throw new Error("bip39seed must be a valid UInt8Array")}}return Object.defineProperty(n.prototype,"unit",{get:function(){return this._unit},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"keys",{get:function(){return this._keys},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"keysetId",{get:function(){if(!this._keysetId)throw new Error("No keysetId set");return this._keysetId},set:function(t){this._keysetId=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"keysets",{get:function(){return this._keysets},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mintInfo",{get:function(){if(!this._mintInfo)throw new Error("Mint info not loaded");return this._mintInfo},enumerable:!1,configurable:!0}),n.prototype.getMintInfo=function(){return __awaiter$7(this,void 0,void 0,function(){var t;return __generator$7(this,function(e){switch(e.label){case 0:return t=this,[4,this.mint.getInfo()];case 1:return t._mintInfo=e.sent(),[2,this._mintInfo]}})})},n.prototype.loadMint=function(){return __awaiter$7(this,void 0,void 0,function(){return __generator$7(this,function(t){switch(t.label){case 0:return[4,this.getMintInfo()];case 1:return t.sent(),[4,this.getKeySets()];case 2:return t.sent(),[4,this.getKeys()];case 3:return t.sent(),[2]}})})},n.prototype.getActiveKeyset=function(t){var e=t.filter(function(a){return a.active});e=e.filter(function(a){return a.id.startsWith("00")});var s=e.sort(function(a,o){var f,p;return((f=a.input_fee_ppk)!==null&&f!==void 0?f:0)-((p=o.input_fee_ppk)!==null&&p!==void 0?p:0)})[0];if(!s)throw new Error("No active keyset found");return s},n.prototype.getKeySets=function(){return __awaiter$7(this,void 0,void 0,function(){var t,e,s=this;return __generator$7(this,function(a){switch(a.label){case 0:return[4,this.mint.getKeySets()];case 1:return t=a.sent(),e=t.keysets.filter(function(o){return o.unit===s._unit}),this._keysets=e,[2,this._keysets]}})})},n.prototype.getAllKeys=function(){return __awaiter$7(this,void 0,void 0,function(){var t;return __generator$7(this,function(e){switch(e.label){case 0:return[4,this.mint.getKeys()];case 1:return t=e.sent(),this._keys=new Map(t.keysets.map(function(s){return[s.id,s]})),this.keysetId=this.getActiveKeyset(this._keysets).id,[2,t.keysets]}})})},n.prototype.getKeys=function(t,e){return __awaiter$7(this,void 0,void 0,function(){var s,a;return __generator$7(this,function(o){switch(o.label){case 0:return!(this._keysets.length>0)||e?[4,this.getKeySets()]:[3,2];case 1:o.sent(),o.label=2;case 2:return t||(s=this.getActiveKeyset(this._keysets),t=s.id),this._keysets.find(function(f){return f.id===t})?[3,4]:[4,this.getKeySets()];case 3:if(o.sent(),!this._keysets.find(function(f){return f.id===t}))throw new Error("could not initialize keys. No keyset with id '".concat(t,"' found"));o.label=4;case 4:return this._keys.get(t)?[3,6]:[4,this.mint.getKeys(t)];case 5:a=o.sent(),this._keys.set(t,a.keysets[0]),o.label=6;case 6:return this.keysetId=t,[2,this._keys.get(t)]}})})},n.prototype.receive=function(t,e){return __awaiter$7(this,void 0,void 0,function(){var s,a,o,f,p,y,g;return __generator$7(this,function(x){switch(x.label){case 0:return typeof t=="string"&&(t=getDecodedToken(t)),[4,this.getKeys(e==null?void 0:e.keysetId)];case 1:return s=x.sent(),a=sumProofs(t.proofs)-this.getFeesForProofs(t.proofs),o=this.createSwapPayload(a,t.proofs,s,e==null?void 0:e.outputAmounts,e==null?void 0:e.counter,e==null?void 0:e.pubkey,e==null?void 0:e.privkey),f=o.payload,p=o.blindingData,[4,this.mint.swap(f)];case 2:return y=x.sent().signatures,g=this.constructProofs(y,p.blindingFactors,p.secrets,s),[2,g]}})})},n.prototype.send=function(t,e,s){var a;return __awaiter$7(this,void 0,void 0,function(){var o,f,p,y,g,x,E,A,S,I,_;return __generator$7(this,function(R){switch(R.label){case 0:if(sumProofs(e)<t)throw new Error("Not enough funds available to send");return o=this.selectProofsToSend(e,t,s==null?void 0:s.includeFees),f=o.keep,p=o.send,y=s!=null&&s.includeFees?this.getFeesForProofs(p):0,!(s!=null&&s.offline)&&(sumProofs(p)!=t+y||s!=null&&s.outputAmounts||s!=null&&s.pubkey||s!=null&&s.privkey||s!=null&&s.keysetId)?(g=this.selectProofsToSend(e,t,!0),x=g.keep,E=g.send,(a=s==null?void 0:s.proofsWeHave)===null||a===void 0||a.push.apply(a,x),[4,this.swap(t,E,s)]):[3,2];case 1:return A=R.sent(),S=A.keep,I=A.send,_=x.concat(S),[2,{keep:_,send:I}];case 2:if(sumProofs(p)<t+y)throw new Error("Not enough funds available to send");return[2,{keep:f,send:p}]}})})},n.prototype.selectProofsToSend=function(t,e,s){var a=t.sort(function(R,N){return R.amount-N.amount}),o=a.filter(function(R){return R.amount<=e}).sort(function(R,N){return N.amount-R.amount}),f=a.filter(function(R){return R.amount>e}).sort(function(R,N){return R.amount-N.amount}),p=f[0];if(!o.length&&p)return{keep:t.filter(function(R){return R.secret!==p.secret}),send:[p]};if(!o.length&&!p)return{keep:t,send:[]};var y=e,g=[o[0]],x=[],E=s?this.getFeesForProofs(g):0;if(y-=g[0].amount-E/1e3,y>0){var A=this.selectProofsToSend(o.slice(1),y,s),S=A.keep,I=A.send;g.push.apply(g,I),x.push.apply(x,S)}var _=s?this.getFeesForProofs(g):0;return sumProofs(g)<e+_&&p&&(g=[p]),{keep:t.filter(function(R){return!g.includes(R)}),send:g}},n.prototype.getFeesForProofs=function(t){var e=this;if(!this._keysets.length)throw new Error("Could not calculate fees. No keysets found");var s=new Set(t.map(function(o){return o.id}));s.forEach(function(o){if(!e._keysets.find(function(f){return f.id===o}))throw new Error("Could not calculate fees. No keyset found with id: ".concat(o))});var a=Math.floor(Math.max((t.reduce(function(o,f){var p;return o+(((p=e._keysets.find(function(y){return y.id===f.id}))===null||p===void 0?void 0:p.input_fee_ppk)||0)},0)+999)/1e3,0));return a},n.prototype.getFeesForKeyset=function(t,e){var s,a=Math.floor(Math.max((t*(((s=this._keysets.find(function(o){return o.id===e}))===null||s===void 0?void 0:s.input_fee_ppk)||0)+999)/1e3,0));return a},n.prototype.swap=function(t,e,s){var a,o,f;return __awaiter$7(this,void 0,void 0,function(){var p,y,g,x,E,A,S,I,_,R,N,D,M,W,B,U,P;return __generator$7(this,function(F){switch(F.label){case 0:return s||(s={}),[4,this.getKeys(s.keysetId)];case 1:if(p=F.sent(),y=e,g=t,x=sumProofs(e),E=x-g-this.getFeesForProofs(y),A=((a=s==null?void 0:s.outputAmounts)===null||a===void 0?void 0:a.sendAmounts)||splitAmount(g,p.keys),s!=null&&s.includeFees){for(S=this.getFeesForKeyset(A.length,p.id),I=splitAmount(S,p.keys);this.getFeesForKeyset(A.concat(I).length,p.id)>S;)S++,I=splitAmount(S,p.keys);A=A.concat(I),g+=S,E-=S}if(s&&!(!((o=s.outputAmounts)===null||o===void 0)&&o.keepAmounts)&&s.proofsWeHave)_=getKeepAmounts(s.proofsWeHave,E,p.keys,this._denominationTarget);else if(s.outputAmounts){if(((f=s.outputAmounts.keepAmounts)===null||f===void 0?void 0:f.reduce(function(j,Q){return j+Q},0))!=E)throw new Error("Keep amounts do not match amount to keep");_=s.outputAmounts.keepAmounts}if(g+this.getFeesForProofs(y)>x)throw console.error("Not enough funds available (".concat(x,") for swap amountToSend: ").concat(g," + fee: ").concat(this.getFeesForProofs(y)," | length: ").concat(y.length)),new Error("Not enough funds available for swap");if(g+this.getFeesForProofs(y)+E!=x)throw new Error("Amounts do not match for swap");return s.outputAmounts={keepAmounts:_,sendAmounts:A},R=this.createSwapPayload(g,y,p,s==null?void 0:s.outputAmounts,s==null?void 0:s.counter,s==null?void 0:s.pubkey,s==null?void 0:s.privkey),N=R.payload,D=R.blindingData,[4,this.mint.swap(N)];case 2:return M=F.sent().signatures,W=this.constructProofs(M,D.blindingFactors,D.secrets,p),B=[],U=[],P=0,W.forEach(function(j){if(P<E){P+=j.amount,B.push(j);return}U.push(j)}),[2,{keep:B,send:U}]}})})},n.prototype.restore=function(t,e,s){return __awaiter$7(this,void 0,void 0,function(){var a,o,f,p,y,g,x,E,A,S,I;return __generator$7(this,function(_){switch(_.label){case 0:return[4,this.getKeys(s==null?void 0:s.keysetId)];case 1:if(a=_.sent(),!this._seed)throw new Error("CashuWallet must be initialized with a seed to use restore");return o=Array(e).fill(0),f=this.createBlindedMessages(o,a.id,t),p=f.blindedMessages,y=f.blindingFactors,g=f.secrets,[4,this.mint.restore({outputs:p})];case 2:return x=_.sent(),E=x.outputs,A=x.promises,S=y.filter(function(R,N){return E.map(function(D){return D.B_}).includes(p[N].B_)}),I=g.filter(function(R,N){return E.map(function(D){return D.B_}).includes(p[N].B_)}),[2,{proofs:this.constructProofs(A,S,I,a)}]}})})},n.prototype.createMintQuote=function(t,e){return __awaiter$7(this,void 0,void 0,function(){var s;return __generator$7(this,function(a){switch(a.label){case 0:return s={unit:this._unit,amount:t,description:e},[4,this.mint.createMintQuote(s)];case 1:return[2,a.sent()]}})})},n.prototype.checkMintQuote=function(t){return __awaiter$7(this,void 0,void 0,function(){return __generator$7(this,function(e){switch(e.label){case 0:return[4,this.mint.checkMintQuote(t)];case 1:return[2,e.sent()]}})})},n.prototype.mintProofs=function(t,e,s){var a;return __awaiter$7(this,void 0,void 0,function(){var o,f,p,y,g,x,E;return __generator$7(this,function(A){switch(A.label){case 0:return[4,this.getKeys(s==null?void 0:s.keysetId)];case 1:return o=A.sent(),!(s!=null&&s.outputAmounts)&&(s!=null&&s.proofsWeHave)&&(s.outputAmounts={keepAmounts:getKeepAmounts(s.proofsWeHave,t,o.keys,this._denominationTarget),sendAmounts:[]}),f=this.createRandomBlindedMessages(t,o,(a=s==null?void 0:s.outputAmounts)===null||a===void 0?void 0:a.keepAmounts,s==null?void 0:s.counter,s==null?void 0:s.pubkey),p=f.blindedMessages,y=f.secrets,g=f.blindingFactors,x={outputs:p,quote:e},[4,this.mint.mint(x)];case 2:return E=A.sent().signatures,[2,{proofs:this.constructProofs(E,g,y,o)}]}})})},n.prototype.createMeltQuote=function(t){return __awaiter$7(this,void 0,void 0,function(){var e,s;return __generator$7(this,function(a){switch(a.label){case 0:return e={unit:this._unit,request:t},[4,this.mint.createMeltQuote(e)];case 1:return s=a.sent(),[2,s]}})})},n.prototype.checkMeltQuote=function(t){return __awaiter$7(this,void 0,void 0,function(){var e;return __generator$7(this,function(s){switch(s.label){case 0:return[4,this.mint.checkMeltQuote(t)];case 1:return e=s.sent(),[2,e]}})})},n.prototype.meltProofs=function(t,e,s){return __awaiter$7(this,void 0,void 0,function(){var a,o,f,p,y,g,x,E;return __generator$7(this,function(A){switch(A.label){case 0:return[4,this.getKeys(s==null?void 0:s.keysetId)];case 1:return a=A.sent(),o=this.createBlankOutputs(sumProofs(e)-t.amount,a.id,s==null?void 0:s.counter),f=o.blindedMessages,p=o.secrets,y=o.blindingFactors,(s==null?void 0:s.privkey)!=null&&(e=NUT11Exports.getSignedProofs(e.map(function(S){return{amount:S.amount,C:commonExports.pointFromHex(S.C),id:S.id,secret:new TextEncoder().encode(S.secret)}}),s.privkey).map(function(S){return clientExports.serializeProof(S)})),g={quote:t.quote,inputs:e,outputs:__spreadArray([],f,!0)},[4,this.mint.melt(g)];case 2:return x=A.sent(),E=[],x.change&&(E=this.constructProofs(x.change,y,p,a)),[2,{quote:x,change:E}]}})})},n.prototype.createSwapPayload=function(t,e,s,a,o,f,p){var y=e.reduce(function(S,I){return S+I.amount},0);a&&a.sendAmounts&&!a.keepAmounts&&(a.keepAmounts=splitAmount(y-t-this.getFeesForProofs(e),s.keys));var g=this.createRandomBlindedMessages(y-t-this.getFeesForProofs(e),s,a==null?void 0:a.keepAmounts,o);this._seed&&o&&(o=o+g.secrets.length);var x=this.createRandomBlindedMessages(t,s,a==null?void 0:a.sendAmounts,o,f);p&&(e=NUT11Exports.getSignedProofs(e.map(function(S){return{amount:S.amount,C:commonExports.pointFromHex(S.C),id:S.id,secret:new TextEncoder().encode(S.secret)}}),p).map(function(S){return clientExports.serializeProof(S)}));var E={blindedMessages:__spreadArray(__spreadArray([],g.blindedMessages,!0),x.blindedMessages,!0),secrets:__spreadArray(__spreadArray([],g.secrets,!0),x.secrets,!0),blindingFactors:__spreadArray(__spreadArray([],g.blindingFactors,!0),x.blindingFactors,!0)},A={inputs:e,outputs:__spreadArray([],E.blindedMessages,!0)};return{payload:A,blindingData:E}},n.prototype.checkProofsStates=function(t){return __awaiter$7(this,void 0,void 0,function(){var e,s,a,o,f,p,y;return __generator$7(this,function(g){switch(g.label){case 0:e=new TextEncoder,s=t.map(function(x){return commonExports.hashToCurve(e.encode(x.secret)).toHex(!0)}),a=100,o=[],f=function(x){var E,A,S,I,_;return __generator$7(this,function(R){switch(R.label){case 0:return E=s.slice(x,x+a),[4,p.mint.check({Ys:E})];case 1:for(A=R.sent().states,S={},A.forEach(function(N){S[N.Y]=N}),I=0;I<E.length;I++){if(_=S[E[I]],!_)throw new Error("Could not find state for proof with Y: "+E[I]);o.push(_)}return[2]}})},p=this,y=0,g.label=1;case 1:return y<s.length?[5,f(y)]:[3,4];case 2:g.sent(),g.label=3;case 3:return y+=a,[3,1];case 4:return[2,o]}})})},n.prototype.createRandomBlindedMessages=function(t,e,s,a,o){var f=splitAmount(t,e.keys,s);return this.createBlindedMessages(f,e.id,a,o)},n.prototype.createBlindedMessages=function(t,e,s,a){if(s!=null&&!this._seed)throw new Error("Cannot create deterministic messages without seed. Instantiate CashuWallet with a bip39seed, or omit counter param.");for(var o=[],f=[],p=[],y=0;y<t.length;y++){var g=void 0,x=void 0;if(a?x=NUT11Exports.createP2PKsecret(a):this._seed&&s!=null?(x=NUT09Exports.deriveSecret(this._seed,e,s+y),g=bytesToNumber(NUT09Exports.deriveBlindingFactor(this._seed,e,s+y))):x=randomBytes(32),!a){var E=bytesToHex$1(x);x=new TextEncoder().encode(E)}f.push(x);var A=clientExports.blindMessage(x,g),S=A.B_,I=A.r;p.push(I);var _=new BlindedMessage(t[y],S,e);o.push(_.getSerializedBlindedMessage())}return{blindedMessages:o,secrets:f,blindingFactors:p,amounts:t}},n.prototype.createBlankOutputs=function(t,e,s){var a=Math.ceil(Math.log2(t))||1;a<0&&(a=0);var o=a?Array(a).fill(1):[],f=this.createBlindedMessages(o,e,s),p=f.blindedMessages,y=f.blindingFactors,g=f.secrets;return{blindedMessages:p,secrets:g,blindingFactors:y}},n.prototype.constructProofs=function(t,e,s,a){return t.map(function(o,f){var p={id:o.id,amount:o.amount,C_:commonExports.pointFromHex(o.C_)},y=e[f],g=s[f],x=commonExports.pointFromHex(a.keys[o.amount]);return clientExports.constructProofFromPromise(p,y,g,x)}).map(function(o){return clientExports.serializeProof(o)})},n}(),mintWallets=new Map,mintWalletPromises=new Map;function mintKey(n,t,e){if(e){const s=new TextDecoder().decode(e);return`${n}-${t}-${s}`}return`${n}-${t}`}async function walletForMint(n,{pk:t,timeout:e=5e3,mintInfo:s,mintKeys:a,onMintInfoNeeded:o,onMintInfoLoaded:f,onMintKeysNeeded:p,onMintKeysLoaded:y}={}){s??(s=await(o==null?void 0:o(n))),a??(a=await(p==null?void 0:p(n))),!s&&f&&(s=await CashuMint.getInfo(n),f==null||f(n,s));const g="sat",x=mintKey(n,g,t);if(mintWallets.has(x))return mintWallets.get(x);if(mintWalletPromises.has(x))return mintWalletPromises.get(x);s||(o&&(s=await o(n)),!s&&f&&(s=await CashuMint.getInfo(n),f(n,s))),!a&&p&&(a=await p(n));const E=new CashuWallet(new CashuMint(n),{unit:g,bip39seed:t,mintInfo:s,keys:a}),A=new Promise(async S=>{try{const I=new Promise((_,R)=>{setTimeout(()=>{R(new Error("timeout loading mint"))},e)});await Promise.race([E.loadMint(),I]),mintWallets.set(x,E),mintWalletPromises.delete(x),E.keys&&(y==null||y(n,E.keys)),S(E)}catch(I){console.error("[WALLET] error loading mint",n,I.message),mintWalletPromises.delete(x),S(null)}});return mintWalletPromises.set(x,A),A}async function getCashuWallet(n){if(this.cashuWallets.has(n))return this.cashuWallets.get(n);const t=await walletForMint(n,{onMintInfoNeeded:this.onMintInfoNeeded,onMintInfoLoaded:this.onMintInfoLoaded,onMintKeysNeeded:this.onMintKeysNeeded,onMintKeysLoaded:this.onMintKeysLoaded});if(!t)throw new Error(`unable to load wallet for mint ${n}`);return this.cashuWallets.set(n,t),t}var NDKWallet=class extends libExports.EventEmitter{constructor(t){super();pe(this,"cashuWallets",new Map);pe(this,"onMintInfoNeeded");pe(this,"onMintInfoLoaded");pe(this,"onMintKeysNeeded");pe(this,"onMintKeysLoaded");pe(this,"getCashuWallet",getCashuWallet.bind(this));pe(this,"ndk");pe(this,"status","initial");pe(this,"walletId","unknown");this.ndk=t}get type(){throw new Error("Not implemented")}get balance(){throw new Error("Not implemented")}redeemNutzaps(t,e,s){throw new Error("Not implemented")}},NDKCashuDepositMonitor=class extends libExports.EventEmitter{constructor(){super(...arguments);pe(this,"deposits",new Map)}addDeposit(t){const{quoteId:e}=t;if(!e)throw new Error("deposit has no quote ID");return this.deposits.has(e)?!1:(t.once("success",s=>{this.removeDeposit(e)}),this.deposits.set(e,t),this.emit("change"),!0)}removeDeposit(t){this.deposits.delete(t),this.emit("change")}};function getBolt11ExpiresAt(n){const t=bolt11Exports.decode(n),e=t.expiry,s=t.sections.find(a=>a.name==="timestamp").value;if(typeof e=="number"&&typeof s=="number")return e+s}function getBolt11Amount(n){const e=bolt11Exports.decode(n).sections.find(a=>a.name==="amount"),s=e==null?void 0:e.value;return Number(s)}function getBolt11Description(n){const e=bolt11Exports.decode(n).sections.find(a=>a.name==="description");return e==null?void 0:e.value}var hs,NDKCashuQuote=(hs=class extends NDKEvent{constructor(e,s){super(e,s);pe(this,"quoteId");pe(this,"mint");pe(this,"amount");pe(this,"unit");pe(this,"_wallet");this.kind??(this.kind=NDKKind.CashuQuote)}static async from(e){const s=new hs(e.ndk,e),a=e;try{await s.decrypt()}catch{s.content=a.content}try{const o=JSON.parse(s.content);s.quoteId=o.quoteId,s.mint=o.mint,s.amount=o.amount,s.unit=o.unit}catch{return}return s}set wallet(e){this._wallet=e}set invoice(e){const s=getBolt11ExpiresAt(e);s&&this.tags.push(["expiration",s.toString()])}async save(){var e;if(!this.ndk)throw new Error("NDK is required");this.content=JSON.stringify({quoteId:this.quoteId,mint:this.mint,amount:this.amount,unit:this.unit}),await this.encrypt(this.ndk.activeUser,void 0,"nip44"),await this.sign(),await this.publish((e=this._wallet)==null?void 0:e.relaySet)}},pe(hs,"kind",NDKKind.CashuQuote),hs);async function createOutTxEvent(n,t,e,s,{nutzaps:a}={}){var y,g,x;let o=t.paymentDescription,f;t.pr?(f=getBolt11Amount(t.pr),o??(o=getBolt11Description(t.pr)),f&&(f/=1e3)):f=t.amount,f||console.error("BUG: Unable to find amount for paymentRequest",t);const p=new NDKCashuWalletTx(n);if(p.direction="out",p.amount=f??0,p.mint=e.mint,p.description=o,e.fee&&(p.fee=e.fee),t.target&&(p.tags.push(t.target.tagReference()),t.target instanceof NDKUser||p.tags.push(["p",t.target.pubkey])),a){p.description??(p.description="nutzap redeem");for(const E of a)p.addRedeemedNutzap(E)}return(y=e.stateUpdate)!=null&&y.created&&(p.createdTokens=[e.stateUpdate.created]),(g=e.stateUpdate)!=null&&g.deleted&&(p.destroyedTokenIds=e.stateUpdate.deleted),(x=e.stateUpdate)!=null&&x.reserved&&(p.reservedTokens=[e.stateUpdate.reserved]),await p.sign(),p.publish(s),p}async function createInTxEvent(n,t,e,s,{nutzaps:a,fee:o,description:f},p){const y=new NDKCashuWalletTx(n),g=proofsTotalBalance(t);if(y.direction="in",y.amount=g,y.mint=e,y.description=f,s.created&&(y.createdTokens=[s.created]),s.deleted&&(y.destroyedTokenIds=s.deleted),s.reserved&&(y.reservedTokens=[s.reserved]),a)for(const x of a)y.addRedeemedNutzap(x);return o&&(y.fee=o),await y.sign(),y.publish(p),y}var d=createDebug3("ndk-wallet:cashu:deposit");function randomMint(n){const t=n.mints;return t[Math.floor(Math.random()*t.length)]}var NDKCashuDeposit=class ef extends libExports.EventEmitter{constructor(e,s,a){super();pe(this,"mint");pe(this,"amount");pe(this,"quoteId");pe(this,"wallet");pe(this,"checkTimeout");pe(this,"checkIntervalLength",2500);pe(this,"finalized",!1);pe(this,"quoteEvent");this.wallet=e,this.mint=a||randomMint(e),this.amount=s}static fromQuoteEvent(e,s){if(!s.amount)throw new Error("quote has no amount");if(!s.mint)throw new Error("quote has no mint");const a=new ef(e,s.amount,s.mint);return a.quoteId=s.quoteId,a}async start(e=2500){const a=await(await this.wallet.getCashuWallet(this.mint)).createMintQuote(this.amount);return d("created quote %s for %d %s",a.quote,this.amount,this.mint),this.quoteId=a.quote,this.wallet.depositMonitor.addDeposit(this),setTimeout(this.check.bind(this,e),e),this.createQuoteEvent(a.quote,a.request).then(o=>this.quoteEvent=o),a.request}async createQuoteEvent(e,s){const{ndk:a}=this.wallet,o=new NDKCashuQuote(a);o.quoteId=e,o.mint=this.mint,o.amount=this.amount,o.wallet=this.wallet,o.invoice=s;try{await o.save(),d("saved quote on event %s",o.rawEvent())}catch(f){d("error saving quote on event %s",f.relayErrors)}return o}async runCheck(){this.finalized||await this.finalize(),this.finalized||this.delayCheck()}delayCheck(){setTimeout(()=>{this.runCheck(),this.checkIntervalLength+=500},this.checkIntervalLength)}async check(e){this.runCheck(),e&&setTimeout(()=>{clearTimeout(this.checkTimeout)},e)}async finalize(){if(!this.quoteId)throw new Error("No quoteId set.");let e;try{d("Checking for minting status of %s",this.quoteId);const s=await this.wallet.getCashuWallet(this.mint),a=await this.wallet.state.getProofs({mint:this.mint});if(e=await s.mintProofs(this.amount,this.quoteId,{proofsWeHave:a}),e.length===0)return}catch(s){if(s.message.match(/not paid/i))return;if(s.message.match(/already issued/i)){d("Mint is saying the quote has already been issued, destroying quote event: %s",s.message),this.destroyQuoteEvent(),this.finalized=!0;return}if(s.message.match(/rate limit/i)){d("Mint seems to be rate limiting, lowering check interval"),this.checkIntervalLength+=5e3;return}d(s.message);return}try{this.finalized=!0;const s=await this.wallet.state.update({store:e,mint:this.mint},"Deposit"),a=s.created;if(!a)throw new Error("no token event created");createInTxEvent(this.wallet.ndk,e,this.mint,s,{description:"Deposit"},this.wallet.relaySet),this.emit("success",a),this.destroyQuoteEvent()}catch(s){this.emit("error",s.message),console.error(s)}}async destroyQuoteEvent(){if(!this.quoteEvent)return;(await this.quoteEvent.delete(void 0,!1)).publish(this.wallet.relaySet)}};async function handleEventDeletion(n){const t=n.getMatchingTags("e").map(e=>e[1]);for(const e of t)this.state.removeTokenId(e)}async function handleQuote(n){const t=await NDKCashuQuote.from(n);if(!t)return;const e=NDKCashuDeposit.fromQuoteEvent(this,t);this.depositMonitor.addDeposit(e)&&e.finalize()}async function handleToken(n){if(this.state.tokens.has(n.id))return;const t=await NDKCashuToken.from(n);if(t){for(const e of t.deletedTokens)this.state.removeTokenId(e);this.state.addToken(t)}}setInterval(()=>{},5e3);var handlers={[NDKKind.CashuToken]:handleToken,[NDKKind.CashuQuote]:handleQuote,[NDKKind.EventDeletion]:handleEventDeletion},balanceUpdateTimer=null;async function eventHandler(n){const t=handlers[n.kind];t&&(balanceUpdateTimer&&clearTimeout(balanceUpdateTimer),await t.call(this,n),balanceUpdateTimer=setTimeout(()=>{this.emit("balance_updated")},100))}async function eventDupHandler(n,t,e,s,a){}var d2=createDebug3("ndk-wallet:cashu:validate");async function consolidateTokens(){d2("checking %d tokens for spent proofs",this.state.tokens.size);const n=new Set(this.state.getMintsProofs({validStates:new Set(["available","reserved","deleted"])}).keys());d2("found %d mints",n.size),n.forEach(t=>{consolidateMintTokens(t,this)})}async function consolidateMintTokens(n,t,e,s,a){var A,S;e??(e=t.state.getProofs({mint:n,includeDeleted:!0,onlyAvailable:!1}));const o=await walletForMint(n);if(!o)return;let f=[];try{f=await o.checkProofsStates(e)}catch{return}const p=[],y=[],g=[];e.forEach((I,_)=>{const{state:R}=f[_];R===CheckStateEnum.SPENT?p.push(I):R===CheckStateEnum.UNSPENT?y.push(I):g.push(I)});const x={mint:n,store:y,destroy:p};if(p.reduce((I,_)=>I+_.amount,0),((A=x.destroy)==null?void 0:A.length)===0)return;(S=x.store)==null||S.push(...g);const E=g.reduce((I,_)=>I+_.amount,0);return t.state.reserveProofs(g,E),t.state.update(x,"Consolidate")}function calculateFee(n,t,e){const s=t.reduce((f,p)=>f+p.amount,0),a=e.reduce((f,p)=>f+p.amount,0),o=s-n-a;if(o<0)throw new Error("Invalid fee calculation: received more proofs than sent to mint");return o}async function withProofReserve(n,t,e,s,a,o){t??(t=await n.getCashuWallet(e));const f=n.state.getProofs({mint:e,onlyAvailable:!0}),p=t.selectProofsToSend(f,s);if(p.send.reduce((A,S)=>A+S.amount,0)<s)return null;n.state.reserveProofs(p.send,s);let g=null,x=null,E=null;try{if(g=await o(p.send,f),!g)return null;x={mint:e,store:g.change,destroy:p.send},E=await n.state.update(x)}catch(A){throw n.state.unreserveProofs(p.send,s,"available"),A}return g?{result:g.result,proofsChange:x,stateUpdate:E,mint:e,fee:calculateFee(a,p.send,g.change)}:null}async function payLn(n,t,{amount:e,unit:s}={}){var f,p;let a=getBolt11Amount(t);if(!a)throw new Error("invoice amount is required");a=a/1e3,e&&s&&s==="msat"&&(e=e/1e3);const o=n.getMintsWithBalance(a+3);if(!o.length)return null;for(const y of o)try{const g=await executePayment(y,t,e??a,n);if(g)return e&&(g.fee=calculateFee(e,((f=g.proofsChange)==null?void 0:f.destroy)??[],((p=g.proofsChange)==null?void 0:p.store)??[])),g}catch(g){n.warn(`Failed to execute payment with min ${y}: ${g}`)}return null}async function executePayment(n,t,e,s){const a=await s.getCashuWallet(n);try{const o=await a.createMeltQuote(t),f=o.amount+o.fee_reserve;return await withProofReserve(s,a,n,f,e,async(y,g)=>{const x=await a.meltProofs(o,y);return x.quote.state===MeltQuoteState.PAID?{result:{preimage:x.quote.payment_preimage??""},change:x.change}:null})}catch(o){if(o instanceof Error)if(o.message.match(/already spent/i))setTimeout(()=>{consolidateMintTokens(n,s)},2500);else throw o;return null}}function ensureIsCashuPubkey(n){if(!n)return;let t=n;if(t.length===64&&(t=`02${t}`),t.length!==66)throw new Error("Invalid pubkey");return t}async function mintProofs(n,t,e,s,a){const o=(f,p,y)=>{const g=ensureIsCashuPubkey(a);n.mintProofs(e,t.quote,{pubkey:g}).then(x=>{console.debug("minted tokens",x),f({proofs:x,mint:s})}).catch(x=>{y++,y<=3?(console.error("error minting tokens",x),setTimeout(()=>o(f,p,y),y*1500)):p(x)})};return new Promise((f,p)=>{o(f,p,0)})}async function createToken(n,t,e,s){s=ensureIsCashuPubkey(s);const a=n.getMintsWithBalance(t),o=e&&e.length>0,f=o?findMintsInCommon([e,a]):a;for(const p of f)try{const y=await createTokenInMint(n,p,t,s);if(y)return y}catch{}return o?await createTokenWithMintTransfer(n,t,e,s):null}async function createTokenInMint(n,t,e,s){const a=await n.getCashuWallet(t);try{return await withProofReserve(n,a,t,e,e,async(f,p)=>{const y=await a.send(e,f,{pubkey:s,proofsWeHave:p});return{result:{proofs:y.send,mint:t},change:y.keep,mint:t}})}catch{}return null}async function createTokenWithMintTransfer(n,t,e,s){const a=async()=>{const S=async D=>{const M=await walletForMint(D);if(!M)throw new Error(`unable to load wallet for mint ${D}`);return{quote:await M.createMintQuote(t),mint:D,targetMintWallet:M}},I=e.map(S),{quote:_,mint:R,targetMintWallet:N}=await Promise.any(I);if(!_)throw new Error("failed to get quote from any mint");return{quote:_,mint:R,targetMintWallet:N}},{quote:o,mint:f,targetMintWallet:p}=await a();if(!o)return null;const y=getBolt11Amount(o.request);if(!y)throw new Error("invoice amount is required");const g=y/1e3;if(g>t)throw new Error(`invoice amount is more than the amount passed in (${g} vs ${t})`);const x=await payLn(n,o.request,{amount:t});if(!x)return null;const{proofs:E,mint:A}=await mintProofs(p,o,t,f,s);return{...x,result:{proofs:E,mint:A},fee:x.fee}}function findMintsInCommon(n){const t=new Map;for(const s of n)for(const a of s){const o=normalizeUrl(a);t.has(o)?t.set(o,t.get(o)+1):t.set(o,1)}const e=[];for(const[s,a]of t.entries())a===n.length&&e.push(s);return e}var PaymentHandler=class{constructor(n){pe(this,"wallet");this.wallet=n}async lnPay(n,t=!0){var a;if(!n.pr)throw new Error("pr is required");const e=getBolt11Amount(n.pr);if(!e)throw new Error("invoice amount is required");if(n.amount&&e>n.amount)throw new Error("invoice amount is more than the amount passed in");const s=await payLn(this.wallet,n.pr,{amount:n.amount,unit:n.unit});if((a=s==null?void 0:s.result)!=null&&a.preimage)return t&&createOutTxEvent(this.wallet.ndk,n,s,this.wallet.relaySet),s.result}async cashuPay(n){var s;const t={...n};(s=t.unit)!=null&&s.startsWith("msat")&&(t.amount=t.amount/1e3,t.unit="sat");let e=await createToken(this.wallet,t.amount,n.mints,n.p2pk);if(!(!e&&(n.allowIntramintFallback&&(e=await createToken(this.wallet,t.amount,void 0,n.p2pk)),!e)))return createOutTxEvent(this.wallet.ndk,t,e,this.wallet.relaySet),e.result}};function getBalance(n){return this.getProofEntries(n).reduce((e,s)=>e+s.proof.amount,0)}function getMintsBalances({onlyAvailable:n}={onlyAvailable:!0}){var s;const t={},e=this.getProofEntries({onlyAvailable:n});for(const a of e)a.mint&&(t[s=a.mint]??(t[s]=0),t[a.mint]+=a.proof.amount);return t}function addProof(n){this.proofs.set(n.proof.C,n),this.journal.push({memo:"Added proof",timestamp:Date.now(),metadata:{type:"proof",id:n.proof.C,amount:n.proof.amount,mint:n.mint}})}function reserveProofs(n,t){for(const e of n)this.updateProof(e,{state:"reserved"});this.reserveAmounts.push(t)}function unreserveProofs(n,t,e){for(const a of n)this.updateProof(a,{state:e});const s=this.reserveAmounts.indexOf(t);if(s!==-1)this.reserveAmounts.splice(s,1);else throw new Error(`BUG: Amount ${t} not found in reserveAmounts`)}function getProofEntries(n={}){const t=new Map,e=new Set(["available"]);let{mint:s,onlyAvailable:a,includeDeleted:o}=n;a??(a=!0),a||e.add("reserved"),o&&e.add("deleted");for(const f of this.proofs.values())s&&f.mint!==s||e.has(f.state)&&f.proof&&t.set(f.proof.C,f);return Array.from(t.values())}function updateProof(n,t){const e=n.C,s=this.proofs.get(e);if(!s)throw new Error("Proof not found");const a={...s,...t};this.proofs.set(e,a),this.journal.push({memo:`Updated proof state: ${JSON.stringify(t)}`,timestamp:Date.now(),metadata:{type:"proof",id:e,amount:n.amount,mint:s.mint}})}function addToken(n){if(!n.mint)throw new Error("BUG: Token has no mint");const t=this.tokens.get(n.id),e=(t==null?void 0:t.state)??"available";this.tokens.set(n.id,{token:n,state:e});for(const s of n.proofs)maybeAssociateProofWithToken(this,s,n,e)}function maybeAssociateProofWithToken(n,t,e,s){const a=t.C,o=n.proofs.get(a);if(!o)return n.addProof({mint:e.mint,state:s,tokenId:e.id,timestamp:e.created_at,proof:t}),!0;if(o.tokenId){if(o.tokenId===e.id)return null;const f=n.tokens.get(o.tokenId);if(!f)throw new Error(`BUG: Token id ${o.tokenId} not found, was expected to be associated with proof ${a}`);const p=f.token;return p&&p.created_at&&(!e.created_at||e.created_at<p.created_at)?!1:(n.updateProof(t,{tokenId:e.id,state:s}),!0)}return n.updateProof(t,{tokenId:e.id,state:s}),!0}function removeTokenId(n){const t=this.tokens.get(n)||{};this.tokens.set(n,{...t,state:"deleted"});for(const e of this.proofs.values()){const{proof:s}=e;if(e.tokenId===n){if(!s)throw new Error("BUG: Proof entry has no proof");this.updateProof(s,{state:"deleted"})}}}async function update(n,t){return updateInternalState(this,n),this.wallet.emit("balance_updated"),updateExternalState(this,n)}function updateInternalState(n,t){if(t.store&&t.store.length>0)for(const e of t.store)n.addProof({mint:t.mint,state:"available",proof:e,timestamp:Date.now()});if(t.destroy&&t.destroy.length>0)for(const e of t.destroy)n.updateProof(e,{state:"deleted"});if(t.reserve&&t.reserve.length>0)throw new Error("BUG: Proofs should not be reserved via update")}async function updateExternalState(n,t){const e=calculateNewState(n,t);if(e.deletedTokenIds.size>0){const a=new NDKEvent(n.wallet.ndk,{kind:NDKKind.EventDeletion,tags:[["k",NDKKind.CashuToken.toString()],...Array.from(e.deletedTokenIds).map(o=>["e",o])]});await a.sign(),publishWithRetry(n,a,n.wallet.relaySet);for(const o of e.deletedTokenIds)n.removeTokenId(o)}const s={};if(e.saveProofs.length>0){const a=await createTokenEvent(n,t.mint,e);s.created=a}return s}async function publishWithRetry(n,t,e,s=10*1e3){let a;a=await t.publish(e);let o;t.kind===NDKKind.EventDeletion&&(o="deletion"),t.kind===NDKKind.CashuToken&&(o="token"),t.kind===NDKKind.CashuWallet&&(o="wallet");const f={type:o,id:t.id,relayUrl:e==null?void 0:e.relayUrls.join(",")};if(a)return n.journal.push({memo:`Publish kind:${t.kind} succeesfully`,timestamp:Date.now(),metadata:f}),a;n.journal.push({memo:"Publish failed",timestamp:Date.now(),metadata:f}),setTimeout(()=>{publishWithRetry(n,t,e,s)},s)}async function createTokenEvent(n,t,e){const s=new NDKCashuToken(n.wallet.ndk);return s.mint=t,s.proofs=e.saveProofs,await s.toNostrEvent(),n.addToken(s),s.deletedTokens=Array.from(e.deletedTokenIds),await s.sign(),n.addToken(s),publishWithRetry(n,s,n.wallet.relaySet),s}function calculateNewState(n,t){const e=new Set;for(const o of t.destroy||[])e.add(o.C);const s=new Map;let a;for(const o of t.store||[])s.set(o.C,o);a=getAffectedTokens(n,t);for(const o of a.values())for(const f of o.proofs)e.has(f.C)||s.set(f.C,f);return{deletedTokenIds:new Set(a.keys()),deletedProofs:e,reserveProofs:[],saveProofs:Array.from(s.values())}}function getAffectedTokens(n,t){const e=new Map;for(const s of t.destroy||[]){const a=n.proofs.get(s.C);if(!a)continue;const o=a.tokenId;if(!o)continue;const f=n.tokens.get(o);f!=null&&f.token&&e.set(o,f.token)}return e}var WalletState=class{constructor(n,t=new Set){pe(this,"reserveAmounts",[]);pe(this,"proofs",new Map);pe(this,"tokens",new Map);pe(this,"journal",[]);pe(this,"addToken",addToken.bind(this));pe(this,"removeTokenId",removeTokenId.bind(this));pe(this,"addProof",addProof.bind(this));pe(this,"reserveProofs",reserveProofs.bind(this));pe(this,"unreserveProofs",unreserveProofs.bind(this));pe(this,"getProofEntries",getProofEntries.bind(this));pe(this,"updateProof",updateProof.bind(this));pe(this,"getBalance",getBalance.bind(this));pe(this,"getMintsBalance",getMintsBalances.bind(this));pe(this,"update",update.bind(this));this.wallet=n,this.reservedProofCs=t}dump(){return{proofs:Array.from(this.proofs.values()),balances:this.getMintsBalance(),totalBalance:this.getBalance(),tokens:Array.from(this.tokens.values())}}getProofs(n){return this.getProofEntries(n).map(t=>t.proof)}getTokens(n={onlyAvailable:!0}){var s;const t=this.getProofEntries(n),e=new Map;for(const a of t){const o=a.tokenId??null,f=e.get(o)??{tokenId:o,mint:a.mint,proofEntries:[]};f.token??(f.token=o?(s=this.tokens.get(o))==null?void 0:s.token:void 0),f.proofEntries.push(a),e.set(o,f)}return e}getMintsProofs({validStates:n=new Set(["available"])}={}){const t=new Map;for(const e of this.proofs.values()){if(!e.mint||!e.proof||!n.has(e.state))continue;const s=t.get(e.mint)||[];s.push(e.proof),t.set(e.mint,s)}return t}};function log(n){}var Li;Li=class extends NDKWallet{constructor(e){super(e);pe(this,"_p2pk");pe(this,"sub");pe(this,"status","initial");pe(this,"mints",[]);pe(this,"privkeys",new Map);pe(this,"signer");pe(this,"walletId","nip-60");pe(this,"depositMonitor",new NDKCashuDepositMonitor);pe(this,"warnings",[]);pe(this,"paymentHandler");pe(this,"state");pe(this,"relaySet");pe(this,"consolidateTokens",consolidateTokens.bind(this));pe(this,"wallets",new Map);this.ndk=e,this.paymentHandler=new PaymentHandler(this),this.state=new WalletState(this)}get type(){return"nip-60"}async backup(e=!0){if(this.privkeys.size===0)throw new Error("no privkey to backup");const s=new NDKCashuWalletBackup(this.ndk),a=[];for(const[o,f]of this.privkeys.entries())a.push(f.privateKey);return s.privkeys=a,s.mints=this.mints,e&&s.save(this.relaySet),s}async mintNuts(e){let s;const a=e.reduce((o,f)=>o+f,0);for(const o of this.mints){const f=await this.getCashuWallet(o),p=await this.state.getProofs({mint:o});if(s=await f.send(a,p,{proofsWeHave:p,includeFees:!0,outputAmounts:{sendAmounts:e}}),s.send.length>0){const y={store:(s==null?void 0:s.keep)??[],destroy:s.send,mint:o},g=await this.state.update(y);return createOutTxEvent(this.ndk,{paymentDescription:"minted nuts",amount:e.reduce((x,E)=>x+E,0)},{result:{proofs:s.send},stateUpdate:g,mint:o,fee:0},this.relaySet),this.emit("balance_updated"),s}}}async loadFromEvent(e){const s=new NDKEvent(e.ndk,e.rawEvent());await s.decrypt();const a=JSON.parse(s.content);for(const o of a)o[0]==="mint"?this.mints.push(o[1]):o[0]==="privkey"&&await this.addPrivkey(o[1]);await this.getP2pk()}static async from(e){if(!e.ndk)throw new Error("no ndk instance on event");const s=new Li(e.ndk);return await s.loadFromEvent(e),s}start(e){var p;const s=(p=this.ndk)==null?void 0:p.activeUser;if(this.status==="ready")return;this.status="loading";const a=(e==null?void 0:e.pubkey)??(s==null?void 0:s.pubkey);if(!a)throw new Error("no pubkey");const o=[{kinds:[NDKKind.CashuToken],authors:[a]},{kinds:[NDKKind.CashuQuote],authors:[a]},{kinds:[NDKKind.EventDeletion],authors:[a],"#k":[NDKKind.CashuToken.toString()]}];e!=null&&e.since&&(o[0].since=e.since,o[1].since=e.since,o[2].since=e.since);const f=e??{};f.subId??(f.subId="cashu-wallet-state"),`${JSON.stringify(o)}${JSON.stringify(e)}`,this.sub=this.ndk.subscribe(o,{...f,relaySet:this.relaySet},!1),this.sub.on("event:dup",eventDupHandler.bind(this)),this.sub.on("event",y=>{`${y.kind}`,eventHandler.call(this,y)}),this.sub.on("eose",()=>{this.emit("ready"),this.status="ready"}),this.sub.start(!0)}stop(){var e;(e=this.sub)==null||e.stop(),this.status="initial"}async getP2pk(){if(this._p2pk)return this._p2pk;if(this.privkeys.size===0){const e=NDKPrivateKeySigner.generate();await this.addPrivkey(e.privateKey)}return this.p2pk}get p2pks(){return Array.from(this.privkeys.keys())}async addPrivkey(e){const s=new NDKPrivateKeySigner(e),a=await s.user();return this.privkeys.set(a.pubkey,s),this._p2pk??(this._p2pk=a.pubkey),this._p2pk}get p2pk(){if(!this._p2pk)throw new Error("p2pk not set");return this._p2pk}set p2pk(e){if(this.privkeys.has(e))this.signer=this.privkeys.get(e),this.p2pk=e;else throw new Error(`privkey for ${e} not found`)}walletPayload(){const e=Array.from(this.privkeys.values()).map(s=>s.privateKey);return payloadForEvent(e,this.mints)}async publish(){var a,o;const e=new NDKEvent(this.ndk,{content:JSON.stringify(this.walletPayload()),kind:NDKKind.CashuWallet}),s=await((o=(a=this.ndk)==null?void 0:a.signer)==null?void 0:o.user());return await e.encrypt(s,void 0,"nip44"),e.publish(this.relaySet)}deposit(e,s){const a=new NDKCashuDeposit(this,e,s);return a.on("success",o=>{this.state.addToken(o)}),a}async receiveToken(e,s){const{mint:a}=getDecodedToken(e),f=await(await this.getCashuWallet(a)).receive(e),p=await this.state.update({store:f,mint:a}),y=p.created;return createInTxEvent(this.ndk,f,a,p,{description:s},this.relaySet),y}async lnPay(e,s=!0){return this.paymentHandler.lnPay(e,s)}async cashuPay(e){return this.paymentHandler.cashuPay(e)}async redeemNutzaps(e,s,{mint:a,proofs:o,cashuWallet:f}){if(f)a??(a=f.mint.mintUrl);else{if(!a)throw new Error("mint not set");f=await this.getCashuWallet(a)}if(!a)throw new Error("mint not set");if(!o)throw new Error("proofs not set");try{const p=this.state.getProofs({mint:a}),y=await f.receive({proofs:o,mint:a},{proofsWeHave:p,privkey:s}),g=o.reduce((S,I)=>S+I.amount,0),x=y.reduce((S,I)=>S+I.amount,0),E=g-x,A=await this.state.update({store:y,mint:a});return createInTxEvent(this.ndk,y,a,A,{nutzaps:e,fee:E},this.relaySet),g}catch(p){throw console.error("error redeeming nutzaps",e.map(y=>y.encode()),p),p}}warn(e,s,a){a??(a=s==null?void 0:s.onRelays),this.warnings.push({msg:e,event:s,relays:a}),this.emit("warning",{msg:e,event:s,relays:a})}get balance(){return{amount:this.state.getBalance({onlyAvailable:!0})}}mintBalance(e){return this.mintBalances[e]||0}get mintBalances(){return this.state.getMintsBalance({onlyAvailable:!0})}getMintsWithBalance(e){const s=this.state.getMintsBalance({onlyAvailable:!0});return Object.entries(s).filter(([a,o])=>o>=e).map(([a])=>a)}},pe(Li,"kind",NDKKind.CashuWallet),pe(Li,"kinds",[NDKKind.CashuWallet]);var NDKCashuWalletBackup=class tf extends NDKEvent{constructor(e,s){super(e,s);pe(this,"privkeys",[]);pe(this,"mints",[]);this.kind??(this.kind=NDKKind.CashuWalletBackup)}static async from(e){if(!e.ndk)throw new Error("no ndk instance on event");const s=new tf(e.ndk,e);try{await s.decrypt();const a=JSON.parse(s.content);for(const o of a)o[0]==="mint"?s.mints.push(o[1]):o[0]==="privkey"&&s.privkeys.push(o[1])}catch(a){console.error("error decrypting backup event",s.encode(),a);return}return s}async save(e){if(!this.ndk)throw new Error("no ndk instance");if(!this.privkeys.length)throw new Error("no privkeys");return this.content=JSON.stringify(payloadForEvent(this.privkeys,this.mints)),await this.encrypt(this.ndk.activeUser,void 0,"nip44"),this.publish(e)}};function payloadForEvent(n,t){if(n.length===0)throw new Error("privkey not set");return[...t.map(s=>["mint",s]),...n.map(s=>["privkey",s])]}createDebug3("ndk-wallet:nwc");var inSeconds=n=>n/1e3,fetchProfileImplementation=(n,t,e,s)=>{const a=s==null?void 0:s.refresh,{ndk:o,profiles:f}=t();if(!o){console.error("NDK instance is not initialized. Did you use useNDKInit at the beginning of your app?");return}if(!e||f.get(e)&&!a)return;o.getUser({pubkey:e}).fetchProfile(s==null?void 0:s.subOpts).then(g=>{n(x=>{const E=new Map(x.profiles);g&&E.set(e,g);const A=new Map(x.lastFetchedAt);return A.set(e,inSeconds(Date.now())),{profiles:E,lastFetchedAt:A}})}).catch(g=>{n(x=>{const E=new Map(x.lastFetchedAt);return E.set(e,inSeconds(Date.now())),{lastFetchedAt:E}})})};function initializeProfilesStore(n,t){const e=t.cacheAdapter;if(e!=null&&e.getAllProfilesSync){const s=e.getAllProfilesSync(),a=new Map,o=new Map;for(const[f,p]of s)a.set(f,p),o.set(f,p.cachedAt??0);n({profiles:a,lastFetchedAt:o,ndk:t})}else n({ndk:t})}var setProfileImplementation=(n,t,e,s)=>{n(a=>{const o=new Map(a.profiles);o.set(t,e);const f=new Map(a.lastFetchedAt);return f.set(t,s??inSeconds(Date.now())),{profiles:o,lastFetchedAt:f}})};create((n,t)=>({profiles:new Map,lastFetchedAt:new Map,ndk:void 0,initialize:e=>initializeProfilesStore(n,e),setProfile:(e,s,a)=>setProfileImplementation(n,e,s,a),fetchProfile:(e,s)=>fetchProfileImplementation(n,t,e,s)}));var useNDKStore=create(n=>({ndk:null,setNDK:t=>{n({ndk:t})},setSigner:t=>{n(e=>(e.ndk&&(e.ndk.signer=t),{ndk:e.ndk}))}})),initMutes=(n,t,e)=>{n(s=>{if(s.mutes.has(e))return{};const a=new Map(s.mutes);return a.set(e,{pubkeys:new Set,hashtags:new Set,words:new Set,eventIds:new Set}),{mutes:a}})};function computeMuteCriteria(n,t){return{pubkeys:new Set([...(n==null?void 0:n.pubkeys)??[],...t.pubkeys??[]]),eventIds:new Set([...(n==null?void 0:n.eventIds)??[],...t.eventIds??[]]),hashtags:new Set([...(n==null?void 0:n.hashtags)??[],...t.hashtags??[]]),words:new Set([...(n==null?void 0:n.words)??[],...t.words??[]])}}var isMuted=(n,t)=>{if(!t)return!1;const{pubkeys:e,eventIds:s,hashtags:a,words:o}=t;if(e.has(n.pubkey)||s.has(n.id))return!0;if(s.size>0||a.size>0){for(const f of n.tags)if(f[0]==="e"&&s.has(f[1])||f[0]==="t"&&[...a].some(p=>{var y;return p.toLowerCase()===((y=f[1])==null?void 0:y.toLowerCase())}))return!0}if(o&&o.size>0&&n.content){const f=n.content.split(/\s+/).map(p=>p.toLowerCase());for(const p of f)if(o.has(p))return!0}return!1},EMPTY_MUTE_CRITERIA={pubkeys:new Set,eventIds:new Set,hashtags:new Set,words:new Set};function useMuteFilter(){const n=useActiveMuteCriteria();return reactExports.useCallback(t=>isMuted(t,n),[n])}function useActiveMuteCriteria(){return useNDKMutes(n=>n.muteCriteria)}var loadMuteList=(n,t,e)=>{n(s=>{const a=e.pubkey;s.mutes.has(a)||initMutes(n,t,a);const o=s.mutes.get(a)??EMPTY_MUTE_CRITERIA;if(!o)return{};const f={...o,pubkeys:new Set,eventIds:new Set,hashtags:new Set,words:new Set,muteListEvent:NDKList.from(e)};for(const g of e.tags)g[0]==="p"?f.pubkeys.add(g[1]):g[0]==="e"?f.eventIds.add(g[1]):g[0]==="t"?f.hashtags.add(g[1]):g[0]==="word"&&f.words.add(g[1]);const p=new Map(s.mutes);p.set(a,f);let y={mutes:p};return s.activePubkey===a&&(y={...y,muteCriteria:computeMuteCriteria(f,s.extraMutes),muteList:NDKList.from(e)}),y})};function identifyMuteItem(n){let t,e;if(n instanceof NDKEvent)t="event",e=n.id;else if(n instanceof NDKUser)t="pubkey",e=n.pubkey;else if(typeof n=="string")n.startsWith("#")&&n.length>1?(t="hashtag",e=n.substring(1)):(t="word",e=n);else{console.warn("identifyMuteItem: Invalid item type provided.",n);return}return{type:t,value:e}}function newMuteList(n){const t=new NDKList(n);return t.kind=NDKKind.MuteList,t}var mute=(n,t,e,s)=>{const a=identifyMuteItem(e);if(!a){console.warn("mute: Unable to identify item to mute. Item:",e);return}const o=t(),f=s||o.activePubkey;if(!f){console.warn("mute: No pubkey provided and no active pubkey found.");return}const p=o.ndk;if(!p){console.warn("mute: NDK instance is not initialized. Call init first.");return}o.mutes.has(f)||initMutes(n,t,f);const{type:y,value:g}=a;n(x=>{const E=x.mutes.get(f);if(!E)return{};const A=new Set(E.pubkeys),S=new Set(E.eventIds),I=new Set(E.hashtags),_=new Set(E.words),R=E.muteListEvent?NDKList.from(E.muteListEvent):newMuteList(p);switch(y){case"pubkey":A.add(g),R.tags.push(["p",g]);break;case"event":S.add(g),R.tags.push(["e",g]);break;case"hashtag":I.add(g),R.tags.push(["t",g]);break;case"word":_.add(g),R.tags.push(["word",g]);break;default:console.warn("mute: Unknown item type:",y)}const N={...E,pubkeys:A,eventIds:S,hashtags:I,words:_,muteListEvent:R},D=new Map(x.mutes);D.set(f,N);let M={mutes:D};return x.activePubkey===f&&(M={...M,muteCriteria:computeMuteCriteria(N,x.extraMutes),muteList:NDKList.from(R)}),setTimeout(()=>R.publishReplaceable(),0),M})},unmute=(n,t,e,s)=>{const a=identifyMuteItem(e);if(!a){console.warn("unmute: Unable to identify item to unmute. Item:",e);return}const o=t(),f=s||o.activePubkey;if(!f){console.warn("unmute: No pubkey provided and no active pubkey found.");return}const p=o.mutes.get(f);if(!p){console.warn("unmute: No mutes initialized for pubkey",f);return}if(!p.muteListEvent){console.warn("unmute: No existing mute list event to modify.");return}n(g=>{const{type:x,value:E}=a,A=g.mutes.get(f);if(!A)return{};const S=new Set(A.pubkeys),I=new Set(A.eventIds),_=new Set(A.hashtags),R=new Set(A.words),N=A.muteListEvent?NDKList.from(A.muteListEvent):void 0;if(!N)return console.warn("unmute: No existing mute list event to modify."),{};switch(x){case"pubkey":S.delete(E),N.tags=N.tags.filter(B=>!(B[0]==="p"&&B[1]===E));break;case"event":I.delete(E),N.tags=N.tags.filter(B=>!(B[0]==="e"&&B[1]===E));break;case"hashtag":_.delete(E),N.tags=N.tags.filter(B=>!(B[0]==="t"&&B[1]===E));break;case"word":R.delete(E),N.tags=N.tags.filter(B=>!(B[0]==="word"&&B[1]===E));break}const D={...A,pubkeys:S,eventIds:I,hashtags:_,words:R,muteListEvent:N},M=new Map(g.mutes);M.set(f,D);let W={mutes:M};return g.activePubkey===f&&(W={...W,muteCriteria:computeMuteCriteria(D,g.extraMutes),muteList:NDKList.from(N)}),setTimeout(()=>N.publishReplaceable(),0),W})};function setActivePubkey(n,t){n(e=>{const s=t?e.mutes.get(t):void 0;return{activePubkey:t,muteCriteria:computeMuteCriteria(s,e.extraMutes)}})}var addExtraMuteItems=(n,t,e)=>{n(s=>{const a=new Set(s.extraMutes.pubkeys),o=new Set(s.extraMutes.eventIds),f=new Set(s.extraMutes.hashtags),p=new Set(s.extraMutes.words);for(const x of e){const E=identifyMuteItem(x);if(!E)continue;const{type:A,value:S}=E;switch(A){case"pubkey":a.add(S);break;case"event":o.add(S);break;case"hashtag":f.add(S.toLowerCase());break;case"word":p.add(S.toLowerCase());break}}const y={pubkeys:a,eventIds:o,hashtags:f,words:p},g=s.activePubkey?s.mutes.get(s.activePubkey):void 0;return{extraMutes:y,muteCriteria:computeMuteCriteria(g,y)}})},mutesStateCreator=(n,t)=>({ndk:void 0,mutes:new Map,extraMutes:{pubkeys:new Set,hashtags:new Set,words:new Set,eventIds:new Set},activePubkey:null,muteList:new NDKList,muteCriteria:{pubkeys:new Set,eventIds:new Set,hashtags:new Set,words:new Set},init:e=>{n({ndk:e})},initMutes:e=>initMutes(n,t,e),loadMuteList:e=>loadMuteList(n,t,e),mute:(e,s)=>mute(n,t,e,s),unmute:(e,s)=>unmute(n,t,e,s),setActivePubkey:e=>setActivePubkey(n,e),addExtraMuteItems:e=>addExtraMuteItems(n,t,e)}),useNDKMutes=create(mutesStateCreator),createDefaultSession=n=>({pubkey:n,events:new Map,lastActive:Date.now()/1e3}),addSession=async(n,t,e,s=!0)=>{let a,o,f;if(e instanceof NDKUser)a=e,f=a.pubkey;else{o=e;try{a=await o.user(),f=a.pubkey,n(p=>{const y=new Map(p.signers);return y.set(f,o),{signers:y}})}catch(p){throw console.error("Failed to get user from signer:",p),new Error("Could not retrieve user from the provided signer.")}}return n(p=>{const y=new Map(p.sessions);let g=y.get(f);g?(g={...g,lastActive:Date.now()/1e3},y.set(f,g),console.debug(`Session already exists for ${f}, updating lastActive.`)):(g=createDefaultSession(f),y.set(f,g));const x={sessions:y};return s&&(x.activePubkey=f,useNDKStore.getState().setSigner(o)),x}),useNDKMutes.getState().initMutes(f),s&&useNDKMutes.getState().setActivePubkey(f),f},init=(n,t)=>{n({ndk:t})},removeSession=(n,t,e)=>{const s=t(),a=s.sessions.get(e);if(!a){console.warn(`No session found to remove for pubkey: ${e}`);return}if(a.subscription){console.debug(`Stopping subscription for removed session ${e}`);try{a.subscription.stop()}catch(f){console.error(`Error stopping subscription for removed session ${e}:`,f)}}const o=s.activePubkey===e;n(f=>{const p=new Map(f.sessions);p.delete(e);const y=new Map(f.signers);y.delete(e);let g=f.activePubkey,x,E=f.ndk;if(o){let A=0;g=void 0;for(const[S,I]of p.entries())I.lastActive>A&&(A=I.lastActive,g=S);x=g?y.get(g):void 0,E&&(E.signer=x)}return{sessions:p,signers:y,activePubkey:o?g:f.activePubkey}})};function handleProfileEvent(n,t){const e=profileFromEvent(n);e&&(e.created_at=n.created_at,t.profile=e)}function handleContactsEvent(n,t){const e=new Set(n.tags.filter(s=>s[0]==="p").map(s=>s[1]));t.followSet=e}function handleOtherEvent(n,t,e){var o;const s=t.events.get(n.kind);(!s||n.created_at>s.created_at)&&t.events.set(n.kind,n);const a=(o=e==null?void 0:e.events)==null?void 0:o.get(n.kind);if(a){const f=a.from(n);f&&t.events.set(n.kind,f)}}function handleKindFollowEvent(n,t,e=!0,s=n.created_at){const a=t.kindFollowSet??new Map,o=n.getMatchingTags("k").map(p=>Number(p[1])),f=n.getMatchingTags("p").map(p=>p[1]);for(const p of o)for(const y of f){const g=a.get(p)||new Map,x={followed:e,last_updated_at:s},E=g.get(y);(!E||E.last_updated_at<n.created_at)&&g.set(y,x),a.set(p,g)}t.kindFollowSet=a}function handkeEventDeletion(n,t){if(t.kindFollowSet)for(const s of n.getMatchingTags("e")){if(!s[1]||!n.ndk)continue;const a=n.ndk.fetchEventSync(s[1]);a!=null&&a[0]&&handleKindFollowEvent(a[0],t,!1,n.created_at)}}function processEvent(n,t,e){var a;const s=(a=t.events)==null?void 0:a.get(n.kind);if(!(!(!s||s.created_at<n.created_at)&&n.isReplaceable()))try{switch(n.kind){case NDKKind.Metadata:handleProfileEvent(n,t);break;case NDKKind.Contacts:handleContactsEvent(n,t);break;case NDKKind.MuteList:useNDKMutes.getState().loadMuteList(n);break;case 967:handleKindFollowEvent(n,t);break;case NDKKind.EventDeletion:handkeEventDeletion(n,t);break;default:handleOtherEvent(n,t,e)}t.events.set(n.kind,n)}catch(o){console.error(`Error processing event kind ${n.kind} for ${t.pubkey}:`,o,n)}}function buildSessionFilter(n,t){var a;const e=new Set;t.profile!==!1&&e.add(NDKKind.Metadata),t.follows!==!1&&e.add(NDKKind.Contacts),e.add(NDKKind.MuteList);for(const o of((a=t.events)==null?void 0:a.keys())||[])e.add(o);const s=[{kinds:Array.from(e),authors:[n]}];return Array.isArray(t.follows)&&s.push({kinds:[967],"#k":t.follows.map(o=>o.toString()),authors:[n]}),s}var startSession=(n,t,e,s)=>{const a=t().ndk;if(!a){console.error("NDK instance not initialized in session store. Cannot start session.");return}const o=t().sessions.get(e);if(!o)return;o.subscription&&(o.subscription.stop(),n(x=>{const E=x.sessions.get(e);if(!E)return{};const A={...E,subscription:void 0},S=new Map(x.sessions);return S.set(e,A),{sessions:S}}));const f=buildSessionFilter(e,s);if(f.length===0){console.warn(`No filters generated for session start options for pubkey ${e}. No subscription created.`);return}const p=(x,E)=>{console.log("handle session event",x.pubkey.slice(0,6),x.kind,E==null?void 0:E.url),n(A=>{const S=A.sessions.get(e);if(!S)return{};const I={...S,events:new Map(S.events)};processEvent(x,I,s);const _=new Map(A.sessions);return _.set(e,I),{sessions:_}})},y=x=>{n(E=>{const A=E.sessions.get(e);if(!A)return{};const S={...A,events:new Map(A.events)};for(const _ of x)processEvent(_,S,s);const I=new Map(E.sessions);return I.set(e,S),console.debug(`Processed ${x.length} cached events for ${e}`),{sessions:I}})};console.debug("Starting session for",e,"with filters",JSON.stringify(f,null,4));const g=a.subscribe(f,{closeOnEose:!1,addSinceFromCache:!0},{onEvent:p,onEvents:y});n(x=>{const E=x.sessions.get(e);if(!E)return{};const A={...E,subscription:g},S=new Map(x.sessions);return S.set(e,A),{sessions:S}})},stopSession=(n,t,e)=>{const s=t().sessions.get(e);if(s!=null&&s.subscription){console.debug(`Stopping session subscription for ${e}`);try{s.subscription.stop()}catch(a){console.error(`Error stopping subscription for ${e}:`,a)}n(a=>{const o=a.sessions.get(e);if(!o)return{};const f={...o,subscription:void 0},p=new Map(a.sessions);return p.set(e,f),{sessions:p}})}else console.debug(`No active subscription found for session ${e} to stop.`)},switchToUser=(n,t,e)=>{const s=t().signers;if(!t().ndk){console.error("Cannot switch user: NDK instance not initialized in session store.");return}let o;if(e!==null){if(!t().sessions.get(e)){console.error(`Cannot switch to user ${e}: Session does not exist.`);return}o=s.get(e)}useNDKStore.getState().setSigner(o),n(p=>{let y=p.sessions,g=e===null?void 0:e;if(e){const x=p.sessions.get(e);if(x){const E={...x,lastActive:Date.now()/1e3};y=new Map(p.sessions),y.set(e,E)}}return{activePubkey:g,sessions:y}});const f=useNDKMutes.getState();f.setActivePubkey(e),e&&f.initMutes(e)},updateSession=(n,t,e,s)=>{n(a=>{const o=a.sessions.get(e);if(!o)return console.warn(`Attempted to update non-existent session: ${e}`),{};const f={...o,...s,lastActive:Date.now()},p=new Map(a.sessions);return p.set(e,f),{sessions:p}})},sessionStateCreator=(n,t)=>({ndk:void 0,sessions:new Map,signers:new Map,activePubkey:void 0,init:e=>init(n,e),addSession:async(e,s)=>{const a=await addSession(n,t,e,s);return a&&s&&t().switchToUser(a),a},startSession:(e,s)=>startSession(n,t,e,s),stopSession:e=>stopSession(n,t,e),switchToUser:e=>switchToUser(n,t,e),removeSession:e=>removeSession(n,t,e),updateSession:(e,s)=>updateSession(n,t,e,s)});create(sessionStateCreator);var useNDK=()=>{const n=useNDKStore(t=>t.ndk);return reactExports.useMemo(()=>({ndk:n}),[n])},createSubscribeStore=(n=30)=>createStore((e,s)=>{const a=new Map;let o=null;const f=()=>{const p=s(),y=new Map(p.eventMap);let g=!1;for(const[x,E]of a.entries()){const A=y.get(x);(!A||A.created_at!==void 0&&E.created_at!==void 0&&E.created_at>A.created_at)&&(y.set(x,E),g=!0)}if(a.clear(),g){const x=Array.from(y.values());e({eventMap:y,events:x})}o=null};return{events:[],eventMap:new Map,eose:!1,subscriptionRef:void 0,addEvent:p=>{const y=p.tagId();if(n!==!1){const g=a.get(y),x=s().eventMap.get(y);if(g&&g.created_at!==void 0&&p.created_at!==void 0&&g.created_at>=p.created_at||x&&x.created_at!==void 0&&p.created_at!==void 0&&x.created_at>=p.created_at)return;a.set(y,p),o||(o=setTimeout(f,n))}else{const g=s(),x=new Map(g.eventMap),E=x.get(y);if(E&&E.created_at!==void 0&&p.created_at!==void 0&&E.created_at>=p.created_at)return;x.set(y,p);const A=Array.from(x.values());e({eventMap:x,events:A})}},addEvents:p=>{if(!(!p||p.length===0))if(n!==!1){let y=!1;for(const g of p){if(!g)continue;const x=g.tagId(),E=a.get(x),A=s().eventMap.get(x);E&&E.created_at!==void 0&&g.created_at!==void 0&&E.created_at>=g.created_at||A&&A.created_at!==void 0&&g.created_at!==void 0&&A.created_at>=g.created_at||(a.set(x,g),y=!0)}y&&!o&&(o=setTimeout(f,n))}else{const y=s(),g=new Map(y.eventMap);let x=!1;for(const E of p){if(!E)continue;const A=E.tagId(),S=g.get(A);S&&S.created_at!==void 0&&E.created_at!==void 0&&S.created_at>=E.created_at||(g.set(A,E),x=!0)}if(x){const E=Array.from(g.values());e({eventMap:g,events:E})}}},removeEventId:p=>{const y=s(),g=new Map(y.eventMap);g.delete(p);const x=Array.from(g.values());e({eventMap:g,events:x})},filterMutedEvents:p=>{const g=s().eventMap,x=new Map;for(const[A,S]of g.entries())p(S)||x.set(A,S);const E=Array.from(x.values());e({eventMap:x,events:E})},setEose:()=>{o&&(clearTimeout(o),o=null,f()),e({eose:!0}),n!==!1&&(n=16)},reset:()=>{a.clear(),o&&(clearTimeout(o),o=null),e({events:[],eventMap:new Map,eose:!1,subscriptionRef:void 0})}}});function useSubscribe(n,t={},e=[]){const{ndk:s}=useNDK(),a=useMuteFilter(),o=reactExports.useRef(null);o.current||(o.current=createSubscribeStore(t.bufferMs));const f=o.current,p=reactExports.useRef(null);reactExports.useEffect(()=>!s||!n?void 0:(p.current&&(p.current.stop(),p.current=null),(()=>{const E=n,A=R=>{if(!t.includeDeleted&&R.hasTag("deleted")||!t.includeMuted&&a(R))return;R.once("deleted",()=>{f.getState().removeEventId(R.tagId())}),f.getState().addEvent(R)},S=R=>{if(R&&R.length>0){const N=R.filter(D=>!(!t.includeDeleted&&D.hasTag("deleted")||!t.includeMuted&&a(D)));if(N.length>0){f.getState().addEvents(N);for(const M of N)M.once("deleted",()=>{f.getState().removeEventId(M.tagId())})}}},I=()=>{f.getState().setEose()},_=s.subscribe(E,t,{onEvent:A,onEvents:S,onEose:I});p.current=_})(),()=>{p.current&&(p.current.stop(),p.current=null)}),[s,a,!!n,...e]),reactExports.useEffect(()=>{t.includeMuted||f.getState().filterMutedEvents(a)},[a,f,t.includeMuted]);const y=useStore(f,x=>x.events),g=useStore(f,x=>x.eose);return{events:y,eose:g}}create(n=>({activeWallet:null,balance:null,setActiveWallet:t=>n({activeWallet:t}),setBalance:t=>n({balance:t})}));create(n=>({nutzapMonitor:null,setNutzapMonitor:t=>n({nutzapMonitor:t})}));const MAX_SAVED_TRACES=5;function useShotTracers(){const[n,t]=reactExports.useState({0:[],1:[]}),e=reactExports.useRef(null),s=reactExports.useCallback(y=>{y.trail=[Matter.Vector.clone(y.position)],console.log(`[useShotTracers] Projectile ${y.id} fired. Initialized trail.`)},[]),a=reactExports.useCallback(y=>{y.trail?y.trail.push(Matter.Vector.clone(y.position)):y.trail=[Matter.Vector.clone(y.position)]},[]),o=reactExports.useCallback(y=>{if(y.trail&&y.trail.length>1){const g=y.custom.firedByPlayerIndex,x=y.trail.map(E=>({x:E.x,y:E.y}));e.current=x,t(E=>{const S=[...E[g],x];return S.length>MAX_SAVED_TRACES&&S.shift(),{...E,[g]:S}}),console.log(`[useShotTracers] Stored trace for player ${g}. Path ref updated. Trace points: ${x.length}`)}else e.current=null,console.log(`[useShotTracers] Projectile ${y.id} removed with no significant trail to store.`)},[]),f=reactExports.useCallback((y,g)=>{if(g.length<2){console.log(`[useShotTracers] Received opponent trace for player ${y} is too short, ignoring.`);return}const x=g.map(E=>Matter.Vector.create(E.x,E.y));t(E=>{const S=[...E[y],x];return S.length>MAX_SAVED_TRACES&&S.shift(),console.log(`[useShotTracers] Added opponent trace for player ${y}. Points: ${g.length}`),{...E,[y]:S}})},[]),p=reactExports.useCallback(()=>{t({0:[],1:[]}),e.current=null,console.log("[useShotTracers] All historical traces reset.")},[]);return{lastShotTraces:n,getLastCompletedPath:()=>e.current,handleProjectileFired:s,handleProjectileUpdate:a,handleProjectileRemoved:o,addOpponentTrace:f,resetTraces:p}}const{Engine,Runner,Bodies,World,Composite,Vector,Body,Events}=Matter,useMatterPhysics=({settings:n,levelData:t,shotTracerHandlers:e,onPlayerHit:s,onProjectileResolved:a})=>{const o=reactExports.useRef(null),f=reactExports.useRef(null),p=reactExports.useRef([null,null]),y=reactExports.useRef(t),g=reactExports.useRef(n),x=reactExports.useRef(s),E=reactExports.useRef(a),A=reactExports.useRef(e);reactExports.useEffect(()=>{x.current=s},[s]),reactExports.useEffect(()=>{E.current=a},[a]),reactExports.useEffect(()=>{A.current=e},[e]),reactExports.useEffect(()=>{y.current=t},[t]),reactExports.useEffect(()=>{g.current=n},[n]);const S=reactExports.useCallback((P,F)=>{const j=A.current;if(!P.custom){console.warn(`[Physics] Cannot remove projectile ${P.id}: missing custom data.`),World.remove(F,P);return}const Q=P.custom.firedByPlayerIndex;j.handleProjectileRemoved(P);const $=j.getLastCompletedPath();World.remove(F,P),$&&E.current($,Q)},[]),I=reactExports.useCallback(P=>{const F=o.current;F&&P.pairs.forEach(j=>{var se,H;const{bodyA:Q,bodyB:$}=j;let V=null,G=null;if(Q.label.startsWith("projectile-")?(V=Q,G=$):$.label.startsWith("projectile-")&&(V=$,G=Q),V&&G){const J=(se=V.custom)==null?void 0:se.firedByPlayerIndex,K=((H=V.custom)==null?void 0:H.abilityType)||"standard";let ie=!1;if(G.label==="planet")console.log(`[Collision] Proj ${V.id} hit planet ${G.id}`),ie=!0;else if(G.label.startsWith("ship-")){const ne=parseInt(G.label.split("-")[1],10);J===void 0?console.warn("[Collision] Projectile hit ship but firing player index unknown!"):(console.log(`[Collision] Proj ${V.id} (P${J}, Type: ${K}) hit P${ne}`),x.current(ne,J,K)),ie=!0}else G.label==="boundary"?(console.log(`[Collision] Proj ${V.id} hit boundary`),ie=!0):G.label.startsWith("projectile-")||(console.warn(`[Collision Warning] Proj ${V.id} collided with unhandled body: ${G.label}. Removing.`),ie=!0);ie&&S(V,F.world)}})},[S]),_=reactExports.useCallback(()=>{const P=o.current,F=g.current;if(!P||!F)return;const{PLANET_MIN_RADIUS:j,GRAVITY_AOE_BONUS_FACTOR:Q,VIRTUAL_WIDTH:$,GRAVITY_CONSTANT:V,SLINGGER_PLANET_REPULSION_CONSTANT:G,PLASTIC_GRAVITY_FACTOR:se,SHIP_GRAVITY_RANGE_FACTOR:H,SHIP_RADIUS:J,SHIP_GRAVITY_CONSTANT:K,SPLITTER_FRAGMENT_RADIUS:ie,DEFAULT_FRICTION_AIR:ne}=F,re=Math.pow(J*H,2),X=[],ae=[],te=[];Composite.allBodies(P.world).forEach(ce=>{var xe,me,Se,be,Me;if(ce.label.startsWith("projectile-")){const Oe=ce;if(((xe=Oe.custom)==null?void 0:xe.abilityType)==="splitter"&&!((me=Oe.custom)!=null&&me.hasSplit)&&Date.now()-(((Se=Oe.custom)==null?void 0:Se.createdAt)??0)>1500){const je=Vector.clone(Oe.position),Pe=Vector.clone(Oe.velocity),We=Oe.custom.firedByPlayerIndex,Ze=Oe.custom.ownerShipLabel;X.push(Oe),S(Oe,P.world);const st=[Vector.rotate(Pe,-.15),Pe,Vector.rotate(Pe,.15)];for(let nt=0;nt<3;nt++){const tt=`${Ze}-frag${nt}`,bt=Bodies.circle(je.x,je.y,ie,{label:tt,frictionAir:ne,restitution:.6,density:.04,collisionFilter:{group:-1}});bt.custom={firedByPlayerIndex:We,abilityType:"splitter_fragment",createdAt:Date.now(),ownerShipLabel:tt},bt.trail=[Vector.clone(je)],Body.setVelocity(bt,st[nt]),ae.push(bt),te.push(bt)}return}if(!Oe.custom||!Oe.trail?(console.warn(`[Physics Update] Proj ${Oe.id} missing data/trail.`),Oe.trail=Oe.trail||[Vector.clone(Oe.position)]):Oe.trail.push(Vector.clone(Oe.position)),A.current.handleProjectileUpdate(Oe),Composite.allBodies(P.world).forEach(je=>{var bt,qe,Et,$t,Vt;if(je.label!=="planet"&&je.label!=="orange-planet")return;const Pe=Vector.sub(je.position,Oe.position),We=Vector.magnitudeSquared(Pe);if(We<=10)return;const Ze=((qe=(bt=je.plugin)==null?void 0:bt.Zapslingers)==null?void 0:qe.radius)||j;let ot=Vector.create(0,0);const st=Ze*(1+Q*(Ze/$));let nt=V*Oe.mass*st/We;((Et=Oe.custom)==null?void 0:Et.abilityType)==="plastic"&&(nt*=se);const tt=Vector.mult(Vector.normalise(Pe),nt);if(ot=Vector.add(ot,tt),je.label==="orange-planet"){const Dt=(Vt=($t=je.plugin)==null?void 0:$t.Zapslingers)==null?void 0:Vt.coreRadius,Lt=Vector.magnitude(Pe);if(Dt&&Lt<=Dt){const de=G*Oe.mass*Dt/We,z=Vector.mult(Vector.normalise(Pe),-de);ot=Vector.add(ot,z)}}Vector.magnitudeSquared(ot)>0&&Body.applyForce(Oe,Oe.position,ot)}),((be=Oe.custom)==null?void 0:be.abilityType)==="gravity"){const Pe=Oe.custom.firedByPlayerIndex===0?1:0,We=p.current[Pe];if(We){const Ze=Vector.sub(We.position,Oe.position),ot=Vector.magnitudeSquared(Ze);if(ot>100&&ot<re){const st=K*Oe.mass*We.mass/ot,nt=Vector.mult(Vector.normalise(Ze),st);Body.applyForce(Oe,Oe.position,nt)}}}Date.now()-(((Me=Oe.custom)==null?void 0:Me.createdAt)??Date.now())>45e3&&(console.log(`[Physics Update] Proj ${Oe.id} timed out.`),X.push(Oe))}}),ae.length>0&&(World.add(P.world,ae),te.forEach(ce=>{A.current.handleProjectileFired(ce)})),X.length>0&&X.forEach(ce=>{S(ce,P.world)})},[S]),R=reactExports.useCallback(P=>{const F=o.current,j=g.current;if(console.log("[Physics initializeWorld] Called. levelData arg:",P,"localSettings from ref:",j),!F||!j){console.error("[Physics Hook] Engine or Settings not available during world initialization.");return}const{SHIP_RADIUS:Q,VIRTUAL_WIDTH:$,VIRTUAL_HEIGHT:V}=j;if(!P||!P.ships||P.ships.length<2||!P.planets){console.error("[Physics Hook] Invalid or undefined levelData provided to initializeWorld:",P),World.clear(F.world,!1),Events.off(F,"beforeUpdate"),Events.off(F,"collisionStart"),p.current=[null,null];return}console.log("[Physics Hook] Initializing/Resetting World with valid data and settings..."),World.clear(F.world,!1),Events.off(F,"beforeUpdate"),Events.off(F,"collisionStart"),A.current.resetTraces();const G=Bodies.circle(P.ships[0].x,P.ships[0].y,Q,{label:"ship-0",restitution:.5,friction:.1,frictionAir:.01,angle:0}),se=Bodies.circle(P.ships[1].x,P.ships[1].y,Q,{label:"ship-1",restitution:.5,friction:.1,frictionAir:.01,angle:Math.PI});p.current=[G,se];const H=50,J=$*2,K=V*3,ie=[Bodies.rectangle($/2,-V,J,H,{isStatic:!0,label:"boundary"}),Bodies.rectangle($/2,V*2,J,H,{isStatic:!0,label:"boundary"}),Bodies.rectangle(-$/2,V/2,H,K,{isStatic:!0,label:"boundary"}),Bodies.rectangle($*1.5,V/2,H,K,{isStatic:!0,label:"boundary"})],ne=[G,se,...P.planets,...ie];World.add(F.world,ne),Events.on(F,"beforeUpdate",_),Events.on(F,"collisionStart",I),console.log("[Physics Hook] World setup complete.")},[I,_]);reactExports.useEffect(()=>{console.log("[Physics Hook] Initializing Engine & Runner...");const P=Engine.create();o.current=P,P.world.gravity.y=0,P.world.gravity.x=0;const F=Runner.create();return f.current=F,g.current&&y.current?R(y.current):(console.warn("[Physics Hook] Initial settings or levelData undefined. World will be initialized when valid data is provided via resetPhysics."),o.current&&World.clear(o.current.world,!1),p.current=[null,null]),console.log("[Physics Hook] Starting runner."),Runner.run(F,P),()=>{console.log("[Physics Hook] Cleanup: Stopping engine, runner."),f.current&&Runner.stop(f.current),o.current&&(Events.off(o.current,"beforeUpdate"),Events.off(o.current,"collisionStart"),World.clear(o.current.world,!1),Engine.clear(o.current)),o.current=null,f.current=null,p.current=[null,null]}},[R]);const N=reactExports.useCallback((P,F,j)=>{const Q=o.current,$=g.current,V=p.current[P];if(!Q||!V||!$)return;console.log("[Physics] Settings:",{SHIP_RADIUS:$.SHIP_RADIUS,STANDARD_PROJECTILE_RADIUS:$.STANDARD_PROJECTILE_RADIUS,SPLITTER_FRAGMENT_RADIUS:$.SPLITTER_FRAGMENT_RADIUS});const{SHIP_RADIUS:G,DEFAULT_FRICTION_AIR:se,PLASTIC_FRICTION_AIR:H,GRAVITY_FRICTION_AIR:J,STANDARD_PROJECTILE_RADIUS:K}=$,ie=V.angle,ne=10+F*1.5,re=Vector.mult(Vector.rotate({x:1,y:0},ie),ne),X=Vector.mult(Vector.rotate({x:1,y:0},ie),G*1.1),ae=Vector.add(V.position,X);let te=se;j==="plastic"?te=H:j==="gravity"&&(te=J);const ce=Bodies.circle(ae.x,ae.y,K,{label:`projectile-${P}-${Date.now()}`,frictionAir:te,restitution:.6,density:.05,collisionFilter:{group:-1}});ce.custom={firedByPlayerIndex:P,abilityType:j,createdAt:Date.now(),ownerShipLabel:`projectile-${P}-${Date.now()}`,hasSplit:j==="splitter"?!1:void 0},ce.trail=[Vector.clone(ae)],Body.setVelocity(ce,re),World.add(Q.world,ce),A.current.handleProjectileFired(ce),console.log(`[Physics] Fired projectile ${ce.id} by P${P}, Power: ${F}, Ability: ${j||"None"}`)},[]),D=reactExports.useCallback((P,F)=>{const j=p.current[P];j&&Body.setAngle(j,F*(Math.PI/180))},[]),M=reactExports.useCallback(P=>{const F=p.current[P];return F?F.angle*(180/Math.PI):void 0},[]),W=reactExports.useCallback(P=>{console.log("[Physics Hook] resetPhysics called.");const F=g.current;if(!P||!F){console.error("[Physics Hook] Attempted resetPhysics with undefined newLevelData or missing settings.");return}y.current=P,R(P)},[R]),B=reactExports.useCallback(()=>o.current?Composite.allBodies(o.current.world).filter(P=>P.label.startsWith("ship-")||P.label.startsWith("projectile-")):[],[]),U=reactExports.useCallback(()=>o.current?Composite.allBodies(o.current.world):[],[]);return{engine:o.current,shipBodies:p,getDynamicBodies:B,getAllBodies:U,fireProjectile:N,setShipAim:D,getShipAngle:M,resetPhysics:W}};function useGameLogic({settings:n,mode:t,localPlayerPubkey:e,opponentPubkey:s,onGameEnd:a,ndk:o,matchId:f}){const{ABILITY_COST_HP:p,MAX_ABILITIES_TOTAL:y,MAX_ABILITIES_PER_TYPE:g,MAX_HP:x,MAX_ROUNDS:E}=n;if(t==="multiplayer"&&(!o||!f||!s))throw new Error("useGameLogic: NDK, matchId, and opponentPubkey required for multiplayer.");const{myPlayerIndex:A}=reactExports.useMemo(()=>{if(t==="practice"||!s)return{myPlayerIndex:0};const te=[e,s].sort()[0];return{myPlayerIndex:e===te?0:1}},[t,e,s]),[S,I]=reactExports.useState([{angle:0,power:50},{angle:180,power:50}]),[_,R]=reactExports.useState(0),[N,D]=reactExports.useState([{hp:x,usedAbilities:new Set,isVulnerable:!1},{hp:x,usedAbilities:new Set,isVulnerable:!1}]),[M,W]=reactExports.useState(null),[B,U]=reactExports.useState([0,0]),[P,F]=reactExports.useState(1),j=reactExports.useRef(N);reactExports.useEffect(()=>{j.current=N},[N]);const Q=useShotTracers(),{levelData:$,regenerateLevel:V}=useGameInitialization(n),G=reactExports.useCallback(ae=>{const te=[...B];ae!==null?(te[ae]++,console.log(`Round ${P} won by Player ${ae}. Score: ${te[0]}-${te[1]}`)):console.log(`Round ${P} completed (No score). Score: ${te[0]}-${te[1]}`),U(te);const ce=Math.ceil(E/2),xe=te[0]>=ce,me=te[1]>=ce,Se=P>=E;if((t==="practice"||t==="custom")&&(xe||me||Se)){let be=[...te],Me=null,Oe="score";if(xe)Me=0;else if(me)Me=1;else if(Se)if(be[0]===be[1]){const je=j.current[0].hp,Pe=j.current[1].hp;je>Pe?(Me=0,be=[ce,be[1]]):Pe>je?(Me=1,be=[be[0],ce]):Me=null,Oe="hp_tiebreaker"}else Me=be[0]>be[1]?0:1;else Me=null,Oe="error",console.error("Game Over in unexpected state!");a({winnerIndex:Me,finalScore:be,reason:Oe})}else if(t==="practice"||t==="custom"){console.log(`Starting Round ${P+1}`);const be=P+1,Me=be%2===1?0:1;F(be),V(),D([{hp:x,usedAbilities:new Set,isVulnerable:!1},{hp:x,usedAbilities:new Set,isVulnerable:!1}]),R(Me),W(null),I([{angle:0,power:50},{angle:180,power:50}])}else t==="multiplayer"&&(xe||me||Se)&&a({winnerIndex:xe?0:me?1:null,finalScore:te,reason:"score"})},[t,P,B,a,E,x,V,j]),se=reactExports.useCallback((ae,te,ce)=>{console.log(`[useGameLogic] handlePlayerHit: P${te} (Type: ${ce}) hit P${ae}`);const me=j.current[ae];let Se=null;if(ae===te)Se=te===0?1:0,console.log("Self-hit detected.");else if(ce==="standard")Se=te,console.log("Standard hit detected.");else if(me.isVulnerable)Se=te,console.log("Vulnerable hit detected.");else{console.log(`[useGameLogic] Ability hit on non-vulnerable P${ae}. No round change.`);return}Se!==null&&G(Se)},[G,j]),H=reactExports.useCallback((ae,te)=>{if(console.log(`[useGameLogic ${t}] handleProjectileResolved: P${te}'s shot resolved. Current Player Before Switch Attempt: ${_}`),!(t==="practice"||t==="custom")){if(t==="multiplayer"&&o&&f&&s){const ce={type:"shotResolved",senderPubkey:e,matchId:f,path:ae},xe=new NDKEvent(o);xe.kind=30079,xe.content=JSON.stringify(ce),xe.tags=[["p",s],["d",f]],xe.publish().catch(me=>console.error("Error publishing shotResolved event:",me)),console.log("[useGameLogic] Published SHOT_RESOLVED event")}}},[t,o,f,s,e,Q,_]),J=useMatterPhysics({settings:n,levelData:$,shotTracerHandlers:Q,onPlayerHit:se,onProjectileResolved:H});reactExports.useEffect(()=>{console.log("[useGameLogic] Physics Reset Effect Triggered. levelData:",$,"physicsHandles:",!!J,"resetPhysics available:",!!(J!=null&&J.resetPhysics)),$&&(J!=null&&J.resetPhysics)?(console.log("[useGameLogic] Conditions met! Resetting physics engine with levelData:",$),J.resetPhysics($)):console.log("[useGameLogic] Conditions NOT met for physics reset.")},[$,J==null?void 0:J.resetPhysics]),reactExports.useEffect(()=>{(t==="practice"||t==="custom")&&W(null)},[_,P,t]);const K=reactExports.useMemo(()=>{if(t!=="multiplayer"||!f||!s)return;const ae=Math.floor(Date.now()/1e3);return{kinds:[30079],authors:[s],"#d":[f],since:ae-300}},[t,f,s]),{events:ie}=useSubscribe(K?[K]:[],{closeOnEose:!1,groupable:!1});reactExports.useEffect(()=>{t!=="multiplayer"||!J||!s||!f||ie.forEach(ae=>{try{const te=JSON.parse(ae.content);if(console.log(`[useGameLogic] Received Event KIND ${ae.kind} from ${ae.pubkey}`,te),te.matchId!==f||te.senderPubkey!==s){console.warn("[useGameLogic] Received event for wrong match/sender. Ignoring.");return}const ce=A===0?1:0;if(te.type==="fire"){console.log("[useGameLogic] Processing opponent FIRE event",te),te.ability&&D(me=>{const Se=[...me],be=Se[ce],Me=Math.max(0,be.hp-p),Oe=new Set(be.usedAbilities);Oe.add(te.ability);const Ue=Oe.size>=2;return Se[ce]={...be,hp:Me,usedAbilities:Oe,isVulnerable:Ue},console.log(`[useGameLogic] Applied HP cost to Opponent P${ce}. New HP: ${Me}, Vulnerable: ${Ue}`),Se});const xe=te.aim.power/20;J.fireProjectile(ce,xe,te.ability)}else te.type==="shotResolved"?(console.log("[useGameLogic] Processing opponent SHOT_RESOLVED event"),Q.addOpponentTrace(ce,te.path)):console.warn(`[useGameLogic] Received unhandled event type: ${te.type??"unknown"}`)}catch(te){console.error("[useGameLogic] Error processing opponent event:",te,ae)}})},[t,J,ie,A,s,f,Q,p,o]);const ne=reactExports.useCallback(ae=>{t==="practice"?(I(te=>{const ce=[...te];return ce[_]=ae,ce}),J==null||J.setShipAim(_,ae.angle)):(t==="multiplayer"||t==="custom")&&(I(te=>{const ce=[...te];return ce[A]=ae,ce}),J==null||J.setShipAim(A,ae.angle))},[t,A,_,J]),re=reactExports.useCallback(ae=>{const te=t==="practice"?_:A,ce=N[te];if(Array.from(ce.usedAbilities).filter(me=>me===ae).length>=g){console.log(`Ability ${ae} already used max times (${g}) for P${te}.`);return}if(ce.usedAbilities.size>=y){console.log(`Max total abilities (${y}) used for P${te}.`);return}if(ce.hp<p){console.log(`Not enough HP (${ce.hp}) for P${te} to use ability (Cost: ${p}).`);return}W(me=>me===ae?null:ae),console.log(`Selected ability: ${M===ae?"None":ae}`)},[t,A,_,N,M,y,g,p,n]),X=reactExports.useCallback(()=>{const ae=t==="practice"?_:A;console.log(t!=="multiplayer"?`[handleFire ${t}] Current Player Index: ${_}, Determined Firing Index: ${ae}`:`[handleFire ${t}] My Index: ${A}, Determined Firing Index: ${ae}`);const te=S[ae],ce=M,xe=N[ae];if(ce&&xe.hp<p){console.warn(`Cannot fire ability ${ce}: Not enough HP.`),W(null);return}ce&&D(Se=>{const be=[...Se],Me=new Set(xe.usedAbilities);Me.add(ce);const Oe=xe.hp-p,Ue=Me.size>=n.MAX_ABILITIES_TOTAL;return be[ae]={hp:Oe,usedAbilities:Me,isVulnerable:Ue},console.log(`[useGameLogic] Applied HP cost to Self P${ae}. New HP: ${Oe}, Vulnerable: ${Ue} (Limit: ${n.MAX_ABILITIES_TOTAL})`),be});const me=te.power/20;if(J==null||J.fireProjectile(ae,me,ce),W(null),t==="multiplayer"&&o&&f&&s){const Se={type:"fire",senderPubkey:e,matchId:f,aim:te,ability:ce},be=new NDKEvent(o);be.kind=30079,be.content=JSON.stringify(Se),be.tags=[["p",s],["d",f]],be.publish().catch(Me=>console.error("Error publishing fire event:",Me)),console.log("[useGameLogic] Published FIRE event",Se)}else if(t==="practice"){const Se=_===0?1:0;console.log(`[handleFire ${t}] Fired for P${_}. Switching turn immediately to P${Se}.`),R(Se)}},[t,A,_,S,M,N,J,o,f,s,e,p,n]);return{playerStates:N,currentPlayerIndex:_,aimStates:S,selectedAbility:M,levelData:$,score:B,currentRound:P,handleAimChange:ne,handleFire:X,handleSelectAbility:re,myPlayerIndex:A,physicsHandles:J,shotTracerHandlers:Q,settings:n}}const basePhysicsAndCore={VIRTUAL_WIDTH:3200,VIRTUAL_HEIGHT:1800,SHIP_RADIUS:63,STANDARD_PROJECTILE_RADIUS:12,SPLITTER_FRAGMENT_RADIUS:4,GRAVITY_CONSTANT:.5,GRAVITY_AOE_BONUS_FACTOR:.3,DEFAULT_FRICTION_AIR:.002,PLASTIC_GRAVITY_FACTOR:.85,PLASTIC_FRICTION_AIR:.0025,SHIP_GRAVITY_RANGE_FACTOR:4,SHIP_GRAVITY_CONSTANT:1,GRAVITY_FRICTION_AIR:.0025,ABILITY_COST_HP:25,MAX_HP:100,AVAILABLE_ABILITIES:["splitter","gravity","plastic"]},standardLevelGeneration={PLANET_MIN_RADIUS:163,PLANET_MAX_RADIUS:435,NUM_PLANETS:4,GAME_VIEW_WIDTH_FACTOR:1.4,GAME_VIEW_HEIGHT_FACTOR:.75,SHIP_ZONE_WIDTH_FACTOR:.1,PLANET_SPAWN_AREA_FACTOR:1,MIN_SHIP_SEPARATION_FACTOR:.98,MIN_PLANET_SHIP_DISTANCE:150,MIN_PLANET_PLANET_DISTANCE:150,NUM_SLINGERS:2,SLINGER_MAX_RADIUS:160,SLINGER_CORE_RADIUS_FACTOR:.3,SLINGER_REPULSION_CONSTANT:3,SLINGER_MIN_SPAWN_DIST_FACTOR:.8,SLINGER_ATTRACTION_FACTOR:1,SLINGER_REPULSION_FACTOR:3,SLINGER_BORDER_PADDING:75,NUM_SLINGGER_PLANETS:0,SLINGGER_PLANET_MAX_RADIUS:200,SLINGGER_PLANET_CORE_RADIUS_FACTOR:.4,SLINGGER_PLANET_REPULSION_CONSTANT:.5},practiceSettings={...basePhysicsAndCore,...standardLevelGeneration,NUM_SLINGERS:0,MAX_ROUNDS:3,MAX_ABILITIES_TOTAL:3,MAX_ABILITIES_PER_TYPE:1},gameSettings={...basePhysicsAndCore,...standardLevelGeneration,MAX_ROUNDS:5,MAX_ABILITIES_TOTAL:3,MAX_ABILITIES_PER_TYPE:1},sandboxSettings={...basePhysicsAndCore,PLANET_MIN_RADIUS:100,PLANET_MAX_RADIUS:300,NUM_PLANETS:4,GAME_VIEW_WIDTH_FACTOR:.8,GAME_VIEW_HEIGHT_FACTOR:.8,SHIP_ZONE_WIDTH_FACTOR:.1,PLANET_SPAWN_AREA_FACTOR:1.04,MIN_SHIP_SEPARATION_FACTOR:.97,MIN_PLANET_SHIP_DISTANCE:150,MIN_PLANET_PLANET_DISTANCE:75,NUM_SLINGERS:2,SLINGER_MAX_RADIUS:160,SLINGER_CORE_RADIUS_FACTOR:.3,SLINGER_REPULSION_CONSTANT:1.6,SLINGER_MIN_SPAWN_DIST_FACTOR:.8,SLINGER_ATTRACTION_FACTOR:1,SLINGER_REPULSION_FACTOR:3,SLINGER_BORDER_PADDING:75,NUM_SLINGGER_PLANETS:2,SLINGGER_PLANET_MAX_RADIUS:200,SLINGGER_PLANET_CORE_RADIUS_FACTOR:.4,SLINGGER_PLANET_REPULSION_CONSTANT:.5,MAX_ROUNDS:999,MAX_ABILITIES_TOTAL:999,MAX_ABILITIES_PER_TYPE:99};function useKeyboardControls({isActive:n,currentAngle:t,currentPower:e,handleAimChange:s,handleFire:a,handleSelectAbility:o}){const f=reactExports.useRef(t),p=reactExports.useRef(e);reactExports.useEffect(()=>{f.current=t},[t]),reactExports.useEffect(()=>{p.current=e},[e]);const y=reactExports.useCallback(g=>{const x=f.current,E=p.current;let A,S,I=!1;switch(g.key){case"ArrowLeft":A=(x-5+360)%360,I=!0;break;case"ArrowRight":A=(x+5)%360,I=!0;break;case"ArrowDown":S=Math.max(0,E-5),I=!0;break;case"ArrowUp":S=Math.min(100,E+5),I=!0;break;case" ":I=!0,a();break;case"1":o("splitter");break;case"2":o("gravity");break;case"3":o("plastic");break}I&&g.preventDefault(),(A!==void 0||S!==void 0)&&s({angle:A!==void 0?A:x,power:S!==void 0?S:E})},[n,s,a,o]);reactExports.useEffect(()=>(window.addEventListener("keydown",y),()=>{window.removeEventListener("keydown",y)}),[n,y])}const GameScreen=({ndk:n,localPlayerPubkey:t,opponentPubkey:e,matchId:s,onGameEnd:a,onBackToMenu:o})=>{const f=reactExports.useCallback(F=>{a(F)},[a]),{playerStates:p,myPlayerIndex:y,aimStates:g,selectedAbility:x,levelData:E,score:A,currentRound:S,handleAimChange:I,handleFire:_,handleSelectAbility:R,physicsHandles:N,shotTracerHandlers:D,settings:M}=useGameLogic({settings:gameSettings,mode:"multiplayer",localPlayerPubkey:t,opponentPubkey:e,onGameEnd:f,ndk:n,matchId:s}),W=p[y],B=g[y],U=y===0?1:0,P=p[U];return useKeyboardControls({isActive:!0,currentAngle:B.angle,currentPower:B.power,handleAimChange:I,handleFire:_,handleSelectAbility:R}),jsxRuntimeExports.jsxs("div",{className:"relative w-full h-dvh bg-black text-white overflow-hidden flex flex-col",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black border-t-2 border-yellow-600",children:jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-[url('/backdrop.png')] bg-no-repeat bg-fixed bg-top"})}),jsxRuntimeExports.jsxs("div",{className:"flex-shrink-0 w-full flex justify-start p-2 bg-gray-800 shadow-md z-20",children:[jsxRuntimeExports.jsx("button",{onClick:o,className:"px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-white font-semibold transition-colors duration-150 mr-4",children:" Leave Match"}),jsxRuntimeExports.jsxs("h1",{className:"text-xl font-bold ml-4 text-purple-300 self-center",children:["Match vs ",e.slice(0,10),"..."]}),jsxRuntimeExports.jsxs("div",{className:"ml-auto text-lg font-semibold text-yellow-300 flex items-center space-x-4 pr-4",children:[jsxRuntimeExports.jsxs("span",{children:["Round: ",S," / ",gameSettings.MAX_ROUNDS]}),jsxRuntimeExports.jsxs("span",{children:["Score: ",A[y]," - ",A[U]]})]})]}),jsxRuntimeExports.jsxs("div",{className:"relative flex-grow w-full h-full",children:[jsxRuntimeExports.jsx("div",{className:`absolute top-2 ${y===0?"left-2":"right-2"} z-10 pointer-events-auto`,children:jsxRuntimeExports.jsx(PlayerHUD,{pubkey:t,currentHp:W.hp,maxHp:gameSettings.MAX_HP,isPlayer1:y===0,ndk:n})}),jsxRuntimeExports.jsx("div",{className:`absolute top-2 ${U===0?"left-2":"right-2"} z-10 pointer-events-auto`,children:jsxRuntimeExports.jsx(PlayerHUD,{pubkey:e,currentHp:P.hp,maxHp:gameSettings.MAX_HP,isPlayer1:U===0,ndk:n})}),jsxRuntimeExports.jsxs("div",{className:"absolute inset-0 z-0 w-full h-full",children:[E&&N&&D&&g&&M&&jsxRuntimeExports.jsx(GameRenderer,{physicsHandles:N,shotTracerHandlers:D,settings:M,aimStates:g}),(!E||!N)&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-2xl font-bold text-gray-500",children:"Initializing Match..."})]}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-6 left-6 z-10 pointer-events-auto flex flex-col items-start max-w-xs",children:jsxRuntimeExports.jsx(AimingInterface,{currentAngle:B.angle,currentPower:B.power,onAimChange:I})}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-6 right-6 z-10 pointer-events-auto flex flex-col items-end",children:jsxRuntimeExports.jsx(ActionButtons,{onFire:_,onAbilitySelect:R,selectedAbility:x,usedAbilities:W.usedAbilities,currentHp:W.hp,abilityCost:gameSettings.ABILITY_COST_HP,maxAbilityUsesTotal:M.MAX_ABILITIES_TOTAL,maxAbilityUsesPerType:M.MAX_ABILITIES_PER_TYPE,disabled:!1,availableAbilities:M.AVAILABLE_ABILITIES})})]})]})};var __defProp=Object.defineProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(n,t,e)=>t in n?__defProp(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,__spreadValues=(n,t)=>{for(var e in t||(t={}))__hasOwnProp.call(t,e)&&__defNormalProp(n,e,t[e]);if(__getOwnPropSymbols)for(var e of __getOwnPropSymbols(t))__propIsEnum.call(t,e)&&__defNormalProp(n,e,t[e]);return n},__objRest=(n,t)=>{var e={};for(var s in n)__hasOwnProp.call(n,s)&&t.indexOf(s)<0&&(e[s]=n[s]);if(n!=null&&__getOwnPropSymbols)for(var s of __getOwnPropSymbols(n))t.indexOf(s)<0&&__propIsEnum.call(n,s)&&(e[s]=n[s]);return e};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var qrcodegen;(n=>{const t=class Bt{constructor(y,g,x,E){if(this.version=y,this.errorCorrectionLevel=g,this.modules=[],this.isFunction=[],y<Bt.MIN_VERSION||y>Bt.MAX_VERSION)throw new RangeError("Version value out of range");if(E<-1||E>7)throw new RangeError("Mask value out of range");this.size=y*4+17;let A=[];for(let I=0;I<this.size;I++)A.push(!1);for(let I=0;I<this.size;I++)this.modules.push(A.slice()),this.isFunction.push(A.slice());this.drawFunctionPatterns();const S=this.addEccAndInterleave(x);if(this.drawCodewords(S),E==-1){let I=1e9;for(let _=0;_<8;_++){this.applyMask(_),this.drawFormatBits(_);const R=this.getPenaltyScore();R<I&&(E=_,I=R),this.applyMask(_)}}a(0<=E&&E<=7),this.mask=E,this.applyMask(E),this.drawFormatBits(E),this.isFunction=[]}static encodeText(y,g){const x=n.QrSegment.makeSegments(y);return Bt.encodeSegments(x,g)}static encodeBinary(y,g){const x=n.QrSegment.makeBytes(y);return Bt.encodeSegments([x],g)}static encodeSegments(y,g,x=1,E=40,A=-1,S=!0){if(!(Bt.MIN_VERSION<=x&&x<=E&&E<=Bt.MAX_VERSION)||A<-1||A>7)throw new RangeError("Invalid value");let I,_;for(I=x;;I++){const M=Bt.getNumDataCodewords(I,g)*8,W=f.getTotalBits(y,I);if(W<=M){_=W;break}if(I>=E)throw new RangeError("Data too long")}for(const M of[Bt.Ecc.MEDIUM,Bt.Ecc.QUARTILE,Bt.Ecc.HIGH])S&&_<=Bt.getNumDataCodewords(I,M)*8&&(g=M);let R=[];for(const M of y){e(M.mode.modeBits,4,R),e(M.numChars,M.mode.numCharCountBits(I),R);for(const W of M.getData())R.push(W)}a(R.length==_);const N=Bt.getNumDataCodewords(I,g)*8;a(R.length<=N),e(0,Math.min(4,N-R.length),R),e(0,(8-R.length%8)%8,R),a(R.length%8==0);for(let M=236;R.length<N;M^=253)e(M,8,R);let D=[];for(;D.length*8<R.length;)D.push(0);return R.forEach((M,W)=>D[W>>>3]|=M<<7-(W&7)),new Bt(I,g,D,A)}getModule(y,g){return 0<=y&&y<this.size&&0<=g&&g<this.size&&this.modules[g][y]}getModules(){return this.modules}drawFunctionPatterns(){for(let x=0;x<this.size;x++)this.setFunctionModule(6,x,x%2==0),this.setFunctionModule(x,6,x%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const y=this.getAlignmentPatternPositions(),g=y.length;for(let x=0;x<g;x++)for(let E=0;E<g;E++)x==0&&E==0||x==0&&E==g-1||x==g-1&&E==0||this.drawAlignmentPattern(y[x],y[E]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(y){const g=this.errorCorrectionLevel.formatBits<<3|y;let x=g;for(let A=0;A<10;A++)x=x<<1^(x>>>9)*1335;const E=(g<<10|x)^21522;a(E>>>15==0);for(let A=0;A<=5;A++)this.setFunctionModule(8,A,s(E,A));this.setFunctionModule(8,7,s(E,6)),this.setFunctionModule(8,8,s(E,7)),this.setFunctionModule(7,8,s(E,8));for(let A=9;A<15;A++)this.setFunctionModule(14-A,8,s(E,A));for(let A=0;A<8;A++)this.setFunctionModule(this.size-1-A,8,s(E,A));for(let A=8;A<15;A++)this.setFunctionModule(8,this.size-15+A,s(E,A));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let y=this.version;for(let x=0;x<12;x++)y=y<<1^(y>>>11)*7973;const g=this.version<<12|y;a(g>>>18==0);for(let x=0;x<18;x++){const E=s(g,x),A=this.size-11+x%3,S=Math.floor(x/3);this.setFunctionModule(A,S,E),this.setFunctionModule(S,A,E)}}drawFinderPattern(y,g){for(let x=-4;x<=4;x++)for(let E=-4;E<=4;E++){const A=Math.max(Math.abs(E),Math.abs(x)),S=y+E,I=g+x;0<=S&&S<this.size&&0<=I&&I<this.size&&this.setFunctionModule(S,I,A!=2&&A!=4)}}drawAlignmentPattern(y,g){for(let x=-2;x<=2;x++)for(let E=-2;E<=2;E++)this.setFunctionModule(y+E,g+x,Math.max(Math.abs(E),Math.abs(x))!=1)}setFunctionModule(y,g,x){this.modules[g][y]=x,this.isFunction[g][y]=!0}addEccAndInterleave(y){const g=this.version,x=this.errorCorrectionLevel;if(y.length!=Bt.getNumDataCodewords(g,x))throw new RangeError("Invalid argument");const E=Bt.NUM_ERROR_CORRECTION_BLOCKS[x.ordinal][g],A=Bt.ECC_CODEWORDS_PER_BLOCK[x.ordinal][g],S=Math.floor(Bt.getNumRawDataModules(g)/8),I=E-S%E,_=Math.floor(S/E);let R=[];const N=Bt.reedSolomonComputeDivisor(A);for(let M=0,W=0;M<E;M++){let B=y.slice(W,W+_-A+(M<I?0:1));W+=B.length;const U=Bt.reedSolomonComputeRemainder(B,N);M<I&&B.push(0),R.push(B.concat(U))}let D=[];for(let M=0;M<R[0].length;M++)R.forEach((W,B)=>{(M!=_-A||B>=I)&&D.push(W[M])});return a(D.length==S),D}drawCodewords(y){if(y.length!=Math.floor(Bt.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let g=0;for(let x=this.size-1;x>=1;x-=2){x==6&&(x=5);for(let E=0;E<this.size;E++)for(let A=0;A<2;A++){const S=x-A,_=(x+1&2)==0?this.size-1-E:E;!this.isFunction[_][S]&&g<y.length*8&&(this.modules[_][S]=s(y[g>>>3],7-(g&7)),g++)}}a(g==y.length*8)}applyMask(y){if(y<0||y>7)throw new RangeError("Mask value out of range");for(let g=0;g<this.size;g++)for(let x=0;x<this.size;x++){let E;switch(y){case 0:E=(x+g)%2==0;break;case 1:E=g%2==0;break;case 2:E=x%3==0;break;case 3:E=(x+g)%3==0;break;case 4:E=(Math.floor(x/3)+Math.floor(g/2))%2==0;break;case 5:E=x*g%2+x*g%3==0;break;case 6:E=(x*g%2+x*g%3)%2==0;break;case 7:E=((x+g)%2+x*g%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[g][x]&&E&&(this.modules[g][x]=!this.modules[g][x])}}getPenaltyScore(){let y=0;for(let A=0;A<this.size;A++){let S=!1,I=0,_=[0,0,0,0,0,0,0];for(let R=0;R<this.size;R++)this.modules[A][R]==S?(I++,I==5?y+=Bt.PENALTY_N1:I>5&&y++):(this.finderPenaltyAddHistory(I,_),S||(y+=this.finderPenaltyCountPatterns(_)*Bt.PENALTY_N3),S=this.modules[A][R],I=1);y+=this.finderPenaltyTerminateAndCount(S,I,_)*Bt.PENALTY_N3}for(let A=0;A<this.size;A++){let S=!1,I=0,_=[0,0,0,0,0,0,0];for(let R=0;R<this.size;R++)this.modules[R][A]==S?(I++,I==5?y+=Bt.PENALTY_N1:I>5&&y++):(this.finderPenaltyAddHistory(I,_),S||(y+=this.finderPenaltyCountPatterns(_)*Bt.PENALTY_N3),S=this.modules[R][A],I=1);y+=this.finderPenaltyTerminateAndCount(S,I,_)*Bt.PENALTY_N3}for(let A=0;A<this.size-1;A++)for(let S=0;S<this.size-1;S++){const I=this.modules[A][S];I==this.modules[A][S+1]&&I==this.modules[A+1][S]&&I==this.modules[A+1][S+1]&&(y+=Bt.PENALTY_N2)}let g=0;for(const A of this.modules)g=A.reduce((S,I)=>S+(I?1:0),g);const x=this.size*this.size,E=Math.ceil(Math.abs(g*20-x*10)/x)-1;return a(0<=E&&E<=9),y+=E*Bt.PENALTY_N4,a(0<=y&&y<=2568888),y}getAlignmentPatternPositions(){if(this.version==1)return[];{const y=Math.floor(this.version/7)+2,g=this.version==32?26:Math.ceil((this.version*4+4)/(y*2-2))*2;let x=[6];for(let E=this.size-7;x.length<y;E-=g)x.splice(1,0,E);return x}}static getNumRawDataModules(y){if(y<Bt.MIN_VERSION||y>Bt.MAX_VERSION)throw new RangeError("Version number out of range");let g=(16*y+128)*y+64;if(y>=2){const x=Math.floor(y/7)+2;g-=(25*x-10)*x-55,y>=7&&(g-=36)}return a(208<=g&&g<=29648),g}static getNumDataCodewords(y,g){return Math.floor(Bt.getNumRawDataModules(y)/8)-Bt.ECC_CODEWORDS_PER_BLOCK[g.ordinal][y]*Bt.NUM_ERROR_CORRECTION_BLOCKS[g.ordinal][y]}static reedSolomonComputeDivisor(y){if(y<1||y>255)throw new RangeError("Degree out of range");let g=[];for(let E=0;E<y-1;E++)g.push(0);g.push(1);let x=1;for(let E=0;E<y;E++){for(let A=0;A<g.length;A++)g[A]=Bt.reedSolomonMultiply(g[A],x),A+1<g.length&&(g[A]^=g[A+1]);x=Bt.reedSolomonMultiply(x,2)}return g}static reedSolomonComputeRemainder(y,g){let x=g.map(E=>0);for(const E of y){const A=E^x.shift();x.push(0),g.forEach((S,I)=>x[I]^=Bt.reedSolomonMultiply(S,A))}return x}static reedSolomonMultiply(y,g){if(y>>>8||g>>>8)throw new RangeError("Byte out of range");let x=0;for(let E=7;E>=0;E--)x=x<<1^(x>>>7)*285,x^=(g>>>E&1)*y;return a(x>>>8==0),x}finderPenaltyCountPatterns(y){const g=y[1];a(g<=this.size*3);const x=g>0&&y[2]==g&&y[3]==g*3&&y[4]==g&&y[5]==g;return(x&&y[0]>=g*4&&y[6]>=g?1:0)+(x&&y[6]>=g*4&&y[0]>=g?1:0)}finderPenaltyTerminateAndCount(y,g,x){return y&&(this.finderPenaltyAddHistory(g,x),g=0),g+=this.size,this.finderPenaltyAddHistory(g,x),this.finderPenaltyCountPatterns(x)}finderPenaltyAddHistory(y,g){g[0]==0&&(y+=this.size),g.pop(),g.unshift(y)}};t.MIN_VERSION=1,t.MAX_VERSION=40,t.PENALTY_N1=3,t.PENALTY_N2=3,t.PENALTY_N3=40,t.PENALTY_N4=10,t.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],t.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],n.QrCode=t;function e(p,y,g){if(y<0||y>31||p>>>y)throw new RangeError("Value out of range");for(let x=y-1;x>=0;x--)g.push(p>>>x&1)}function s(p,y){return(p>>>y&1)!=0}function a(p){if(!p)throw new Error("Assertion error")}const o=class fn{constructor(y,g,x){if(this.mode=y,this.numChars=g,this.bitData=x,g<0)throw new RangeError("Invalid argument");this.bitData=x.slice()}static makeBytes(y){let g=[];for(const x of y)e(x,8,g);return new fn(fn.Mode.BYTE,y.length,g)}static makeNumeric(y){if(!fn.isNumeric(y))throw new RangeError("String contains non-numeric characters");let g=[];for(let x=0;x<y.length;){const E=Math.min(y.length-x,3);e(parseInt(y.substring(x,x+E),10),E*3+1,g),x+=E}return new fn(fn.Mode.NUMERIC,y.length,g)}static makeAlphanumeric(y){if(!fn.isAlphanumeric(y))throw new RangeError("String contains unencodable characters in alphanumeric mode");let g=[],x;for(x=0;x+2<=y.length;x+=2){let E=fn.ALPHANUMERIC_CHARSET.indexOf(y.charAt(x))*45;E+=fn.ALPHANUMERIC_CHARSET.indexOf(y.charAt(x+1)),e(E,11,g)}return x<y.length&&e(fn.ALPHANUMERIC_CHARSET.indexOf(y.charAt(x)),6,g),new fn(fn.Mode.ALPHANUMERIC,y.length,g)}static makeSegments(y){return y==""?[]:fn.isNumeric(y)?[fn.makeNumeric(y)]:fn.isAlphanumeric(y)?[fn.makeAlphanumeric(y)]:[fn.makeBytes(fn.toUtf8ByteArray(y))]}static makeEci(y){let g=[];if(y<0)throw new RangeError("ECI assignment value out of range");if(y<128)e(y,8,g);else if(y<16384)e(2,2,g),e(y,14,g);else if(y<1e6)e(6,3,g),e(y,21,g);else throw new RangeError("ECI assignment value out of range");return new fn(fn.Mode.ECI,0,g)}static isNumeric(y){return fn.NUMERIC_REGEX.test(y)}static isAlphanumeric(y){return fn.ALPHANUMERIC_REGEX.test(y)}getData(){return this.bitData.slice()}static getTotalBits(y,g){let x=0;for(const E of y){const A=E.mode.numCharCountBits(g);if(E.numChars>=1<<A)return 1/0;x+=4+A+E.bitData.length}return x}static toUtf8ByteArray(y){y=encodeURI(y);let g=[];for(let x=0;x<y.length;x++)y.charAt(x)!="%"?g.push(y.charCodeAt(x)):(g.push(parseInt(y.substring(x+1,x+3),16)),x+=2);return g}};o.NUMERIC_REGEX=/^[0-9]*$/,o.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,o.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let f=o;n.QrSegment=o})(qrcodegen||(qrcodegen={}));(n=>{(t=>{const e=class{constructor(a,o){this.ordinal=a,this.formatBits=o}};e.LOW=new e(0,1),e.MEDIUM=new e(1,0),e.QUARTILE=new e(2,3),e.HIGH=new e(3,2),t.Ecc=e})(n.QrCode||(n.QrCode={}))})(qrcodegen||(qrcodegen={}));(n=>{(t=>{const e=class{constructor(a,o){this.modeBits=a,this.numBitsCharCount=o}numCharCountBits(a){return this.numBitsCharCount[Math.floor((a+7)/17)]}};e.NUMERIC=new e(1,[10,12,14]),e.ALPHANUMERIC=new e(2,[9,11,13]),e.BYTE=new e(4,[8,16,16]),e.KANJI=new e(8,[8,10,12]),e.ECI=new e(7,[0,0,0]),t.Mode=e})(n.QrSegment||(n.QrSegment={}))})(qrcodegen||(qrcodegen={}));var qrcodegen_default=qrcodegen;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var ERROR_LEVEL_MAP={L:qrcodegen_default.QrCode.Ecc.LOW,M:qrcodegen_default.QrCode.Ecc.MEDIUM,Q:qrcodegen_default.QrCode.Ecc.QUARTILE,H:qrcodegen_default.QrCode.Ecc.HIGH},DEFAULT_SIZE=128,DEFAULT_LEVEL="L",DEFAULT_BGCOLOR="#FFFFFF",DEFAULT_FGCOLOR="#000000",DEFAULT_INCLUDEMARGIN=!1,DEFAULT_MINVERSION=1,SPEC_MARGIN_SIZE=4,DEFAULT_MARGIN_SIZE=0,DEFAULT_IMG_SCALE=.1;function generatePath(n,t=0){const e=[];return n.forEach(function(s,a){let o=null;s.forEach(function(f,p){if(!f&&o!==null){e.push(`M${o+t} ${a+t}h${p-o}v1H${o+t}z`),o=null;return}if(p===s.length-1){if(!f)return;o===null?e.push(`M${p+t},${a+t} h1v1H${p+t}z`):e.push(`M${o+t},${a+t} h${p+1-o}v1H${o+t}z`);return}f&&o===null&&(o=p)})}),e.join("")}function excavateModules(n,t){return n.slice().map((e,s)=>s<t.y||s>=t.y+t.h?e:e.map((a,o)=>o<t.x||o>=t.x+t.w?a:!1))}function getImageSettings(n,t,e,s){if(s==null)return null;const a=n.length+e*2,o=Math.floor(t*DEFAULT_IMG_SCALE),f=a/t,p=(s.width||o)*f,y=(s.height||o)*f,g=s.x==null?n.length/2-p/2:s.x*f,x=s.y==null?n.length/2-y/2:s.y*f,E=s.opacity==null?1:s.opacity;let A=null;if(s.excavate){let I=Math.floor(g),_=Math.floor(x),R=Math.ceil(p+g-I),N=Math.ceil(y+x-_);A={x:I,y:_,w:R,h:N}}const S=s.crossOrigin;return{x:g,y:x,h:y,w:p,excavation:A,opacity:E,crossOrigin:S}}function getMarginSize(n,t){return t!=null?Math.max(Math.floor(t),0):n?SPEC_MARGIN_SIZE:DEFAULT_MARGIN_SIZE}function useQRCode({value:n,level:t,minVersion:e,includeMargin:s,marginSize:a,imageSettings:o,size:f,boostLevel:p}){let y=React.useMemo(()=>{const I=(Array.isArray(n)?n:[n]).reduce((_,R)=>(_.push(...qrcodegen_default.QrSegment.makeSegments(R)),_),[]);return qrcodegen_default.QrCode.encodeSegments(I,ERROR_LEVEL_MAP[t],e,void 0,void 0,p)},[n,t,e,p]);const{cells:g,margin:x,numCells:E,calculatedImageSettings:A}=React.useMemo(()=>{let S=y.getModules();const I=getMarginSize(s,a),_=S.length+I*2,R=getImageSettings(S,f,I,o);return{cells:S,margin:I,numCells:_,calculatedImageSettings:R}},[y,f,o,s,a]);return{qrcode:y,margin:x,cells:g,numCells:E,calculatedImageSettings:A}}var SUPPORTS_PATH2D=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}(),QRCodeCanvas=React.forwardRef(function n(t,e){const s=t,{value:a,size:o=DEFAULT_SIZE,level:f=DEFAULT_LEVEL,bgColor:p=DEFAULT_BGCOLOR,fgColor:y=DEFAULT_FGCOLOR,includeMargin:g=DEFAULT_INCLUDEMARGIN,minVersion:x=DEFAULT_MINVERSION,boostLevel:E,marginSize:A,imageSettings:S}=s,_=__objRest(s,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:R}=_,N=__objRest(_,["style"]),D=S==null?void 0:S.src,M=React.useRef(null),W=React.useRef(null),B=React.useCallback(se=>{M.current=se,typeof e=="function"?e(se):e&&(e.current=se)},[e]),[U,P]=React.useState(!1),{margin:F,cells:j,numCells:Q,calculatedImageSettings:$}=useQRCode({value:a,level:f,minVersion:x,boostLevel:E,includeMargin:g,marginSize:A,imageSettings:S,size:o});React.useEffect(()=>{if(M.current!=null){const se=M.current,H=se.getContext("2d");if(!H)return;let J=j;const K=W.current,ie=$!=null&&K!==null&&K.complete&&K.naturalHeight!==0&&K.naturalWidth!==0;ie&&$.excavation!=null&&(J=excavateModules(j,$.excavation));const ne=window.devicePixelRatio||1;se.height=se.width=o*ne;const re=o/Q*ne;H.scale(re,re),H.fillStyle=p,H.fillRect(0,0,Q,Q),H.fillStyle=y,SUPPORTS_PATH2D?H.fill(new Path2D(generatePath(J,F))):j.forEach(function(X,ae){X.forEach(function(te,ce){te&&H.fillRect(ce+F,ae+F,1,1)})}),$&&(H.globalAlpha=$.opacity),ie&&H.drawImage(K,$.x+F,$.y+F,$.w,$.h)}}),React.useEffect(()=>{P(!1)},[D]);const V=__spreadValues({height:o,width:o},R);let G=null;return D!=null&&(G=React.createElement("img",{src:D,key:D,style:{display:"none"},onLoad:()=>{P(!0)},ref:W,crossOrigin:$==null?void 0:$.crossOrigin})),React.createElement(React.Fragment,null,React.createElement("canvas",__spreadValues({style:V,height:o,width:o,ref:B,role:"img"},N)),G)});QRCodeCanvas.displayName="QRCodeCanvas";var QRCodeSVG=React.forwardRef(function n(t,e){const s=t,{value:a,size:o=DEFAULT_SIZE,level:f=DEFAULT_LEVEL,bgColor:p=DEFAULT_BGCOLOR,fgColor:y=DEFAULT_FGCOLOR,includeMargin:g=DEFAULT_INCLUDEMARGIN,minVersion:x=DEFAULT_MINVERSION,boostLevel:E,title:A,marginSize:S,imageSettings:I}=s,_=__objRest(s,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:R,cells:N,numCells:D,calculatedImageSettings:M}=useQRCode({value:a,level:f,minVersion:x,boostLevel:E,includeMargin:g,marginSize:S,imageSettings:I,size:o});let W=N,B=null;I!=null&&M!=null&&(M.excavation!=null&&(W=excavateModules(N,M.excavation)),B=React.createElement("image",{href:I.src,height:M.h,width:M.w,x:M.x+R,y:M.y+R,preserveAspectRatio:"none",opacity:M.opacity,crossOrigin:M.crossOrigin}));const U=generatePath(W,R);return React.createElement("svg",__spreadValues({height:o,width:o,viewBox:`0 0 ${D} ${D}`,ref:e,role:"img"},_),!!A&&React.createElement("title",null,A),React.createElement("path",{fill:p,d:`M0,0 h${D}v${D}H0z`,shapeRendering:"crispEdges"}),React.createElement("path",{fill:y,d:U,shapeRendering:"crispEdges"}),B)});QRCodeSVG.displayName="QRCodeSVG";function hasNip04Wrapper(n){var t,e;return n&&"nip04"in n&&typeof((t=n.nip04)==null?void 0:t.decrypt)=="function"&&typeof((e=n.nip04)==null?void 0:e.encrypt)=="function"}function hasNip04StandardGlobal(){if(typeof window>"u"||!window.nostr)return!1;const n=window.nostr.nip04;return typeof n=="object"&&n!==null&&typeof n.decrypt=="function"&&typeof n.encrypt=="function"}function hasNip44(n){var t,e;return n&&"nip44"in n&&typeof((t=n.nip44)==null?void 0:t.decrypt)=="function"&&typeof((e=n.nip44)==null?void 0:e.encrypt)=="function"}const CHALLENGE_EXPIRY_MS=3*60*1e3,LOCALSTORAGE_KEY="Zapslingers_active_sent_challenge";function ChallengeHandler({ndk:n,loggedInPubkey:t,onChallengeAccepted:e,recipientNpubOrHex:s,setRecipientNpubOrHex:a}){const[o,f]=reactExports.useState(null),[p,y]=reactExports.useState(null),[g,x]=reactExports.useState(null),E=reactExports.useRef(null),A=reactExports.useRef(null),S=reactExports.useRef(null),I=reactExports.useRef(p),_=reactExports.useRef(g);reactExports.useEffect(()=>{I.current=p},[p]),reactExports.useEffect(()=>{_.current=g},[g]);const R=reactExports.useCallback(()=>{E.current&&(clearTimeout(E.current),E.current=null),y(null);try{localStorage.removeItem(LOCALSTORAGE_KEY)}catch(G){console.error("[ChallengeHandler] Failed to remove item from localStorage:",G)}},[]),N=reactExports.useCallback(()=>{A.current&&(clearTimeout(A.current),A.current=null),x(null)},[]),D=reactExports.useCallback(()=>{E.current&&clearTimeout(E.current),A.current&&clearTimeout(A.current),E.current=null,A.current=null},[]);reactExports.useEffect(()=>{console.log("[ChallengeHandler] Mount Effect: Checking for pending sent challenge...");let G=null;try{const se=localStorage.getItem(LOCALSTORAGE_KEY);if(console.log(`[ChallengeHandler] Raw data from localStorage for ${LOCALSTORAGE_KEY}:`,se),se){const H=JSON.parse(se);if(console.log("[ChallengeHandler] Parsed challenge data:",H),H&&H.recipientPubkey&&H.eventId&&H.timestamp){const J=Date.now()-H.timestamp;if(console.log(`[ChallengeHandler] Time elapsed since challenge sent: ${J}ms`),J<CHALLENGE_EXPIRY_MS){const K=CHALLENGE_EXPIRY_MS-J;console.log(`[ChallengeHandler] Found VALID pending challenge ${H.eventId}. Restoring with ${K.toFixed(0)}ms remaining.`),G=H,E.current=setTimeout(()=>{console.log(`[ChallengeHandler] Restored sent challenge ${H.eventId} expired.`),R()},K)}else console.log(`[ChallengeHandler] Found EXPIRED pending challenge ${H.eventId}. Clearing storage.`),localStorage.removeItem(LOCALSTORAGE_KEY)}else console.warn("[ChallengeHandler] Invalid data structure found in localStorage. Clearing.",H),localStorage.removeItem(LOCALSTORAGE_KEY)}else console.log("[ChallengeHandler] No pending challenge data found in localStorage.")}catch(se){console.error("[ChallengeHandler] Failed to load or parse challenge from localStorage:",se),localStorage.removeItem(LOCALSTORAGE_KEY)}G&&(y(G),console.log("[ChallengeHandler] Restored challenge state set."))},[]);const M=reactExports.useCallback(async G=>{var se,H;if(!(!t||G.pubkey===t)){console.log("[ChallengeHandler] Received potential DM event:",G.encode());try{const J=G.content,K=J.includes("?iv=");let ie;const ne=n==null?void 0:n.signer;if(!ne&&!hasNip04StandardGlobal()){console.warn("[ChallengeHandler] No active signer or NIP-04 capability found for decryption.");return}if(K)if(console.log("[ChallengeHandler] Detected NIP-04 format. Checking signer capability..."),ne&&hasNip04Wrapper(ne))console.log(`[ChallengeHandler] Attempting manual NIP-04 decrypt with Wrapper signer for sender ${G.pubkey}`),ie=await ne.nip04.decrypt(G.pubkey,J),console.log("[ChallengeHandler] Manual NIP-04 decryption successful (Wrapper).");else if(hasNip04StandardGlobal()){if(console.log(`[ChallengeHandler] Attempting manual NIP-04 decrypt with Standard NIP-07 (window.nostr) for sender ${G.pubkey}`),!((H=(se=window.nostr)==null?void 0:se.nip04)!=null&&H.decrypt))throw new Error("window.nostr.nip04.decrypt not available");ie=await window.nostr.nip04.decrypt(G.pubkey,J),console.log("[ChallengeHandler] Manual NIP-04 decryption successful (Standard Global).")}else{console.warn("[ChallengeHandler] Signer or environment does not support NIP-04 decryption.");return}else if(console.log("[ChallengeHandler] Detected non-NIP-04 format (assuming NIP-44). Checking signer capability..."),ne&&hasNip44(ne))console.log(`[ChallengeHandler] Attempting manual NIP-44 decrypt with signer for sender ${G.pubkey}`),ie=await ne.nip44.decrypt(G.pubkey,J),console.log("[ChallengeHandler] Manual NIP-44 decryption successful.");else{console.warn("[ChallengeHandler] Current signer does not support NIP-44 decryption for this content.");return}if(ie===void 0){console.warn("[ChallengeHandler] Decryption failed or did not produce content for event:",G.encode());return}const re=ie.trim();let X=null;try{X=JSON.parse(re)}catch{}const ae=G.tags.find(me=>me[0]==="t");console.log(`[ChallengeHandler] DM Event ${G.encode()} Tags:`,JSON.stringify(G.tags),"Found t-tag:",ae);const te=I.current,ce=_.current;if(te&&G.pubkey===te.recipientPubkey&&ae&&ae[1]===te.eventId&&(X&&X.type==="accept"||re.toLowerCase()==="accept")){console.log(`[ChallengeHandler] Received ACCEPTANCE ${G.encode()} for our challenge ${te.eventId} from ${G.pubkey}`);const Se=te.recipientPubkey,be=te.eventId;R(),e(Se,be);return}if((X&&X.type==="challenge"||re.toLowerCase()==="challenge")&&!ae){if(!te&&!ce){console.log(`[ChallengeHandler] Received new CHALLENGE ${G.encode()} from ${G.pubkey}`),N();const me={challengerPubkey:G.pubkey,eventId:G.encode()};x(me),A.current=setTimeout(()=>{console.log(`[ChallengeHandler] Incoming challenge ${G.encode()} expired.`),x(Se=>(Se==null?void 0:Se.eventId)===me.eventId?null:Se),A.current=null},CHALLENGE_EXPIRY_MS)}else console.log(`[ChallengeHandler] Ignoring new challenge ${G.encode()} while already in an active challenge state (Sent: ${!!te}, Received: ${!!ce}).`);return}}catch(J){console.error(`[ChallengeHandler] Failed to process DM ${G.encode()}:`,J)}}},[t,n,R,e,N]),W=reactExports.useCallback(()=>{},[]),B=reactExports.useCallback(()=>{var H;if(!t||!n)return null;console.log("[ChallengeHandler][subscribeToDMs] CALLED. loggedInPubkey:",t),(H=S.current)==null||H.stop(),console.log("[ChallengeHandler] Stopping previous DM subscription (if any).");const G={kinds:[NDKKind.EncryptedDirectMessage],"#p":[t],since:Math.floor(Date.now()/1e3)-5*60};console.log("[ChallengeHandler] Subscribing to DMs with filter:",G);const se=n.subscribe([G],{closeOnEose:!1});return se.on("event",M),se.on("eose",W),console.log("[ChallengeHandler] New DM subscription created and listeners attached."),S.current=se,se},[n,t,M,W]);reactExports.useEffect(()=>{var se;return console.log("[ChallengeHandler][Main Effect RUNNING] loggedInPubkey:",t,"subscribeToDMs changed:",B!==((se=S.current)==null?void 0:se.on)),B(),()=>{var H;console.log("[ChallengeHandler] Main Effect Cleanup: Stopping final DM subscription and clearing state."),(H=S.current)==null||H.stop(),S.current=null,R(),N()}},[t,B,R,N]);const U=reactExports.useCallback(()=>{console.log("[ChallengeHandler] Manual refresh triggered."),B()},[B]),P=reactExports.useCallback(async()=>{var H,J;const G=n==null?void 0:n.signer;if(!n||!t||!G){f("NDK not ready, user not logged in, or signer missing.");return}if(!s){f("Recipient pubkey is required.");return}if(p||g){f("Please resolve the current challenge first.");return}f(null),D();let se;try{if(s.startsWith("npub1")){const ce=nip19_exports.decode(s);if(ce.type!=="npub")throw new Error("Invalid npub format.");se=ce.data}else if(/^[0-9a-f]{64}$/i.test(s))se=s;else throw new Error("Invalid recipient pubkey format. Use npub or hex.");if(se===t)throw new Error("Cannot challenge yourself.");const K={type:"challenge"},ie=new NDKEvent(n);ie.kind=NDKKind.EncryptedDirectMessage,ie.tags=[["p",se]];const ne=JSON.stringify(K);let re;if(console.log(`[ChallengeHandler] Attempting manual NIP-04 encrypt (send challenge) for recipient ${se}`),G&&hasNip04Wrapper(G))console.log("[ChallengeHandler] Using Wrapper NIP-04 encrypt..."),re=await G.nip04.encrypt(se,ne);else if(hasNip04StandardGlobal()){if(console.log("[ChallengeHandler] Using Standard NIP-07 (window.nostr) encrypt..."),!((J=(H=window.nostr)==null?void 0:H.nip04)!=null&&J.encrypt))throw new Error("window.nostr.nip04.encrypt not available");re=await window.nostr.nip04.encrypt(se,ne)}else throw new Error("Current signer or environment does not support NIP-04 encryption.");ie.content=re,console.log("[ChallengeHandler] Manual NIP-04 encryption (send challenge) successful."),await ie.publish();const X=ie.encode(),ae=Date.now();console.log(`Challenge sent to ${se}, event ID: ${X}`);const te={recipientPubkey:se,eventId:X,timestamp:ae};R(),N(),y(te),a("");try{localStorage.setItem(LOCALSTORAGE_KEY,JSON.stringify(te)),console.log(`[ChallengeHandler] Saved challenge ${X} to localStorage.`)}catch(ce){console.error("[ChallengeHandler] Failed to save challenge to localStorage:",ce)}E.current=setTimeout(()=>{var ce;console.log(`[ChallengeHandler] Sent challenge ${X} expired.`),((ce=I.current)==null?void 0:ce.eventId)===X&&R(),E.current=null},CHALLENGE_EXPIRY_MS)}catch(K){console.error("Failed to send challenge:",K),f(`Failed to send challenge: ${K instanceof Error?K.message:String(K)}`),R()}},[n,t,s,a,R,N]),F=reactExports.useCallback(async()=>{var J,K;const G=n==null?void 0:n.signer;if(!n||!t||!g||!G){f("Cannot accept challenge: Invalid state or signer missing.");return}const{challengerPubkey:se,eventId:H}=g;f(null);try{const ie={type:"accept"},ne=new NDKEvent(n);ne.kind=NDKKind.EncryptedDirectMessage,ne.tags=[["p",se],["t",H]];const re=JSON.stringify(ie);let X;if(console.log(`[ChallengeHandler] Attempting manual NIP-04 encrypt (accept challenge) for recipient ${se}`),G&&hasNip04Wrapper(G))console.log("[ChallengeHandler] Using Wrapper NIP-04 encrypt..."),X=await G.nip04.encrypt(se,re);else if(hasNip04StandardGlobal()){if(console.log("[ChallengeHandler] Using Standard NIP-07 (window.nostr) encrypt..."),!((K=(J=window.nostr)==null?void 0:J.nip04)!=null&&K.encrypt))throw new Error("window.nostr.nip04.encrypt not available");X=await window.nostr.nip04.encrypt(se,re)}else throw new Error("Current signer or environment does not support NIP-04 encryption.");ne.content=X,console.log("[ChallengeHandler] Manual NIP-04 encryption (accept challenge) successful."),await ne.publish();const ae=ne.encode();console.log(`Acceptance sent to ${se} for challenge ${H}. Acceptance event ID: ${ae}`),N(),e(se,H)}catch(ie){console.error("Failed to send acceptance:",ie),f(`Failed to send acceptance: ${ie instanceof Error?ie.message:String(ie)}`)}},[n,t,g,e,N]),j=reactExports.useCallback(()=>{g&&(console.log(`[ChallengeHandler] Dismissing incoming challenge: ${g==null?void 0:g.eventId}`),N())},[g,N]),Q=t&&!p&&!g,$=!!p,V=!!g;return jsxRuntimeExports.jsxs("div",{className:"p-4 border rounded border-gray-600",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-3",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold",children:"Challenge a Player"}),t&&jsxRuntimeExports.jsx("button",{onClick:U,className:"px-3 py-1 bg-gray-600 rounded hover:bg-gray-500 text-sm",children:"Refresh DMs"})]}),Q&&jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[jsxRuntimeExports.jsx("input",{type:"text",value:s,onChange:G=>a(G.target.value),placeholder:"Enter opponent's npub or hex pubkey",className:"flex-grow text-black p-2 border rounded",disabled:!t}),jsxRuntimeExports.jsx("button",{onClick:P,disabled:!s||!t,className:"px-4 py-2 bg-blue-600 rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Send Challenge"})]}),o&&jsxRuntimeExports.jsxs("p",{className:"text-red-500 mt-1 text-sm",children:["Error: ",o]}),$&&jsxRuntimeExports.jsxs("p",{className:"text-yellow-400 mt-2",children:["Challenge sent to ",p!=null&&p.recipientPubkey?nip19_exports.npubEncode(p.recipientPubkey).substring(0,12)+"...":"...",". Waiting for acceptance."]}),V&&jsxRuntimeExports.jsxs("div",{className:"mt-4 p-3 bg-gray-700 rounded",children:[jsxRuntimeExports.jsxs("p",{className:"text-green-400 font-medium mb-2",children:["Incoming challenge from: ",g!=null&&g.challengerPubkey?nip19_exports.npubEncode(g.challengerPubkey).substring(0,12)+"...":"..."]}),jsxRuntimeExports.jsxs("div",{className:"flex space-x-2",children:[jsxRuntimeExports.jsx("button",{onClick:F,className:"px-3 py-1 bg-green-600 rounded hover:bg-green-700 text-sm disabled:opacity-50",disabled:!g,children:"Accept"}),jsxRuntimeExports.jsx("button",{onClick:j,className:"px-3 py-1 bg-red-600 rounded hover:bg-red-700 text-sm disabled:opacity-50",disabled:!g,children:"Dismiss"})]})]}),!t&&jsxRuntimeExports.jsx("p",{className:"text-gray-400 mt-2",children:"Log in to send or receive challenges."})]})}var Html5QrcodeSupportedFormats;(function(n){n[n.QR_CODE=0]="QR_CODE",n[n.AZTEC=1]="AZTEC",n[n.CODABAR=2]="CODABAR",n[n.CODE_39=3]="CODE_39",n[n.CODE_93=4]="CODE_93",n[n.CODE_128=5]="CODE_128",n[n.DATA_MATRIX=6]="DATA_MATRIX",n[n.MAXICODE=7]="MAXICODE",n[n.ITF=8]="ITF",n[n.EAN_13=9]="EAN_13",n[n.EAN_8=10]="EAN_8",n[n.PDF_417=11]="PDF_417",n[n.RSS_14=12]="RSS_14",n[n.RSS_EXPANDED=13]="RSS_EXPANDED",n[n.UPC_A=14]="UPC_A",n[n.UPC_E=15]="UPC_E",n[n.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(Html5QrcodeSupportedFormats||(Html5QrcodeSupportedFormats={}));var html5QrcodeSupportedFormatsTextMap=new Map([[Html5QrcodeSupportedFormats.QR_CODE,"QR_CODE"],[Html5QrcodeSupportedFormats.AZTEC,"AZTEC"],[Html5QrcodeSupportedFormats.CODABAR,"CODABAR"],[Html5QrcodeSupportedFormats.CODE_39,"CODE_39"],[Html5QrcodeSupportedFormats.CODE_93,"CODE_93"],[Html5QrcodeSupportedFormats.CODE_128,"CODE_128"],[Html5QrcodeSupportedFormats.DATA_MATRIX,"DATA_MATRIX"],[Html5QrcodeSupportedFormats.MAXICODE,"MAXICODE"],[Html5QrcodeSupportedFormats.ITF,"ITF"],[Html5QrcodeSupportedFormats.EAN_13,"EAN_13"],[Html5QrcodeSupportedFormats.EAN_8,"EAN_8"],[Html5QrcodeSupportedFormats.PDF_417,"PDF_417"],[Html5QrcodeSupportedFormats.RSS_14,"RSS_14"],[Html5QrcodeSupportedFormats.RSS_EXPANDED,"RSS_EXPANDED"],[Html5QrcodeSupportedFormats.UPC_A,"UPC_A"],[Html5QrcodeSupportedFormats.UPC_E,"UPC_E"],[Html5QrcodeSupportedFormats.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]),DecodedTextType;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.URL=1]="URL"})(DecodedTextType||(DecodedTextType={}));function isValidHtml5QrcodeSupportedFormats(n){return Object.values(Html5QrcodeSupportedFormats).includes(n)}var Html5QrcodeScanType;(function(n){n[n.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",n[n.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"})(Html5QrcodeScanType||(Html5QrcodeScanType={}));var Html5QrcodeConstants=function(){function n(){}return n.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",n.SCAN_DEFAULT_FPS=2,n.DEFAULT_DISABLE_FLIP=!1,n.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,n.DEFAULT_SUPPORTED_SCAN_TYPE=[Html5QrcodeScanType.SCAN_TYPE_CAMERA,Html5QrcodeScanType.SCAN_TYPE_FILE],n}(),QrcodeResultFormat=function(){function n(t,e){this.format=t,this.formatName=e}return n.prototype.toString=function(){return this.formatName},n.create=function(t){if(!html5QrcodeSupportedFormatsTextMap.has(t))throw"".concat(t," not in html5QrcodeSupportedFormatsTextMap");return new n(t,html5QrcodeSupportedFormatsTextMap.get(t))},n}(),Html5QrcodeResultFactory=function(){function n(){}return n.createFromText=function(t){var e={text:t};return{decodedText:t,result:e}},n.createFromQrcodeResult=function(t){return{decodedText:t.text,result:t}},n}(),Html5QrcodeErrorTypes;(function(n){n[n.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",n[n.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",n[n.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"})(Html5QrcodeErrorTypes||(Html5QrcodeErrorTypes={}));var Html5QrcodeErrorFactory=function(){function n(){}return n.createFrom=function(t){return{errorMessage:t,type:Html5QrcodeErrorTypes.UNKWOWN_ERROR}},n}(),BaseLoggger=function(){function n(t){this.verbose=t}return n.prototype.log=function(t){this.verbose&&console.log(t)},n.prototype.warn=function(t){this.verbose&&console.warn(t)},n.prototype.logError=function(t,e){(this.verbose||e===!0)&&console.error(t)},n.prototype.logErrors=function(t){if(t.length===0)throw"Logger#logError called without arguments";this.verbose&&console.error(t)},n}();function isNullOrUndefined(n){return typeof n>"u"||n===null}function clip(n,t,e){return n>e?e:n<t?t:n}var Html5QrcodeStrings=function(){function n(){}return n.codeParseError=function(t){return"QR code parse error, error = ".concat(t)},n.errorGettingUserMedia=function(t){return"Error getting userMedia, error = ".concat(t)},n.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},n.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},n.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},n.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},n.scannerPaused=function(){return"Scanner paused"},n}(),Html5QrcodeScannerStrings=function(){function n(){}return n.scanningStatus=function(){return"Scanning"},n.idleStatus=function(){return"Idle"},n.errorStatus=function(){return"Error"},n.permissionStatus=function(){return"Permission"},n.noCameraFoundErrorStatus=function(){return"No Cameras"},n.lastMatch=function(t){return"Last Match: ".concat(t)},n.codeScannerTitle=function(){return"Code Scanner"},n.cameraPermissionTitle=function(){return"Request Camera Permissions"},n.cameraPermissionRequesting=function(){return"Requesting camera permissions..."},n.noCameraFound=function(){return"No camera found"},n.scanButtonStopScanningText=function(){return"Stop Scanning"},n.scanButtonStartScanningText=function(){return"Start Scanning"},n.torchOnButton=function(){return"Switch On Torch"},n.torchOffButton=function(){return"Switch Off Torch"},n.torchOnFailedMessage=function(){return"Failed to turn on torch"},n.torchOffFailedMessage=function(){return"Failed to turn off torch"},n.scanButtonScanningStarting=function(){return"Launching Camera..."},n.textIfCameraScanSelected=function(){return"Scan an Image File"},n.textIfFileScanSelected=function(){return"Scan using camera directly"},n.selectCamera=function(){return"Select Camera"},n.fileSelectionChooseImage=function(){return"Choose Image"},n.fileSelectionChooseAnother=function(){return"Choose Another"},n.fileSelectionNoImageSelected=function(){return"No image choosen"},n.anonymousCameraPrefix=function(){return"Anonymous Camera"},n.dragAndDropMessage=function(){return"Or drop an image to scan"},n.dragAndDropMessageOnlyImages=function(){return"Or drop an image to scan (other files not supported)"},n.zoom=function(){return"zoom"},n.loadingImage=function(){return"Loading image..."},n.cameraScanAltText=function(){return"Camera based scan"},n.fileScanAltText=function(){return"Fule based scan"},n}(),LibraryInfoStrings=function(){function n(){}return n.poweredBy=function(){return"Powered by "},n.reportIssues=function(){return"Report issues"},n}(),VideoConstraintsUtil=function(){function n(){}return n.isMediaStreamConstraintsValid=function(t,e){if(typeof t!="object"){var s=typeof t;return e.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(s,"."),!0),!1}for(var a=["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"],o=new Set(a),f=Object.keys(t),p=0,y=f;p<y.length;p++){var g=y[p];if(o.has(g))return e.logError("".concat(g," is not supported videoConstaints."),!0),!1}return!0},n}(),zxingJs_umd$2={exports:{}},zxingJs_umd$1=zxingJs_umd$2.exports,hasRequiredZxingJs_umd;function requireZxingJs_umd(){return hasRequiredZxingJs_umd||(hasRequiredZxingJs_umd=1,function(n,t){(function(e,s){s(t)})(zxingJs_umd$1,function(e){function s(oe){return oe==null}var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(oe,r){oe.__proto__=r}||function(oe,r){for(var c in r)r.hasOwnProperty(c)&&(oe[c]=r[c])};function o(oe,r){a(oe,r);function c(){this.constructor=oe}oe.prototype=r===null?Object.create(r):(c.prototype=r.prototype,new c)}function f(oe,r){var c=Object.setPrototypeOf;c?c(oe,r):oe.__proto__=r}function p(oe,r){r===void 0&&(r=oe.constructor);var c=Error.captureStackTrace;c&&c(oe,r)}var y=function(oe){o(r,oe);function r(c){var u=this.constructor,m=oe.call(this,c)||this;return Object.defineProperty(m,"name",{value:u.name,enumerable:!1}),f(m,u.prototype),p(m),m}return r}(Error);class g extends y{constructor(r=void 0){super(r),this.message=r}getKind(){return this.constructor.kind}}g.kind="Exception";class x extends g{}x.kind="ArgumentException";class E extends g{}E.kind="IllegalArgumentException";class A{constructor(r){if(this.binarizer=r,r===null)throw new E("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(r,c){return this.binarizer.getBlackRow(r,c)}getBlackMatrix(){return(this.matrix===null||this.matrix===void 0)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(r,c,u,m){const w=this.binarizer.getLuminanceSource().crop(r,c,u,m);return new A(this.binarizer.createBinarizer(w))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const r=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new A(this.binarizer.createBinarizer(r))}rotateCounterClockwise45(){const r=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new A(this.binarizer.createBinarizer(r))}toString(){try{return this.getBlackMatrix().toString()}catch{return""}}}class S extends g{static getChecksumInstance(){return new S}}S.kind="ChecksumException";class I{constructor(r){this.source=r}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class _{static arraycopy(r,c,u,m,w){for(;w--;)u[m++]=r[c++]}static currentTimeMillis(){return Date.now()}}class R extends g{}R.kind="IndexOutOfBoundsException";class N extends R{constructor(r=void 0,c=void 0){super(c),this.index=r,this.message=c}}N.kind="ArrayIndexOutOfBoundsException";class D{static fill(r,c){for(let u=0,m=r.length;u<m;u++)r[u]=c}static fillWithin(r,c,u,m){D.rangeCheck(r.length,c,u);for(let w=c;w<u;w++)r[w]=m}static rangeCheck(r,c,u){if(c>u)throw new E("fromIndex("+c+") > toIndex("+u+")");if(c<0)throw new N(c);if(u>r)throw new N(u)}static asList(...r){return r}static create(r,c,u){return Array.from({length:r}).map(w=>Array.from({length:c}).fill(u))}static createInt32Array(r,c,u){return Array.from({length:r}).map(w=>Int32Array.from({length:c}).fill(u))}static equals(r,c){if(!r||!c||!r.length||!c.length||r.length!==c.length)return!1;for(let u=0,m=r.length;u<m;u++)if(r[u]!==c[u])return!1;return!0}static hashCode(r){if(r===null)return 0;let c=1;for(const u of r)c=31*c+u;return c}static fillUint8Array(r,c){for(let u=0;u!==r.length;u++)r[u]=c}static copyOf(r,c){return r.slice(0,c)}static copyOfUint8Array(r,c){if(r.length<=c){const u=new Uint8Array(c);return u.set(r),u}return r.slice(0,c)}static copyOfRange(r,c,u){const m=u-c,w=new Int32Array(m);return _.arraycopy(r,c,w,0,m),w}static binarySearch(r,c,u){u===void 0&&(u=D.numberComparator);let m=0,w=r.length-1;for(;m<=w;){const v=w+m>>1,C=u(c,r[v]);if(C>0)m=v+1;else if(C<0)w=v-1;else return v}return-m-1}static numberComparator(r,c){return r-c}}class M{static numberOfTrailingZeros(r){let c;if(r===0)return 32;let u=31;return c=r<<16,c!==0&&(u-=16,r=c),c=r<<8,c!==0&&(u-=8,r=c),c=r<<4,c!==0&&(u-=4,r=c),c=r<<2,c!==0&&(u-=2,r=c),u-(r<<1>>>31)}static numberOfLeadingZeros(r){if(r===0)return 32;let c=1;return r>>>16||(c+=16,r<<=16),r>>>24||(c+=8,r<<=8),r>>>28||(c+=4,r<<=4),r>>>30||(c+=2,r<<=2),c-=r>>>31,c}static toHexString(r){return r.toString(16)}static toBinaryString(r){return String(parseInt(String(r),2))}static bitCount(r){return r=r-(r>>>1&1431655765),r=(r&858993459)+(r>>>2&858993459),r=r+(r>>>4)&252645135,r=r+(r>>>8),r=r+(r>>>16),r&63}static truncDivision(r,c){return Math.trunc(r/c)}static parseInt(r,c=void 0){return parseInt(r,c)}}M.MIN_VALUE_32_BITS=-2147483648,M.MAX_VALUE=Number.MAX_SAFE_INTEGER;class W{constructor(r,c){r===void 0?(this.size=0,this.bits=new Int32Array(1)):(this.size=r,c==null?this.bits=W.makeArray(r):this.bits=c)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(r){if(r>this.bits.length*32){const c=W.makeArray(r);_.arraycopy(this.bits,0,c,0,this.bits.length),this.bits=c}}get(r){return(this.bits[Math.floor(r/32)]&1<<(r&31))!==0}set(r){this.bits[Math.floor(r/32)]|=1<<(r&31)}flip(r){this.bits[Math.floor(r/32)]^=1<<(r&31)}getNextSet(r){const c=this.size;if(r>=c)return c;const u=this.bits;let m=Math.floor(r/32),w=u[m];w&=~((1<<(r&31))-1);const v=u.length;for(;w===0;){if(++m===v)return c;w=u[m]}const C=m*32+M.numberOfTrailingZeros(w);return C>c?c:C}getNextUnset(r){const c=this.size;if(r>=c)return c;const u=this.bits;let m=Math.floor(r/32),w=~u[m];w&=~((1<<(r&31))-1);const v=u.length;for(;w===0;){if(++m===v)return c;w=~u[m]}const C=m*32+M.numberOfTrailingZeros(w);return C>c?c:C}setBulk(r,c){this.bits[Math.floor(r/32)]=c}setRange(r,c){if(c<r||r<0||c>this.size)throw new E;if(c===r)return;c--;const u=Math.floor(r/32),m=Math.floor(c/32),w=this.bits;for(let v=u;v<=m;v++){const C=v>u?0:r&31,O=(2<<(v<m?31:c&31))-(1<<C);w[v]|=O}}clear(){const r=this.bits.length,c=this.bits;for(let u=0;u<r;u++)c[u]=0}isRange(r,c,u){if(c<r||r<0||c>this.size)throw new E;if(c===r)return!0;c--;const m=Math.floor(r/32),w=Math.floor(c/32),v=this.bits;for(let C=m;C<=w;C++){const k=C>m?0:r&31,Z=(2<<(C<w?31:c&31))-(1<<k)&4294967295;if((v[C]&Z)!==(u?Z:0))return!1}return!0}appendBit(r){this.ensureCapacity(this.size+1),r&&(this.bits[Math.floor(this.size/32)]|=1<<(this.size&31)),this.size++}appendBits(r,c){if(c<0||c>32)throw new E("Num bits must be between 0 and 32");this.ensureCapacity(this.size+c);for(let u=c;u>0;u--)this.appendBit((r>>u-1&1)===1)}appendBitArray(r){const c=r.size;this.ensureCapacity(this.size+c);for(let u=0;u<c;u++)this.appendBit(r.get(u))}xor(r){if(this.size!==r.size)throw new E("Sizes don't match");const c=this.bits;for(let u=0,m=c.length;u<m;u++)c[u]^=r.bits[u]}toBytes(r,c,u,m){for(let w=0;w<m;w++){let v=0;for(let C=0;C<8;C++)this.get(r)&&(v|=1<<7-C),r++;c[u+w]=v}}getBitArray(){return this.bits}reverse(){const r=new Int32Array(this.bits.length),c=Math.floor((this.size-1)/32),u=c+1,m=this.bits;for(let w=0;w<u;w++){let v=m[w];v=v>>1&1431655765|(v&1431655765)<<1,v=v>>2&858993459|(v&858993459)<<2,v=v>>4&252645135|(v&252645135)<<4,v=v>>8&16711935|(v&16711935)<<8,v=v>>16&65535|(v&65535)<<16,r[c-w]=v}if(this.size!==u*32){const w=u*32-this.size;let v=r[0]>>>w;for(let C=1;C<u;C++){const k=r[C];v|=k<<32-w,r[C-1]=v,v=k>>>w}r[u-1]=v}this.bits=r}static makeArray(r){return new Int32Array(Math.floor((r+31)/32))}equals(r){if(!(r instanceof W))return!1;const c=r;return this.size===c.size&&D.equals(this.bits,c.bits)}hashCode(){return 31*this.size+D.hashCode(this.bits)}toString(){let r="";for(let c=0,u=this.size;c<u;c++)(c&7)===0&&(r+=" "),r+=this.get(c)?"X":".";return r}clone(){return new W(this.size,this.bits.slice())}}var B;(function(oe){oe[oe.OTHER=0]="OTHER",oe[oe.PURE_BARCODE=1]="PURE_BARCODE",oe[oe.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",oe[oe.TRY_HARDER=3]="TRY_HARDER",oe[oe.CHARACTER_SET=4]="CHARACTER_SET",oe[oe.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",oe[oe.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",oe[oe.ASSUME_GS1=7]="ASSUME_GS1",oe[oe.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",oe[oe.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",oe[oe.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"})(B||(B={}));var U=B;class P extends g{static getFormatInstance(){return new P}}P.kind="FormatException";var F;(function(oe){oe[oe.Cp437=0]="Cp437",oe[oe.ISO8859_1=1]="ISO8859_1",oe[oe.ISO8859_2=2]="ISO8859_2",oe[oe.ISO8859_3=3]="ISO8859_3",oe[oe.ISO8859_4=4]="ISO8859_4",oe[oe.ISO8859_5=5]="ISO8859_5",oe[oe.ISO8859_6=6]="ISO8859_6",oe[oe.ISO8859_7=7]="ISO8859_7",oe[oe.ISO8859_8=8]="ISO8859_8",oe[oe.ISO8859_9=9]="ISO8859_9",oe[oe.ISO8859_10=10]="ISO8859_10",oe[oe.ISO8859_11=11]="ISO8859_11",oe[oe.ISO8859_13=12]="ISO8859_13",oe[oe.ISO8859_14=13]="ISO8859_14",oe[oe.ISO8859_15=14]="ISO8859_15",oe[oe.ISO8859_16=15]="ISO8859_16",oe[oe.SJIS=16]="SJIS",oe[oe.Cp1250=17]="Cp1250",oe[oe.Cp1251=18]="Cp1251",oe[oe.Cp1252=19]="Cp1252",oe[oe.Cp1256=20]="Cp1256",oe[oe.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",oe[oe.UTF8=22]="UTF8",oe[oe.ASCII=23]="ASCII",oe[oe.Big5=24]="Big5",oe[oe.GB18030=25]="GB18030",oe[oe.EUC_KR=26]="EUC_KR"})(F||(F={}));class j{constructor(r,c,u,...m){this.valueIdentifier=r,this.name=u,typeof c=="number"?this.values=Int32Array.from([c]):this.values=c,this.otherEncodingNames=m,j.VALUE_IDENTIFIER_TO_ECI.set(r,this),j.NAME_TO_ECI.set(u,this);const w=this.values;for(let v=0,C=w.length;v!==C;v++){const k=w[v];j.VALUES_TO_ECI.set(k,this)}for(const v of m)j.NAME_TO_ECI.set(v,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(r){if(r<0||r>=900)throw new P("incorect value");const c=j.VALUES_TO_ECI.get(r);if(c===void 0)throw new P("incorect value");return c}static getCharacterSetECIByName(r){const c=j.NAME_TO_ECI.get(r);if(c===void 0)throw new P("incorect value");return c}equals(r){if(!(r instanceof j))return!1;const c=r;return this.getName()===c.getName()}}j.VALUE_IDENTIFIER_TO_ECI=new Map,j.VALUES_TO_ECI=new Map,j.NAME_TO_ECI=new Map,j.Cp437=new j(F.Cp437,Int32Array.from([0,2]),"Cp437"),j.ISO8859_1=new j(F.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),j.ISO8859_2=new j(F.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),j.ISO8859_3=new j(F.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),j.ISO8859_4=new j(F.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),j.ISO8859_5=new j(F.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),j.ISO8859_6=new j(F.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),j.ISO8859_7=new j(F.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),j.ISO8859_8=new j(F.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),j.ISO8859_9=new j(F.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),j.ISO8859_10=new j(F.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),j.ISO8859_11=new j(F.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),j.ISO8859_13=new j(F.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),j.ISO8859_14=new j(F.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),j.ISO8859_15=new j(F.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),j.ISO8859_16=new j(F.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),j.SJIS=new j(F.SJIS,20,"SJIS","Shift_JIS"),j.Cp1250=new j(F.Cp1250,21,"Cp1250","windows-1250"),j.Cp1251=new j(F.Cp1251,22,"Cp1251","windows-1251"),j.Cp1252=new j(F.Cp1252,23,"Cp1252","windows-1252"),j.Cp1256=new j(F.Cp1256,24,"Cp1256","windows-1256"),j.UnicodeBigUnmarked=new j(F.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),j.UTF8=new j(F.UTF8,26,"UTF8","UTF-8"),j.ASCII=new j(F.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),j.Big5=new j(F.Big5,28,"Big5"),j.GB18030=new j(F.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),j.EUC_KR=new j(F.EUC_KR,30,"EUC_KR","EUC-KR");class Q extends g{}Q.kind="UnsupportedOperationException";class ${static decode(r,c){const u=this.encodingName(c);return this.customDecoder?this.customDecoder(r,u):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(u)?this.decodeFallback(r,u):new TextDecoder(u).decode(r)}static shouldDecodeOnFallback(r){return!$.isBrowser()&&r==="ISO-8859-1"}static encode(r,c){const u=this.encodingName(c);return this.customEncoder?this.customEncoder(r,u):typeof TextEncoder>"u"?this.encodeFallback(r):new TextEncoder().encode(r)}static isBrowser(){return typeof window<"u"&&{}.toString.call(window)==="[object Window]"}static encodingName(r){return typeof r=="string"?r:r.getName()}static encodingCharacterSet(r){return r instanceof j?r:j.getCharacterSetECIByName(r)}static decodeFallback(r,c){const u=this.encodingCharacterSet(c);if($.isDecodeFallbackSupported(u)){let m="";for(let w=0,v=r.length;w<v;w++){let C=r[w].toString(16);C.length<2&&(C="0"+C),m+="%"+C}return decodeURIComponent(m)}if(u.equals(j.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(r.buffer));throw new Q(`Encoding ${this.encodingName(c)} not supported by fallback.`)}static isDecodeFallbackSupported(r){return r.equals(j.UTF8)||r.equals(j.ISO8859_1)||r.equals(j.ASCII)}static encodeFallback(r){const u=btoa(unescape(encodeURIComponent(r))).split(""),m=[];for(let w=0;w<u.length;w++)m.push(u[w].charCodeAt(0));return new Uint8Array(m)}}class V{static castAsNonUtf8Char(r,c=null){const u=c?c.getName():this.ISO88591;return $.decode(new Uint8Array([r]),u)}static guessEncoding(r,c){if(c!=null&&c.get(U.CHARACTER_SET)!==void 0)return c.get(U.CHARACTER_SET).toString();const u=r.length;let m=!0,w=!0,v=!0,C=0,k=0,O=0,Z=0,le=0,he=0,Ee=0,Ce=0,Ie=0,Re=0,Fe=0;const Xe=r.length>3&&r[0]===239&&r[1]===187&&r[2]===191;for(let Je=0;Je<u&&(m||w||v);Je++){const Ye=r[Je]&255;v&&(C>0?(Ye&128)===0?v=!1:C--:(Ye&128)!==0&&((Ye&64)===0?v=!1:(C++,(Ye&32)===0?k++:(C++,(Ye&16)===0?O++:(C++,(Ye&8)===0?Z++:v=!1))))),m&&(Ye>127&&Ye<160?m=!1:Ye>159&&(Ye<192||Ye===215||Ye===247)&&Fe++),w&&(le>0?Ye<64||Ye===127||Ye>252?w=!1:le--:Ye===128||Ye===160||Ye>239?w=!1:Ye>160&&Ye<224?(he++,Ce=0,Ee++,Ee>Ie&&(Ie=Ee)):Ye>127?(le++,Ee=0,Ce++,Ce>Re&&(Re=Ce)):(Ee=0,Ce=0))}return v&&C>0&&(v=!1),w&&le>0&&(w=!1),v&&(Xe||k+O+Z>0)?V.UTF8:w&&(V.ASSUME_SHIFT_JIS||Ie>=3||Re>=3)?V.SHIFT_JIS:m&&w?Ie===2&&he===2||Fe*10>=u?V.SHIFT_JIS:V.ISO88591:m?V.ISO88591:w?V.SHIFT_JIS:v?V.UTF8:V.PLATFORM_DEFAULT_ENCODING}static format(r,...c){let u=-1;function m(v,C,k,O,Z,le){if(v==="%%")return"%";if(c[++u]===void 0)return;v=O?parseInt(O.substr(1)):void 0;let he=Z?parseInt(Z.substr(1)):void 0,Ee;switch(le){case"s":Ee=c[u];break;case"c":Ee=c[u][0];break;case"f":Ee=parseFloat(c[u]).toFixed(v);break;case"p":Ee=parseFloat(c[u]).toPrecision(v);break;case"e":Ee=parseFloat(c[u]).toExponential(v);break;case"x":Ee=parseInt(c[u]).toString(he||16);break;case"d":Ee=parseFloat(parseInt(c[u],he||10).toPrecision(v)).toFixed(0);break}Ee=typeof Ee=="object"?JSON.stringify(Ee):(+Ee).toString(he);let Ce=parseInt(k),Ie=k&&k[0]+""=="0"?"0":" ";for(;Ee.length<Ce;)Ee=C!==void 0?Ee+Ie:Ie+Ee;return Ee}let w=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return r.replace(w,m)}static getBytes(r,c){return $.encode(r,c)}static getCharCode(r,c=0){return r.charCodeAt(c)}static getCharAt(r){return String.fromCharCode(r)}}V.SHIFT_JIS=j.SJIS.getName(),V.GB2312="GB2312",V.ISO88591=j.ISO8859_1.getName(),V.EUC_JP="EUC_JP",V.UTF8=j.UTF8.getName(),V.PLATFORM_DEFAULT_ENCODING=V.UTF8,V.ASSUME_SHIFT_JIS=!1;class G{constructor(r=""){this.value=r}enableDecoding(r){return this.encoding=r,this}append(r){return typeof r=="string"?this.value+=r.toString():this.encoding?this.value+=V.castAsNonUtf8Char(r,this.encoding):this.value+=String.fromCharCode(r),this}appendChars(r,c,u){for(let m=c;c<c+u;m++)this.append(r[m]);return this}length(){return this.value.length}charAt(r){return this.value.charAt(r)}deleteCharAt(r){this.value=this.value.substr(0,r)+this.value.substring(r+1)}setCharAt(r,c){this.value=this.value.substr(0,r)+c+this.value.substr(r+1)}substring(r,c){return this.value.substring(r,c)}setLengthToZero(){this.value=""}toString(){return this.value}insert(r,c){this.value=this.value.substr(0,r)+c+this.value.substr(r+c.length)}}class se{constructor(r,c,u,m){if(this.width=r,this.height=c,this.rowSize=u,this.bits=m,c==null&&(c=r),this.height=c,r<1||c<1)throw new E("Both dimensions must be greater than 0");u==null&&(u=Math.floor((r+31)/32)),this.rowSize=u,m==null&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(r){const c=r.length,u=r[0].length,m=new se(u,c);for(let w=0;w<c;w++){const v=r[w];for(let C=0;C<u;C++)v[C]&&m.set(C,w)}return m}static parseFromString(r,c,u){if(r===null)throw new E("stringRepresentation cannot be null");const m=new Array(r.length);let w=0,v=0,C=-1,k=0,O=0;for(;O<r.length;)if(r.charAt(O)===`
`||r.charAt(O)==="\r"){if(w>v){if(C===-1)C=w-v;else if(w-v!==C)throw new E("row lengths do not match");v=w,k++}O++}else if(r.substring(O,O+c.length)===c)O+=c.length,m[w]=!0,w++;else if(r.substring(O,O+u.length)===u)O+=u.length,m[w]=!1,w++;else throw new E("illegal character encountered: "+r.substring(O));if(w>v){if(C===-1)C=w-v;else if(w-v!==C)throw new E("row lengths do not match");k++}const Z=new se(C,k);for(let le=0;le<w;le++)m[le]&&Z.set(Math.floor(le%C),Math.floor(le/C));return Z}get(r,c){const u=c*this.rowSize+Math.floor(r/32);return(this.bits[u]>>>(r&31)&1)!==0}set(r,c){const u=c*this.rowSize+Math.floor(r/32);this.bits[u]|=1<<(r&31)&4294967295}unset(r,c){const u=c*this.rowSize+Math.floor(r/32);this.bits[u]&=~(1<<(r&31)&4294967295)}flip(r,c){const u=c*this.rowSize+Math.floor(r/32);this.bits[u]^=1<<(r&31)&4294967295}xor(r){if(this.width!==r.getWidth()||this.height!==r.getHeight()||this.rowSize!==r.getRowSize())throw new E("input matrix dimensions do not match");const c=new W(Math.floor(this.width/32)+1),u=this.rowSize,m=this.bits;for(let w=0,v=this.height;w<v;w++){const C=w*u,k=r.getRow(w,c).getBitArray();for(let O=0;O<u;O++)m[C+O]^=k[O]}}clear(){const r=this.bits,c=r.length;for(let u=0;u<c;u++)r[u]=0}setRegion(r,c,u,m){if(c<0||r<0)throw new E("Left and top must be nonnegative");if(m<1||u<1)throw new E("Height and width must be at least 1");const w=r+u,v=c+m;if(v>this.height||w>this.width)throw new E("The region must fit inside the matrix");const C=this.rowSize,k=this.bits;for(let O=c;O<v;O++){const Z=O*C;for(let le=r;le<w;le++)k[Z+Math.floor(le/32)]|=1<<(le&31)&4294967295}}getRow(r,c){c==null||c.getSize()<this.width?c=new W(this.width):c.clear();const u=this.rowSize,m=this.bits,w=r*u;for(let v=0;v<u;v++)c.setBulk(v*32,m[w+v]);return c}setRow(r,c){_.arraycopy(c.getBitArray(),0,this.bits,r*this.rowSize,this.rowSize)}rotate180(){const r=this.getWidth(),c=this.getHeight();let u=new W(r),m=new W(r);for(let w=0,v=Math.floor((c+1)/2);w<v;w++)u=this.getRow(w,u),m=this.getRow(c-1-w,m),u.reverse(),m.reverse(),this.setRow(w,m),this.setRow(c-1-w,u)}getEnclosingRectangle(){const r=this.width,c=this.height,u=this.rowSize,m=this.bits;let w=r,v=c,C=-1,k=-1;for(let O=0;O<c;O++)for(let Z=0;Z<u;Z++){const le=m[O*u+Z];if(le!==0){if(O<v&&(v=O),O>k&&(k=O),Z*32<w){let he=0;for(;(le<<31-he&4294967295)===0;)he++;Z*32+he<w&&(w=Z*32+he)}if(Z*32+31>C){let he=31;for(;!(le>>>he);)he--;Z*32+he>C&&(C=Z*32+he)}}}return C<w||k<v?null:Int32Array.from([w,v,C-w+1,k-v+1])}getTopLeftOnBit(){const r=this.rowSize,c=this.bits;let u=0;for(;u<c.length&&c[u]===0;)u++;if(u===c.length)return null;const m=u/r;let w=u%r*32;const v=c[u];let C=0;for(;(v<<31-C&4294967295)===0;)C++;return w+=C,Int32Array.from([w,m])}getBottomRightOnBit(){const r=this.rowSize,c=this.bits;let u=c.length-1;for(;u>=0&&c[u]===0;)u--;if(u<0)return null;const m=Math.floor(u/r);let w=Math.floor(u%r)*32;const v=c[u];let C=31;for(;!(v>>>C);)C--;return w+=C,Int32Array.from([w,m])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(r){if(!(r instanceof se))return!1;const c=r;return this.width===c.width&&this.height===c.height&&this.rowSize===c.rowSize&&D.equals(this.bits,c.bits)}hashCode(){let r=this.width;return r=31*r+this.width,r=31*r+this.height,r=31*r+this.rowSize,r=31*r+D.hashCode(this.bits),r}toString(r="X ",c="  ",u=`
`){return this.buildToString(r,c,u)}buildToString(r,c,u){let m=new G;for(let w=0,v=this.height;w<v;w++){for(let C=0,k=this.width;C<k;C++)m.append(this.get(C,w)?r:c);m.append(u)}return m.toString()}clone(){return new se(this.width,this.height,this.rowSize,this.bits.slice())}}class H extends g{static getNotFoundInstance(){return new H}}H.kind="NotFoundException";class J extends I{constructor(r){super(r),this.luminances=J.EMPTY,this.buckets=new Int32Array(J.LUMINANCE_BUCKETS)}getBlackRow(r,c){const u=this.getLuminanceSource(),m=u.getWidth();c==null||c.getSize()<m?c=new W(m):c.clear(),this.initArrays(m);const w=u.getRow(r,this.luminances),v=this.buckets;for(let k=0;k<m;k++)v[(w[k]&255)>>J.LUMINANCE_SHIFT]++;const C=J.estimateBlackPoint(v);if(m<3)for(let k=0;k<m;k++)(w[k]&255)<C&&c.set(k);else{let k=w[0]&255,O=w[1]&255;for(let Z=1;Z<m-1;Z++){const le=w[Z+1]&255;(O*4-k-le)/2<C&&c.set(Z),k=O,O=le}}return c}getBlackMatrix(){const r=this.getLuminanceSource(),c=r.getWidth(),u=r.getHeight(),m=new se(c,u);this.initArrays(c);const w=this.buckets;for(let k=1;k<5;k++){const O=Math.floor(u*k/5),Z=r.getRow(O,this.luminances),le=Math.floor(c*4/5);for(let he=Math.floor(c/5);he<le;he++){const Ee=Z[he]&255;w[Ee>>J.LUMINANCE_SHIFT]++}}const v=J.estimateBlackPoint(w),C=r.getMatrix();for(let k=0;k<u;k++){const O=k*c;for(let Z=0;Z<c;Z++)(C[O+Z]&255)<v&&m.set(Z,k)}return m}createBinarizer(r){return new J(r)}initArrays(r){this.luminances.length<r&&(this.luminances=new Uint8ClampedArray(r));const c=this.buckets;for(let u=0;u<J.LUMINANCE_BUCKETS;u++)c[u]=0}static estimateBlackPoint(r){const c=r.length;let u=0,m=0,w=0;for(let Z=0;Z<c;Z++)r[Z]>w&&(m=Z,w=r[Z]),r[Z]>u&&(u=r[Z]);let v=0,C=0;for(let Z=0;Z<c;Z++){const le=Z-m,he=r[Z]*le*le;he>C&&(v=Z,C=he)}if(m>v){const Z=m;m=v,v=Z}if(v-m<=c/16)throw new H;let k=v-1,O=-1;for(let Z=v-1;Z>m;Z--){const le=Z-m,he=le*le*(v-Z)*(u-r[Z]);he>O&&(k=Z,O=he)}return k<<J.LUMINANCE_SHIFT}}J.LUMINANCE_BITS=5,J.LUMINANCE_SHIFT=8-J.LUMINANCE_BITS,J.LUMINANCE_BUCKETS=1<<J.LUMINANCE_BITS,J.EMPTY=Uint8ClampedArray.from([0]);class K extends J{constructor(r){super(r),this.matrix=null}getBlackMatrix(){if(this.matrix!==null)return this.matrix;const r=this.getLuminanceSource(),c=r.getWidth(),u=r.getHeight();if(c>=K.MINIMUM_DIMENSION&&u>=K.MINIMUM_DIMENSION){const m=r.getMatrix();let w=c>>K.BLOCK_SIZE_POWER;(c&K.BLOCK_SIZE_MASK)!==0&&w++;let v=u>>K.BLOCK_SIZE_POWER;(u&K.BLOCK_SIZE_MASK)!==0&&v++;const C=K.calculateBlackPoints(m,w,v,c,u),k=new se(c,u);K.calculateThresholdForBlock(m,w,v,c,u,C,k),this.matrix=k}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(r){return new K(r)}static calculateThresholdForBlock(r,c,u,m,w,v,C){const k=w-K.BLOCK_SIZE,O=m-K.BLOCK_SIZE;for(let Z=0;Z<u;Z++){let le=Z<<K.BLOCK_SIZE_POWER;le>k&&(le=k);const he=K.cap(Z,2,u-3);for(let Ee=0;Ee<c;Ee++){let Ce=Ee<<K.BLOCK_SIZE_POWER;Ce>O&&(Ce=O);const Ie=K.cap(Ee,2,c-3);let Re=0;for(let Xe=-2;Xe<=2;Xe++){const Je=v[he+Xe];Re+=Je[Ie-2]+Je[Ie-1]+Je[Ie]+Je[Ie+1]+Je[Ie+2]}const Fe=Re/25;K.thresholdBlock(r,Ce,le,Fe,m,C)}}}static cap(r,c,u){return r<c?c:r>u?u:r}static thresholdBlock(r,c,u,m,w,v){for(let C=0,k=u*w+c;C<K.BLOCK_SIZE;C++,k+=w)for(let O=0;O<K.BLOCK_SIZE;O++)(r[k+O]&255)<=m&&v.set(c+O,u+C)}static calculateBlackPoints(r,c,u,m,w){const v=w-K.BLOCK_SIZE,C=m-K.BLOCK_SIZE,k=new Array(u);for(let O=0;O<u;O++){k[O]=new Int32Array(c);let Z=O<<K.BLOCK_SIZE_POWER;Z>v&&(Z=v);for(let le=0;le<c;le++){let he=le<<K.BLOCK_SIZE_POWER;he>C&&(he=C);let Ee=0,Ce=255,Ie=0;for(let Fe=0,Xe=Z*m+he;Fe<K.BLOCK_SIZE;Fe++,Xe+=m){for(let Je=0;Je<K.BLOCK_SIZE;Je++){const Ye=r[Xe+Je]&255;Ee+=Ye,Ye<Ce&&(Ce=Ye),Ye>Ie&&(Ie=Ye)}if(Ie-Ce>K.MIN_DYNAMIC_RANGE)for(Fe++,Xe+=m;Fe<K.BLOCK_SIZE;Fe++,Xe+=m)for(let Je=0;Je<K.BLOCK_SIZE;Je++)Ee+=r[Xe+Je]&255}let Re=Ee>>K.BLOCK_SIZE_POWER*2;if(Ie-Ce<=K.MIN_DYNAMIC_RANGE&&(Re=Ce/2,O>0&&le>0)){const Fe=(k[O-1][le]+2*k[O][le-1]+k[O-1][le-1])/4;Ce<Fe&&(Re=Fe)}k[O][le]=Re}}return k}}K.BLOCK_SIZE_POWER=3,K.BLOCK_SIZE=1<<K.BLOCK_SIZE_POWER,K.BLOCK_SIZE_MASK=K.BLOCK_SIZE-1,K.MINIMUM_DIMENSION=K.BLOCK_SIZE*5,K.MIN_DYNAMIC_RANGE=24;class ie{constructor(r,c){this.width=r,this.height=c}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(r,c,u,m){throw new Q("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new Q("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new Q("This luminance source does not support rotation by 45 degrees.")}toString(){const r=new Uint8ClampedArray(this.width);let c=new G;for(let u=0;u<this.height;u++){const m=this.getRow(u,r);for(let w=0;w<this.width;w++){const v=m[w]&255;let C;v<64?C="#":v<128?C="+":v<192?C=".":C=" ",c.append(C)}c.append(`
`)}return c.toString()}}class ne extends ie{constructor(r){super(r.getWidth(),r.getHeight()),this.delegate=r}getRow(r,c){const u=this.delegate.getRow(r,c),m=this.getWidth();for(let w=0;w<m;w++)u[w]=255-(u[w]&255);return u}getMatrix(){const r=this.delegate.getMatrix(),c=this.getWidth()*this.getHeight(),u=new Uint8ClampedArray(c);for(let m=0;m<c;m++)u[m]=255-(r[m]&255);return u}isCropSupported(){return this.delegate.isCropSupported()}crop(r,c,u,m){return new ne(this.delegate.crop(r,c,u,m))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new ne(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new ne(this.delegate.rotateCounterClockwise45())}}class re extends ie{constructor(r){super(r.width,r.height),this.canvas=r,this.tempCanvasElement=null,this.buffer=re.makeBufferFromCanvasImageData(r)}static makeBufferFromCanvasImageData(r){const c=r.getContext("2d").getImageData(0,0,r.width,r.height);return re.toGrayscaleBuffer(c.data,r.width,r.height)}static toGrayscaleBuffer(r,c,u){const m=new Uint8ClampedArray(c*u);for(let w=0,v=0,C=r.length;w<C;w+=4,v++){let k;if(r[w+3]===0)k=255;else{const Z=r[w],le=r[w+1],he=r[w+2];k=306*Z+601*le+117*he+512>>10}m[v]=k}return m}getRow(r,c){if(r<0||r>=this.getHeight())throw new E("Requested row is outside the image: "+r);const u=this.getWidth(),m=r*u;return c===null?c=this.buffer.slice(m,m+u):(c.length<u&&(c=new Uint8ClampedArray(u)),c.set(this.buffer.slice(m,m+u))),c}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(r,c,u,m){return super.crop(r,c,u,m),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(this.tempCanvasElement===null){const r=this.canvas.ownerDocument.createElement("canvas");r.width=this.canvas.width,r.height=this.canvas.height,this.tempCanvasElement=r}return this.tempCanvasElement}rotate(r){const c=this.getTempCanvasElement(),u=c.getContext("2d"),m=r*re.DEGREE_TO_RADIANS,w=this.canvas.width,v=this.canvas.height,C=Math.ceil(Math.abs(Math.cos(m))*w+Math.abs(Math.sin(m))*v),k=Math.ceil(Math.abs(Math.sin(m))*w+Math.abs(Math.cos(m))*v);return c.width=C,c.height=k,u.translate(C/2,k/2),u.rotate(m),u.drawImage(this.canvas,w/-2,v/-2),this.buffer=re.makeBufferFromCanvasImageData(c),this}invert(){return new ne(this)}}re.DEGREE_TO_RADIANS=Math.PI/180;class X{constructor(r,c,u){this.deviceId=r,this.label=c,this.kind="videoinput",this.groupId=u||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var ae=(globalThis||commonjsGlobal||self||window||void 0)&&(globalThis||commonjsGlobal||self||window||void 0).__awaiter||function(oe,r,c,u){function m(w){return w instanceof c?w:new c(function(v){v(w)})}return new(c||(c=Promise))(function(w,v){function C(Z){try{O(u.next(Z))}catch(le){v(le)}}function k(Z){try{O(u.throw(Z))}catch(le){v(le)}}function O(Z){Z.done?w(Z.value):m(Z.value).then(C,k)}O((u=u.apply(oe,r||[])).next())})};class te{constructor(r,c=500,u){this.reader=r,this.timeBetweenScansMillis=c,this._hints=u,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return typeof navigator<"u"}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(r){this._timeBetweenDecodingAttempts=r<0?0:r}set hints(r){this._hints=r||null}get hints(){return this._hints}listVideoInputDevices(){return ae(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const r=yield navigator.mediaDevices.enumerateDevices(),c=[];for(const u of r){const m=u.kind==="video"?"videoinput":u.kind;if(m!=="videoinput")continue;const w=u.deviceId||u.id,v=u.label||`Video device ${c.length+1}`,C=u.groupId,k={deviceId:w,label:v,kind:m,groupId:C};c.push(k)}return c})}getVideoInputDevices(){return ae(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(c=>new X(c.deviceId,c.label))})}findDeviceById(r){return ae(this,void 0,void 0,function*(){const c=yield this.listVideoInputDevices();return c?c.find(u=>u.deviceId===r):null})}decodeFromInputVideoDevice(r,c){return ae(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(r,c)})}decodeOnceFromVideoDevice(r,c){return ae(this,void 0,void 0,function*(){this.reset();let u;r?u={deviceId:{exact:r}}:u={facingMode:"environment"};const m={video:u};return yield this.decodeOnceFromConstraints(m,c)})}decodeOnceFromConstraints(r,c){return ae(this,void 0,void 0,function*(){const u=yield navigator.mediaDevices.getUserMedia(r);return yield this.decodeOnceFromStream(u,c)})}decodeOnceFromStream(r,c){return ae(this,void 0,void 0,function*(){this.reset();const u=yield this.attachStreamToVideo(r,c);return yield this.decodeOnce(u)})}decodeFromInputVideoDeviceContinuously(r,c,u){return ae(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(r,c,u)})}decodeFromVideoDevice(r,c,u){return ae(this,void 0,void 0,function*(){let m;r?m={deviceId:{exact:r}}:m={facingMode:"environment"};const w={video:m};return yield this.decodeFromConstraints(w,c,u)})}decodeFromConstraints(r,c,u){return ae(this,void 0,void 0,function*(){const m=yield navigator.mediaDevices.getUserMedia(r);return yield this.decodeFromStream(m,c,u)})}decodeFromStream(r,c,u){return ae(this,void 0,void 0,function*(){this.reset();const m=yield this.attachStreamToVideo(r,c);return yield this.decodeContinuously(m,u)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(r,c){return ae(this,void 0,void 0,function*(){const u=this.prepareVideoElement(c);return this.addVideoSource(u,r),this.videoElement=u,this.stream=r,yield this.playVideoOnLoadAsync(u),u})}playVideoOnLoadAsync(r){return new Promise((c,u)=>this.playVideoOnLoad(r,()=>c()))}playVideoOnLoad(r,c){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(r),r.addEventListener("ended",this.videoEndedListener),r.addEventListener("canplay",this.videoCanPlayListener),r.addEventListener("playing",c),this.tryPlayVideo(r)}isVideoPlaying(r){return r.currentTime>0&&!r.paused&&!r.ended&&r.readyState>2}tryPlayVideo(r){return ae(this,void 0,void 0,function*(){if(this.isVideoPlaying(r)){console.warn("Trying to play video that is already playing.");return}try{yield r.play()}catch{console.warn("It was not possible to play the video.")}})}getMediaElement(r,c){const u=document.getElementById(r);if(!u)throw new x(`element with id '${r}' not found`);if(u.nodeName.toLowerCase()!==c.toLowerCase())throw new x(`element with id '${r}' must be an ${c} element`);return u}decodeFromImage(r,c){if(!r&&!c)throw new x("either imageElement with a src set or an url must be provided");return c&&!r?this.decodeFromImageUrl(c):this.decodeFromImageElement(r)}decodeFromVideo(r,c){if(!r&&!c)throw new x("Either an element with a src set or an URL must be provided");return c&&!r?this.decodeFromVideoUrl(c):this.decodeFromVideoElement(r)}decodeFromVideoContinuously(r,c,u){if(r===void 0&&c===void 0)throw new x("Either an element with a src set or an URL must be provided");return c&&!r?this.decodeFromVideoUrlContinuously(c,u):this.decodeFromVideoElementContinuously(r,u)}decodeFromImageElement(r){if(!r)throw new x("An image element must be provided.");this.reset();const c=this.prepareImageElement(r);this.imageElement=c;let u;return this.isImageLoaded(c)?u=this.decodeOnce(c,!1,!0):u=this._decodeOnLoadImage(c),u}decodeFromVideoElement(r){const c=this._decodeFromVideoElementSetup(r);return this._decodeOnLoadVideo(c)}decodeFromVideoElementContinuously(r,c){const u=this._decodeFromVideoElementSetup(r);return this._decodeOnLoadVideoContinuously(u,c)}_decodeFromVideoElementSetup(r){if(!r)throw new x("A video element must be provided.");this.reset();const c=this.prepareVideoElement(r);return this.videoElement=c,c}decodeFromImageUrl(r){if(!r)throw new x("An URL must be provided.");this.reset();const c=this.prepareImageElement();this.imageElement=c;const u=this._decodeOnLoadImage(c);return c.src=r,u}decodeFromVideoUrl(r){if(!r)throw new x("An URL must be provided.");this.reset();const c=this.prepareVideoElement(),u=this.decodeFromVideoElement(c);return c.src=r,u}decodeFromVideoUrlContinuously(r,c){if(!r)throw new x("An URL must be provided.");this.reset();const u=this.prepareVideoElement(),m=this.decodeFromVideoElementContinuously(u,c);return u.src=r,m}_decodeOnLoadImage(r){return new Promise((c,u)=>{this.imageLoadedListener=()=>this.decodeOnce(r,!1,!0).then(c,u),r.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(r){return ae(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(r),yield this.decodeOnce(r)})}_decodeOnLoadVideoContinuously(r,c){return ae(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(r),this.decodeContinuously(r,c)})}isImageLoaded(r){return!(!r.complete||r.naturalWidth===0)}prepareImageElement(r){let c;return typeof r>"u"&&(c=document.createElement("img"),c.width=200,c.height=200),typeof r=="string"&&(c=this.getMediaElement(r,"img")),r instanceof HTMLImageElement&&(c=r),c}prepareVideoElement(r){let c;return!r&&typeof document<"u"&&(c=document.createElement("video"),c.width=200,c.height=200),typeof r=="string"&&(c=this.getMediaElement(r,"video")),r instanceof HTMLVideoElement&&(c=r),c.setAttribute("autoplay","true"),c.setAttribute("muted","true"),c.setAttribute("playsinline","true"),c}decodeOnce(r,c=!0,u=!0){this._stopAsyncDecode=!1;const m=(w,v)=>{if(this._stopAsyncDecode){v(new H("Video stream has ended before any code could be detected.")),this._stopAsyncDecode=void 0;return}try{const C=this.decode(r);w(C)}catch(C){const k=c&&C instanceof H,Z=(C instanceof S||C instanceof P)&&u;if(k||Z)return setTimeout(m,this._timeBetweenDecodingAttempts,w,v);v(C)}};return new Promise((w,v)=>m(w,v))}decodeContinuously(r,c){this._stopContinuousDecode=!1;const u=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=void 0;return}try{const m=this.decode(r);c(m,null),setTimeout(u,this.timeBetweenScansMillis)}catch(m){c(null,m);const w=m instanceof S||m instanceof P,v=m instanceof H;(w||v)&&setTimeout(u,this._timeBetweenDecodingAttempts)}};u()}decode(r){const c=this.createBinaryBitmap(r);return this.decodeBitmap(c)}_isHTMLVideoElement(r){return r.videoWidth!==0}drawFrameOnCanvas(r,c,u){c||(c={sx:0,sy:0,sWidth:r.videoWidth,sHeight:r.videoHeight,dx:0,dy:0,dWidth:r.videoWidth,dHeight:r.videoHeight}),u||(u=this.captureCanvasContext),u.drawImage(r,c.sx,c.sy,c.sWidth,c.sHeight,c.dx,c.dy,c.dWidth,c.dHeight)}drawImageOnCanvas(r,c,u=this.captureCanvasContext){c||(c={sx:0,sy:0,sWidth:r.naturalWidth,sHeight:r.naturalHeight,dx:0,dy:0,dWidth:r.naturalWidth,dHeight:r.naturalHeight}),u||(u=this.captureCanvasContext),u.drawImage(r,c.sx,c.sy,c.sWidth,c.sHeight,c.dx,c.dy,c.dWidth,c.dHeight)}createBinaryBitmap(r){this.getCaptureCanvasContext(r),this._isHTMLVideoElement(r)?this.drawFrameOnCanvas(r):this.drawImageOnCanvas(r);const c=this.getCaptureCanvas(r),u=new re(c),m=new K(u);return new A(m)}getCaptureCanvasContext(r){if(!this.captureCanvasContext){const u=this.getCaptureCanvas(r).getContext("2d");this.captureCanvasContext=u}return this.captureCanvasContext}getCaptureCanvas(r){if(!this.captureCanvas){const c=this.createCaptureCanvas(r);this.captureCanvas=c}return this.captureCanvas}decodeBitmap(r){return this.reader.decode(r,this._hints)}createCaptureCanvas(r){if(typeof document>"u")return this._destroyCaptureCanvas(),null;const c=document.createElement("canvas");let u,m;return typeof r<"u"&&(r instanceof HTMLVideoElement?(u=r.videoWidth,m=r.videoHeight):r instanceof HTMLImageElement&&(u=r.naturalWidth||r.width,m=r.naturalHeight||r.height)),c.style.width=u+"px",c.style.height=m+"px",c.width=u,c.height=m,c}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(r=>r.stop()),this.stream=void 0),this._stopAsyncDecode===!1&&this.stopAsyncDecode(),this._stopContinuousDecode===!1&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(this.imageLoadedListener!==void 0&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(r,c){try{r.srcObject=c}catch{r.src=URL.createObjectURL(c)}}cleanVideoSource(r){try{r.srcObject=null}catch{r.src=""}this.videoElement.removeAttribute("src")}}class ce{constructor(r,c,u=c==null?0:8*c.length,m,w,v=_.currentTimeMillis()){this.text=r,this.rawBytes=c,this.numBits=u,this.resultPoints=m,this.format=w,this.timestamp=v,this.text=r,this.rawBytes=c,u==null?this.numBits=c==null?0:8*c.length:this.numBits=u,this.resultPoints=m,this.format=w,this.resultMetadata=null,v==null?this.timestamp=_.currentTimeMillis():this.timestamp=v}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(r,c){this.resultMetadata===null&&(this.resultMetadata=new Map),this.resultMetadata.set(r,c)}putAllMetadata(r){r!==null&&(this.resultMetadata===null?this.resultMetadata=r:this.resultMetadata=new Map(r))}addResultPoints(r){const c=this.resultPoints;if(c===null)this.resultPoints=r;else if(r!==null&&r.length>0){const u=new Array(c.length+r.length);_.arraycopy(c,0,u,0,c.length),_.arraycopy(r,0,u,c.length,r.length),this.resultPoints=u}}getTimestamp(){return this.timestamp}toString(){return this.text}}var xe;(function(oe){oe[oe.AZTEC=0]="AZTEC",oe[oe.CODABAR=1]="CODABAR",oe[oe.CODE_39=2]="CODE_39",oe[oe.CODE_93=3]="CODE_93",oe[oe.CODE_128=4]="CODE_128",oe[oe.DATA_MATRIX=5]="DATA_MATRIX",oe[oe.EAN_8=6]="EAN_8",oe[oe.EAN_13=7]="EAN_13",oe[oe.ITF=8]="ITF",oe[oe.MAXICODE=9]="MAXICODE",oe[oe.PDF_417=10]="PDF_417",oe[oe.QR_CODE=11]="QR_CODE",oe[oe.RSS_14=12]="RSS_14",oe[oe.RSS_EXPANDED=13]="RSS_EXPANDED",oe[oe.UPC_A=14]="UPC_A",oe[oe.UPC_E=15]="UPC_E",oe[oe.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(xe||(xe={}));var me=xe,Se;(function(oe){oe[oe.OTHER=0]="OTHER",oe[oe.ORIENTATION=1]="ORIENTATION",oe[oe.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",oe[oe.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",oe[oe.ISSUE_NUMBER=4]="ISSUE_NUMBER",oe[oe.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",oe[oe.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",oe[oe.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",oe[oe.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",oe[oe.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",oe[oe.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"})(Se||(Se={}));var be=Se;class Me{constructor(r,c,u,m,w=-1,v=-1){this.rawBytes=r,this.text=c,this.byteSegments=u,this.ecLevel=m,this.structuredAppendSequenceNumber=w,this.structuredAppendParity=v,this.numBits=r==null?0:8*r.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(r){this.numBits=r}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(r){this.errorsCorrected=r}getErasures(){return this.erasures}setErasures(r){this.erasures=r}getOther(){return this.other}setOther(r){this.other=r}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class Oe{exp(r){return this.expTable[r]}log(r){if(r===0)throw new E;return this.logTable[r]}static addOrSubtract(r,c){return r^c}}class Ue{constructor(r,c){if(c.length===0)throw new E;this.field=r;const u=c.length;if(u>1&&c[0]===0){let m=1;for(;m<u&&c[m]===0;)m++;m===u?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(u-m),_.arraycopy(c,m,this.coefficients,0,this.coefficients.length))}else this.coefficients=c}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(r){return this.coefficients[this.coefficients.length-1-r]}evaluateAt(r){if(r===0)return this.getCoefficient(0);const c=this.coefficients;let u;if(r===1){u=0;for(let v=0,C=c.length;v!==C;v++){const k=c[v];u=Oe.addOrSubtract(u,k)}return u}u=c[0];const m=c.length,w=this.field;for(let v=1;v<m;v++)u=Oe.addOrSubtract(w.multiply(r,u),c[v]);return u}addOrSubtract(r){if(!this.field.equals(r.field))throw new E("GenericGFPolys do not have same GenericGF field");if(this.isZero())return r;if(r.isZero())return this;let c=this.coefficients,u=r.coefficients;if(c.length>u.length){const v=c;c=u,u=v}let m=new Int32Array(u.length);const w=u.length-c.length;_.arraycopy(u,0,m,0,w);for(let v=w;v<u.length;v++)m[v]=Oe.addOrSubtract(c[v-w],u[v]);return new Ue(this.field,m)}multiply(r){if(!this.field.equals(r.field))throw new E("GenericGFPolys do not have same GenericGF field");if(this.isZero()||r.isZero())return this.field.getZero();const c=this.coefficients,u=c.length,m=r.coefficients,w=m.length,v=new Int32Array(u+w-1),C=this.field;for(let k=0;k<u;k++){const O=c[k];for(let Z=0;Z<w;Z++)v[k+Z]=Oe.addOrSubtract(v[k+Z],C.multiply(O,m[Z]))}return new Ue(C,v)}multiplyScalar(r){if(r===0)return this.field.getZero();if(r===1)return this;const c=this.coefficients.length,u=this.field,m=new Int32Array(c),w=this.coefficients;for(let v=0;v<c;v++)m[v]=u.multiply(w[v],r);return new Ue(u,m)}multiplyByMonomial(r,c){if(r<0)throw new E;if(c===0)return this.field.getZero();const u=this.coefficients,m=u.length,w=new Int32Array(m+r),v=this.field;for(let C=0;C<m;C++)w[C]=v.multiply(u[C],c);return new Ue(v,w)}divide(r){if(!this.field.equals(r.field))throw new E("GenericGFPolys do not have same GenericGF field");if(r.isZero())throw new E("Divide by 0");const c=this.field;let u=c.getZero(),m=this;const w=r.getCoefficient(r.getDegree()),v=c.inverse(w);for(;m.getDegree()>=r.getDegree()&&!m.isZero();){const C=m.getDegree()-r.getDegree(),k=c.multiply(m.getCoefficient(m.getDegree()),v),O=r.multiplyByMonomial(C,k),Z=c.buildMonomial(C,k);u=u.addOrSubtract(Z),m=m.addOrSubtract(O)}return[u,m]}toString(){let r="";for(let c=this.getDegree();c>=0;c--){let u=this.getCoefficient(c);if(u!==0){if(u<0?(r+=" - ",u=-u):r.length>0&&(r+=" + "),c===0||u!==1){const m=this.field.log(u);m===0?r+="1":m===1?r+="a":(r+="a^",r+=m)}c!==0&&(c===1?r+="x":(r+="x^",r+=c))}}return r}}class je extends g{}je.kind="ArithmeticException";class Pe extends Oe{constructor(r,c,u){super(),this.primitive=r,this.size=c,this.generatorBase=u;const m=new Int32Array(c);let w=1;for(let C=0;C<c;C++)m[C]=w,w*=2,w>=c&&(w^=r,w&=c-1);this.expTable=m;const v=new Int32Array(c);for(let C=0;C<c-1;C++)v[m[C]]=C;this.logTable=v,this.zero=new Ue(this,Int32Array.from([0])),this.one=new Ue(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(r,c){if(r<0)throw new E;if(c===0)return this.zero;const u=new Int32Array(r+1);return u[0]=c,new Ue(this,u)}inverse(r){if(r===0)throw new je;return this.expTable[this.size-this.logTable[r]-1]}multiply(r,c){return r===0||c===0?0:this.expTable[(this.logTable[r]+this.logTable[c])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+M.toHexString(this.primitive)+","+this.size+")"}equals(r){return r===this}}Pe.AZTEC_DATA_12=new Pe(4201,4096,1),Pe.AZTEC_DATA_10=new Pe(1033,1024,1),Pe.AZTEC_DATA_6=new Pe(67,64,1),Pe.AZTEC_PARAM=new Pe(19,16,1),Pe.QR_CODE_FIELD_256=new Pe(285,256,0),Pe.DATA_MATRIX_FIELD_256=new Pe(301,256,1),Pe.AZTEC_DATA_8=Pe.DATA_MATRIX_FIELD_256,Pe.MAXICODE_FIELD_64=Pe.AZTEC_DATA_6;class We extends g{}We.kind="ReedSolomonException";class Ze extends g{}Ze.kind="IllegalStateException";class ot{constructor(r){this.field=r}decode(r,c){const u=this.field,m=new Ue(u,r),w=new Int32Array(c);let v=!0;for(let Ee=0;Ee<c;Ee++){const Ce=m.evaluateAt(u.exp(Ee+u.getGeneratorBase()));w[w.length-1-Ee]=Ce,Ce!==0&&(v=!1)}if(v)return;const C=new Ue(u,w),k=this.runEuclideanAlgorithm(u.buildMonomial(c,1),C,c),O=k[0],Z=k[1],le=this.findErrorLocations(O),he=this.findErrorMagnitudes(Z,le);for(let Ee=0;Ee<le.length;Ee++){const Ce=r.length-1-u.log(le[Ee]);if(Ce<0)throw new We("Bad error location");r[Ce]=Pe.addOrSubtract(r[Ce],he[Ee])}}runEuclideanAlgorithm(r,c,u){if(r.getDegree()<c.getDegree()){const Ee=r;r=c,c=Ee}const m=this.field;let w=r,v=c,C=m.getZero(),k=m.getOne();for(;v.getDegree()>=(u/2|0);){let Ee=w,Ce=C;if(w=v,C=k,w.isZero())throw new We("r_{i-1} was zero");v=Ee;let Ie=m.getZero();const Re=w.getCoefficient(w.getDegree()),Fe=m.inverse(Re);for(;v.getDegree()>=w.getDegree()&&!v.isZero();){const Xe=v.getDegree()-w.getDegree(),Je=m.multiply(v.getCoefficient(v.getDegree()),Fe);Ie=Ie.addOrSubtract(m.buildMonomial(Xe,Je)),v=v.addOrSubtract(w.multiplyByMonomial(Xe,Je))}if(k=Ie.multiply(C).addOrSubtract(Ce),v.getDegree()>=w.getDegree())throw new Ze("Division algorithm failed to reduce polynomial?")}const O=k.getCoefficient(0);if(O===0)throw new We("sigmaTilde(0) was zero");const Z=m.inverse(O),le=k.multiplyScalar(Z),he=v.multiplyScalar(Z);return[le,he]}findErrorLocations(r){const c=r.getDegree();if(c===1)return Int32Array.from([r.getCoefficient(1)]);const u=new Int32Array(c);let m=0;const w=this.field;for(let v=1;v<w.getSize()&&m<c;v++)r.evaluateAt(v)===0&&(u[m]=w.inverse(v),m++);if(m!==c)throw new We("Error locator degree does not match number of roots");return u}findErrorMagnitudes(r,c){const u=c.length,m=new Int32Array(u),w=this.field;for(let v=0;v<u;v++){const C=w.inverse(c[v]);let k=1;for(let O=0;O<u;O++)if(v!==O){const Z=w.multiply(c[O],C),le=(Z&1)===0?Z|1:Z&-2;k=w.multiply(k,le)}m[v]=w.multiply(r.evaluateAt(C),w.inverse(k)),w.getGeneratorBase()!==0&&(m[v]=w.multiply(m[v],C))}return m}}var st;(function(oe){oe[oe.UPPER=0]="UPPER",oe[oe.LOWER=1]="LOWER",oe[oe.MIXED=2]="MIXED",oe[oe.DIGIT=3]="DIGIT",oe[oe.PUNCT=4]="PUNCT",oe[oe.BINARY=5]="BINARY"})(st||(st={}));class nt{decode(r){this.ddata=r;let c=r.getBits(),u=this.extractBits(c),m=this.correctBits(u),w=nt.convertBoolArrayToByteArray(m),v=nt.getEncodedData(m),C=new Me(w,v,null,null);return C.setNumBits(m.length),C}static highLevelDecode(r){return this.getEncodedData(r)}static getEncodedData(r){let c=r.length,u=st.UPPER,m=st.UPPER,w="",v=0;for(;v<c;)if(m===st.BINARY){if(c-v<5)break;let C=nt.readCode(r,v,5);if(v+=5,C===0){if(c-v<11)break;C=nt.readCode(r,v,11)+31,v+=11}for(let k=0;k<C;k++){if(c-v<8){v=c;break}const O=nt.readCode(r,v,8);w+=V.castAsNonUtf8Char(O),v+=8}m=u}else{let C=m===st.DIGIT?4:5;if(c-v<C)break;let k=nt.readCode(r,v,C);v+=C;let O=nt.getCharacter(m,k);O.startsWith("CTRL_")?(u=m,m=nt.getTable(O.charAt(5)),O.charAt(6)==="L"&&(u=m)):(w+=O,m=u)}return w}static getTable(r){switch(r){case"L":return st.LOWER;case"P":return st.PUNCT;case"M":return st.MIXED;case"D":return st.DIGIT;case"B":return st.BINARY;case"U":default:return st.UPPER}}static getCharacter(r,c){switch(r){case st.UPPER:return nt.UPPER_TABLE[c];case st.LOWER:return nt.LOWER_TABLE[c];case st.MIXED:return nt.MIXED_TABLE[c];case st.PUNCT:return nt.PUNCT_TABLE[c];case st.DIGIT:return nt.DIGIT_TABLE[c];default:throw new Ze("Bad table")}}correctBits(r){let c,u;this.ddata.getNbLayers()<=2?(u=6,c=Pe.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(u=8,c=Pe.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(u=10,c=Pe.AZTEC_DATA_10):(u=12,c=Pe.AZTEC_DATA_12);let m=this.ddata.getNbDatablocks(),w=r.length/u;if(w<m)throw new P;let v=r.length%u,C=new Int32Array(w);for(let he=0;he<w;he++,v+=u)C[he]=nt.readCode(r,v,u);try{new ot(c).decode(C,w-m)}catch(he){throw new P(he)}let k=(1<<u)-1,O=0;for(let he=0;he<m;he++){let Ee=C[he];if(Ee===0||Ee===k)throw new P;(Ee===1||Ee===k-1)&&O++}let Z=new Array(m*u-O),le=0;for(let he=0;he<m;he++){let Ee=C[he];if(Ee===1||Ee===k-1)Z.fill(Ee>1,le,le+u-1),le+=u-1;else for(let Ce=u-1;Ce>=0;--Ce)Z[le++]=(Ee&1<<Ce)!==0}return Z}extractBits(r){let c=this.ddata.isCompact(),u=this.ddata.getNbLayers(),m=(c?11:14)+u*4,w=new Int32Array(m),v=new Array(this.totalBitsInLayer(u,c));if(c)for(let C=0;C<w.length;C++)w[C]=C;else{let C=m+1+2*M.truncDivision(M.truncDivision(m,2)-1,15),k=m/2,O=M.truncDivision(C,2);for(let Z=0;Z<k;Z++){let le=Z+M.truncDivision(Z,15);w[k-Z-1]=O-le-1,w[k+Z]=O+le+1}}for(let C=0,k=0;C<u;C++){let O=(u-C)*4+(c?9:12),Z=C*2,le=m-1-Z;for(let he=0;he<O;he++){let Ee=he*2;for(let Ce=0;Ce<2;Ce++)v[k+Ee+Ce]=r.get(w[Z+Ce],w[Z+he]),v[k+2*O+Ee+Ce]=r.get(w[Z+he],w[le-Ce]),v[k+4*O+Ee+Ce]=r.get(w[le-Ce],w[le-he]),v[k+6*O+Ee+Ce]=r.get(w[le-he],w[Z+Ce])}k+=O*8}return v}static readCode(r,c,u){let m=0;for(let w=c;w<c+u;w++)m<<=1,r[w]&&(m|=1);return m}static readByte(r,c){let u=r.length-c;return u>=8?nt.readCode(r,c,8):nt.readCode(r,c,u)<<8-u}static convertBoolArrayToByteArray(r){let c=new Uint8Array((r.length+7)/8);for(let u=0;u<c.length;u++)c[u]=nt.readByte(r,8*u);return c}totalBitsInLayer(r,c){return((c?88:112)+16*r)*r}}nt.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],nt.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],nt.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","	",`
`,"\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],nt.PUNCT_TABLE=["","\r",`\r
`,". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],nt.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class tt{constructor(){}static round(r){return r===NaN?0:r<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:r>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:r+(r<0?-.5:.5)|0}static distance(r,c,u,m){const w=r-u,v=c-m;return Math.sqrt(w*w+v*v)}static sum(r){let c=0;for(let u=0,m=r.length;u!==m;u++){const w=r[u];c+=w}return c}}class bt{static floatToIntBits(r){return r}}bt.MAX_VALUE=Number.MAX_SAFE_INTEGER;class qe{constructor(r,c){this.x=r,this.y=c}getX(){return this.x}getY(){return this.y}equals(r){if(r instanceof qe){const c=r;return this.x===c.x&&this.y===c.y}return!1}hashCode(){return 31*bt.floatToIntBits(this.x)+bt.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(r){const c=this.distance(r[0],r[1]),u=this.distance(r[1],r[2]),m=this.distance(r[0],r[2]);let w,v,C;if(u>=c&&u>=m?(v=r[0],w=r[1],C=r[2]):m>=u&&m>=c?(v=r[1],w=r[0],C=r[2]):(v=r[2],w=r[0],C=r[1]),this.crossProductZ(w,v,C)<0){const k=w;w=C,C=k}r[0]=w,r[1]=v,r[2]=C}static distance(r,c){return tt.distance(r.x,r.y,c.x,c.y)}static crossProductZ(r,c,u){const m=c.x,w=c.y;return(u.x-m)*(r.y-w)-(u.y-w)*(r.x-m)}}class Et{constructor(r,c){this.bits=r,this.points=c}getBits(){return this.bits}getPoints(){return this.points}}class $t extends Et{constructor(r,c,u,m,w){super(r,c),this.compact=u,this.nbDatablocks=m,this.nbLayers=w}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class Vt{constructor(r,c,u,m){this.image=r,this.height=r.getHeight(),this.width=r.getWidth(),c==null&&(c=Vt.INIT_SIZE),u==null&&(u=r.getWidth()/2|0),m==null&&(m=r.getHeight()/2|0);const w=c/2|0;if(this.leftInit=u-w,this.rightInit=u+w,this.upInit=m-w,this.downInit=m+w,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new H}detect(){let r=this.leftInit,c=this.rightInit,u=this.upInit,m=this.downInit,w=!1,v=!0,C=!1,k=!1,O=!1,Z=!1,le=!1;const he=this.width,Ee=this.height;for(;v;){v=!1;let Ce=!0;for(;(Ce||!k)&&c<he;)Ce=this.containsBlackPoint(u,m,c,!1),Ce?(c++,v=!0,k=!0):k||c++;if(c>=he){w=!0;break}let Ie=!0;for(;(Ie||!O)&&m<Ee;)Ie=this.containsBlackPoint(r,c,m,!0),Ie?(m++,v=!0,O=!0):O||m++;if(m>=Ee){w=!0;break}let Re=!0;for(;(Re||!Z)&&r>=0;)Re=this.containsBlackPoint(u,m,r,!1),Re?(r--,v=!0,Z=!0):Z||r--;if(r<0){w=!0;break}let Fe=!0;for(;(Fe||!le)&&u>=0;)Fe=this.containsBlackPoint(r,c,u,!0),Fe?(u--,v=!0,le=!0):le||u--;if(u<0){w=!0;break}v&&(C=!0)}if(!w&&C){const Ce=c-r;let Ie=null;for(let Je=1;Ie===null&&Je<Ce;Je++)Ie=this.getBlackPointOnSegment(r,m-Je,r+Je,m);if(Ie==null)throw new H;let Re=null;for(let Je=1;Re===null&&Je<Ce;Je++)Re=this.getBlackPointOnSegment(r,u+Je,r+Je,u);if(Re==null)throw new H;let Fe=null;for(let Je=1;Fe===null&&Je<Ce;Je++)Fe=this.getBlackPointOnSegment(c,u+Je,c-Je,u);if(Fe==null)throw new H;let Xe=null;for(let Je=1;Xe===null&&Je<Ce;Je++)Xe=this.getBlackPointOnSegment(c,m-Je,c-Je,m);if(Xe==null)throw new H;return this.centerEdges(Xe,Ie,Fe,Re)}else throw new H}getBlackPointOnSegment(r,c,u,m){const w=tt.round(tt.distance(r,c,u,m)),v=(u-r)/w,C=(m-c)/w,k=this.image;for(let O=0;O<w;O++){const Z=tt.round(r+O*v),le=tt.round(c+O*C);if(k.get(Z,le))return new qe(Z,le)}return null}centerEdges(r,c,u,m){const w=r.getX(),v=r.getY(),C=c.getX(),k=c.getY(),O=u.getX(),Z=u.getY(),le=m.getX(),he=m.getY(),Ee=Vt.CORR;return w<this.width/2?[new qe(le-Ee,he+Ee),new qe(C+Ee,k+Ee),new qe(O-Ee,Z-Ee),new qe(w+Ee,v-Ee)]:[new qe(le+Ee,he+Ee),new qe(C+Ee,k-Ee),new qe(O-Ee,Z+Ee),new qe(w-Ee,v-Ee)]}containsBlackPoint(r,c,u,m){const w=this.image;if(m){for(let v=r;v<=c;v++)if(w.get(v,u))return!0}else for(let v=r;v<=c;v++)if(w.get(u,v))return!0;return!1}}Vt.INIT_SIZE=10,Vt.CORR=1;class Dt{static checkAndNudgePoints(r,c){const u=r.getWidth(),m=r.getHeight();let w=!0;for(let v=0;v<c.length&&w;v+=2){const C=Math.floor(c[v]),k=Math.floor(c[v+1]);if(C<-1||C>u||k<-1||k>m)throw new H;w=!1,C===-1?(c[v]=0,w=!0):C===u&&(c[v]=u-1,w=!0),k===-1?(c[v+1]=0,w=!0):k===m&&(c[v+1]=m-1,w=!0)}w=!0;for(let v=c.length-2;v>=0&&w;v-=2){const C=Math.floor(c[v]),k=Math.floor(c[v+1]);if(C<-1||C>u||k<-1||k>m)throw new H;w=!1,C===-1?(c[v]=0,w=!0):C===u&&(c[v]=u-1,w=!0),k===-1?(c[v+1]=0,w=!0):k===m&&(c[v+1]=m-1,w=!0)}}}class Lt{constructor(r,c,u,m,w,v,C,k,O){this.a11=r,this.a21=c,this.a31=u,this.a12=m,this.a22=w,this.a32=v,this.a13=C,this.a23=k,this.a33=O}static quadrilateralToQuadrilateral(r,c,u,m,w,v,C,k,O,Z,le,he,Ee,Ce,Ie,Re){const Fe=Lt.quadrilateralToSquare(r,c,u,m,w,v,C,k);return Lt.squareToQuadrilateral(O,Z,le,he,Ee,Ce,Ie,Re).times(Fe)}transformPoints(r){const c=r.length,u=this.a11,m=this.a12,w=this.a13,v=this.a21,C=this.a22,k=this.a23,O=this.a31,Z=this.a32,le=this.a33;for(let he=0;he<c;he+=2){const Ee=r[he],Ce=r[he+1],Ie=w*Ee+k*Ce+le;r[he]=(u*Ee+v*Ce+O)/Ie,r[he+1]=(m*Ee+C*Ce+Z)/Ie}}transformPointsWithValues(r,c){const u=this.a11,m=this.a12,w=this.a13,v=this.a21,C=this.a22,k=this.a23,O=this.a31,Z=this.a32,le=this.a33,he=r.length;for(let Ee=0;Ee<he;Ee++){const Ce=r[Ee],Ie=c[Ee],Re=w*Ce+k*Ie+le;r[Ee]=(u*Ce+v*Ie+O)/Re,c[Ee]=(m*Ce+C*Ie+Z)/Re}}static squareToQuadrilateral(r,c,u,m,w,v,C,k){const O=r-u+w-C,Z=c-m+v-k;if(O===0&&Z===0)return new Lt(u-r,w-u,r,m-c,v-m,c,0,0,1);{const le=u-w,he=C-w,Ee=m-v,Ce=k-v,Ie=le*Ce-he*Ee,Re=(O*Ce-he*Z)/Ie,Fe=(le*Z-O*Ee)/Ie;return new Lt(u-r+Re*u,C-r+Fe*C,r,m-c+Re*m,k-c+Fe*k,c,Re,Fe,1)}}static quadrilateralToSquare(r,c,u,m,w,v,C,k){return Lt.squareToQuadrilateral(r,c,u,m,w,v,C,k).buildAdjoint()}buildAdjoint(){return new Lt(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(r){return new Lt(this.a11*r.a11+this.a21*r.a12+this.a31*r.a13,this.a11*r.a21+this.a21*r.a22+this.a31*r.a23,this.a11*r.a31+this.a21*r.a32+this.a31*r.a33,this.a12*r.a11+this.a22*r.a12+this.a32*r.a13,this.a12*r.a21+this.a22*r.a22+this.a32*r.a23,this.a12*r.a31+this.a22*r.a32+this.a32*r.a33,this.a13*r.a11+this.a23*r.a12+this.a33*r.a13,this.a13*r.a21+this.a23*r.a22+this.a33*r.a23,this.a13*r.a31+this.a23*r.a32+this.a33*r.a33)}}class de extends Dt{sampleGrid(r,c,u,m,w,v,C,k,O,Z,le,he,Ee,Ce,Ie,Re,Fe,Xe,Je){const Ye=Lt.quadrilateralToQuadrilateral(m,w,v,C,k,O,Z,le,he,Ee,Ce,Ie,Re,Fe,Xe,Je);return this.sampleGridWithTransform(r,c,u,Ye)}sampleGridWithTransform(r,c,u,m){if(c<=0||u<=0)throw new H;const w=new se(c,u),v=new Float32Array(2*c);for(let C=0;C<u;C++){const k=v.length,O=C+.5;for(let Z=0;Z<k;Z+=2)v[Z]=Z/2+.5,v[Z+1]=O;m.transformPoints(v),Dt.checkAndNudgePoints(r,v);try{for(let Z=0;Z<k;Z+=2)r.get(Math.floor(v[Z]),Math.floor(v[Z+1]))&&w.set(Z/2,C)}catch{throw new H}}return w}}class z{static setGridSampler(r){z.gridSampler=r}static getInstance(){return z.gridSampler}}z.gridSampler=new de;class Y{constructor(r,c){this.x=r,this.y=c}toResultPoint(){return new qe(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class ye{constructor(r){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=r}detect(){return this.detectMirror(!1)}detectMirror(r){let c=this.getMatrixCenter(),u=this.getBullsEyeCorners(c);if(r){let v=u[0];u[0]=u[2],u[2]=v}this.extractParameters(u);let m=this.sampleGrid(this.image,u[this.shift%4],u[(this.shift+1)%4],u[(this.shift+2)%4],u[(this.shift+3)%4]),w=this.getMatrixCornerPoints(u);return new $t(m,w,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(r){if(!this.isValidPoint(r[0])||!this.isValidPoint(r[1])||!this.isValidPoint(r[2])||!this.isValidPoint(r[3]))throw new H;let c=2*this.nbCenterLayers,u=new Int32Array([this.sampleLine(r[0],r[1],c),this.sampleLine(r[1],r[2],c),this.sampleLine(r[2],r[3],c),this.sampleLine(r[3],r[0],c)]);this.shift=this.getRotation(u,c);let m=0;for(let v=0;v<4;v++){let C=u[(this.shift+v)%4];this.compact?(m<<=7,m+=C>>1&127):(m<<=10,m+=(C>>2&992)+(C>>1&31))}let w=this.getCorrectedParameterData(m,this.compact);this.compact?(this.nbLayers=(w>>6)+1,this.nbDataBlocks=(w&63)+1):(this.nbLayers=(w>>11)+1,this.nbDataBlocks=(w&2047)+1)}getRotation(r,c){let u=0;r.forEach((m,w,v)=>{let C=(m>>c-2<<1)+(m&1);u=(u<<3)+C}),u=((u&1)<<11)+(u>>1);for(let m=0;m<4;m++)if(M.bitCount(u^this.EXPECTED_CORNER_BITS[m])<=2)return m;throw new H}getCorrectedParameterData(r,c){let u,m;c?(u=7,m=2):(u=10,m=4);let w=u-m,v=new Int32Array(u);for(let k=u-1;k>=0;--k)v[k]=r&15,r>>=4;try{new ot(Pe.AZTEC_PARAM).decode(v,w)}catch{throw new H}let C=0;for(let k=0;k<m;k++)C=(C<<4)+v[k];return C}getBullsEyeCorners(r){let c=r,u=r,m=r,w=r,v=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let le=this.getFirstDifferent(c,v,1,-1),he=this.getFirstDifferent(u,v,1,1),Ee=this.getFirstDifferent(m,v,-1,1),Ce=this.getFirstDifferent(w,v,-1,-1);if(this.nbCenterLayers>2){let Ie=this.distancePoint(Ce,le)*this.nbCenterLayers/(this.distancePoint(w,c)*(this.nbCenterLayers+2));if(Ie<.75||Ie>1.25||!this.isWhiteOrBlackRectangle(le,he,Ee,Ce))break}c=le,u=he,m=Ee,w=Ce,v=!v}if(this.nbCenterLayers!==5&&this.nbCenterLayers!==7)throw new H;this.compact=this.nbCenterLayers===5;let C=new qe(c.getX()+.5,c.getY()-.5),k=new qe(u.getX()+.5,u.getY()+.5),O=new qe(m.getX()-.5,m.getY()+.5),Z=new qe(w.getX()-.5,w.getY()-.5);return this.expandSquare([C,k,O,Z],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let r,c,u,m;try{let C=new Vt(this.image).detect();r=C[0],c=C[1],u=C[2],m=C[3]}catch{let k=this.image.getWidth()/2,O=this.image.getHeight()/2;r=this.getFirstDifferent(new Y(k+7,O-7),!1,1,-1).toResultPoint(),c=this.getFirstDifferent(new Y(k+7,O+7),!1,1,1).toResultPoint(),u=this.getFirstDifferent(new Y(k-7,O+7),!1,-1,1).toResultPoint(),m=this.getFirstDifferent(new Y(k-7,O-7),!1,-1,-1).toResultPoint()}let w=tt.round((r.getX()+m.getX()+c.getX()+u.getX())/4),v=tt.round((r.getY()+m.getY()+c.getY()+u.getY())/4);try{let C=new Vt(this.image,15,w,v).detect();r=C[0],c=C[1],u=C[2],m=C[3]}catch{r=this.getFirstDifferent(new Y(w+7,v-7),!1,1,-1).toResultPoint(),c=this.getFirstDifferent(new Y(w+7,v+7),!1,1,1).toResultPoint(),u=this.getFirstDifferent(new Y(w-7,v+7),!1,-1,1).toResultPoint(),m=this.getFirstDifferent(new Y(w-7,v-7),!1,-1,-1).toResultPoint()}return w=tt.round((r.getX()+m.getX()+c.getX()+u.getX())/4),v=tt.round((r.getY()+m.getY()+c.getY()+u.getY())/4),new Y(w,v)}getMatrixCornerPoints(r){return this.expandSquare(r,2*this.nbCenterLayers,this.getDimension())}sampleGrid(r,c,u,m,w){let v=z.getInstance(),C=this.getDimension(),k=C/2-this.nbCenterLayers,O=C/2+this.nbCenterLayers;return v.sampleGrid(r,C,C,k,k,O,k,O,O,k,O,c.getX(),c.getY(),u.getX(),u.getY(),m.getX(),m.getY(),w.getX(),w.getY())}sampleLine(r,c,u){let m=0,w=this.distanceResultPoint(r,c),v=w/u,C=r.getX(),k=r.getY(),O=v*(c.getX()-r.getX())/w,Z=v*(c.getY()-r.getY())/w;for(let le=0;le<u;le++)this.image.get(tt.round(C+le*O),tt.round(k+le*Z))&&(m|=1<<u-le-1);return m}isWhiteOrBlackRectangle(r,c,u,m){let w=3;r=new Y(r.getX()-w,r.getY()+w),c=new Y(c.getX()-w,c.getY()-w),u=new Y(u.getX()+w,u.getY()-w),m=new Y(m.getX()+w,m.getY()+w);let v=this.getColor(m,r);if(v===0)return!1;let C=this.getColor(r,c);return C!==v||(C=this.getColor(c,u),C!==v)?!1:(C=this.getColor(u,m),C===v)}getColor(r,c){let u=this.distancePoint(r,c),m=(c.getX()-r.getX())/u,w=(c.getY()-r.getY())/u,v=0,C=r.getX(),k=r.getY(),O=this.image.get(r.getX(),r.getY()),Z=Math.ceil(u);for(let he=0;he<Z;he++)C+=m,k+=w,this.image.get(tt.round(C),tt.round(k))!==O&&v++;let le=v/u;return le>.1&&le<.9?0:le<=.1===O?1:-1}getFirstDifferent(r,c,u,m){let w=r.getX()+u,v=r.getY()+m;for(;this.isValid(w,v)&&this.image.get(w,v)===c;)w+=u,v+=m;for(w-=u,v-=m;this.isValid(w,v)&&this.image.get(w,v)===c;)w+=u;for(w-=u;this.isValid(w,v)&&this.image.get(w,v)===c;)v+=m;return v-=m,new Y(w,v)}expandSquare(r,c,u){let m=u/(2*c),w=r[0].getX()-r[2].getX(),v=r[0].getY()-r[2].getY(),C=(r[0].getX()+r[2].getX())/2,k=(r[0].getY()+r[2].getY())/2,O=new qe(C+m*w,k+m*v),Z=new qe(C-m*w,k-m*v);w=r[1].getX()-r[3].getX(),v=r[1].getY()-r[3].getY(),C=(r[1].getX()+r[3].getX())/2,k=(r[1].getY()+r[3].getY())/2;let le=new qe(C+m*w,k+m*v),he=new qe(C-m*w,k-m*v);return[O,le,Z,he]}isValid(r,c){return r>=0&&r<this.image.getWidth()&&c>0&&c<this.image.getHeight()}isValidPoint(r){let c=tt.round(r.getX()),u=tt.round(r.getY());return this.isValid(c,u)}distancePoint(r,c){return tt.distance(r.getX(),r.getY(),c.getX(),c.getY())}distanceResultPoint(r,c){return tt.distance(r.getX(),r.getY(),c.getX(),c.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(M.truncDivision(this.nbLayers-4,8)+1)+15}}class Ae{decode(r,c=null){let u=null,m=new ye(r.getBlackMatrix()),w=null,v=null;try{let Z=m.detectMirror(!1);w=Z.getPoints(),this.reportFoundResultPoints(c,w),v=new nt().decode(Z)}catch(Z){u=Z}if(v==null)try{let Z=m.detectMirror(!0);w=Z.getPoints(),this.reportFoundResultPoints(c,w),v=new nt().decode(Z)}catch(Z){throw u??Z}let C=new ce(v.getText(),v.getRawBytes(),v.getNumBits(),w,me.AZTEC,_.currentTimeMillis()),k=v.getByteSegments();k!=null&&C.putMetadata(be.BYTE_SEGMENTS,k);let O=v.getECLevel();return O!=null&&C.putMetadata(be.ERROR_CORRECTION_LEVEL,O),C}reportFoundResultPoints(r,c){if(r!=null){let u=r.get(U.NEED_RESULT_POINT_CALLBACK);u!=null&&c.forEach((m,w,v)=>{u.foundPossibleResultPoint(m)})}}reset(){}}class Be extends te{constructor(r=500){super(new Ae,r)}}class Le{decode(r,c){try{return this.doDecode(r,c)}catch{if(c&&c.get(U.TRY_HARDER)===!0&&r.isRotateSupported()){const w=r.rotateCounterClockwise(),v=this.doDecode(w,c),C=v.getResultMetadata();let k=270;C!==null&&C.get(be.ORIENTATION)===!0&&(k=k+C.get(be.ORIENTATION)%360),v.putMetadata(be.ORIENTATION,k);const O=v.getResultPoints();if(O!==null){const Z=w.getHeight();for(let le=0;le<O.length;le++)O[le]=new qe(Z-O[le].getY()-1,O[le].getX())}return v}else throw new H}}reset(){}doDecode(r,c){const u=r.getWidth(),m=r.getHeight();let w=new W(u);const v=c&&c.get(U.TRY_HARDER)===!0,C=Math.max(1,m>>(v?8:5));let k;v?k=m:k=15;const O=Math.trunc(m/2);for(let Z=0;Z<k;Z++){const le=Math.trunc((Z+1)/2),he=(Z&1)===0,Ee=O+C*(he?le:-le);if(Ee<0||Ee>=m)break;try{w=r.getBlackRow(Ee,w)}catch{continue}for(let Ce=0;Ce<2;Ce++){if(Ce===1&&(w.reverse(),c&&c.get(U.NEED_RESULT_POINT_CALLBACK)===!0)){const Ie=new Map;c.forEach((Re,Fe)=>Ie.set(Fe,Re)),Ie.delete(U.NEED_RESULT_POINT_CALLBACK),c=Ie}try{const Ie=this.decodeRow(Ee,w,c);if(Ce===1){Ie.putMetadata(be.ORIENTATION,180);const Re=Ie.getResultPoints();Re!==null&&(Re[0]=new qe(u-Re[0].getX()-1,Re[0].getY()),Re[1]=new qe(u-Re[1].getX()-1,Re[1].getY()))}return Ie}catch{}}}throw new H}static recordPattern(r,c,u){const m=u.length;for(let O=0;O<m;O++)u[O]=0;const w=r.getSize();if(c>=w)throw new H;let v=!r.get(c),C=0,k=c;for(;k<w;){if(r.get(k)!==v)u[C]++;else{if(++C===m)break;u[C]=1,v=!v}k++}if(!(C===m||C===m-1&&k===w))throw new H}static recordPatternInReverse(r,c,u){let m=u.length,w=r.get(c);for(;c>0&&m>=0;)r.get(--c)!==w&&(m--,w=!w);if(m>=0)throw new H;Le.recordPattern(r,c+1,u)}static patternMatchVariance(r,c,u){const m=r.length;let w=0,v=0;for(let O=0;O<m;O++)w+=r[O],v+=c[O];if(w<v)return Number.POSITIVE_INFINITY;const C=w/v;u*=C;let k=0;for(let O=0;O<m;O++){const Z=r[O],le=c[O]*C,he=Z>le?Z-le:le-Z;if(he>u)return Number.POSITIVE_INFINITY;k+=he}return k/w}}class Ve extends Le{static findStartPattern(r){const c=r.getSize(),u=r.getNextSet(0);let m=0,w=Int32Array.from([0,0,0,0,0,0]),v=u,C=!1;const k=6;for(let O=u;O<c;O++)if(r.get(O)!==C)w[m]++;else{if(m===k-1){let Z=Ve.MAX_AVG_VARIANCE,le=-1;for(let he=Ve.CODE_START_A;he<=Ve.CODE_START_C;he++){const Ee=Le.patternMatchVariance(w,Ve.CODE_PATTERNS[he],Ve.MAX_INDIVIDUAL_VARIANCE);Ee<Z&&(Z=Ee,le=he)}if(le>=0&&r.isRange(Math.max(0,v-(O-v)/2),v,!1))return Int32Array.from([v,O,le]);v+=w[0]+w[1],w=w.slice(2,w.length-1),w[m-1]=0,w[m]=0,m--}else m++;w[m]=1,C=!C}throw new H}static decodeCode(r,c,u){Le.recordPattern(r,u,c);let m=Ve.MAX_AVG_VARIANCE,w=-1;for(let v=0;v<Ve.CODE_PATTERNS.length;v++){const C=Ve.CODE_PATTERNS[v],k=this.patternMatchVariance(c,C,Ve.MAX_INDIVIDUAL_VARIANCE);k<m&&(m=k,w=v)}if(w>=0)return w;throw new H}decodeRow(r,c,u){const m=u&&u.get(U.ASSUME_GS1)===!0,w=Ve.findStartPattern(c),v=w[2];let C=0;const k=new Uint8Array(20);k[C++]=v;let O;switch(v){case Ve.CODE_START_A:O=Ve.CODE_CODE_A;break;case Ve.CODE_START_B:O=Ve.CODE_CODE_B;break;case Ve.CODE_START_C:O=Ve.CODE_CODE_C;break;default:throw new P}let Z=!1,le=!1,he="",Ee=w[0],Ce=w[1];const Ie=Int32Array.from([0,0,0,0,0,0]);let Re=0,Fe=0,Xe=v,Je=0,Ye=!0,Nt=!1,Ct=!1;for(;!Z;){const Cr=le;switch(le=!1,Re=Fe,Fe=Ve.decodeCode(c,Ie,Ce),k[C++]=Fe,Fe!==Ve.CODE_STOP&&(Ye=!0),Fe!==Ve.CODE_STOP&&(Je++,Xe+=Je*Fe),Ee=Ce,Ce+=Ie.reduce((fi,lo)=>fi+lo,0),Fe){case Ve.CODE_START_A:case Ve.CODE_START_B:case Ve.CODE_START_C:throw new P}switch(O){case Ve.CODE_CODE_A:if(Fe<64)Ct===Nt?he+=String.fromCharCode(32+Fe):he+=String.fromCharCode(32+Fe+128),Ct=!1;else if(Fe<96)Ct===Nt?he+=String.fromCharCode(Fe-64):he+=String.fromCharCode(Fe+64),Ct=!1;else switch(Fe!==Ve.CODE_STOP&&(Ye=!1),Fe){case Ve.CODE_FNC_1:m&&(he.length===0?he+="]C1":he+="");break;case Ve.CODE_FNC_2:case Ve.CODE_FNC_3:break;case Ve.CODE_FNC_4_A:!Nt&&Ct?(Nt=!0,Ct=!1):Nt&&Ct?(Nt=!1,Ct=!1):Ct=!0;break;case Ve.CODE_SHIFT:le=!0,O=Ve.CODE_CODE_B;break;case Ve.CODE_CODE_B:O=Ve.CODE_CODE_B;break;case Ve.CODE_CODE_C:O=Ve.CODE_CODE_C;break;case Ve.CODE_STOP:Z=!0;break}break;case Ve.CODE_CODE_B:if(Fe<96)Ct===Nt?he+=String.fromCharCode(32+Fe):he+=String.fromCharCode(32+Fe+128),Ct=!1;else switch(Fe!==Ve.CODE_STOP&&(Ye=!1),Fe){case Ve.CODE_FNC_1:m&&(he.length===0?he+="]C1":he+="");break;case Ve.CODE_FNC_2:case Ve.CODE_FNC_3:break;case Ve.CODE_FNC_4_B:!Nt&&Ct?(Nt=!0,Ct=!1):Nt&&Ct?(Nt=!1,Ct=!1):Ct=!0;break;case Ve.CODE_SHIFT:le=!0,O=Ve.CODE_CODE_A;break;case Ve.CODE_CODE_A:O=Ve.CODE_CODE_A;break;case Ve.CODE_CODE_C:O=Ve.CODE_CODE_C;break;case Ve.CODE_STOP:Z=!0;break}break;case Ve.CODE_CODE_C:if(Fe<100)Fe<10&&(he+="0"),he+=Fe;else switch(Fe!==Ve.CODE_STOP&&(Ye=!1),Fe){case Ve.CODE_FNC_1:m&&(he.length===0?he+="]C1":he+="");break;case Ve.CODE_CODE_A:O=Ve.CODE_CODE_A;break;case Ve.CODE_CODE_B:O=Ve.CODE_CODE_B;break;case Ve.CODE_STOP:Z=!0;break}break}Cr&&(O=O===Ve.CODE_CODE_A?Ve.CODE_CODE_B:Ve.CODE_CODE_A)}const Fn=Ce-Ee;if(Ce=c.getNextUnset(Ce),!c.isRange(Ce,Math.min(c.getSize(),Ce+(Ce-Ee)/2),!1))throw new H;if(Xe-=Je*Re,Xe%103!==Re)throw new S;const ar=he.length;if(ar===0)throw new H;ar>0&&Ye&&(O===Ve.CODE_CODE_C?he=he.substring(0,ar-2):he=he.substring(0,ar-1));const pn=(w[1]+w[0])/2,jt=Ee+Fn/2,sn=k.length,Bn=new Uint8Array(sn);for(let Cr=0;Cr<sn;Cr++)Bn[Cr]=k[Cr];const zr=[new qe(pn,r),new qe(jt,r)];return new ce(he,Bn,0,zr,me.CODE_128,new Date().getTime())}}Ve.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],Ve.MAX_AVG_VARIANCE=.25,Ve.MAX_INDIVIDUAL_VARIANCE=.7,Ve.CODE_SHIFT=98,Ve.CODE_CODE_C=99,Ve.CODE_CODE_B=100,Ve.CODE_CODE_A=101,Ve.CODE_FNC_1=102,Ve.CODE_FNC_2=97,Ve.CODE_FNC_3=96,Ve.CODE_FNC_4_A=101,Ve.CODE_FNC_4_B=100,Ve.CODE_START_A=103,Ve.CODE_START_B=104,Ve.CODE_START_C=105,Ve.CODE_STOP=106;class vt extends Le{constructor(r=!1,c=!1){super(),this.usingCheckDigit=r,this.extendedMode=c,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(r,c,u){let m=this.counters;m.fill(0),this.decodeRowResult="";let w=vt.findAsteriskPattern(c,m),v=c.getNextSet(w[1]),C=c.getSize(),k,O;do{vt.recordPattern(c,v,m);let Ie=vt.toNarrowWidePattern(m);if(Ie<0)throw new H;k=vt.patternToChar(Ie),this.decodeRowResult+=k,O=v;for(let Re of m)v+=Re;v=c.getNextSet(v)}while(k!=="*");this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let Z=0;for(let Ie of m)Z+=Ie;let le=v-O-Z;if(v!==C&&le*2<Z)throw new H;if(this.usingCheckDigit){let Ie=this.decodeRowResult.length-1,Re=0;for(let Fe=0;Fe<Ie;Fe++)Re+=vt.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(Fe));if(this.decodeRowResult.charAt(Ie)!==vt.ALPHABET_STRING.charAt(Re%43))throw new S;this.decodeRowResult=this.decodeRowResult.substring(0,Ie)}if(this.decodeRowResult.length===0)throw new H;let he;this.extendedMode?he=vt.decodeExtended(this.decodeRowResult):he=this.decodeRowResult;let Ee=(w[1]+w[0])/2,Ce=O+Z/2;return new ce(he,null,0,[new qe(Ee,r),new qe(Ce,r)],me.CODE_39,new Date().getTime())}static findAsteriskPattern(r,c){let u=r.getSize(),m=r.getNextSet(0),w=0,v=m,C=!1,k=c.length;for(let O=m;O<u;O++)if(r.get(O)!==C)c[w]++;else{if(w===k-1){if(this.toNarrowWidePattern(c)===vt.ASTERISK_ENCODING&&r.isRange(Math.max(0,v-Math.floor((O-v)/2)),v,!1))return[v,O];v+=c[0]+c[1],c.copyWithin(0,2,2+w-1),c[w-1]=0,c[w]=0,w--}else w++;c[w]=1,C=!C}throw new H}static toNarrowWidePattern(r){let c=r.length,u=0,m;do{let w=2147483647;for(let k of r)k<w&&k>u&&(w=k);u=w,m=0;let v=0,C=0;for(let k=0;k<c;k++){let O=r[k];O>u&&(C|=1<<c-1-k,m++,v+=O)}if(m===3){for(let k=0;k<c&&m>0;k++){let O=r[k];if(O>u&&(m--,O*2>=v))return-1}return C}}while(m>3);return-1}static patternToChar(r){for(let c=0;c<vt.CHARACTER_ENCODINGS.length;c++)if(vt.CHARACTER_ENCODINGS[c]===r)return vt.ALPHABET_STRING.charAt(c);if(r===vt.ASTERISK_ENCODING)return"*";throw new H}static decodeExtended(r){let c=r.length,u="";for(let m=0;m<c;m++){let w=r.charAt(m);if(w==="+"||w==="$"||w==="%"||w==="/"){let v=r.charAt(m+1),C="\0";switch(w){case"+":if(v>="A"&&v<="Z")C=String.fromCharCode(v.charCodeAt(0)+32);else throw new P;break;case"$":if(v>="A"&&v<="Z")C=String.fromCharCode(v.charCodeAt(0)-64);else throw new P;break;case"%":if(v>="A"&&v<="E")C=String.fromCharCode(v.charCodeAt(0)-38);else if(v>="F"&&v<="J")C=String.fromCharCode(v.charCodeAt(0)-11);else if(v>="K"&&v<="O")C=String.fromCharCode(v.charCodeAt(0)+16);else if(v>="P"&&v<="T")C=String.fromCharCode(v.charCodeAt(0)+43);else if(v==="U")C="\0";else if(v==="V")C="@";else if(v==="W")C="`";else if(v==="X"||v==="Y"||v==="Z")C="";else throw new P;break;case"/":if(v>="A"&&v<="O")C=String.fromCharCode(v.charCodeAt(0)-32);else if(v==="Z")C=":";else throw new P;break}u+=C,m++}else u+=w}return u}}vt.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",vt.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],vt.ASTERISK_ENCODING=148;class ft extends Le{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(r,c,u){let m=this.decodeStart(c),w=this.decodeEnd(c),v=new G;ft.decodeMiddle(c,m[1],w[0],v);let C=v.toString(),k=null;u!=null&&(k=u.get(U.ALLOWED_LENGTHS)),k==null&&(k=ft.DEFAULT_ALLOWED_LENGTHS);let O=C.length,Z=!1,le=0;for(let Ce of k){if(O===Ce){Z=!0;break}Ce>le&&(le=Ce)}if(!Z&&O>le&&(Z=!0),!Z)throw new P;const he=[new qe(m[1],r),new qe(w[0],r)];return new ce(C,null,0,he,me.ITF,new Date().getTime())}static decodeMiddle(r,c,u,m){let w=new Int32Array(10),v=new Int32Array(5),C=new Int32Array(5);for(w.fill(0),v.fill(0),C.fill(0);c<u;){Le.recordPattern(r,c,w);for(let O=0;O<5;O++){let Z=2*O;v[O]=w[Z],C[O]=w[Z+1]}let k=ft.decodeDigit(v);m.append(k.toString()),k=this.decodeDigit(C),m.append(k.toString()),w.forEach(function(O){c+=O})}}decodeStart(r){let c=ft.skipWhiteSpace(r),u=ft.findGuardPattern(r,c,ft.START_PATTERN);return this.narrowLineWidth=(u[1]-u[0])/4,this.validateQuietZone(r,u[0]),u}validateQuietZone(r,c){let u=this.narrowLineWidth*10;u=u<c?u:c;for(let m=c-1;u>0&&m>=0&&!r.get(m);m--)u--;if(u!==0)throw new H}static skipWhiteSpace(r){const c=r.getSize(),u=r.getNextSet(0);if(u===c)throw new H;return u}decodeEnd(r){r.reverse();try{let c=ft.skipWhiteSpace(r),u;try{u=ft.findGuardPattern(r,c,ft.END_PATTERN_REVERSED[0])}catch(w){w instanceof H&&(u=ft.findGuardPattern(r,c,ft.END_PATTERN_REVERSED[1]))}this.validateQuietZone(r,u[0]);let m=u[0];return u[0]=r.getSize()-u[1],u[1]=r.getSize()-m,u}finally{r.reverse()}}static findGuardPattern(r,c,u){let m=u.length,w=new Int32Array(m),v=r.getSize(),C=!1,k=0,O=c;w.fill(0);for(let Z=c;Z<v;Z++)if(r.get(Z)!==C)w[k]++;else{if(k===m-1){if(Le.patternMatchVariance(w,u,ft.MAX_INDIVIDUAL_VARIANCE)<ft.MAX_AVG_VARIANCE)return[O,Z];O+=w[0]+w[1],_.arraycopy(w,2,w,0,k-1),w[k-1]=0,w[k]=0,k--}else k++;w[k]=1,C=!C}throw new H}static decodeDigit(r){let c=ft.MAX_AVG_VARIANCE,u=-1,m=ft.PATTERNS.length;for(let w=0;w<m;w++){let v=ft.PATTERNS[w],C=Le.patternMatchVariance(r,v,ft.MAX_INDIVIDUAL_VARIANCE);C<c?(c=C,u=w):C===c&&(u=-1)}if(u>=0)return u%10;throw new H}}ft.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],ft.MAX_AVG_VARIANCE=.38,ft.MAX_INDIVIDUAL_VARIANCE=.5,ft.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],ft.START_PATTERN=Int32Array.from([1,1,1,1]),ft.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class gt extends Le{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(r){let c=!1,u,m=0,w=Int32Array.from([0,0,0]);for(;!c;){w=Int32Array.from([0,0,0]),u=gt.findGuardPattern(r,m,!1,this.START_END_PATTERN,w);let v=u[0];m=u[1];let C=v-(m-v);C>=0&&(c=r.isRange(C,v,!1))}return u}static checkChecksum(r){return gt.checkStandardUPCEANChecksum(r)}static checkStandardUPCEANChecksum(r){let c=r.length;if(c===0)return!1;let u=parseInt(r.charAt(c-1),10);return gt.getStandardUPCEANChecksum(r.substring(0,c-1))===u}static getStandardUPCEANChecksum(r){let c=r.length,u=0;for(let m=c-1;m>=0;m-=2){let w=r.charAt(m).charCodeAt(0)-48;if(w<0||w>9)throw new P;u+=w}u*=3;for(let m=c-2;m>=0;m-=2){let w=r.charAt(m).charCodeAt(0)-48;if(w<0||w>9)throw new P;u+=w}return(1e3-u)%10}static decodeEnd(r,c){return gt.findGuardPattern(r,c,!1,gt.START_END_PATTERN,new Int32Array(gt.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(r,c,u,m){return this.findGuardPattern(r,c,u,m,new Int32Array(m.length))}static findGuardPattern(r,c,u,m,w){let v=r.getSize();c=u?r.getNextUnset(c):r.getNextSet(c);let C=0,k=c,O=m.length,Z=u;for(let le=c;le<v;le++)if(r.get(le)!==Z)w[C]++;else{if(C===O-1){if(Le.patternMatchVariance(w,m,gt.MAX_INDIVIDUAL_VARIANCE)<gt.MAX_AVG_VARIANCE)return Int32Array.from([k,le]);k+=w[0]+w[1];let he=w.slice(2,w.length-1);for(let Ee=0;Ee<C-1;Ee++)w[Ee]=he[Ee];w[C-1]=0,w[C]=0,C--}else C++;w[C]=1,Z=!Z}throw new H}static decodeDigit(r,c,u,m){this.recordPattern(r,u,c);let w=this.MAX_AVG_VARIANCE,v=-1,C=m.length;for(let k=0;k<C;k++){let O=m[k],Z=Le.patternMatchVariance(c,O,gt.MAX_INDIVIDUAL_VARIANCE);Z<w&&(w=Z,v=k)}if(v>=0)return v;throw new H}}gt.MAX_AVG_VARIANCE=.48,gt.MAX_INDIVIDUAL_VARIANCE=.7,gt.START_END_PATTERN=Int32Array.from([1,1,1]),gt.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),gt.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),gt.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class Rt{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(r,c,u){let m=this.decodeRowStringBuffer,w=this.decodeMiddle(c,u,m),v=m.toString(),C=Rt.parseExtensionString(v),k=[new qe((u[0]+u[1])/2,r),new qe(w,r)],O=new ce(v,null,0,k,me.UPC_EAN_EXTENSION,new Date().getTime());return C!=null&&O.putAllMetadata(C),O}decodeMiddle(r,c,u){let m=this.decodeMiddleCounters;m[0]=0,m[1]=0,m[2]=0,m[3]=0;let w=r.getSize(),v=c[1],C=0;for(let O=0;O<5&&v<w;O++){let Z=gt.decodeDigit(r,m,v,gt.L_AND_G_PATTERNS);u+=String.fromCharCode(48+Z%10);for(let le of m)v+=le;Z>=10&&(C|=1<<4-O),O!==4&&(v=r.getNextSet(v),v=r.getNextUnset(v))}if(u.length!==5)throw new H;let k=this.determineCheckDigit(C);if(Rt.extensionChecksum(u.toString())!==k)throw new H;return v}static extensionChecksum(r){let c=r.length,u=0;for(let m=c-2;m>=0;m-=2)u+=r.charAt(m).charCodeAt(0)-48;u*=3;for(let m=c-1;m>=0;m-=2)u+=r.charAt(m).charCodeAt(0)-48;return u*=3,u%10}determineCheckDigit(r){for(let c=0;c<10;c++)if(r===this.CHECK_DIGIT_ENCODINGS[c])return c;throw new H}static parseExtensionString(r){if(r.length!==5)return null;let c=Rt.parseExtension5String(r);return c==null?null:new Map([[be.SUGGESTED_PRICE,c]])}static parseExtension5String(r){let c;switch(r.charAt(0)){case"0":c="";break;case"5":c="$";break;case"9":switch(r){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}c="";break;default:c="";break}let u=parseInt(r.substring(1)),m=(u/100).toString(),w=u%100,v=w<10?"0"+w:w.toString();return c+m+"."+v}}class Ui{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(r,c,u){let m=this.decodeRowStringBuffer,w=this.decodeMiddle(c,u,m),v=m.toString(),C=Ui.parseExtensionString(v),k=[new qe((u[0]+u[1])/2,r),new qe(w,r)],O=new ce(v,null,0,k,me.UPC_EAN_EXTENSION,new Date().getTime());return C!=null&&O.putAllMetadata(C),O}decodeMiddle(r,c,u){let m=this.decodeMiddleCounters;m[0]=0,m[1]=0,m[2]=0,m[3]=0;let w=r.getSize(),v=c[1],C=0;for(let k=0;k<2&&v<w;k++){let O=gt.decodeDigit(r,m,v,gt.L_AND_G_PATTERNS);u+=String.fromCharCode(48+O%10);for(let Z of m)v+=Z;O>=10&&(C|=1<<1-k),k!==1&&(v=r.getNextSet(v),v=r.getNextUnset(v))}if(u.length!==2)throw new H;if(parseInt(u.toString())%4!==C)throw new H;return v}static parseExtensionString(r){return r.length!==2?null:new Map([[be.ISSUE_NUMBER,parseInt(r)]])}}class ps{static decodeRow(r,c,u){let m=gt.findGuardPattern(c,u,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return new Rt().decodeRow(r,c,m)}catch{return new Ui().decodeRow(r,c,m)}}}ps.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class kt extends gt{constructor(){super(),this.decodeRowStringBuffer="",kt.L_AND_G_PATTERNS=kt.L_PATTERNS.map(r=>Int32Array.from(r));for(let r=10;r<20;r++){let c=kt.L_PATTERNS[r-10],u=new Int32Array(c.length);for(let m=0;m<c.length;m++)u[m]=c[c.length-m-1];kt.L_AND_G_PATTERNS[r]=u}}decodeRow(r,c,u){let m=kt.findStartGuardPattern(c),w=u==null?null:u.get(U.NEED_RESULT_POINT_CALLBACK);if(w!=null){const Ye=new qe((m[0]+m[1])/2,r);w.foundPossibleResultPoint(Ye)}let v=this.decodeMiddle(c,m,this.decodeRowStringBuffer),C=v.rowOffset,k=v.resultString;if(w!=null){const Ye=new qe(C,r);w.foundPossibleResultPoint(Ye)}let O=this.decodeEnd(c,C);if(w!=null){const Ye=new qe((O[0]+O[1])/2,r);w.foundPossibleResultPoint(Ye)}let Z=O[1],le=Z+(Z-O[0]);if(le>=c.getSize()||!c.isRange(Z,le,!1))throw new H;let he=k.toString();if(he.length<8)throw new P;if(!kt.checkChecksum(he))throw new S;let Ee=(m[1]+m[0])/2,Ce=(O[1]+O[0])/2,Ie=this.getBarcodeFormat(),Re=[new qe(Ee,r),new qe(Ce,r)],Fe=new ce(he,null,0,Re,Ie,new Date().getTime()),Xe=0;try{let Ye=ps.decodeRow(r,c,O[1]);Fe.putMetadata(be.UPC_EAN_EXTENSION,Ye.getText()),Fe.putAllMetadata(Ye.getResultMetadata()),Fe.addResultPoints(Ye.getResultPoints()),Xe=Ye.getText().length}catch{}let Je=u==null?null:u.get(U.ALLOWED_EAN_EXTENSIONS);if(Je!=null){let Ye=!1;for(let Nt in Je)if(Xe.toString()===Nt){Ye=!0;break}if(!Ye)throw new H}return Fe}decodeEnd(r,c){return kt.findGuardPattern(r,c,!1,kt.START_END_PATTERN,new Int32Array(kt.START_END_PATTERN.length).fill(0))}static checkChecksum(r){return kt.checkStandardUPCEANChecksum(r)}static checkStandardUPCEANChecksum(r){let c=r.length;if(c===0)return!1;let u=parseInt(r.charAt(c-1),10);return kt.getStandardUPCEANChecksum(r.substring(0,c-1))===u}static getStandardUPCEANChecksum(r){let c=r.length,u=0;for(let m=c-1;m>=0;m-=2){let w=r.charAt(m).charCodeAt(0)-48;if(w<0||w>9)throw new P;u+=w}u*=3;for(let m=c-2;m>=0;m-=2){let w=r.charAt(m).charCodeAt(0)-48;if(w<0||w>9)throw new P;u+=w}return(1e3-u)%10}}class Gn extends kt{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(r,c,u){let m=this.decodeMiddleCounters;m[0]=0,m[1]=0,m[2]=0,m[3]=0;let w=r.getSize(),v=c[1],C=0;for(let O=0;O<6&&v<w;O++){let Z=kt.decodeDigit(r,m,v,kt.L_AND_G_PATTERNS);u+=String.fromCharCode(48+Z%10);for(let le of m)v+=le;Z>=10&&(C|=1<<5-O)}u=Gn.determineFirstDigit(u,C),v=kt.findGuardPattern(r,v,!0,kt.MIDDLE_PATTERN,new Int32Array(kt.MIDDLE_PATTERN.length).fill(0))[1];for(let O=0;O<6&&v<w;O++){let Z=kt.decodeDigit(r,m,v,kt.L_PATTERNS);u+=String.fromCharCode(48+Z);for(let le of m)v+=le}return{rowOffset:v,resultString:u}}getBarcodeFormat(){return me.EAN_13}static determineFirstDigit(r,c){for(let u=0;u<10;u++)if(c===this.FIRST_DIGIT_ENCODINGS[u])return r=String.fromCharCode(48+u)+r,r;throw new H}}Gn.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class js extends kt{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(r,c,u){const m=this.decodeMiddleCounters;m[0]=0,m[1]=0,m[2]=0,m[3]=0;let w=r.getSize(),v=c[1];for(let k=0;k<4&&v<w;k++){let O=kt.decodeDigit(r,m,v,kt.L_PATTERNS);u+=String.fromCharCode(48+O);for(let Z of m)v+=Z}v=kt.findGuardPattern(r,v,!0,kt.MIDDLE_PATTERN,new Int32Array(kt.MIDDLE_PATTERN.length).fill(0))[1];for(let k=0;k<4&&v<w;k++){let O=kt.decodeDigit(r,m,v,kt.L_PATTERNS);u+=String.fromCharCode(48+O);for(let Z of m)v+=Z}return{rowOffset:v,resultString:u}}getBarcodeFormat(){return me.EAN_8}}class Vs extends kt{constructor(){super(...arguments),this.ean13Reader=new Gn}getBarcodeFormat(){return me.UPC_A}decode(r,c){return this.maybeReturnResult(this.ean13Reader.decode(r))}decodeRow(r,c,u){return this.maybeReturnResult(this.ean13Reader.decodeRow(r,c,u))}decodeMiddle(r,c,u){return this.ean13Reader.decodeMiddle(r,c,u)}maybeReturnResult(r){let c=r.getText();if(c.charAt(0)==="0"){let u=new ce(c.substring(1),null,null,r.getResultPoints(),me.UPC_A);return r.getResultMetadata()!=null&&u.putAllMetadata(r.getResultMetadata()),u}else throw new H}reset(){this.ean13Reader.reset()}}class Yn extends kt{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(r,c,u){const m=this.decodeMiddleCounters.map(O=>O);m[0]=0,m[1]=0,m[2]=0,m[3]=0;const w=r.getSize();let v=c[1],C=0;for(let O=0;O<6&&v<w;O++){const Z=Yn.decodeDigit(r,m,v,Yn.L_AND_G_PATTERNS);u+=String.fromCharCode(48+Z%10);for(let le of m)v+=le;Z>=10&&(C|=1<<5-O)}let k=Yn.determineNumSysAndCheckDigit(u,C);return{rowOffset:v,resultString:k}}decodeEnd(r,c){return Yn.findGuardPatternWithoutCounters(r,c,!0,Yn.MIDDLE_END_PATTERN)}checkChecksum(r){return kt.checkChecksum(Yn.convertUPCEtoUPCA(r))}static determineNumSysAndCheckDigit(r,c){for(let u=0;u<=1;u++)for(let m=0;m<10;m++)if(c===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[u][m]){let w=String.fromCharCode(48+u),v=String.fromCharCode(48+m);return w+r+v}throw H.getNotFoundInstance()}getBarcodeFormat(){return me.UPC_E}static convertUPCEtoUPCA(r){const c=r.slice(1,7).split("").map(w=>w.charCodeAt(0)),u=new G;u.append(r.charAt(0));let m=c[5];switch(m){case 0:case 1:case 2:u.appendChars(c,0,2),u.append(m),u.append("0000"),u.appendChars(c,2,3);break;case 3:u.appendChars(c,0,3),u.append("00000"),u.appendChars(c,3,2);break;case 4:u.appendChars(c,0,4),u.append("00000"),u.append(c[4]);break;default:u.appendChars(c,0,5),u.append("0000"),u.append(m);break}return r.length>=8&&u.append(r.charAt(7)),u.toString()}}Yn.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Yn.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class gs extends Le{constructor(r){super();let c=r==null?null:r.get(U.POSSIBLE_FORMATS),u=[];s(c)?(u.push(new Gn),u.push(new Vs),u.push(new js),u.push(new Yn)):(c.indexOf(me.EAN_13)>-1&&u.push(new Gn),c.indexOf(me.UPC_A)>-1&&u.push(new Vs),c.indexOf(me.EAN_8)>-1&&u.push(new js),c.indexOf(me.UPC_E)>-1&&u.push(new Yn)),this.readers=u}decodeRow(r,c,u){for(let m of this.readers)try{const w=m.decodeRow(r,c,u),v=w.getBarcodeFormat()===me.EAN_13&&w.getText().charAt(0)==="0",C=u==null?null:u.get(U.POSSIBLE_FORMATS),k=C==null||C.includes(me.UPC_A);if(v&&k){const O=w.getRawBytes(),Z=new ce(w.getText().substring(1),O,O?O.length:null,w.getResultPoints(),me.UPC_A);return Z.putAllMetadata(w.getResultMetadata()),Z}return w}catch{}throw new H}reset(){for(let r of this.readers)r.reset()}}class wn extends Le{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(r,c){for(let u=0;u<c.length;u++)if(Le.patternMatchVariance(r,c[u],wn.MAX_INDIVIDUAL_VARIANCE)<wn.MAX_AVG_VARIANCE)return u;throw new H}static count(r){return tt.sum(new Int32Array(r))}static increment(r,c){let u=0,m=c[0];for(let w=1;w<r.length;w++)c[w]>m&&(m=c[w],u=w);r[u]++}static decrement(r,c){let u=0,m=c[0];for(let w=1;w<r.length;w++)c[w]<m&&(m=c[w],u=w);r[u]--}static isFinderPattern(r){let c=r[0]+r[1],u=c+r[2]+r[3],m=c/u;if(m>=wn.MIN_FINDER_PATTERN_RATIO&&m<=wn.MAX_FINDER_PATTERN_RATIO){let w=Number.MAX_SAFE_INTEGER,v=Number.MIN_SAFE_INTEGER;for(let C of r)C>v&&(v=C),C<w&&(w=C);return v<10*w}return!1}}wn.MAX_AVG_VARIANCE=.2,wn.MAX_INDIVIDUAL_VARIANCE=.45,wn.MIN_FINDER_PATTERN_RATIO=9.5/12,wn.MAX_FINDER_PATTERN_RATIO=12.5/14;class Mr{constructor(r,c){this.value=r,this.checksumPortion=c}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(r){if(!(r instanceof Mr))return!1;const c=r;return this.value===c.value&&this.checksumPortion===c.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class Fi{constructor(r,c,u,m,w){this.value=r,this.startEnd=c,this.value=r,this.startEnd=c,this.resultPoints=new Array,this.resultPoints.push(new qe(u,w)),this.resultPoints.push(new qe(m,w))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(r){if(!(r instanceof Fi))return!1;const c=r;return this.value===c.value}hashCode(){return this.value}}class On{constructor(){}static getRSSvalue(r,c,u){let m=0;for(let k of r)m+=k;let w=0,v=0,C=r.length;for(let k=0;k<C-1;k++){let O;for(O=1,v|=1<<k;O<r[k];O++,v&=~(1<<k)){let Z=On.combins(m-O-1,C-k-2);if(u&&v===0&&m-O-(C-k-1)>=C-k-1&&(Z-=On.combins(m-O-(C-k),C-k-2)),C-k-1>1){let le=0;for(let he=m-O-(C-k-2);he>c;he--)le+=On.combins(m-O-he-1,C-k-3);Z-=le*(C-1-k)}else m-O>c&&Z--;w+=Z}m-=O}return w}static combins(r,c){let u,m;r-c>c?(m=c,u=r-c):(m=r-c,u=c);let w=1,v=1;for(let C=r;C>u;C--)w*=C,v<=m&&(w/=v,v++);for(;v<=m;)w/=v,v++;return w}}class zs{static buildBitArray(r){let c=r.length*2-1;r[r.length-1].getRightChar()==null&&(c-=1);let u=12*c,m=new W(u),w=0,C=r[0].getRightChar().getValue();for(let k=11;k>=0;--k)(C&1<<k)!=0&&m.set(w),w++;for(let k=1;k<r.length;++k){let O=r[k],Z=O.getLeftChar().getValue();for(let le=11;le>=0;--le)(Z&1<<le)!=0&&m.set(w),w++;if(O.getRightChar()!=null){let le=O.getRightChar().getValue();for(let he=11;he>=0;--he)(le&1<<he)!=0&&m.set(w),w++}}return m}}class tr{constructor(r,c){c?this.decodedInformation=null:(this.finished=r,this.decodedInformation=c)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class Ws{constructor(r){this.newPosition=r}getNewPosition(){return this.newPosition}}class mn extends Ws{constructor(r,c){super(r),this.value=c}getValue(){return this.value}isFNC1(){return this.value===mn.FNC1}}mn.FNC1="$";class fr extends Ws{constructor(r,c,u){super(r),u?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=c}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class Nn extends Ws{constructor(r,c,u){if(super(r),c<0||c>10||u<0||u>10)throw new P;this.firstDigit=c,this.secondDigit=u}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return this.firstDigit*10+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===Nn.FNC1}isSecondDigitFNC1(){return this.secondDigit===Nn.FNC1}isAnyFNC1(){return this.firstDigit===Nn.FNC1||this.secondDigit===Nn.FNC1}}Nn.FNC1=10;class rt{constructor(){}static parseFieldsInGeneralPurpose(r){if(!r)return null;if(r.length<2)throw new H;let c=r.substring(0,2);for(let w of rt.TWO_DIGIT_DATA_LENGTH)if(w[0]===c)return w[1]===rt.VARIABLE_LENGTH?rt.processVariableAI(2,w[2],r):rt.processFixedAI(2,w[1],r);if(r.length<3)throw new H;let u=r.substring(0,3);for(let w of rt.THREE_DIGIT_DATA_LENGTH)if(w[0]===u)return w[1]===rt.VARIABLE_LENGTH?rt.processVariableAI(3,w[2],r):rt.processFixedAI(3,w[1],r);for(let w of rt.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(w[0]===u)return w[1]===rt.VARIABLE_LENGTH?rt.processVariableAI(4,w[2],r):rt.processFixedAI(4,w[1],r);if(r.length<4)throw new H;let m=r.substring(0,4);for(let w of rt.FOUR_DIGIT_DATA_LENGTH)if(w[0]===m)return w[1]===rt.VARIABLE_LENGTH?rt.processVariableAI(4,w[2],r):rt.processFixedAI(4,w[1],r);throw new H}static processFixedAI(r,c,u){if(u.length<r)throw new H;let m=u.substring(0,r);if(u.length<r+c)throw new H;let w=u.substring(r,r+c),v=u.substring(r+c),C="("+m+")"+w,k=rt.parseFieldsInGeneralPurpose(v);return k==null?C:C+k}static processVariableAI(r,c,u){let m=u.substring(0,r),w;u.length<r+c?w=u.length:w=r+c;let v=u.substring(r,w),C=u.substring(w),k="("+m+")"+v,O=rt.parseFieldsInGeneralPurpose(C);return O==null?k:k+O}}rt.VARIABLE_LENGTH=[],rt.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",rt.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",rt.VARIABLE_LENGTH,20],["22",rt.VARIABLE_LENGTH,29],["30",rt.VARIABLE_LENGTH,8],["37",rt.VARIABLE_LENGTH,8],["90",rt.VARIABLE_LENGTH,30],["91",rt.VARIABLE_LENGTH,30],["92",rt.VARIABLE_LENGTH,30],["93",rt.VARIABLE_LENGTH,30],["94",rt.VARIABLE_LENGTH,30],["95",rt.VARIABLE_LENGTH,30],["96",rt.VARIABLE_LENGTH,30],["97",rt.VARIABLE_LENGTH,3],["98",rt.VARIABLE_LENGTH,30],["99",rt.VARIABLE_LENGTH,30]],rt.THREE_DIGIT_DATA_LENGTH=[["240",rt.VARIABLE_LENGTH,30],["241",rt.VARIABLE_LENGTH,30],["242",rt.VARIABLE_LENGTH,6],["250",rt.VARIABLE_LENGTH,30],["251",rt.VARIABLE_LENGTH,30],["253",rt.VARIABLE_LENGTH,17],["254",rt.VARIABLE_LENGTH,20],["400",rt.VARIABLE_LENGTH,30],["401",rt.VARIABLE_LENGTH,30],["402",17],["403",rt.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",rt.VARIABLE_LENGTH,20],["421",rt.VARIABLE_LENGTH,15],["422",3],["423",rt.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],rt.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",rt.VARIABLE_LENGTH,15],["391",rt.VARIABLE_LENGTH,18],["392",rt.VARIABLE_LENGTH,15],["393",rt.VARIABLE_LENGTH,18],["703",rt.VARIABLE_LENGTH,30]],rt.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",rt.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",rt.VARIABLE_LENGTH,20],["8003",rt.VARIABLE_LENGTH,30],["8004",rt.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",rt.VARIABLE_LENGTH,30],["8008",rt.VARIABLE_LENGTH,12],["8018",18],["8020",rt.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",rt.VARIABLE_LENGTH,70],["8200",rt.VARIABLE_LENGTH,70]];class ti{constructor(r){this.buffer=new G,this.information=r}decodeAllCodes(r,c){let u=c,m=null;do{let w=this.decodeGeneralPurposeField(u,m),v=rt.parseFieldsInGeneralPurpose(w.getNewString());if(v!=null&&r.append(v),w.isRemaining()?m=""+w.getRemainingValue():m=null,u===w.getNewPosition())break;u=w.getNewPosition()}while(!0);return r.toString()}isStillNumeric(r){if(r+7>this.information.getSize())return r+4<=this.information.getSize();for(let c=r;c<r+3;++c)if(this.information.get(c))return!0;return this.information.get(r+3)}decodeNumeric(r){if(r+7>this.information.getSize()){let w=this.extractNumericValueFromBitArray(r,4);return w===0?new Nn(this.information.getSize(),Nn.FNC1,Nn.FNC1):new Nn(this.information.getSize(),w-1,Nn.FNC1)}let c=this.extractNumericValueFromBitArray(r,7),u=(c-8)/11,m=(c-8)%11;return new Nn(r+7,u,m)}extractNumericValueFromBitArray(r,c){return ti.extractNumericValueFromBitArray(this.information,r,c)}static extractNumericValueFromBitArray(r,c,u){let m=0;for(let w=0;w<u;++w)r.get(c+w)&&(m|=1<<u-w-1);return m}decodeGeneralPurposeField(r,c){this.buffer.setLengthToZero(),c!=null&&this.buffer.append(c),this.current.setPosition(r);let u=this.parseBlocks();return u!=null&&u.isRemaining()?new fr(this.current.getPosition(),this.buffer.toString(),u.getRemainingValue()):new fr(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let r,c;do{let u=this.current.getPosition();if(this.current.isAlpha()?(c=this.parseAlphaBlock(),r=c.isFinished()):this.current.isIsoIec646()?(c=this.parseIsoIec646Block(),r=c.isFinished()):(c=this.parseNumericBlock(),r=c.isFinished()),!(u!==this.current.getPosition())&&!r)break}while(!r);return c.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let r=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(r.getNewPosition()),r.isFirstDigitFNC1()){let c;return r.isSecondDigitFNC1()?c=new fr(this.current.getPosition(),this.buffer.toString()):c=new fr(this.current.getPosition(),this.buffer.toString(),r.getSecondDigit()),new tr(!0,c)}if(this.buffer.append(r.getFirstDigit()),r.isSecondDigitFNC1()){let c=new fr(this.current.getPosition(),this.buffer.toString());return new tr(!0,c)}this.buffer.append(r.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new tr(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let r=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(r.getNewPosition()),r.isFNC1()){let c=new fr(this.current.getPosition(),this.buffer.toString());return new tr(!0,c)}this.buffer.append(r.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new tr(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let r=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(r.getNewPosition()),r.isFNC1()){let c=new fr(this.current.getPosition(),this.buffer.toString());return new tr(!0,c)}this.buffer.append(r.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new tr(!1)}isStillIsoIec646(r){if(r+5>this.information.getSize())return!1;let c=this.extractNumericValueFromBitArray(r,5);if(c>=5&&c<16)return!0;if(r+7>this.information.getSize())return!1;let u=this.extractNumericValueFromBitArray(r,7);if(u>=64&&u<116)return!0;if(r+8>this.information.getSize())return!1;let m=this.extractNumericValueFromBitArray(r,8);return m>=232&&m<253}decodeIsoIec646(r){let c=this.extractNumericValueFromBitArray(r,5);if(c===15)return new mn(r+5,mn.FNC1);if(c>=5&&c<15)return new mn(r+5,"0"+(c-5));let u=this.extractNumericValueFromBitArray(r,7);if(u>=64&&u<90)return new mn(r+7,""+(u+1));if(u>=90&&u<116)return new mn(r+7,""+(u+7));let m=this.extractNumericValueFromBitArray(r,8),w;switch(m){case 232:w="!";break;case 233:w='"';break;case 234:w="%";break;case 235:w="&";break;case 236:w="'";break;case 237:w="(";break;case 238:w=")";break;case 239:w="*";break;case 240:w="+";break;case 241:w=",";break;case 242:w="-";break;case 243:w=".";break;case 244:w="/";break;case 245:w=":";break;case 246:w=";";break;case 247:w="<";break;case 248:w="=";break;case 249:w=">";break;case 250:w="?";break;case 251:w="_";break;case 252:w=" ";break;default:throw new P}return new mn(r+8,w)}isStillAlpha(r){if(r+5>this.information.getSize())return!1;let c=this.extractNumericValueFromBitArray(r,5);if(c>=5&&c<16)return!0;if(r+6>this.information.getSize())return!1;let u=this.extractNumericValueFromBitArray(r,6);return u>=16&&u<63}decodeAlphanumeric(r){let c=this.extractNumericValueFromBitArray(r,5);if(c===15)return new mn(r+5,mn.FNC1);if(c>=5&&c<15)return new mn(r+5,"0"+(c-5));let u=this.extractNumericValueFromBitArray(r,6);if(u>=32&&u<58)return new mn(r+6,""+(u+33));let m;switch(u){case 58:m="*";break;case 59:m=",";break;case 60:m="-";break;case 61:m=".";break;case 62:m="/";break;default:throw new Ze("Decoding invalid alphanumeric value: "+u)}return new mn(r+6,m)}isAlphaTo646ToAlphaLatch(r){if(r+1>this.information.getSize())return!1;for(let c=0;c<5&&c+r<this.information.getSize();++c)if(c===2){if(!this.information.get(r+2))return!1}else if(this.information.get(r+c))return!1;return!0}isAlphaOr646ToNumericLatch(r){if(r+3>this.information.getSize())return!1;for(let c=r;c<r+3;++c)if(this.information.get(c))return!1;return!0}isNumericToAlphaNumericLatch(r){if(r+1>this.information.getSize())return!1;for(let c=0;c<4&&c+r<this.information.getSize();++c)if(this.information.get(r+c))return!1;return!0}}class qs{constructor(r){this.information=r,this.generalDecoder=new ti(r)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class Ln extends qs{constructor(r){super(r)}encodeCompressedGtin(r,c){r.append("(01)");let u=r.length();r.append("9"),this.encodeCompressedGtinWithoutAI(r,c,u)}encodeCompressedGtinWithoutAI(r,c,u){for(let m=0;m<4;++m){let w=this.getGeneralDecoder().extractNumericValueFromBitArray(c+10*m,10);w/100===0&&r.append("0"),w/10===0&&r.append("0"),r.append(w)}Ln.appendCheckDigit(r,u)}static appendCheckDigit(r,c){let u=0;for(let m=0;m<13;m++){let w=r.charAt(m+c).charCodeAt(0)-48;u+=(m&1)===0?3*w:w}u=10-u%10,u===10&&(u=0),r.append(u)}}Ln.GTIN_SIZE=40;class Qn extends Ln{constructor(r){super(r)}parseInformation(){let r=new G;r.append("(01)");let c=r.length(),u=this.getGeneralDecoder().extractNumericValueFromBitArray(Qn.HEADER_SIZE,4);return r.append(u),this.encodeCompressedGtinWithoutAI(r,Qn.HEADER_SIZE+4,c),this.getGeneralDecoder().decodeAllCodes(r,Qn.HEADER_SIZE+44)}}Qn.HEADER_SIZE=4;class Hi extends qs{constructor(r){super(r)}parseInformation(){let r=new G;return this.getGeneralDecoder().decodeAllCodes(r,Hi.HEADER_SIZE)}}Hi.HEADER_SIZE=5;class $i extends Ln{constructor(r){super(r)}encodeCompressedWeight(r,c,u){let m=this.getGeneralDecoder().extractNumericValueFromBitArray(c,u);this.addWeightCode(r,m);let w=this.checkWeight(m),v=1e5;for(let C=0;C<5;++C)w/v===0&&r.append("0"),v/=10;r.append(w)}}class dr extends $i{constructor(r){super(r)}parseInformation(){if(this.getInformation().getSize()!=dr.HEADER_SIZE+$i.GTIN_SIZE+dr.WEIGHT_SIZE)throw new H;let r=new G;return this.encodeCompressedGtin(r,dr.HEADER_SIZE),this.encodeCompressedWeight(r,dr.HEADER_SIZE+$i.GTIN_SIZE,dr.WEIGHT_SIZE),r.toString()}}dr.HEADER_SIZE=5,dr.WEIGHT_SIZE=15;class Ro extends dr{constructor(r){super(r)}addWeightCode(r,c){r.append("(3103)")}checkWeight(r){return r}}class No extends dr{constructor(r){super(r)}addWeightCode(r,c){c<1e4?r.append("(3202)"):r.append("(3203)")}checkWeight(r){return r<1e4?r:r-1e4}}class nr extends Ln{constructor(r){super(r)}parseInformation(){if(this.getInformation().getSize()<nr.HEADER_SIZE+Ln.GTIN_SIZE)throw new H;let r=new G;this.encodeCompressedGtin(r,nr.HEADER_SIZE);let c=this.getGeneralDecoder().extractNumericValueFromBitArray(nr.HEADER_SIZE+Ln.GTIN_SIZE,nr.LAST_DIGIT_SIZE);r.append("(392"),r.append(c),r.append(")");let u=this.getGeneralDecoder().decodeGeneralPurposeField(nr.HEADER_SIZE+Ln.GTIN_SIZE+nr.LAST_DIGIT_SIZE,null);return r.append(u.getNewString()),r.toString()}}nr.HEADER_SIZE=8,nr.LAST_DIGIT_SIZE=2;class Cn extends Ln{constructor(r){super(r)}parseInformation(){if(this.getInformation().getSize()<Cn.HEADER_SIZE+Ln.GTIN_SIZE)throw new H;let r=new G;this.encodeCompressedGtin(r,Cn.HEADER_SIZE);let c=this.getGeneralDecoder().extractNumericValueFromBitArray(Cn.HEADER_SIZE+Ln.GTIN_SIZE,Cn.LAST_DIGIT_SIZE);r.append("(393"),r.append(c),r.append(")");let u=this.getGeneralDecoder().extractNumericValueFromBitArray(Cn.HEADER_SIZE+Ln.GTIN_SIZE+Cn.LAST_DIGIT_SIZE,Cn.FIRST_THREE_DIGITS_SIZE);u/100==0&&r.append("0"),u/10==0&&r.append("0"),r.append(u);let m=this.getGeneralDecoder().decodeGeneralPurposeField(Cn.HEADER_SIZE+Ln.GTIN_SIZE+Cn.LAST_DIGIT_SIZE+Cn.FIRST_THREE_DIGITS_SIZE,null);return r.append(m.getNewString()),r.toString()}}Cn.HEADER_SIZE=8,Cn.LAST_DIGIT_SIZE=2,Cn.FIRST_THREE_DIGITS_SIZE=10;class Kt extends $i{constructor(r,c,u){super(r),this.dateCode=u,this.firstAIdigits=c}parseInformation(){if(this.getInformation().getSize()!=Kt.HEADER_SIZE+Kt.GTIN_SIZE+Kt.WEIGHT_SIZE+Kt.DATE_SIZE)throw new H;let r=new G;return this.encodeCompressedGtin(r,Kt.HEADER_SIZE),this.encodeCompressedWeight(r,Kt.HEADER_SIZE+Kt.GTIN_SIZE,Kt.WEIGHT_SIZE),this.encodeCompressedDate(r,Kt.HEADER_SIZE+Kt.GTIN_SIZE+Kt.WEIGHT_SIZE),r.toString()}encodeCompressedDate(r,c){let u=this.getGeneralDecoder().extractNumericValueFromBitArray(c,Kt.DATE_SIZE);if(u==38400)return;r.append("("),r.append(this.dateCode),r.append(")");let m=u%32;u/=32;let w=u%12+1;u/=12;let v=u;v/10==0&&r.append("0"),r.append(v),w/10==0&&r.append("0"),r.append(w),m/10==0&&r.append("0"),r.append(m)}addWeightCode(r,c){r.append("("),r.append(this.firstAIdigits),r.append(c/1e5),r.append(")")}checkWeight(r){return r%1e5}}Kt.HEADER_SIZE=8,Kt.WEIGHT_SIZE=20,Kt.DATE_SIZE=16;function ko(oe){try{if(oe.get(1))return new Qn(oe);if(!oe.get(2))return new Hi(oe);switch(ti.extractNumericValueFromBitArray(oe,1,4)){case 4:return new Ro(oe);case 5:return new No(oe)}switch(ti.extractNumericValueFromBitArray(oe,1,5)){case 12:return new nr(oe);case 13:return new Cn(oe)}switch(ti.extractNumericValueFromBitArray(oe,1,7)){case 56:return new Kt(oe,"310","11");case 57:return new Kt(oe,"320","11");case 58:return new Kt(oe,"310","13");case 59:return new Kt(oe,"320","13");case 60:return new Kt(oe,"310","15");case 61:return new Kt(oe,"320","15");case 62:return new Kt(oe,"310","17");case 63:return new Kt(oe,"320","17")}}catch(r){throw console.log(r),new Ze("unknown decoder: "+oe)}}class zt{constructor(r,c,u,m){this.leftchar=r,this.rightchar=c,this.finderpattern=u,this.maybeLast=m}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return this.rightchar==null}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(this.finderpattern==null?"null":this.finderpattern.getValue())+" ]"}static equals(r,c){return r instanceof zt?zt.equalsOrNull(r.leftchar,c.leftchar)&&zt.equalsOrNull(r.rightchar,c.rightchar)&&zt.equalsOrNull(r.finderpattern,c.finderpattern):!1}static equalsOrNull(r,c){return r===null?c===null:zt.equals(r,c)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class Gs{constructor(r,c,u){this.pairs=r,this.rowNumber=c,this.wasReversed=u}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(r){return this.checkEqualitity(this,r)}toString(){return"{ "+this.pairs+" }"}equals(r,c){return r instanceof Gs?this.checkEqualitity(r,c)&&r.wasReversed===c.wasReversed:!1}checkEqualitity(r,c){if(!r||!c)return;let u;return r.forEach((m,w)=>{c.forEach(v=>{m.getLeftChar().getValue()===v.getLeftChar().getValue()&&m.getRightChar().getValue()===v.getRightChar().getValue()&&m.getFinderPatter().getValue()===v.getFinderPatter().getValue()&&(u=!0)})}),u}}class ze extends wn{constructor(r){super(...arguments),this.pairs=new Array(ze.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=r===!0}decodeRow(r,c,u){this.pairs.length=0,this.startFromEven=!1;try{return ze.constructResult(this.decodeRow2pairs(r,c))}catch(m){this.verbose&&console.log(m)}return this.pairs.length=0,this.startFromEven=!0,ze.constructResult(this.decodeRow2pairs(r,c))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(r,c){let u=!1;for(;!u;)try{this.pairs.push(this.retrieveNextPair(c,this.pairs,r))}catch(w){if(w instanceof H){if(!this.pairs.length)throw new H;u=!0}}if(this.checkChecksum())return this.pairs;let m;if(this.rows.length?m=!0:m=!1,this.storeRow(r,!1),m){let w=this.checkRowsBoolean(!1);if(w!=null||(w=this.checkRowsBoolean(!0),w!=null))return w}throw new H}checkRowsBoolean(r){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,r&&(this.rows=this.rows.reverse());let c=null;try{c=this.checkRows(new Array,0)}catch(u){this.verbose&&console.log(u)}return r&&(this.rows=this.rows.reverse()),c}checkRows(r,c){for(let u=c;u<this.rows.length;u++){let m=this.rows[u];this.pairs.length=0;for(let v of r)this.pairs.push(v.getPairs());if(this.pairs.push(m.getPairs()),!ze.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let w=new Array(r);w.push(m);try{return this.checkRows(w,u+1)}catch(v){this.verbose&&console.log(v)}}throw new H}static isValidSequence(r){for(let c of ze.FINDER_PATTERN_SEQUENCES){if(r.length>c.length)continue;let u=!0;for(let m=0;m<r.length;m++)if(r[m].getFinderPattern().getValue()!=c[m]){u=!1;break}if(u)return!0}return!1}storeRow(r,c){let u=0,m=!1,w=!1;for(;u<this.rows.length;){let v=this.rows[u];if(v.getRowNumber()>r){w=v.isEquivalent(this.pairs);break}m=v.isEquivalent(this.pairs),u++}w||m||ze.isPartialRow(this.pairs,this.rows)||(this.rows.push(u,new Gs(this.pairs,r,c)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(r,c){for(let u of c)if(u.getPairs().length!==r.length){for(let m of u.getPairs())for(let w of r)if(zt.equals(m,w))break}}static isPartialRow(r,c){for(let u of c){let m=!0;for(let w of r){let v=!1;for(let C of u.getPairs())if(w.equals(C)){v=!0;break}if(!v){m=!1;break}}if(m)return!0}return!1}getRows(){return this.rows}static constructResult(r){let c=zs.buildBitArray(r),m=ko(c).parseInformation(),w=r[0].getFinderPattern().getResultPoints(),v=r[r.length-1].getFinderPattern().getResultPoints(),C=[w[0],w[1],v[0],v[1]];return new ce(m,null,null,C,me.RSS_EXPANDED,null)}checkChecksum(){let r=this.pairs.get(0),c=r.getLeftChar(),u=r.getRightChar();if(u==null)return!1;let m=u.getChecksumPortion(),w=2;for(let C=1;C<this.pairs.size();++C){let k=this.pairs.get(C);m+=k.getLeftChar().getChecksumPortion(),w++;let O=k.getRightChar();O!=null&&(m+=O.getChecksumPortion(),w++)}return m%=211,211*(w-4)+m==c.getValue()}static getNextSecondBar(r,c){let u;return r.get(c)?(u=r.getNextUnset(c),u=r.getNextSet(u)):(u=r.getNextSet(c),u=r.getNextUnset(u)),u}retrieveNextPair(r,c,u){let m=c.length%2==0;this.startFromEven&&(m=!m);let w,v=!0,C=-1;do this.findNextPair(r,c,C),w=this.parseFoundFinderPattern(r,u,m),w==null?C=ze.getNextSecondBar(r,this.startEnd[0]):v=!1;while(v);let k=this.decodeDataCharacter(r,w,m,!0);if(!this.isEmptyPair(c)&&c[c.length-1].mustBeLast())throw new H;let O;try{O=this.decodeDataCharacter(r,w,m,!1)}catch(Z){O=null,this.verbose&&console.log(Z)}return new zt(k,O,w,!0)}isEmptyPair(r){return r.length===0}findNextPair(r,c,u){let m=this.getDecodeFinderCounters();m[0]=0,m[1]=0,m[2]=0,m[3]=0;let w=r.getSize(),v;u>=0?v=u:this.isEmptyPair(c)?v=0:v=c[c.length-1].getFinderPattern().getStartEnd()[1];let C=c.length%2!=0;this.startFromEven&&(C=!C);let k=!1;for(;v<w&&(k=!r.get(v),!!k);)v++;let O=0,Z=v;for(let le=v;le<w;le++)if(r.get(le)!=k)m[O]++;else{if(O==3){if(C&&ze.reverseCounters(m),ze.isFinderPattern(m)){this.startEnd[0]=Z,this.startEnd[1]=le;return}C&&ze.reverseCounters(m),Z+=m[0]+m[1],m[0]=m[2],m[1]=m[3],m[2]=0,m[3]=0,O--}else O++;m[O]=1,k=!k}throw new H}static reverseCounters(r){let c=r.length;for(let u=0;u<c/2;++u){let m=r[u];r[u]=r[c-u-1],r[c-u-1]=m}}parseFoundFinderPattern(r,c,u){let m,w,v;if(u){let O=this.startEnd[0]-1;for(;O>=0&&!r.get(O);)O--;O++,m=this.startEnd[0]-O,w=O,v=this.startEnd[1]}else w=this.startEnd[0],v=r.getNextUnset(this.startEnd[1]+1),m=v-this.startEnd[1];let C=this.getDecodeFinderCounters();_.arraycopy(C,0,C,1,C.length-1),C[0]=m;let k;try{k=this.parseFinderValue(C,ze.FINDER_PATTERNS)}catch{return null}return new Fi(k,[w,v],w,v,c)}decodeDataCharacter(r,c,u,m){let w=this.getDataCharacterCounters();for(let jt=0;jt<w.length;jt++)w[jt]=0;if(m)ze.recordPatternInReverse(r,c.getStartEnd()[0],w);else{ze.recordPattern(r,c.getStartEnd()[1],w);for(let jt=0,sn=w.length-1;jt<sn;jt++,sn--){let Bn=w[jt];w[jt]=w[sn],w[sn]=Bn}}let v=17,C=tt.sum(new Int32Array(w))/v,k=(c.getStartEnd()[1]-c.getStartEnd()[0])/15;if(Math.abs(C-k)/k>.3)throw new H;let O=this.getOddCounts(),Z=this.getEvenCounts(),le=this.getOddRoundingErrors(),he=this.getEvenRoundingErrors();for(let jt=0;jt<w.length;jt++){let sn=1*w[jt]/C,Bn=sn+.5;if(Bn<1){if(sn<.3)throw new H;Bn=1}else if(Bn>8){if(sn>8.7)throw new H;Bn=8}let zr=jt/2;(jt&1)==0?(O[zr]=Bn,le[zr]=sn-Bn):(Z[zr]=Bn,he[zr]=sn-Bn)}this.adjustOddEvenCounts(v);let Ee=4*c.getValue()+(u?0:2)+(m?0:1)-1,Ce=0,Ie=0;for(let jt=O.length-1;jt>=0;jt--){if(ze.isNotA1left(c,u,m)){let sn=ze.WEIGHTS[Ee][2*jt];Ie+=O[jt]*sn}Ce+=O[jt]}let Re=0;for(let jt=Z.length-1;jt>=0;jt--)if(ze.isNotA1left(c,u,m)){let sn=ze.WEIGHTS[Ee][2*jt+1];Re+=Z[jt]*sn}let Fe=Ie+Re;if((Ce&1)!=0||Ce>13||Ce<4)throw new H;let Xe=(13-Ce)/2,Je=ze.SYMBOL_WIDEST[Xe],Ye=9-Je,Nt=On.getRSSvalue(O,Je,!0),Ct=On.getRSSvalue(Z,Ye,!1),Fn=ze.EVEN_TOTAL_SUBSET[Xe],ar=ze.GSUM[Xe],pn=Nt*Fn+Ct+ar;return new Mr(pn,Fe)}static isNotA1left(r,c,u){return!(r.getValue()==0&&c&&u)}adjustOddEvenCounts(r){let c=tt.sum(new Int32Array(this.getOddCounts())),u=tt.sum(new Int32Array(this.getEvenCounts())),m=!1,w=!1;c>13?w=!0:c<4&&(m=!0);let v=!1,C=!1;u>13?C=!0:u<4&&(v=!0);let k=c+u-r,O=(c&1)==1,Z=(u&1)==0;if(k==1)if(O){if(Z)throw new H;w=!0}else{if(!Z)throw new H;C=!0}else if(k==-1)if(O){if(Z)throw new H;m=!0}else{if(!Z)throw new H;v=!0}else if(k==0){if(O){if(!Z)throw new H;c<u?(m=!0,C=!0):(w=!0,v=!0)}else if(Z)throw new H}else throw new H;if(m){if(w)throw new H;ze.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(w&&ze.decrement(this.getOddCounts(),this.getOddRoundingErrors()),v){if(C)throw new H;ze.increment(this.getEvenCounts(),this.getOddRoundingErrors())}C&&ze.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}ze.SYMBOL_WIDEST=[7,5,4,3,1],ze.EVEN_TOTAL_SUBSET=[4,20,52,104,204],ze.GSUM=[0,348,1388,2948,3988],ze.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],ze.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],ze.FINDER_PAT_A=0,ze.FINDER_PAT_B=1,ze.FINDER_PAT_C=2,ze.FINDER_PAT_D=3,ze.FINDER_PAT_E=4,ze.FINDER_PAT_F=5,ze.FINDER_PATTERN_SEQUENCES=[[ze.FINDER_PAT_A,ze.FINDER_PAT_A],[ze.FINDER_PAT_A,ze.FINDER_PAT_B,ze.FINDER_PAT_B],[ze.FINDER_PAT_A,ze.FINDER_PAT_C,ze.FINDER_PAT_B,ze.FINDER_PAT_D],[ze.FINDER_PAT_A,ze.FINDER_PAT_E,ze.FINDER_PAT_B,ze.FINDER_PAT_D,ze.FINDER_PAT_C],[ze.FINDER_PAT_A,ze.FINDER_PAT_E,ze.FINDER_PAT_B,ze.FINDER_PAT_D,ze.FINDER_PAT_D,ze.FINDER_PAT_F],[ze.FINDER_PAT_A,ze.FINDER_PAT_E,ze.FINDER_PAT_B,ze.FINDER_PAT_D,ze.FINDER_PAT_E,ze.FINDER_PAT_F,ze.FINDER_PAT_F],[ze.FINDER_PAT_A,ze.FINDER_PAT_A,ze.FINDER_PAT_B,ze.FINDER_PAT_B,ze.FINDER_PAT_C,ze.FINDER_PAT_C,ze.FINDER_PAT_D,ze.FINDER_PAT_D],[ze.FINDER_PAT_A,ze.FINDER_PAT_A,ze.FINDER_PAT_B,ze.FINDER_PAT_B,ze.FINDER_PAT_C,ze.FINDER_PAT_C,ze.FINDER_PAT_D,ze.FINDER_PAT_E,ze.FINDER_PAT_E],[ze.FINDER_PAT_A,ze.FINDER_PAT_A,ze.FINDER_PAT_B,ze.FINDER_PAT_B,ze.FINDER_PAT_C,ze.FINDER_PAT_C,ze.FINDER_PAT_D,ze.FINDER_PAT_E,ze.FINDER_PAT_F,ze.FINDER_PAT_F],[ze.FINDER_PAT_A,ze.FINDER_PAT_A,ze.FINDER_PAT_B,ze.FINDER_PAT_B,ze.FINDER_PAT_C,ze.FINDER_PAT_D,ze.FINDER_PAT_D,ze.FINDER_PAT_E,ze.FINDER_PAT_E,ze.FINDER_PAT_F,ze.FINDER_PAT_F]],ze.MAX_PAIRS=11;class Mo extends Mr{constructor(r,c,u){super(r,c),this.count=0,this.finderPattern=u}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class Yt extends wn{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(r,c,u){const m=this.decodePair(c,!1,r,u);Yt.addOrTally(this.possibleLeftPairs,m),c.reverse();let w=this.decodePair(c,!0,r,u);Yt.addOrTally(this.possibleRightPairs,w),c.reverse();for(let v of this.possibleLeftPairs)if(v.getCount()>1){for(let C of this.possibleRightPairs)if(C.getCount()>1&&Yt.checkChecksum(v,C))return Yt.constructResult(v,C)}throw new H}static addOrTally(r,c){if(c==null)return;let u=!1;for(let m of r)if(m.getValue()===c.getValue()){m.incrementCount(),u=!0;break}u||r.push(c)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(r,c){let u=4537077*r.getValue()+c.getValue(),m=new String(u).toString(),w=new G;for(let O=13-m.length;O>0;O--)w.append("0");w.append(m);let v=0;for(let O=0;O<13;O++){let Z=w.charAt(O).charCodeAt(0)-48;v+=(O&1)===0?3*Z:Z}v=10-v%10,v===10&&(v=0),w.append(v.toString());let C=r.getFinderPattern().getResultPoints(),k=c.getFinderPattern().getResultPoints();return new ce(w.toString(),null,0,[C[0],C[1],k[0],k[1]],me.RSS_14,new Date().getTime())}static checkChecksum(r,c){let u=(r.getChecksumPortion()+16*c.getChecksumPortion())%79,m=9*r.getFinderPattern().getValue()+c.getFinderPattern().getValue();return m>72&&m--,m>8&&m--,u===m}decodePair(r,c,u,m){try{let w=this.findFinderPattern(r,c),v=this.parseFoundFinderPattern(r,u,c,w),C=m==null?null:m.get(U.NEED_RESULT_POINT_CALLBACK);if(C!=null){let Z=(w[0]+w[1])/2;c&&(Z=r.getSize()-1-Z),C.foundPossibleResultPoint(new qe(Z,u))}let k=this.decodeDataCharacter(r,v,!0),O=this.decodeDataCharacter(r,v,!1);return new Mo(1597*k.getValue()+O.getValue(),k.getChecksumPortion()+4*O.getChecksumPortion(),v)}catch{return null}}decodeDataCharacter(r,c,u){let m=this.getDataCharacterCounters();for(let Re=0;Re<m.length;Re++)m[Re]=0;if(u)Le.recordPatternInReverse(r,c.getStartEnd()[0],m);else{Le.recordPattern(r,c.getStartEnd()[1]+1,m);for(let Re=0,Fe=m.length-1;Re<Fe;Re++,Fe--){let Xe=m[Re];m[Re]=m[Fe],m[Fe]=Xe}}let w=u?16:15,v=tt.sum(new Int32Array(m))/w,C=this.getOddCounts(),k=this.getEvenCounts(),O=this.getOddRoundingErrors(),Z=this.getEvenRoundingErrors();for(let Re=0;Re<m.length;Re++){let Fe=m[Re]/v,Xe=Math.floor(Fe+.5);Xe<1?Xe=1:Xe>8&&(Xe=8);let Je=Math.floor(Re/2);(Re&1)===0?(C[Je]=Xe,O[Je]=Fe-Xe):(k[Je]=Xe,Z[Je]=Fe-Xe)}this.adjustOddEvenCounts(u,w);let le=0,he=0;for(let Re=C.length-1;Re>=0;Re--)he*=9,he+=C[Re],le+=C[Re];let Ee=0,Ce=0;for(let Re=k.length-1;Re>=0;Re--)Ee*=9,Ee+=k[Re],Ce+=k[Re];let Ie=he+3*Ee;if(u){if((le&1)!==0||le>12||le<4)throw new H;let Re=(12-le)/2,Fe=Yt.OUTSIDE_ODD_WIDEST[Re],Xe=9-Fe,Je=On.getRSSvalue(C,Fe,!1),Ye=On.getRSSvalue(k,Xe,!0),Nt=Yt.OUTSIDE_EVEN_TOTAL_SUBSET[Re],Ct=Yt.OUTSIDE_GSUM[Re];return new Mr(Je*Nt+Ye+Ct,Ie)}else{if((Ce&1)!==0||Ce>10||Ce<4)throw new H;let Re=(10-Ce)/2,Fe=Yt.INSIDE_ODD_WIDEST[Re],Xe=9-Fe,Je=On.getRSSvalue(C,Fe,!0),Ye=On.getRSSvalue(k,Xe,!1),Nt=Yt.INSIDE_ODD_TOTAL_SUBSET[Re],Ct=Yt.INSIDE_GSUM[Re];return new Mr(Ye*Nt+Je+Ct,Ie)}}findFinderPattern(r,c){let u=this.getDecodeFinderCounters();u[0]=0,u[1]=0,u[2]=0,u[3]=0;let m=r.getSize(),w=!1,v=0;for(;v<m&&(w=!r.get(v),c!==w);)v++;let C=0,k=v;for(let O=v;O<m;O++)if(r.get(O)!==w)u[C]++;else{if(C===3){if(wn.isFinderPattern(u))return[k,O];k+=u[0]+u[1],u[0]=u[2],u[1]=u[3],u[2]=0,u[3]=0,C--}else C++;u[C]=1,w=!w}throw new H}parseFoundFinderPattern(r,c,u,m){let w=r.get(m[0]),v=m[0]-1;for(;v>=0&&w!==r.get(v);)v--;v++;const C=m[0]-v,k=this.getDecodeFinderCounters(),O=new Int32Array(k.length);_.arraycopy(k,0,O,1,k.length-1),O[0]=C;const Z=this.parseFinderValue(O,Yt.FINDER_PATTERNS);let le=v,he=m[1];return u&&(le=r.getSize()-1-le,he=r.getSize()-1-he),new Fi(Z,[v,m[1]],le,he,c)}adjustOddEvenCounts(r,c){let u=tt.sum(new Int32Array(this.getOddCounts())),m=tt.sum(new Int32Array(this.getEvenCounts())),w=!1,v=!1,C=!1,k=!1;r?(u>12?v=!0:u<4&&(w=!0),m>12?k=!0:m<4&&(C=!0)):(u>11?v=!0:u<5&&(w=!0),m>10?k=!0:m<4&&(C=!0));let O=u+m-c,Z=(u&1)===(r?1:0),le=(m&1)===1;if(O===1)if(Z){if(le)throw new H;v=!0}else{if(!le)throw new H;k=!0}else if(O===-1)if(Z){if(le)throw new H;w=!0}else{if(!le)throw new H;C=!0}else if(O===0){if(Z){if(!le)throw new H;u<m?(w=!0,k=!0):(v=!0,C=!0)}else if(le)throw new H}else throw new H;if(w){if(v)throw new H;wn.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(v&&wn.decrement(this.getOddCounts(),this.getOddRoundingErrors()),C){if(k)throw new H;wn.increment(this.getEvenCounts(),this.getOddRoundingErrors())}k&&wn.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}Yt.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],Yt.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],Yt.OUTSIDE_GSUM=[0,161,961,2015,2715],Yt.INSIDE_GSUM=[0,336,1036,1516],Yt.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],Yt.INSIDE_ODD_WIDEST=[2,4,6,8],Yt.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class ni extends Le{constructor(r,c){super(),this.readers=[],this.verbose=c===!0;const u=r?r.get(U.POSSIBLE_FORMATS):null,m=r&&r.get(U.ASSUME_CODE_39_CHECK_DIGIT)!==void 0;u?((u.includes(me.EAN_13)||u.includes(me.UPC_A)||u.includes(me.EAN_8)||u.includes(me.UPC_E))&&this.readers.push(new gs(r)),u.includes(me.CODE_39)&&this.readers.push(new vt(m)),u.includes(me.CODE_128)&&this.readers.push(new Ve),u.includes(me.ITF)&&this.readers.push(new ft),u.includes(me.RSS_14)&&this.readers.push(new Yt),u.includes(me.RSS_EXPANDED)&&this.readers.push(new ze(this.verbose))):(this.readers.push(new gs(r)),this.readers.push(new vt),this.readers.push(new gs(r)),this.readers.push(new Ve),this.readers.push(new ft),this.readers.push(new Yt),this.readers.push(new ze(this.verbose)))}decodeRow(r,c,u){for(let m=0;m<this.readers.length;m++)try{return this.readers[m].decodeRow(r,c,u)}catch{}throw new H}reset(){this.readers.forEach(r=>r.reset())}}class Bo extends te{constructor(r=500,c){super(new ni(c),r,c)}}class Ot{constructor(r,c,u){this.ecCodewords=r,this.ecBlocks=[c],u&&this.ecBlocks.push(u)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class It{constructor(r,c){this.count=r,this.dataCodewords=c}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class Mt{constructor(r,c,u,m,w,v){this.versionNumber=r,this.symbolSizeRows=c,this.symbolSizeColumns=u,this.dataRegionSizeRows=m,this.dataRegionSizeColumns=w,this.ecBlocks=v;let C=0;const k=v.getECCodewords(),O=v.getECBlocks();for(let Z of O)C+=Z.getCount()*(Z.getDataCodewords()+k);this.totalCodewords=C}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(r,c){if((r&1)!==0||(c&1)!==0)throw new P;for(let u of Mt.VERSIONS)if(u.symbolSizeRows===r&&u.symbolSizeColumns===c)return u;throw new P}toString(){return""+this.versionNumber}static buildVersions(){return[new Mt(1,10,10,8,8,new Ot(5,new It(1,3))),new Mt(2,12,12,10,10,new Ot(7,new It(1,5))),new Mt(3,14,14,12,12,new Ot(10,new It(1,8))),new Mt(4,16,16,14,14,new Ot(12,new It(1,12))),new Mt(5,18,18,16,16,new Ot(14,new It(1,18))),new Mt(6,20,20,18,18,new Ot(18,new It(1,22))),new Mt(7,22,22,20,20,new Ot(20,new It(1,30))),new Mt(8,24,24,22,22,new Ot(24,new It(1,36))),new Mt(9,26,26,24,24,new Ot(28,new It(1,44))),new Mt(10,32,32,14,14,new Ot(36,new It(1,62))),new Mt(11,36,36,16,16,new Ot(42,new It(1,86))),new Mt(12,40,40,18,18,new Ot(48,new It(1,114))),new Mt(13,44,44,20,20,new Ot(56,new It(1,144))),new Mt(14,48,48,22,22,new Ot(68,new It(1,174))),new Mt(15,52,52,24,24,new Ot(42,new It(2,102))),new Mt(16,64,64,14,14,new Ot(56,new It(2,140))),new Mt(17,72,72,16,16,new Ot(36,new It(4,92))),new Mt(18,80,80,18,18,new Ot(48,new It(4,114))),new Mt(19,88,88,20,20,new Ot(56,new It(4,144))),new Mt(20,96,96,22,22,new Ot(68,new It(4,174))),new Mt(21,104,104,24,24,new Ot(56,new It(6,136))),new Mt(22,120,120,18,18,new Ot(68,new It(6,175))),new Mt(23,132,132,20,20,new Ot(62,new It(8,163))),new Mt(24,144,144,22,22,new Ot(62,new It(8,156),new It(2,155))),new Mt(25,8,18,6,16,new Ot(7,new It(1,5))),new Mt(26,8,32,6,14,new Ot(11,new It(1,10))),new Mt(27,12,26,10,24,new Ot(14,new It(1,16))),new Mt(28,12,36,10,16,new Ot(18,new It(1,22))),new Mt(29,16,36,14,16,new Ot(24,new It(1,32))),new Mt(30,16,48,14,22,new Ot(28,new It(1,49)))]}}Mt.VERSIONS=Mt.buildVersions();class zn{constructor(r){const c=r.getHeight();if(c<8||c>144||(c&1)!==0)throw new P;this.version=zn.readVersion(r),this.mappingBitMatrix=this.extractDataRegion(r),this.readMappingMatrix=new se(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(r){const c=r.getHeight(),u=r.getWidth();return Mt.getVersionForDimensions(c,u)}readCodewords(){const r=new Int8Array(this.version.getTotalCodewords());let c=0,u=4,m=0;const w=this.mappingBitMatrix.getHeight(),v=this.mappingBitMatrix.getWidth();let C=!1,k=!1,O=!1,Z=!1;do if(u===w&&m===0&&!C)r[c++]=this.readCorner1(w,v)&255,u-=2,m+=2,C=!0;else if(u===w-2&&m===0&&(v&3)!==0&&!k)r[c++]=this.readCorner2(w,v)&255,u-=2,m+=2,k=!0;else if(u===w+4&&m===2&&(v&7)===0&&!O)r[c++]=this.readCorner3(w,v)&255,u-=2,m+=2,O=!0;else if(u===w-2&&m===0&&(v&7)===4&&!Z)r[c++]=this.readCorner4(w,v)&255,u-=2,m+=2,Z=!0;else{do u<w&&m>=0&&!this.readMappingMatrix.get(m,u)&&(r[c++]=this.readUtah(u,m,w,v)&255),u-=2,m+=2;while(u>=0&&m<v);u+=1,m+=3;do u>=0&&m<v&&!this.readMappingMatrix.get(m,u)&&(r[c++]=this.readUtah(u,m,w,v)&255),u+=2,m-=2;while(u<w&&m>=0);u+=3,m+=1}while(u<w||m<v);if(c!==this.version.getTotalCodewords())throw new P;return r}readModule(r,c,u,m){return r<0&&(r+=u,c+=4-(u+4&7)),c<0&&(c+=m,r+=4-(m+4&7)),this.readMappingMatrix.set(c,r),this.mappingBitMatrix.get(c,r)}readUtah(r,c,u,m){let w=0;return this.readModule(r-2,c-2,u,m)&&(w|=1),w<<=1,this.readModule(r-2,c-1,u,m)&&(w|=1),w<<=1,this.readModule(r-1,c-2,u,m)&&(w|=1),w<<=1,this.readModule(r-1,c-1,u,m)&&(w|=1),w<<=1,this.readModule(r-1,c,u,m)&&(w|=1),w<<=1,this.readModule(r,c-2,u,m)&&(w|=1),w<<=1,this.readModule(r,c-1,u,m)&&(w|=1),w<<=1,this.readModule(r,c,u,m)&&(w|=1),w}readCorner1(r,c){let u=0;return this.readModule(r-1,0,r,c)&&(u|=1),u<<=1,this.readModule(r-1,1,r,c)&&(u|=1),u<<=1,this.readModule(r-1,2,r,c)&&(u|=1),u<<=1,this.readModule(0,c-2,r,c)&&(u|=1),u<<=1,this.readModule(0,c-1,r,c)&&(u|=1),u<<=1,this.readModule(1,c-1,r,c)&&(u|=1),u<<=1,this.readModule(2,c-1,r,c)&&(u|=1),u<<=1,this.readModule(3,c-1,r,c)&&(u|=1),u}readCorner2(r,c){let u=0;return this.readModule(r-3,0,r,c)&&(u|=1),u<<=1,this.readModule(r-2,0,r,c)&&(u|=1),u<<=1,this.readModule(r-1,0,r,c)&&(u|=1),u<<=1,this.readModule(0,c-4,r,c)&&(u|=1),u<<=1,this.readModule(0,c-3,r,c)&&(u|=1),u<<=1,this.readModule(0,c-2,r,c)&&(u|=1),u<<=1,this.readModule(0,c-1,r,c)&&(u|=1),u<<=1,this.readModule(1,c-1,r,c)&&(u|=1),u}readCorner3(r,c){let u=0;return this.readModule(r-1,0,r,c)&&(u|=1),u<<=1,this.readModule(r-1,c-1,r,c)&&(u|=1),u<<=1,this.readModule(0,c-3,r,c)&&(u|=1),u<<=1,this.readModule(0,c-2,r,c)&&(u|=1),u<<=1,this.readModule(0,c-1,r,c)&&(u|=1),u<<=1,this.readModule(1,c-3,r,c)&&(u|=1),u<<=1,this.readModule(1,c-2,r,c)&&(u|=1),u<<=1,this.readModule(1,c-1,r,c)&&(u|=1),u}readCorner4(r,c){let u=0;return this.readModule(r-3,0,r,c)&&(u|=1),u<<=1,this.readModule(r-2,0,r,c)&&(u|=1),u<<=1,this.readModule(r-1,0,r,c)&&(u|=1),u<<=1,this.readModule(0,c-2,r,c)&&(u|=1),u<<=1,this.readModule(0,c-1,r,c)&&(u|=1),u<<=1,this.readModule(1,c-1,r,c)&&(u|=1),u<<=1,this.readModule(2,c-1,r,c)&&(u|=1),u<<=1,this.readModule(3,c-1,r,c)&&(u|=1),u}extractDataRegion(r){const c=this.version.getSymbolSizeRows(),u=this.version.getSymbolSizeColumns();if(r.getHeight()!==c)throw new E("Dimension of bitMatrix must match the version size");const m=this.version.getDataRegionSizeRows(),w=this.version.getDataRegionSizeColumns(),v=c/m|0,C=u/w|0,k=v*m,O=C*w,Z=new se(O,k);for(let le=0;le<v;++le){const he=le*m;for(let Ee=0;Ee<C;++Ee){const Ce=Ee*w;for(let Ie=0;Ie<m;++Ie){const Re=le*(m+2)+1+Ie,Fe=he+Ie;for(let Xe=0;Xe<w;++Xe){const Je=Ee*(w+2)+1+Xe;if(r.get(Je,Re)){const Ye=Ce+Xe;Z.set(Ye,Fe)}}}}}return Z}}class Ys{constructor(r,c){this.numDataCodewords=r,this.codewords=c}static getDataBlocks(r,c){const u=c.getECBlocks();let m=0;const w=u.getECBlocks();for(let Ie of w)m+=Ie.getCount();const v=new Array(m);let C=0;for(let Ie of w)for(let Re=0;Re<Ie.getCount();Re++){const Fe=Ie.getDataCodewords(),Xe=u.getECCodewords()+Fe;v[C++]=new Ys(Fe,new Uint8Array(Xe))}const O=v[0].codewords.length-u.getECCodewords(),Z=O-1;let le=0;for(let Ie=0;Ie<Z;Ie++)for(let Re=0;Re<C;Re++)v[Re].codewords[Ie]=r[le++];const he=c.getVersionNumber()===24,Ee=he?8:C;for(let Ie=0;Ie<Ee;Ie++)v[Ie].codewords[O-1]=r[le++];const Ce=v[0].codewords.length;for(let Ie=O;Ie<Ce;Ie++)for(let Re=0;Re<C;Re++){const Fe=he?(Re+8)%C:Re,Xe=he&&Fe>7?Ie-1:Ie;v[Fe].codewords[Xe]=r[le++]}if(le!==r.length)throw new E;return v}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class Qs{constructor(r){this.bytes=r,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(r){if(r<1||r>32||r>this.available())throw new E(""+r);let c=0,u=this.bitOffset,m=this.byteOffset;const w=this.bytes;if(u>0){const v=8-u,C=r<v?r:v,k=v-C,O=255>>8-C<<k;c=(w[m]&O)>>k,r-=C,u+=C,u===8&&(u=0,m++)}if(r>0){for(;r>=8;)c=c<<8|w[m]&255,m++,r-=8;if(r>0){const v=8-r,C=255>>v<<v;c=c<<r|(w[m]&C)>>v,u+=r}}return this.bitOffset=u,this.byteOffset=m,c}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}var dn;(function(oe){oe[oe.PAD_ENCODE=0]="PAD_ENCODE",oe[oe.ASCII_ENCODE=1]="ASCII_ENCODE",oe[oe.C40_ENCODE=2]="C40_ENCODE",oe[oe.TEXT_ENCODE=3]="TEXT_ENCODE",oe[oe.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",oe[oe.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",oe[oe.BASE256_ENCODE=6]="BASE256_ENCODE"})(dn||(dn={}));class rr{static decode(r){const c=new Qs(r),u=new G,m=new G,w=new Array;let v=dn.ASCII_ENCODE;do if(v===dn.ASCII_ENCODE)v=this.decodeAsciiSegment(c,u,m);else{switch(v){case dn.C40_ENCODE:this.decodeC40Segment(c,u);break;case dn.TEXT_ENCODE:this.decodeTextSegment(c,u);break;case dn.ANSIX12_ENCODE:this.decodeAnsiX12Segment(c,u);break;case dn.EDIFACT_ENCODE:this.decodeEdifactSegment(c,u);break;case dn.BASE256_ENCODE:this.decodeBase256Segment(c,u,w);break;default:throw new P}v=dn.ASCII_ENCODE}while(v!==dn.PAD_ENCODE&&c.available()>0);return m.length()>0&&u.append(m.toString()),new Me(r,u.toString(),w.length===0?null:w,null)}static decodeAsciiSegment(r,c,u){let m=!1;do{let w=r.readBits(8);if(w===0)throw new P;if(w<=128)return m&&(w+=128),c.append(String.fromCharCode(w-1)),dn.ASCII_ENCODE;if(w===129)return dn.PAD_ENCODE;if(w<=229){const v=w-130;v<10&&c.append("0"),c.append(""+v)}else switch(w){case 230:return dn.C40_ENCODE;case 231:return dn.BASE256_ENCODE;case 232:c.append("");break;case 233:case 234:break;case 235:m=!0;break;case 236:c.append("[)>05"),u.insert(0,"");break;case 237:c.append("[)>06"),u.insert(0,"");break;case 238:return dn.ANSIX12_ENCODE;case 239:return dn.TEXT_ENCODE;case 240:return dn.EDIFACT_ENCODE;case 241:break;default:if(w!==254||r.available()!==0)throw new P;break}}while(r.available()>0);return dn.ASCII_ENCODE}static decodeC40Segment(r,c){let u=!1;const m=[];let w=0;do{if(r.available()===8)return;const v=r.readBits(8);if(v===254)return;this.parseTwoBytes(v,r.readBits(8),m);for(let C=0;C<3;C++){const k=m[C];switch(w){case 0:if(k<3)w=k+1;else if(k<this.C40_BASIC_SET_CHARS.length){const O=this.C40_BASIC_SET_CHARS[k];u?(c.append(String.fromCharCode(O.charCodeAt(0)+128)),u=!1):c.append(O)}else throw new P;break;case 1:u?(c.append(String.fromCharCode(k+128)),u=!1):c.append(String.fromCharCode(k)),w=0;break;case 2:if(k<this.C40_SHIFT2_SET_CHARS.length){const O=this.C40_SHIFT2_SET_CHARS[k];u?(c.append(String.fromCharCode(O.charCodeAt(0)+128)),u=!1):c.append(O)}else switch(k){case 27:c.append("");break;case 30:u=!0;break;default:throw new P}w=0;break;case 3:u?(c.append(String.fromCharCode(k+224)),u=!1):c.append(String.fromCharCode(k+96)),w=0;break;default:throw new P}}}while(r.available()>0)}static decodeTextSegment(r,c){let u=!1,m=[],w=0;do{if(r.available()===8)return;const v=r.readBits(8);if(v===254)return;this.parseTwoBytes(v,r.readBits(8),m);for(let C=0;C<3;C++){const k=m[C];switch(w){case 0:if(k<3)w=k+1;else if(k<this.TEXT_BASIC_SET_CHARS.length){const O=this.TEXT_BASIC_SET_CHARS[k];u?(c.append(String.fromCharCode(O.charCodeAt(0)+128)),u=!1):c.append(O)}else throw new P;break;case 1:u?(c.append(String.fromCharCode(k+128)),u=!1):c.append(String.fromCharCode(k)),w=0;break;case 2:if(k<this.TEXT_SHIFT2_SET_CHARS.length){const O=this.TEXT_SHIFT2_SET_CHARS[k];u?(c.append(String.fromCharCode(O.charCodeAt(0)+128)),u=!1):c.append(O)}else switch(k){case 27:c.append("");break;case 30:u=!0;break;default:throw new P}w=0;break;case 3:if(k<this.TEXT_SHIFT3_SET_CHARS.length){const O=this.TEXT_SHIFT3_SET_CHARS[k];u?(c.append(String.fromCharCode(O.charCodeAt(0)+128)),u=!1):c.append(O),w=0}else throw new P;break;default:throw new P}}}while(r.available()>0)}static decodeAnsiX12Segment(r,c){const u=[];do{if(r.available()===8)return;const m=r.readBits(8);if(m===254)return;this.parseTwoBytes(m,r.readBits(8),u);for(let w=0;w<3;w++){const v=u[w];switch(v){case 0:c.append("\r");break;case 1:c.append("*");break;case 2:c.append(">");break;case 3:c.append(" ");break;default:if(v<14)c.append(String.fromCharCode(v+44));else if(v<40)c.append(String.fromCharCode(v+51));else throw new P;break}}}while(r.available()>0)}static parseTwoBytes(r,c,u){let m=(r<<8)+c-1,w=Math.floor(m/1600);u[0]=w,m-=w*1600,w=Math.floor(m/40),u[1]=w,u[2]=m-w*40}static decodeEdifactSegment(r,c){do{if(r.available()<=16)return;for(let u=0;u<4;u++){let m=r.readBits(6);if(m===31){const w=8-r.getBitOffset();w!==8&&r.readBits(w);return}(m&32)===0&&(m|=64),c.append(String.fromCharCode(m))}}while(r.available()>0)}static decodeBase256Segment(r,c,u){let m=1+r.getByteOffset();const w=this.unrandomize255State(r.readBits(8),m++);let v;if(w===0?v=r.available()/8|0:w<250?v=w:v=250*(w-249)+this.unrandomize255State(r.readBits(8),m++),v<0)throw new P;const C=new Uint8Array(v);for(let k=0;k<v;k++){if(r.available()<8)throw new P;C[k]=this.unrandomize255State(r.readBits(8),m++)}u.push(C);try{c.append($.decode(C,V.ISO88591))}catch(k){throw new Ze("Platform does not support required encoding: "+k.message)}}static unrandomize255State(r,c){const u=149*c%255+1,m=r-u;return m>=0?m:m+256}}rr.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],rr.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],rr.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],rr.TEXT_SHIFT2_SET_CHARS=rr.C40_SHIFT2_SET_CHARS,rr.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",""];class ys{constructor(){this.rsDecoder=new ot(Pe.DATA_MATRIX_FIELD_256)}decode(r){const c=new zn(r),u=c.getVersion(),m=c.readCodewords(),w=Ys.getDataBlocks(m,u);let v=0;for(let O of w)v+=O.getNumDataCodewords();const C=new Uint8Array(v),k=w.length;for(let O=0;O<k;O++){const Z=w[O],le=Z.getCodewords(),he=Z.getNumDataCodewords();this.correctErrors(le,he);for(let Ee=0;Ee<he;Ee++)C[Ee*k+O]=le[Ee]}return rr.decode(C)}correctErrors(r,c){const u=new Int32Array(r);try{this.rsDecoder.decode(u,r.length-c)}catch{throw new S}for(let m=0;m<c;m++)r[m]=u[m]}}class Qt{constructor(r){this.image=r,this.rectangleDetector=new Vt(this.image)}detect(){const r=this.rectangleDetector.detect();let c=this.detectSolid1(r);if(c=this.detectSolid2(c),c[3]=this.correctTopRight(c),!c[3])throw new H;c=this.shiftToModuleCenter(c);const u=c[0],m=c[1],w=c[2],v=c[3];let C=this.transitionsBetween(u,v)+1,k=this.transitionsBetween(w,v)+1;(C&1)===1&&(C+=1),(k&1)===1&&(k+=1),4*C<7*k&&4*k<7*C&&(C=k=Math.max(C,k));let O=Qt.sampleGrid(this.image,u,m,w,v,C,k);return new Et(O,[u,m,w,v])}static shiftPoint(r,c,u){let m=(c.getX()-r.getX())/(u+1),w=(c.getY()-r.getY())/(u+1);return new qe(r.getX()+m,r.getY()+w)}static moveAway(r,c,u){let m=r.getX(),w=r.getY();return m<c?m-=1:m+=1,w<u?w-=1:w+=1,new qe(m,w)}detectSolid1(r){let c=r[0],u=r[1],m=r[3],w=r[2],v=this.transitionsBetween(c,u),C=this.transitionsBetween(u,m),k=this.transitionsBetween(m,w),O=this.transitionsBetween(w,c),Z=v,le=[w,c,u,m];return Z>C&&(Z=C,le[0]=c,le[1]=u,le[2]=m,le[3]=w),Z>k&&(Z=k,le[0]=u,le[1]=m,le[2]=w,le[3]=c),Z>O&&(le[0]=m,le[1]=w,le[2]=c,le[3]=u),le}detectSolid2(r){let c=r[0],u=r[1],m=r[2],w=r[3],v=this.transitionsBetween(c,w),C=Qt.shiftPoint(u,m,(v+1)*4),k=Qt.shiftPoint(m,u,(v+1)*4),O=this.transitionsBetween(C,c),Z=this.transitionsBetween(k,w);return O<Z?(r[0]=c,r[1]=u,r[2]=m,r[3]=w):(r[0]=u,r[1]=m,r[2]=w,r[3]=c),r}correctTopRight(r){let c=r[0],u=r[1],m=r[2],w=r[3],v=this.transitionsBetween(c,w),C=this.transitionsBetween(u,w),k=Qt.shiftPoint(c,u,(C+1)*4),O=Qt.shiftPoint(m,u,(v+1)*4);v=this.transitionsBetween(k,w),C=this.transitionsBetween(O,w);let Z=new qe(w.getX()+(m.getX()-u.getX())/(v+1),w.getY()+(m.getY()-u.getY())/(v+1)),le=new qe(w.getX()+(c.getX()-u.getX())/(C+1),w.getY()+(c.getY()-u.getY())/(C+1));if(!this.isValid(Z))return this.isValid(le)?le:null;if(!this.isValid(le))return Z;let he=this.transitionsBetween(k,Z)+this.transitionsBetween(O,Z),Ee=this.transitionsBetween(k,le)+this.transitionsBetween(O,le);return he>Ee?Z:le}shiftToModuleCenter(r){let c=r[0],u=r[1],m=r[2],w=r[3],v=this.transitionsBetween(c,w)+1,C=this.transitionsBetween(m,w)+1,k=Qt.shiftPoint(c,u,C*4),O=Qt.shiftPoint(m,u,v*4);v=this.transitionsBetween(k,w)+1,C=this.transitionsBetween(O,w)+1,(v&1)===1&&(v+=1),(C&1)===1&&(C+=1);let Z=(c.getX()+u.getX()+m.getX()+w.getX())/4,le=(c.getY()+u.getY()+m.getY()+w.getY())/4;c=Qt.moveAway(c,Z,le),u=Qt.moveAway(u,Z,le),m=Qt.moveAway(m,Z,le),w=Qt.moveAway(w,Z,le);let he,Ee;return k=Qt.shiftPoint(c,u,C*4),k=Qt.shiftPoint(k,w,v*4),he=Qt.shiftPoint(u,c,C*4),he=Qt.shiftPoint(he,m,v*4),O=Qt.shiftPoint(m,w,C*4),O=Qt.shiftPoint(O,u,v*4),Ee=Qt.shiftPoint(w,m,C*4),Ee=Qt.shiftPoint(Ee,c,v*4),[k,he,O,Ee]}isValid(r){return r.getX()>=0&&r.getX()<this.image.getWidth()&&r.getY()>0&&r.getY()<this.image.getHeight()}static sampleGrid(r,c,u,m,w,v,C){return z.getInstance().sampleGrid(r,v,C,.5,.5,v-.5,.5,v-.5,C-.5,.5,C-.5,c.getX(),c.getY(),w.getX(),w.getY(),m.getX(),m.getY(),u.getX(),u.getY())}transitionsBetween(r,c){let u=Math.trunc(r.getX()),m=Math.trunc(r.getY()),w=Math.trunc(c.getX()),v=Math.trunc(c.getY()),C=Math.abs(v-m)>Math.abs(w-u);if(C){let Ie=u;u=m,m=Ie,Ie=w,w=v,v=Ie}let k=Math.abs(w-u),O=Math.abs(v-m),Z=-k/2,le=m<v?1:-1,he=u<w?1:-1,Ee=0,Ce=this.image.get(C?m:u,C?u:m);for(let Ie=u,Re=m;Ie!==w;Ie+=he){let Fe=this.image.get(C?Re:Ie,C?Ie:Re);if(Fe!==Ce&&(Ee++,Ce=Fe),Z+=O,Z>0){if(Re===v)break;Re+=le,Z-=k}}return Ee}}class ir{constructor(){this.decoder=new ys}decode(r,c=null){let u,m;if(c!=null&&c.has(U.PURE_BARCODE)){const O=ir.extractPureBits(r.getBlackMatrix());u=this.decoder.decode(O),m=ir.NO_POINTS}else{const O=new Qt(r.getBlackMatrix()).detect();u=this.decoder.decode(O.getBits()),m=O.getPoints()}const w=u.getRawBytes(),v=new ce(u.getText(),w,8*w.length,m,me.DATA_MATRIX,_.currentTimeMillis()),C=u.getByteSegments();C!=null&&v.putMetadata(be.BYTE_SEGMENTS,C);const k=u.getECLevel();return k!=null&&v.putMetadata(be.ERROR_CORRECTION_LEVEL,k),v}reset(){}static extractPureBits(r){const c=r.getTopLeftOnBit(),u=r.getBottomRightOnBit();if(c==null||u==null)throw new H;const m=this.moduleSize(c,r);let w=c[1];const v=u[1];let C=c[0];const O=(u[0]-C+1)/m,Z=(v-w+1)/m;if(O<=0||Z<=0)throw new H;const le=m/2;w+=le,C+=le;const he=new se(O,Z);for(let Ee=0;Ee<Z;Ee++){const Ce=w+Ee*m;for(let Ie=0;Ie<O;Ie++)r.get(C+Ie*m,Ce)&&he.set(Ie,Ee)}return he}static moduleSize(r,c){const u=c.getWidth();let m=r[0];const w=r[1];for(;m<u&&c.get(m,w);)m++;if(m===u)throw new H;const v=m-r[0];if(v===0)throw new H;return v}}ir.NO_POINTS=[];class La extends te{constructor(r=500){super(new ir,r)}}var ri;(function(oe){oe[oe.L=0]="L",oe[oe.M=1]="M",oe[oe.Q=2]="Q",oe[oe.H=3]="H"})(ri||(ri={}));class Wt{constructor(r,c,u){this.value=r,this.stringValue=c,this.bits=u,Wt.FOR_BITS.set(u,this),Wt.FOR_VALUE.set(r,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(r){switch(r){case"L":return Wt.L;case"M":return Wt.M;case"Q":return Wt.Q;case"H":return Wt.H;default:throw new x(r+"not available")}}toString(){return this.stringValue}equals(r){if(!(r instanceof Wt))return!1;const c=r;return this.value===c.value}static forBits(r){if(r<0||r>=Wt.FOR_BITS.size)throw new E;return Wt.FOR_BITS.get(r)}}Wt.FOR_BITS=new Map,Wt.FOR_VALUE=new Map,Wt.L=new Wt(ri.L,"L",1),Wt.M=new Wt(ri.M,"M",0),Wt.Q=new Wt(ri.Q,"Q",3),Wt.H=new Wt(ri.H,"H",2);class xn{constructor(r){this.errorCorrectionLevel=Wt.forBits(r>>3&3),this.dataMask=r&7}static numBitsDiffering(r,c){return M.bitCount(r^c)}static decodeFormatInformation(r,c){const u=xn.doDecodeFormatInformation(r,c);return u!==null?u:xn.doDecodeFormatInformation(r^xn.FORMAT_INFO_MASK_QR,c^xn.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(r,c){let u=Number.MAX_SAFE_INTEGER,m=0;for(const w of xn.FORMAT_INFO_DECODE_LOOKUP){const v=w[0];if(v===r||v===c)return new xn(w[1]);let C=xn.numBitsDiffering(r,v);C<u&&(m=w[1],u=C),r!==c&&(C=xn.numBitsDiffering(c,v),C<u&&(m=w[1],u=C))}return u<=3?new xn(m):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(r){if(!(r instanceof xn))return!1;const c=r;return this.errorCorrectionLevel===c.errorCorrectionLevel&&this.dataMask===c.dataMask}}xn.FORMAT_INFO_MASK_QR=21522,xn.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class Ne{constructor(r,...c){this.ecCodewordsPerBlock=r,this.ecBlocks=c}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let r=0;const c=this.ecBlocks;for(const u of c)r+=u.getCount();return r}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class we{constructor(r,c){this.count=r,this.dataCodewords=c}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class ht{constructor(r,c,...u){this.versionNumber=r,this.alignmentPatternCenters=c,this.ecBlocks=u;let m=0;const w=u[0].getECCodewordsPerBlock(),v=u[0].getECBlocks();for(const C of v)m+=C.getCount()*(C.getDataCodewords()+w);this.totalCodewords=m}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(r){return this.ecBlocks[r.getValue()]}static getProvisionalVersionForDimension(r){if(r%4!==1)throw new P;try{return this.getVersionForNumber((r-17)/4)}catch{throw new P}}static getVersionForNumber(r){if(r<1||r>40)throw new E;return ht.VERSIONS[r-1]}static decodeVersionInformation(r){let c=Number.MAX_SAFE_INTEGER,u=0;for(let m=0;m<ht.VERSION_DECODE_INFO.length;m++){const w=ht.VERSION_DECODE_INFO[m];if(w===r)return ht.getVersionForNumber(m+7);const v=xn.numBitsDiffering(r,w);v<c&&(u=m+7,c=v)}return c<=3?ht.getVersionForNumber(u):null}buildFunctionPattern(){const r=this.getDimensionForVersion(),c=new se(r);c.setRegion(0,0,9,9),c.setRegion(r-8,0,8,9),c.setRegion(0,r-8,9,8);const u=this.alignmentPatternCenters.length;for(let m=0;m<u;m++){const w=this.alignmentPatternCenters[m]-2;for(let v=0;v<u;v++)m===0&&(v===0||v===u-1)||m===u-1&&v===0||c.setRegion(this.alignmentPatternCenters[v]-2,w,5,5)}return c.setRegion(6,9,1,r-17),c.setRegion(9,6,r-17,1),this.versionNumber>6&&(c.setRegion(r-11,0,3,6),c.setRegion(0,r-11,6,3)),c}toString(){return""+this.versionNumber}}ht.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),ht.VERSIONS=[new ht(1,new Int32Array(0),new Ne(7,new we(1,19)),new Ne(10,new we(1,16)),new Ne(13,new we(1,13)),new Ne(17,new we(1,9))),new ht(2,Int32Array.from([6,18]),new Ne(10,new we(1,34)),new Ne(16,new we(1,28)),new Ne(22,new we(1,22)),new Ne(28,new we(1,16))),new ht(3,Int32Array.from([6,22]),new Ne(15,new we(1,55)),new Ne(26,new we(1,44)),new Ne(18,new we(2,17)),new Ne(22,new we(2,13))),new ht(4,Int32Array.from([6,26]),new Ne(20,new we(1,80)),new Ne(18,new we(2,32)),new Ne(26,new we(2,24)),new Ne(16,new we(4,9))),new ht(5,Int32Array.from([6,30]),new Ne(26,new we(1,108)),new Ne(24,new we(2,43)),new Ne(18,new we(2,15),new we(2,16)),new Ne(22,new we(2,11),new we(2,12))),new ht(6,Int32Array.from([6,34]),new Ne(18,new we(2,68)),new Ne(16,new we(4,27)),new Ne(24,new we(4,19)),new Ne(28,new we(4,15))),new ht(7,Int32Array.from([6,22,38]),new Ne(20,new we(2,78)),new Ne(18,new we(4,31)),new Ne(18,new we(2,14),new we(4,15)),new Ne(26,new we(4,13),new we(1,14))),new ht(8,Int32Array.from([6,24,42]),new Ne(24,new we(2,97)),new Ne(22,new we(2,38),new we(2,39)),new Ne(22,new we(4,18),new we(2,19)),new Ne(26,new we(4,14),new we(2,15))),new ht(9,Int32Array.from([6,26,46]),new Ne(30,new we(2,116)),new Ne(22,new we(3,36),new we(2,37)),new Ne(20,new we(4,16),new we(4,17)),new Ne(24,new we(4,12),new we(4,13))),new ht(10,Int32Array.from([6,28,50]),new Ne(18,new we(2,68),new we(2,69)),new Ne(26,new we(4,43),new we(1,44)),new Ne(24,new we(6,19),new we(2,20)),new Ne(28,new we(6,15),new we(2,16))),new ht(11,Int32Array.from([6,30,54]),new Ne(20,new we(4,81)),new Ne(30,new we(1,50),new we(4,51)),new Ne(28,new we(4,22),new we(4,23)),new Ne(24,new we(3,12),new we(8,13))),new ht(12,Int32Array.from([6,32,58]),new Ne(24,new we(2,92),new we(2,93)),new Ne(22,new we(6,36),new we(2,37)),new Ne(26,new we(4,20),new we(6,21)),new Ne(28,new we(7,14),new we(4,15))),new ht(13,Int32Array.from([6,34,62]),new Ne(26,new we(4,107)),new Ne(22,new we(8,37),new we(1,38)),new Ne(24,new we(8,20),new we(4,21)),new Ne(22,new we(12,11),new we(4,12))),new ht(14,Int32Array.from([6,26,46,66]),new Ne(30,new we(3,115),new we(1,116)),new Ne(24,new we(4,40),new we(5,41)),new Ne(20,new we(11,16),new we(5,17)),new Ne(24,new we(11,12),new we(5,13))),new ht(15,Int32Array.from([6,26,48,70]),new Ne(22,new we(5,87),new we(1,88)),new Ne(24,new we(5,41),new we(5,42)),new Ne(30,new we(5,24),new we(7,25)),new Ne(24,new we(11,12),new we(7,13))),new ht(16,Int32Array.from([6,26,50,74]),new Ne(24,new we(5,98),new we(1,99)),new Ne(28,new we(7,45),new we(3,46)),new Ne(24,new we(15,19),new we(2,20)),new Ne(30,new we(3,15),new we(13,16))),new ht(17,Int32Array.from([6,30,54,78]),new Ne(28,new we(1,107),new we(5,108)),new Ne(28,new we(10,46),new we(1,47)),new Ne(28,new we(1,22),new we(15,23)),new Ne(28,new we(2,14),new we(17,15))),new ht(18,Int32Array.from([6,30,56,82]),new Ne(30,new we(5,120),new we(1,121)),new Ne(26,new we(9,43),new we(4,44)),new Ne(28,new we(17,22),new we(1,23)),new Ne(28,new we(2,14),new we(19,15))),new ht(19,Int32Array.from([6,30,58,86]),new Ne(28,new we(3,113),new we(4,114)),new Ne(26,new we(3,44),new we(11,45)),new Ne(26,new we(17,21),new we(4,22)),new Ne(26,new we(9,13),new we(16,14))),new ht(20,Int32Array.from([6,34,62,90]),new Ne(28,new we(3,107),new we(5,108)),new Ne(26,new we(3,41),new we(13,42)),new Ne(30,new we(15,24),new we(5,25)),new Ne(28,new we(15,15),new we(10,16))),new ht(21,Int32Array.from([6,28,50,72,94]),new Ne(28,new we(4,116),new we(4,117)),new Ne(26,new we(17,42)),new Ne(28,new we(17,22),new we(6,23)),new Ne(30,new we(19,16),new we(6,17))),new ht(22,Int32Array.from([6,26,50,74,98]),new Ne(28,new we(2,111),new we(7,112)),new Ne(28,new we(17,46)),new Ne(30,new we(7,24),new we(16,25)),new Ne(24,new we(34,13))),new ht(23,Int32Array.from([6,30,54,78,102]),new Ne(30,new we(4,121),new we(5,122)),new Ne(28,new we(4,47),new we(14,48)),new Ne(30,new we(11,24),new we(14,25)),new Ne(30,new we(16,15),new we(14,16))),new ht(24,Int32Array.from([6,28,54,80,106]),new Ne(30,new we(6,117),new we(4,118)),new Ne(28,new we(6,45),new we(14,46)),new Ne(30,new we(11,24),new we(16,25)),new Ne(30,new we(30,16),new we(2,17))),new ht(25,Int32Array.from([6,32,58,84,110]),new Ne(26,new we(8,106),new we(4,107)),new Ne(28,new we(8,47),new we(13,48)),new Ne(30,new we(7,24),new we(22,25)),new Ne(30,new we(22,15),new we(13,16))),new ht(26,Int32Array.from([6,30,58,86,114]),new Ne(28,new we(10,114),new we(2,115)),new Ne(28,new we(19,46),new we(4,47)),new Ne(28,new we(28,22),new we(6,23)),new Ne(30,new we(33,16),new we(4,17))),new ht(27,Int32Array.from([6,34,62,90,118]),new Ne(30,new we(8,122),new we(4,123)),new Ne(28,new we(22,45),new we(3,46)),new Ne(30,new we(8,23),new we(26,24)),new Ne(30,new we(12,15),new we(28,16))),new ht(28,Int32Array.from([6,26,50,74,98,122]),new Ne(30,new we(3,117),new we(10,118)),new Ne(28,new we(3,45),new we(23,46)),new Ne(30,new we(4,24),new we(31,25)),new Ne(30,new we(11,15),new we(31,16))),new ht(29,Int32Array.from([6,30,54,78,102,126]),new Ne(30,new we(7,116),new we(7,117)),new Ne(28,new we(21,45),new we(7,46)),new Ne(30,new we(1,23),new we(37,24)),new Ne(30,new we(19,15),new we(26,16))),new ht(30,Int32Array.from([6,26,52,78,104,130]),new Ne(30,new we(5,115),new we(10,116)),new Ne(28,new we(19,47),new we(10,48)),new Ne(30,new we(15,24),new we(25,25)),new Ne(30,new we(23,15),new we(25,16))),new ht(31,Int32Array.from([6,30,56,82,108,134]),new Ne(30,new we(13,115),new we(3,116)),new Ne(28,new we(2,46),new we(29,47)),new Ne(30,new we(42,24),new we(1,25)),new Ne(30,new we(23,15),new we(28,16))),new ht(32,Int32Array.from([6,34,60,86,112,138]),new Ne(30,new we(17,115)),new Ne(28,new we(10,46),new we(23,47)),new Ne(30,new we(10,24),new we(35,25)),new Ne(30,new we(19,15),new we(35,16))),new ht(33,Int32Array.from([6,30,58,86,114,142]),new Ne(30,new we(17,115),new we(1,116)),new Ne(28,new we(14,46),new we(21,47)),new Ne(30,new we(29,24),new we(19,25)),new Ne(30,new we(11,15),new we(46,16))),new ht(34,Int32Array.from([6,34,62,90,118,146]),new Ne(30,new we(13,115),new we(6,116)),new Ne(28,new we(14,46),new we(23,47)),new Ne(30,new we(44,24),new we(7,25)),new Ne(30,new we(59,16),new we(1,17))),new ht(35,Int32Array.from([6,30,54,78,102,126,150]),new Ne(30,new we(12,121),new we(7,122)),new Ne(28,new we(12,47),new we(26,48)),new Ne(30,new we(39,24),new we(14,25)),new Ne(30,new we(22,15),new we(41,16))),new ht(36,Int32Array.from([6,24,50,76,102,128,154]),new Ne(30,new we(6,121),new we(14,122)),new Ne(28,new we(6,47),new we(34,48)),new Ne(30,new we(46,24),new we(10,25)),new Ne(30,new we(2,15),new we(64,16))),new ht(37,Int32Array.from([6,28,54,80,106,132,158]),new Ne(30,new we(17,122),new we(4,123)),new Ne(28,new we(29,46),new we(14,47)),new Ne(30,new we(49,24),new we(10,25)),new Ne(30,new we(24,15),new we(46,16))),new ht(38,Int32Array.from([6,32,58,84,110,136,162]),new Ne(30,new we(4,122),new we(18,123)),new Ne(28,new we(13,46),new we(32,47)),new Ne(30,new we(48,24),new we(14,25)),new Ne(30,new we(42,15),new we(32,16))),new ht(39,Int32Array.from([6,26,54,82,110,138,166]),new Ne(30,new we(20,117),new we(4,118)),new Ne(28,new we(40,47),new we(7,48)),new Ne(30,new we(43,24),new we(22,25)),new Ne(30,new we(10,15),new we(67,16))),new ht(40,Int32Array.from([6,30,58,86,114,142,170]),new Ne(30,new we(19,118),new we(6,119)),new Ne(28,new we(18,47),new we(31,48)),new Ne(30,new we(34,24),new we(34,25)),new Ne(30,new we(20,15),new we(61,16)))];var ln;(function(oe){oe[oe.DATA_MASK_000=0]="DATA_MASK_000",oe[oe.DATA_MASK_001=1]="DATA_MASK_001",oe[oe.DATA_MASK_010=2]="DATA_MASK_010",oe[oe.DATA_MASK_011=3]="DATA_MASK_011",oe[oe.DATA_MASK_100=4]="DATA_MASK_100",oe[oe.DATA_MASK_101=5]="DATA_MASK_101",oe[oe.DATA_MASK_110=6]="DATA_MASK_110",oe[oe.DATA_MASK_111=7]="DATA_MASK_111"})(ln||(ln={}));class Tt{constructor(r,c){this.value=r,this.isMasked=c}unmaskBitMatrix(r,c){for(let u=0;u<c;u++)for(let m=0;m<c;m++)this.isMasked(u,m)&&r.flip(m,u)}}Tt.values=new Map([[ln.DATA_MASK_000,new Tt(ln.DATA_MASK_000,(oe,r)=>(oe+r&1)===0)],[ln.DATA_MASK_001,new Tt(ln.DATA_MASK_001,(oe,r)=>(oe&1)===0)],[ln.DATA_MASK_010,new Tt(ln.DATA_MASK_010,(oe,r)=>r%3===0)],[ln.DATA_MASK_011,new Tt(ln.DATA_MASK_011,(oe,r)=>(oe+r)%3===0)],[ln.DATA_MASK_100,new Tt(ln.DATA_MASK_100,(oe,r)=>(Math.floor(oe/2)+Math.floor(r/3)&1)===0)],[ln.DATA_MASK_101,new Tt(ln.DATA_MASK_101,(oe,r)=>oe*r%6===0)],[ln.DATA_MASK_110,new Tt(ln.DATA_MASK_110,(oe,r)=>oe*r%6<3)],[ln.DATA_MASK_111,new Tt(ln.DATA_MASK_111,(oe,r)=>(oe+r+oe*r%3&1)===0)]]);class Po{constructor(r){const c=r.getHeight();if(c<21||(c&3)!==1)throw new P;this.bitMatrix=r}readFormatInformation(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==void 0)return this.parsedFormatInfo;let r=0;for(let w=0;w<6;w++)r=this.copyBit(w,8,r);r=this.copyBit(7,8,r),r=this.copyBit(8,8,r),r=this.copyBit(8,7,r);for(let w=5;w>=0;w--)r=this.copyBit(8,w,r);const c=this.bitMatrix.getHeight();let u=0;const m=c-7;for(let w=c-1;w>=m;w--)u=this.copyBit(8,w,u);for(let w=c-8;w<c;w++)u=this.copyBit(w,8,u);if(this.parsedFormatInfo=xn.decodeFormatInformation(r,u),this.parsedFormatInfo!==null)return this.parsedFormatInfo;throw new P}readVersion(){if(this.parsedVersion!==null&&this.parsedVersion!==void 0)return this.parsedVersion;const r=this.bitMatrix.getHeight(),c=Math.floor((r-17)/4);if(c<=6)return ht.getVersionForNumber(c);let u=0;const m=r-11;for(let v=5;v>=0;v--)for(let C=r-9;C>=m;C--)u=this.copyBit(C,v,u);let w=ht.decodeVersionInformation(u);if(w!==null&&w.getDimensionForVersion()===r)return this.parsedVersion=w,w;u=0;for(let v=5;v>=0;v--)for(let C=r-9;C>=m;C--)u=this.copyBit(v,C,u);if(w=ht.decodeVersionInformation(u),w!==null&&w.getDimensionForVersion()===r)return this.parsedVersion=w,w;throw new P}copyBit(r,c,u){return(this.isMirror?this.bitMatrix.get(c,r):this.bitMatrix.get(r,c))?u<<1|1:u<<1}readCodewords(){const r=this.readFormatInformation(),c=this.readVersion(),u=Tt.values.get(r.getDataMask()),m=this.bitMatrix.getHeight();u.unmaskBitMatrix(this.bitMatrix,m);const w=c.buildFunctionPattern();let v=!0;const C=new Uint8Array(c.getTotalCodewords());let k=0,O=0,Z=0;for(let le=m-1;le>0;le-=2){le===6&&le--;for(let he=0;he<m;he++){const Ee=v?m-1-he:he;for(let Ce=0;Ce<2;Ce++)w.get(le-Ce,Ee)||(Z++,O<<=1,this.bitMatrix.get(le-Ce,Ee)&&(O|=1),Z===8&&(C[k++]=O,Z=0,O=0))}v=!v}if(k!==c.getTotalCodewords())throw new P;return C}remask(){if(this.parsedFormatInfo===null)return;const r=Tt.values[this.parsedFormatInfo.getDataMask()],c=this.bitMatrix.getHeight();r.unmaskBitMatrix(this.bitMatrix,c)}setMirror(r){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=r}mirror(){const r=this.bitMatrix;for(let c=0,u=r.getWidth();c<u;c++)for(let m=c+1,w=r.getHeight();m<w;m++)r.get(c,m)!==r.get(m,c)&&(r.flip(m,c),r.flip(c,m))}}class ws{constructor(r,c){this.numDataCodewords=r,this.codewords=c}static getDataBlocks(r,c,u){if(r.length!==c.getTotalCodewords())throw new E;const m=c.getECBlocksForLevel(u);let w=0;const v=m.getECBlocks();for(const Ce of v)w+=Ce.getCount();const C=new Array(w);let k=0;for(const Ce of v)for(let Ie=0;Ie<Ce.getCount();Ie++){const Re=Ce.getDataCodewords(),Fe=m.getECCodewordsPerBlock()+Re;C[k++]=new ws(Re,new Uint8Array(Fe))}const O=C[0].codewords.length;let Z=C.length-1;for(;Z>=0&&C[Z].codewords.length!==O;)Z--;Z++;const le=O-m.getECCodewordsPerBlock();let he=0;for(let Ce=0;Ce<le;Ce++)for(let Ie=0;Ie<k;Ie++)C[Ie].codewords[Ce]=r[he++];for(let Ce=Z;Ce<k;Ce++)C[Ce].codewords[le]=r[he++];const Ee=C[0].codewords.length;for(let Ce=le;Ce<Ee;Ce++)for(let Ie=0;Ie<k;Ie++){const Re=Ie<Z?Ce:Ce+1;C[Ie].codewords[Re]=r[he++]}return C}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}var Un;(function(oe){oe[oe.TERMINATOR=0]="TERMINATOR",oe[oe.NUMERIC=1]="NUMERIC",oe[oe.ALPHANUMERIC=2]="ALPHANUMERIC",oe[oe.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",oe[oe.BYTE=4]="BYTE",oe[oe.ECI=5]="ECI",oe[oe.KANJI=6]="KANJI",oe[oe.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",oe[oe.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",oe[oe.HANZI=9]="HANZI"})(Un||(Un={}));class pt{constructor(r,c,u,m){this.value=r,this.stringValue=c,this.characterCountBitsForVersions=u,this.bits=m,pt.FOR_BITS.set(m,this),pt.FOR_VALUE.set(r,this)}static forBits(r){const c=pt.FOR_BITS.get(r);if(c===void 0)throw new E;return c}getCharacterCountBits(r){const c=r.getVersionNumber();let u;return c<=9?u=0:c<=26?u=1:u=2,this.characterCountBitsForVersions[u]}getValue(){return this.value}getBits(){return this.bits}equals(r){if(!(r instanceof pt))return!1;const c=r;return this.value===c.value}toString(){return this.stringValue}}pt.FOR_BITS=new Map,pt.FOR_VALUE=new Map,pt.TERMINATOR=new pt(Un.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),pt.NUMERIC=new pt(Un.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),pt.ALPHANUMERIC=new pt(Un.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),pt.STRUCTURED_APPEND=new pt(Un.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),pt.BYTE=new pt(Un.BYTE,"BYTE",Int32Array.from([8,16,16]),4),pt.ECI=new pt(Un.ECI,"ECI",Int32Array.from([0,0,0]),7),pt.KANJI=new pt(Un.KANJI,"KANJI",Int32Array.from([8,10,12]),8),pt.FNC1_FIRST_POSITION=new pt(Un.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),pt.FNC1_SECOND_POSITION=new pt(Un.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),pt.HANZI=new pt(Un.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class Xt{static decode(r,c,u,m){const w=new Qs(r);let v=new G;const C=new Array;let k=-1,O=-1;try{let Z=null,le=!1,he;do{if(w.available()<4)he=pt.TERMINATOR;else{const Ee=w.readBits(4);he=pt.forBits(Ee)}switch(he){case pt.TERMINATOR:break;case pt.FNC1_FIRST_POSITION:case pt.FNC1_SECOND_POSITION:le=!0;break;case pt.STRUCTURED_APPEND:if(w.available()<16)throw new P;k=w.readBits(8),O=w.readBits(8);break;case pt.ECI:const Ee=Xt.parseECIValue(w);if(Z=j.getCharacterSetECIByValue(Ee),Z===null)throw new P;break;case pt.HANZI:const Ce=w.readBits(4),Ie=w.readBits(he.getCharacterCountBits(c));Ce===Xt.GB2312_SUBSET&&Xt.decodeHanziSegment(w,v,Ie);break;default:const Re=w.readBits(he.getCharacterCountBits(c));switch(he){case pt.NUMERIC:Xt.decodeNumericSegment(w,v,Re);break;case pt.ALPHANUMERIC:Xt.decodeAlphanumericSegment(w,v,Re,le);break;case pt.BYTE:Xt.decodeByteSegment(w,v,Re,Z,C,m);break;case pt.KANJI:Xt.decodeKanjiSegment(w,v,Re);break;default:throw new P}break}}while(he!==pt.TERMINATOR)}catch{throw new P}return new Me(r,v.toString(),C.length===0?null:C,u===null?null:u.toString(),k,O)}static decodeHanziSegment(r,c,u){if(u*13>r.available())throw new P;const m=new Uint8Array(2*u);let w=0;for(;u>0;){const v=r.readBits(13);let C=v/96<<8&4294967295|v%96;C<959?C+=41377:C+=42657,m[w]=C>>8&255,m[w+1]=C&255,w+=2,u--}try{c.append($.decode(m,V.GB2312))}catch(v){throw new P(v)}}static decodeKanjiSegment(r,c,u){if(u*13>r.available())throw new P;const m=new Uint8Array(2*u);let w=0;for(;u>0;){const v=r.readBits(13);let C=v/192<<8&4294967295|v%192;C<7936?C+=33088:C+=49472,m[w]=C>>8,m[w+1]=C,w+=2,u--}try{c.append($.decode(m,V.SHIFT_JIS))}catch(v){throw new P(v)}}static decodeByteSegment(r,c,u,m,w,v){if(8*u>r.available())throw new P;const C=new Uint8Array(u);for(let O=0;O<u;O++)C[O]=r.readBits(8);let k;m===null?k=V.guessEncoding(C,v):k=m.getName();try{c.append($.decode(C,k))}catch(O){throw new P(O)}w.push(C)}static toAlphaNumericChar(r){if(r>=Xt.ALPHANUMERIC_CHARS.length)throw new P;return Xt.ALPHANUMERIC_CHARS[r]}static decodeAlphanumericSegment(r,c,u,m){const w=c.length();for(;u>1;){if(r.available()<11)throw new P;const v=r.readBits(11);c.append(Xt.toAlphaNumericChar(Math.floor(v/45))),c.append(Xt.toAlphaNumericChar(v%45)),u-=2}if(u===1){if(r.available()<6)throw new P;c.append(Xt.toAlphaNumericChar(r.readBits(6)))}if(m)for(let v=w;v<c.length();v++)c.charAt(v)==="%"&&(v<c.length()-1&&c.charAt(v+1)==="%"?c.deleteCharAt(v+1):c.setCharAt(v,""))}static decodeNumericSegment(r,c,u){for(;u>=3;){if(r.available()<10)throw new P;const m=r.readBits(10);if(m>=1e3)throw new P;c.append(Xt.toAlphaNumericChar(Math.floor(m/100))),c.append(Xt.toAlphaNumericChar(Math.floor(m/10)%10)),c.append(Xt.toAlphaNumericChar(m%10)),u-=3}if(u===2){if(r.available()<7)throw new P;const m=r.readBits(7);if(m>=100)throw new P;c.append(Xt.toAlphaNumericChar(Math.floor(m/10))),c.append(Xt.toAlphaNumericChar(m%10))}else if(u===1){if(r.available()<4)throw new P;const m=r.readBits(4);if(m>=10)throw new P;c.append(Xt.toAlphaNumericChar(m))}}static parseECIValue(r){const c=r.readBits(8);if((c&128)===0)return c&127;if((c&192)===128){const u=r.readBits(8);return(c&63)<<8&4294967295|u}if((c&224)===192){const u=r.readBits(16);return(c&31)<<16&4294967295|u}throw new P}}Xt.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",Xt.GB2312_SUBSET=1;class Ks{constructor(r){this.mirrored=r}isMirrored(){return this.mirrored}applyMirroredCorrection(r){if(!this.mirrored||r===null||r.length<3)return;const c=r[0];r[0]=r[2],r[2]=c}}class Xs{constructor(){this.rsDecoder=new ot(Pe.QR_CODE_FIELD_256)}decodeBooleanArray(r,c){return this.decodeBitMatrix(se.parseFromBooleanArray(r),c)}decodeBitMatrix(r,c){const u=new Po(r);let m=null;try{return this.decodeBitMatrixParser(u,c)}catch(w){m=w}try{u.remask(),u.setMirror(!0),u.readVersion(),u.readFormatInformation(),u.mirror();const w=this.decodeBitMatrixParser(u,c);return w.setOther(new Ks(!0)),w}catch(w){throw m!==null?m:w}}decodeBitMatrixParser(r,c){const u=r.readVersion(),m=r.readFormatInformation().getErrorCorrectionLevel(),w=r.readCodewords(),v=ws.getDataBlocks(w,u,m);let C=0;for(const Z of v)C+=Z.getNumDataCodewords();const k=new Uint8Array(C);let O=0;for(const Z of v){const le=Z.getCodewords(),he=Z.getNumDataCodewords();this.correctErrors(le,he);for(let Ee=0;Ee<he;Ee++)k[O++]=le[Ee]}return Xt.decode(k,u,m,c)}correctErrors(r,c){const u=new Int32Array(r);try{this.rsDecoder.decode(u,r.length-c)}catch{throw new S}for(let m=0;m<c;m++)r[m]=u[m]}}class ii extends qe{constructor(r,c,u){super(r,c),this.estimatedModuleSize=u}aboutEquals(r,c,u){if(Math.abs(c-this.getY())<=r&&Math.abs(u-this.getX())<=r){const m=Math.abs(r-this.estimatedModuleSize);return m<=1||m<=this.estimatedModuleSize}return!1}combineEstimate(r,c,u){const m=(this.getX()+c)/2,w=(this.getY()+r)/2,v=(this.estimatedModuleSize+u)/2;return new ii(m,w,v)}}class sr{constructor(r,c,u,m,w,v,C){this.image=r,this.startX=c,this.startY=u,this.width=m,this.height=w,this.moduleSize=v,this.resultPointCallback=C,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const r=this.startX,c=this.height,u=this.width,m=r+u,w=this.startY+c/2,v=new Int32Array(3),C=this.image;for(let k=0;k<c;k++){const O=w+((k&1)===0?Math.floor((k+1)/2):-Math.floor((k+1)/2));v[0]=0,v[1]=0,v[2]=0;let Z=r;for(;Z<m&&!C.get(Z,O);)Z++;let le=0;for(;Z<m;){if(C.get(Z,O))if(le===1)v[1]++;else if(le===2){if(this.foundPatternCross(v)){const he=this.handlePossibleCenter(v,O,Z);if(he!==null)return he}v[0]=v[2],v[1]=1,v[2]=0,le=1}else v[++le]++;else le===1&&le++,v[le]++;Z++}if(this.foundPatternCross(v)){const he=this.handlePossibleCenter(v,O,m);if(he!==null)return he}}if(this.possibleCenters.length!==0)return this.possibleCenters[0];throw new H}static centerFromEnd(r,c){return c-r[2]-r[1]/2}foundPatternCross(r){const c=this.moduleSize,u=c/2;for(let m=0;m<3;m++)if(Math.abs(c-r[m])>=u)return!1;return!0}crossCheckVertical(r,c,u,m){const w=this.image,v=w.getHeight(),C=this.crossCheckStateCount;C[0]=0,C[1]=0,C[2]=0;let k=r;for(;k>=0&&w.get(c,k)&&C[1]<=u;)C[1]++,k--;if(k<0||C[1]>u)return NaN;for(;k>=0&&!w.get(c,k)&&C[0]<=u;)C[0]++,k--;if(C[0]>u)return NaN;for(k=r+1;k<v&&w.get(c,k)&&C[1]<=u;)C[1]++,k++;if(k===v||C[1]>u)return NaN;for(;k<v&&!w.get(c,k)&&C[2]<=u;)C[2]++,k++;if(C[2]>u)return NaN;const O=C[0]+C[1]+C[2];return 5*Math.abs(O-m)>=2*m?NaN:this.foundPatternCross(C)?sr.centerFromEnd(C,k):NaN}handlePossibleCenter(r,c,u){const m=r[0]+r[1]+r[2],w=sr.centerFromEnd(r,u),v=this.crossCheckVertical(c,w,2*r[1],m);if(!isNaN(v)){const C=(r[0]+r[1]+r[2])/3;for(const O of this.possibleCenters)if(O.aboutEquals(C,v,w))return O.combineEstimate(v,w,C);const k=new ii(w,v,C);this.possibleCenters.push(k),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(k)}return null}}class hr extends qe{constructor(r,c,u,m){super(r,c),this.estimatedModuleSize=u,this.count=m,m===void 0&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(r,c,u){if(Math.abs(c-this.getY())<=r&&Math.abs(u-this.getX())<=r){const m=Math.abs(r-this.estimatedModuleSize);return m<=1||m<=this.estimatedModuleSize}return!1}combineEstimate(r,c,u){const m=this.count+1,w=(this.count*this.getX()+c)/m,v=(this.count*this.getY()+r)/m,C=(this.count*this.estimatedModuleSize+u)/m;return new hr(w,v,C,m)}}class Br{constructor(r){this.bottomLeft=r[0],this.topLeft=r[1],this.topRight=r[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class nn{constructor(r,c){this.image=r,this.resultPointCallback=c,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=c}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(r){const c=r!=null&&r.get(U.TRY_HARDER)!==void 0,u=r!=null&&r.get(U.PURE_BARCODE)!==void 0,m=this.image,w=m.getHeight(),v=m.getWidth();let C=Math.floor(3*w/(4*nn.MAX_MODULES));(C<nn.MIN_SKIP||c)&&(C=nn.MIN_SKIP);let k=!1;const O=new Int32Array(5);for(let le=C-1;le<w&&!k;le+=C){O[0]=0,O[1]=0,O[2]=0,O[3]=0,O[4]=0;let he=0;for(let Ee=0;Ee<v;Ee++)if(m.get(Ee,le))(he&1)===1&&he++,O[he]++;else if((he&1)===0)if(he===4)if(nn.foundPatternCross(O)){if(this.handlePossibleCenter(O,le,Ee,u)===!0)if(C=2,this.hasSkipped===!0)k=this.haveMultiplyConfirmedCenters();else{const Ie=this.findRowSkip();Ie>O[2]&&(le+=Ie-O[2]-C,Ee=v-1)}else{O[0]=O[2],O[1]=O[3],O[2]=O[4],O[3]=1,O[4]=0,he=3;continue}he=0,O[0]=0,O[1]=0,O[2]=0,O[3]=0,O[4]=0}else O[0]=O[2],O[1]=O[3],O[2]=O[4],O[3]=1,O[4]=0,he=3;else O[++he]++;else O[he]++;nn.foundPatternCross(O)&&this.handlePossibleCenter(O,le,v,u)===!0&&(C=O[0],this.hasSkipped&&(k=this.haveMultiplyConfirmedCenters()))}const Z=this.selectBestPatterns();return qe.orderBestPatterns(Z),new Br(Z)}static centerFromEnd(r,c){return c-r[4]-r[3]-r[2]/2}static foundPatternCross(r){let c=0;for(let w=0;w<5;w++){const v=r[w];if(v===0)return!1;c+=v}if(c<7)return!1;const u=c/7,m=u/2;return Math.abs(u-r[0])<m&&Math.abs(u-r[1])<m&&Math.abs(3*u-r[2])<3*m&&Math.abs(u-r[3])<m&&Math.abs(u-r[4])<m}getCrossCheckStateCount(){const r=this.crossCheckStateCount;return r[0]=0,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r}crossCheckDiagonal(r,c,u,m){const w=this.getCrossCheckStateCount();let v=0;const C=this.image;for(;r>=v&&c>=v&&C.get(c-v,r-v);)w[2]++,v++;if(r<v||c<v)return!1;for(;r>=v&&c>=v&&!C.get(c-v,r-v)&&w[1]<=u;)w[1]++,v++;if(r<v||c<v||w[1]>u)return!1;for(;r>=v&&c>=v&&C.get(c-v,r-v)&&w[0]<=u;)w[0]++,v++;if(w[0]>u)return!1;const k=C.getHeight(),O=C.getWidth();for(v=1;r+v<k&&c+v<O&&C.get(c+v,r+v);)w[2]++,v++;if(r+v>=k||c+v>=O)return!1;for(;r+v<k&&c+v<O&&!C.get(c+v,r+v)&&w[3]<u;)w[3]++,v++;if(r+v>=k||c+v>=O||w[3]>=u)return!1;for(;r+v<k&&c+v<O&&C.get(c+v,r+v)&&w[4]<u;)w[4]++,v++;if(w[4]>=u)return!1;const Z=w[0]+w[1]+w[2]+w[3]+w[4];return Math.abs(Z-m)<2*m&&nn.foundPatternCross(w)}crossCheckVertical(r,c,u,m){const w=this.image,v=w.getHeight(),C=this.getCrossCheckStateCount();let k=r;for(;k>=0&&w.get(c,k);)C[2]++,k--;if(k<0)return NaN;for(;k>=0&&!w.get(c,k)&&C[1]<=u;)C[1]++,k--;if(k<0||C[1]>u)return NaN;for(;k>=0&&w.get(c,k)&&C[0]<=u;)C[0]++,k--;if(C[0]>u)return NaN;for(k=r+1;k<v&&w.get(c,k);)C[2]++,k++;if(k===v)return NaN;for(;k<v&&!w.get(c,k)&&C[3]<u;)C[3]++,k++;if(k===v||C[3]>=u)return NaN;for(;k<v&&w.get(c,k)&&C[4]<u;)C[4]++,k++;if(C[4]>=u)return NaN;const O=C[0]+C[1]+C[2]+C[3]+C[4];return 5*Math.abs(O-m)>=2*m?NaN:nn.foundPatternCross(C)?nn.centerFromEnd(C,k):NaN}crossCheckHorizontal(r,c,u,m){const w=this.image,v=w.getWidth(),C=this.getCrossCheckStateCount();let k=r;for(;k>=0&&w.get(k,c);)C[2]++,k--;if(k<0)return NaN;for(;k>=0&&!w.get(k,c)&&C[1]<=u;)C[1]++,k--;if(k<0||C[1]>u)return NaN;for(;k>=0&&w.get(k,c)&&C[0]<=u;)C[0]++,k--;if(C[0]>u)return NaN;for(k=r+1;k<v&&w.get(k,c);)C[2]++,k++;if(k===v)return NaN;for(;k<v&&!w.get(k,c)&&C[3]<u;)C[3]++,k++;if(k===v||C[3]>=u)return NaN;for(;k<v&&w.get(k,c)&&C[4]<u;)C[4]++,k++;if(C[4]>=u)return NaN;const O=C[0]+C[1]+C[2]+C[3]+C[4];return 5*Math.abs(O-m)>=m?NaN:nn.foundPatternCross(C)?nn.centerFromEnd(C,k):NaN}handlePossibleCenter(r,c,u,m){const w=r[0]+r[1]+r[2]+r[3]+r[4];let v=nn.centerFromEnd(r,u),C=this.crossCheckVertical(c,Math.floor(v),r[2],w);if(!isNaN(C)&&(v=this.crossCheckHorizontal(Math.floor(v),Math.floor(C),r[2],w),!isNaN(v)&&(!m||this.crossCheckDiagonal(Math.floor(C),Math.floor(v),r[2],w)))){const k=w/7;let O=!1;const Z=this.possibleCenters;for(let le=0,he=Z.length;le<he;le++){const Ee=Z[le];if(Ee.aboutEquals(k,C,v)){Z[le]=Ee.combineEstimate(C,v,k),O=!0;break}}if(!O){const le=new hr(v,C,k);Z.push(le),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(le)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let c=null;for(const u of this.possibleCenters)if(u.getCount()>=nn.CENTER_QUORUM)if(c==null)c=u;else return this.hasSkipped=!0,Math.floor((Math.abs(c.getX()-u.getX())-Math.abs(c.getY()-u.getY()))/2);return 0}haveMultiplyConfirmedCenters(){let r=0,c=0;const u=this.possibleCenters.length;for(const v of this.possibleCenters)v.getCount()>=nn.CENTER_QUORUM&&(r++,c+=v.getEstimatedModuleSize());if(r<3)return!1;const m=c/u;let w=0;for(const v of this.possibleCenters)w+=Math.abs(v.getEstimatedModuleSize()-m);return w<=.05*c}selectBestPatterns(){const r=this.possibleCenters.length;if(r<3)throw new H;const c=this.possibleCenters;let u;if(r>3){let m=0,w=0;for(const k of this.possibleCenters){const O=k.getEstimatedModuleSize();m+=O,w+=O*O}u=m/r;let v=Math.sqrt(w/r-u*u);c.sort((k,O)=>{const Z=Math.abs(O.getEstimatedModuleSize()-u),le=Math.abs(k.getEstimatedModuleSize()-u);return Z<le?-1:Z>le?1:0});const C=Math.max(.2*u,v);for(let k=0;k<c.length&&c.length>3;k++){const O=c[k];Math.abs(O.getEstimatedModuleSize()-u)>C&&(c.splice(k,1),k--)}}if(c.length>3){let m=0;for(const w of c)m+=w.getEstimatedModuleSize();u=m/c.length,c.sort((w,v)=>{if(v.getCount()===w.getCount()){const C=Math.abs(v.getEstimatedModuleSize()-u),k=Math.abs(w.getEstimatedModuleSize()-u);return C<k?1:C>k?-1:0}else return v.getCount()-w.getCount()}),c.splice(3)}return[c[0],c[1],c[2]]}}nn.CENTER_QUORUM=2,nn.MIN_SKIP=3,nn.MAX_MODULES=57;class br{constructor(r){this.image=r}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(r){this.resultPointCallback=r==null?null:r.get(U.NEED_RESULT_POINT_CALLBACK);const u=new nn(this.image,this.resultPointCallback).find(r);return this.processFinderPatternInfo(u)}processFinderPatternInfo(r){const c=r.getTopLeft(),u=r.getTopRight(),m=r.getBottomLeft(),w=this.calculateModuleSize(c,u,m);if(w<1)throw new H("No pattern found in proccess finder.");const v=br.computeDimension(c,u,m,w),C=ht.getProvisionalVersionForDimension(v),k=C.getDimensionForVersion()-7;let O=null;if(C.getAlignmentPatternCenters().length>0){const Ee=u.getX()-c.getX()+m.getX(),Ce=u.getY()-c.getY()+m.getY(),Ie=1-3/k,Re=Math.floor(c.getX()+Ie*(Ee-c.getX())),Fe=Math.floor(c.getY()+Ie*(Ce-c.getY()));for(let Xe=4;Xe<=16;Xe<<=1)try{O=this.findAlignmentInRegion(w,Re,Fe,Xe);break}catch(Je){if(!(Je instanceof H))throw Je}}const Z=br.createTransform(c,u,m,O,v),le=br.sampleGrid(this.image,Z,v);let he;return O===null?he=[m,c,u]:he=[m,c,u,O],new Et(le,he)}static createTransform(r,c,u,m,w){const v=w-3.5;let C,k,O,Z;return m!==null?(C=m.getX(),k=m.getY(),O=v-3,Z=O):(C=c.getX()-r.getX()+u.getX(),k=c.getY()-r.getY()+u.getY(),O=v,Z=v),Lt.quadrilateralToQuadrilateral(3.5,3.5,v,3.5,O,Z,3.5,v,r.getX(),r.getY(),c.getX(),c.getY(),C,k,u.getX(),u.getY())}static sampleGrid(r,c,u){return z.getInstance().sampleGridWithTransform(r,u,u,c)}static computeDimension(r,c,u,m){const w=tt.round(qe.distance(r,c)/m),v=tt.round(qe.distance(r,u)/m);let C=Math.floor((w+v)/2)+7;switch(C&3){case 0:C++;break;case 2:C--;break;case 3:throw new H("Dimensions could be not found.")}return C}calculateModuleSize(r,c,u){return(this.calculateModuleSizeOneWay(r,c)+this.calculateModuleSizeOneWay(r,u))/2}calculateModuleSizeOneWay(r,c){const u=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(r.getX()),Math.floor(r.getY()),Math.floor(c.getX()),Math.floor(c.getY())),m=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(c.getX()),Math.floor(c.getY()),Math.floor(r.getX()),Math.floor(r.getY()));return isNaN(u)?m/7:isNaN(m)?u/7:(u+m)/14}sizeOfBlackWhiteBlackRunBothWays(r,c,u,m){let w=this.sizeOfBlackWhiteBlackRun(r,c,u,m),v=1,C=r-(u-r);C<0?(v=r/(r-C),C=0):C>=this.image.getWidth()&&(v=(this.image.getWidth()-1-r)/(C-r),C=this.image.getWidth()-1);let k=Math.floor(c-(m-c)*v);return v=1,k<0?(v=c/(c-k),k=0):k>=this.image.getHeight()&&(v=(this.image.getHeight()-1-c)/(k-c),k=this.image.getHeight()-1),C=Math.floor(r+(C-r)*v),w+=this.sizeOfBlackWhiteBlackRun(r,c,C,k),w-1}sizeOfBlackWhiteBlackRun(r,c,u,m){const w=Math.abs(m-c)>Math.abs(u-r);if(w){let Ee=r;r=c,c=Ee,Ee=u,u=m,m=Ee}const v=Math.abs(u-r),C=Math.abs(m-c);let k=-v/2;const O=r<u?1:-1,Z=c<m?1:-1;let le=0;const he=u+O;for(let Ee=r,Ce=c;Ee!==he;Ee+=O){const Ie=w?Ce:Ee,Re=w?Ee:Ce;if(le===1===this.image.get(Ie,Re)){if(le===2)return tt.distance(Ee,Ce,r,c);le++}if(k+=C,k>0){if(Ce===m)break;Ce+=Z,k-=v}}return le===2?tt.distance(u+O,m,r,c):NaN}findAlignmentInRegion(r,c,u,m){const w=Math.floor(m*r),v=Math.max(0,c-w),C=Math.min(this.image.getWidth()-1,c+w);if(C-v<r*3)throw new H("Alignment top exceeds estimated module size.");const k=Math.max(0,u-w),O=Math.min(this.image.getHeight()-1,u+w);if(O-k<r*3)throw new H("Alignment bottom exceeds estimated module size.");return new sr(this.image,v,k,C-v,O-k,r,this.resultPointCallback).find()}}class kn{constructor(){this.decoder=new Xs}getDecoder(){return this.decoder}decode(r,c){let u,m;if(c!=null&&c.get(U.PURE_BARCODE)!==void 0){const k=kn.extractPureBits(r.getBlackMatrix());u=this.decoder.decodeBitMatrix(k,c),m=kn.NO_POINTS}else{const k=new br(r.getBlackMatrix()).detect(c);u=this.decoder.decodeBitMatrix(k.getBits(),c),m=k.getPoints()}u.getOther()instanceof Ks&&u.getOther().applyMirroredCorrection(m);const w=new ce(u.getText(),u.getRawBytes(),void 0,m,me.QR_CODE,void 0),v=u.getByteSegments();v!==null&&w.putMetadata(be.BYTE_SEGMENTS,v);const C=u.getECLevel();return C!==null&&w.putMetadata(be.ERROR_CORRECTION_LEVEL,C),u.hasStructuredAppend()&&(w.putMetadata(be.STRUCTURED_APPEND_SEQUENCE,u.getStructuredAppendSequenceNumber()),w.putMetadata(be.STRUCTURED_APPEND_PARITY,u.getStructuredAppendParity())),w}reset(){}static extractPureBits(r){const c=r.getTopLeftOnBit(),u=r.getBottomRightOnBit();if(c===null||u===null)throw new H;const m=this.moduleSize(c,r);let w=c[1],v=u[1],C=c[0],k=u[0];if(C>=k||w>=v)throw new H;if(v-w!==k-C&&(k=C+(v-w),k>=r.getWidth()))throw new H;const O=Math.round((k-C+1)/m),Z=Math.round((v-w+1)/m);if(O<=0||Z<=0)throw new H;if(Z!==O)throw new H;const le=Math.floor(m/2);w+=le,C+=le;const he=C+Math.floor((O-1)*m)-k;if(he>0){if(he>le)throw new H;C-=he}const Ee=w+Math.floor((Z-1)*m)-v;if(Ee>0){if(Ee>le)throw new H;w-=Ee}const Ce=new se(O,Z);for(let Ie=0;Ie<Z;Ie++){const Re=w+Math.floor(Ie*m);for(let Fe=0;Fe<O;Fe++)r.get(C+Math.floor(Fe*m),Re)&&Ce.set(Fe,Ie)}return Ce}static moduleSize(r,c){const u=c.getHeight(),m=c.getWidth();let w=r[0],v=r[1],C=!0,k=0;for(;w<m&&v<u;){if(C!==c.get(w,v)){if(++k===5)break;C=!C}w++,v++}if(w===m||v===u)throw new H;return(w-r[0])/7}}kn.NO_POINTS=new Array;class xt{PDF417Common(){}static getBitCountSum(r){return tt.sum(r)}static toIntArray(r){if(r==null||!r.length)return xt.EMPTY_INT_ARRAY;const c=new Int32Array(r.length);let u=0;for(const m of r)c[u++]=m;return c}static getCodeword(r){const c=D.binarySearch(xt.SYMBOL_TABLE,r&262143);return c<0?-1:(xt.CODEWORD_TABLE[c]-1)%xt.NUMBER_OF_CODEWORDS}}xt.NUMBER_OF_CODEWORDS=929,xt.MAX_CODEWORDS_IN_BARCODE=xt.NUMBER_OF_CODEWORDS-1,xt.MIN_ROWS_IN_BARCODE=3,xt.MAX_ROWS_IN_BARCODE=90,xt.MODULES_IN_CODEWORD=17,xt.MODULES_IN_STOP_PATTERN=18,xt.BARS_IN_MODULE=8,xt.EMPTY_INT_ARRAY=new Int32Array([]),xt.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),xt.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class Do{constructor(r,c){this.bits=r,this.points=c}getBits(){return this.bits}getPoints(){return this.points}}class At{static detectMultiple(r,c,u){let m=r.getBlackMatrix(),w=At.detect(u,m);return w.length||(m=m.clone(),m.rotate180(),w=At.detect(u,m)),new Do(m,w)}static detect(r,c){const u=new Array;let m=0,w=0,v=!1;for(;m<c.getHeight();){const C=At.findVertices(c,m,w);if(C[0]==null&&C[3]==null){if(!v)break;v=!1,w=0;for(const k of u)k[1]!=null&&(m=Math.trunc(Math.max(m,k[1].getY()))),k[3]!=null&&(m=Math.max(m,Math.trunc(k[3].getY())));m+=At.ROW_STEP;continue}if(v=!0,u.push(C),!r)break;C[2]!=null?(w=Math.trunc(C[2].getX()),m=Math.trunc(C[2].getY())):(w=Math.trunc(C[4].getX()),m=Math.trunc(C[4].getY()))}return u}static findVertices(r,c,u){const m=r.getHeight(),w=r.getWidth(),v=new Array(8);return At.copyToResult(v,At.findRowsWithPattern(r,m,w,c,u,At.START_PATTERN),At.INDEXES_START_PATTERN),v[4]!=null&&(u=Math.trunc(v[4].getX()),c=Math.trunc(v[4].getY())),At.copyToResult(v,At.findRowsWithPattern(r,m,w,c,u,At.STOP_PATTERN),At.INDEXES_STOP_PATTERN),v}static copyToResult(r,c,u){for(let m=0;m<u.length;m++)r[u[m]]=c[m]}static findRowsWithPattern(r,c,u,m,w,v){const C=new Array(4);let k=!1;const O=new Int32Array(v.length);for(;m<c;m+=At.ROW_STEP){let le=At.findGuardPattern(r,w,m,u,!1,v,O);if(le!=null){for(;m>0;){const he=At.findGuardPattern(r,w,--m,u,!1,v,O);if(he!=null)le=he;else{m++;break}}C[0]=new qe(le[0],m),C[1]=new qe(le[1],m),k=!0;break}}let Z=m+1;if(k){let le=0,he=Int32Array.from([Math.trunc(C[0].getX()),Math.trunc(C[1].getX())]);for(;Z<c;Z++){const Ee=At.findGuardPattern(r,he[0],Z,u,!1,v,O);if(Ee!=null&&Math.abs(he[0]-Ee[0])<At.MAX_PATTERN_DRIFT&&Math.abs(he[1]-Ee[1])<At.MAX_PATTERN_DRIFT)he=Ee,le=0;else{if(le>At.SKIPPED_ROW_COUNT_MAX)break;le++}}Z-=le+1,C[2]=new qe(he[0],Z),C[3]=new qe(he[1],Z)}return Z-m<At.BARCODE_MIN_HEIGHT&&D.fill(C,null),C}static findGuardPattern(r,c,u,m,w,v,C){D.fillWithin(C,0,C.length,0);let k=c,O=0;for(;r.get(k,u)&&k>0&&O++<At.MAX_PIXEL_DRIFT;)k--;let Z=k,le=0,he=v.length;for(let Ee=w;Z<m;Z++)if(r.get(Z,u)!==Ee)C[le]++;else{if(le===he-1){if(At.patternMatchVariance(C,v,At.MAX_INDIVIDUAL_VARIANCE)<At.MAX_AVG_VARIANCE)return new Int32Array([k,Z]);k+=C[0]+C[1],_.arraycopy(C,2,C,0,le-1),C[le-1]=0,C[le]=0,le--}else le++;C[le]=1,Ee=!Ee}return le===he-1&&At.patternMatchVariance(C,v,At.MAX_INDIVIDUAL_VARIANCE)<At.MAX_AVG_VARIANCE?new Int32Array([k,Z-1]):null}static patternMatchVariance(r,c,u){let m=r.length,w=0,v=0;for(let O=0;O<m;O++)w+=r[O],v+=c[O];if(w<v)return 1/0;let C=w/v;u*=C;let k=0;for(let O=0;O<m;O++){let Z=r[O],le=c[O]*C,he=Z>le?Z-le:le-Z;if(he>u)return 1/0;k+=he}return k/w}}At.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),At.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),At.MAX_AVG_VARIANCE=.42,At.MAX_INDIVIDUAL_VARIANCE=.8,At.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),At.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),At.MAX_PIXEL_DRIFT=3,At.MAX_PATTERN_DRIFT=5,At.SKIPPED_ROW_COUNT_MAX=25,At.ROW_STEP=5,At.BARCODE_MIN_HEIGHT=10;class En{constructor(r,c){if(c.length===0)throw new E;this.field=r;let u=c.length;if(u>1&&c[0]===0){let m=1;for(;m<u&&c[m]===0;)m++;m===u?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(u-m),_.arraycopy(c,m,this.coefficients,0,this.coefficients.length))}else this.coefficients=c}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(r){return this.coefficients[this.coefficients.length-1-r]}evaluateAt(r){if(r===0)return this.getCoefficient(0);if(r===1){let m=0;for(let w of this.coefficients)m=this.field.add(m,w);return m}let c=this.coefficients[0],u=this.coefficients.length;for(let m=1;m<u;m++)c=this.field.add(this.field.multiply(r,c),this.coefficients[m]);return c}add(r){if(!this.field.equals(r.field))throw new E("ModulusPolys do not have same ModulusGF field");if(this.isZero())return r;if(r.isZero())return this;let c=this.coefficients,u=r.coefficients;if(c.length>u.length){let v=c;c=u,u=v}let m=new Int32Array(u.length),w=u.length-c.length;_.arraycopy(u,0,m,0,w);for(let v=w;v<u.length;v++)m[v]=this.field.add(c[v-w],u[v]);return new En(this.field,m)}subtract(r){if(!this.field.equals(r.field))throw new E("ModulusPolys do not have same ModulusGF field");return r.isZero()?this:this.add(r.negative())}multiply(r){return r instanceof En?this.multiplyOther(r):this.multiplyScalar(r)}multiplyOther(r){if(!this.field.equals(r.field))throw new E("ModulusPolys do not have same ModulusGF field");if(this.isZero()||r.isZero())return new En(this.field,new Int32Array([0]));let c=this.coefficients,u=c.length,m=r.coefficients,w=m.length,v=new Int32Array(u+w-1);for(let C=0;C<u;C++){let k=c[C];for(let O=0;O<w;O++)v[C+O]=this.field.add(v[C+O],this.field.multiply(k,m[O]))}return new En(this.field,v)}negative(){let r=this.coefficients.length,c=new Int32Array(r);for(let u=0;u<r;u++)c[u]=this.field.subtract(0,this.coefficients[u]);return new En(this.field,c)}multiplyScalar(r){if(r===0)return new En(this.field,new Int32Array([0]));if(r===1)return this;let c=this.coefficients.length,u=new Int32Array(c);for(let m=0;m<c;m++)u[m]=this.field.multiply(this.coefficients[m],r);return new En(this.field,u)}multiplyByMonomial(r,c){if(r<0)throw new E;if(c===0)return new En(this.field,new Int32Array([0]));let u=this.coefficients.length,m=new Int32Array(u+r);for(let w=0;w<u;w++)m[w]=this.field.multiply(this.coefficients[w],c);return new En(this.field,m)}toString(){let r=new G;for(let c=this.getDegree();c>=0;c--){let u=this.getCoefficient(c);u!==0&&(u<0?(r.append(" - "),u=-u):r.length()>0&&r.append(" + "),(c===0||u!==1)&&r.append(u),c!==0&&(c===1?r.append("x"):(r.append("x^"),r.append(c))))}return r.toString()}}class Oo{add(r,c){return(r+c)%this.modulus}subtract(r,c){return(this.modulus+r-c)%this.modulus}exp(r){return this.expTable[r]}log(r){if(r===0)throw new E;return this.logTable[r]}inverse(r){if(r===0)throw new je;return this.expTable[this.modulus-this.logTable[r]-1]}multiply(r,c){return r===0||c===0?0:this.expTable[(this.logTable[r]+this.logTable[c])%(this.modulus-1)]}getSize(){return this.modulus}equals(r){return r===this}}class si extends Oo{constructor(r,c){super(),this.modulus=r,this.expTable=new Int32Array(r),this.logTable=new Int32Array(r);let u=1;for(let m=0;m<r;m++)this.expTable[m]=u,u=u*c%r;for(let m=0;m<r-1;m++)this.logTable[this.expTable[m]]=m;this.zero=new En(this,new Int32Array([0])),this.one=new En(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(r,c){if(r<0)throw new E;if(c===0)return this.zero;let u=new Int32Array(r+1);return u[0]=c,new En(this,u)}}si.PDF417_GF=new si(xt.NUMBER_OF_CODEWORDS,3);class Zs{constructor(){this.field=si.PDF417_GF}decode(r,c,u){let m=new En(this.field,r),w=new Int32Array(c),v=!1;for(let Ce=c;Ce>0;Ce--){let Ie=m.evaluateAt(this.field.exp(Ce));w[c-Ce]=Ie,Ie!==0&&(v=!0)}if(!v)return 0;let C=this.field.getOne();if(u!=null)for(const Ce of u){let Ie=this.field.exp(r.length-1-Ce),Re=new En(this.field,new Int32Array([this.field.subtract(0,Ie),1]));C=C.multiply(Re)}let k=new En(this.field,w),O=this.runEuclideanAlgorithm(this.field.buildMonomial(c,1),k,c),Z=O[0],le=O[1],he=this.findErrorLocations(Z),Ee=this.findErrorMagnitudes(le,Z,he);for(let Ce=0;Ce<he.length;Ce++){let Ie=r.length-1-this.field.log(he[Ce]);if(Ie<0)throw S.getChecksumInstance();r[Ie]=this.field.subtract(r[Ie],Ee[Ce])}return he.length}runEuclideanAlgorithm(r,c,u){if(r.getDegree()<c.getDegree()){let he=r;r=c,c=he}let m=r,w=c,v=this.field.getZero(),C=this.field.getOne();for(;w.getDegree()>=Math.round(u/2);){let he=m,Ee=v;if(m=w,v=C,m.isZero())throw S.getChecksumInstance();w=he;let Ce=this.field.getZero(),Ie=m.getCoefficient(m.getDegree()),Re=this.field.inverse(Ie);for(;w.getDegree()>=m.getDegree()&&!w.isZero();){let Fe=w.getDegree()-m.getDegree(),Xe=this.field.multiply(w.getCoefficient(w.getDegree()),Re);Ce=Ce.add(this.field.buildMonomial(Fe,Xe)),w=w.subtract(m.multiplyByMonomial(Fe,Xe))}C=Ce.multiply(v).subtract(Ee).negative()}let k=C.getCoefficient(0);if(k===0)throw S.getChecksumInstance();let O=this.field.inverse(k),Z=C.multiply(O),le=w.multiply(O);return[Z,le]}findErrorLocations(r){let c=r.getDegree(),u=new Int32Array(c),m=0;for(let w=1;w<this.field.getSize()&&m<c;w++)r.evaluateAt(w)===0&&(u[m]=this.field.inverse(w),m++);if(m!==c)throw S.getChecksumInstance();return u}findErrorMagnitudes(r,c,u){let m=c.getDegree(),w=new Int32Array(m);for(let O=1;O<=m;O++)w[m-O]=this.field.multiply(O,c.getCoefficient(O));let v=new En(this.field,w),C=u.length,k=new Int32Array(C);for(let O=0;O<C;O++){let Z=this.field.inverse(u[O]),le=this.field.subtract(0,r.evaluateAt(Z)),he=this.field.inverse(v.evaluateAt(Z));k[O]=this.field.multiply(le,he)}return k}}class Hr{constructor(r,c,u,m,w){r instanceof Hr?this.constructor_2(r):this.constructor_1(r,c,u,m,w)}constructor_1(r,c,u,m,w){const v=c==null||u==null,C=m==null||w==null;if(v&&C)throw new H;v?(c=new qe(0,m.getY()),u=new qe(0,w.getY())):C&&(m=new qe(r.getWidth()-1,c.getY()),w=new qe(r.getWidth()-1,u.getY())),this.image=r,this.topLeft=c,this.bottomLeft=u,this.topRight=m,this.bottomRight=w,this.minX=Math.trunc(Math.min(c.getX(),u.getX())),this.maxX=Math.trunc(Math.max(m.getX(),w.getX())),this.minY=Math.trunc(Math.min(c.getY(),m.getY())),this.maxY=Math.trunc(Math.max(u.getY(),w.getY()))}constructor_2(r){this.image=r.image,this.topLeft=r.getTopLeft(),this.bottomLeft=r.getBottomLeft(),this.topRight=r.getTopRight(),this.bottomRight=r.getBottomRight(),this.minX=r.getMinX(),this.maxX=r.getMaxX(),this.minY=r.getMinY(),this.maxY=r.getMaxY()}static merge(r,c){return r==null?c:c==null?r:new Hr(r.image,r.topLeft,r.bottomLeft,c.topRight,c.bottomRight)}addMissingRows(r,c,u){let m=this.topLeft,w=this.bottomLeft,v=this.topRight,C=this.bottomRight;if(r>0){let k=u?this.topLeft:this.topRight,O=Math.trunc(k.getY()-r);O<0&&(O=0);let Z=new qe(k.getX(),O);u?m=Z:v=Z}if(c>0){let k=u?this.bottomLeft:this.bottomRight,O=Math.trunc(k.getY()+c);O>=this.image.getHeight()&&(O=this.image.getHeight()-1);let Z=new qe(k.getX(),O);u?w=Z:C=Z}return new Hr(this.image,m,w,v,C)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class ji{constructor(r,c,u,m){this.columnCount=r,this.errorCorrectionLevel=m,this.rowCountUpperPart=c,this.rowCountLowerPart=u,this.rowCount=c+u}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class Sr{constructor(){this.buffer=""}static form(r,c){let u=-1;function m(v,C,k,O,Z,le){if(v==="%%")return"%";if(c[++u]===void 0)return;v=O?parseInt(O.substr(1)):void 0;let he=Z?parseInt(Z.substr(1)):void 0,Ee;switch(le){case"s":Ee=c[u];break;case"c":Ee=c[u][0];break;case"f":Ee=parseFloat(c[u]).toFixed(v);break;case"p":Ee=parseFloat(c[u]).toPrecision(v);break;case"e":Ee=parseFloat(c[u]).toExponential(v);break;case"x":Ee=parseInt(c[u]).toString(he||16);break;case"d":Ee=parseFloat(parseInt(c[u],he||10).toPrecision(v)).toFixed(0);break}Ee=typeof Ee=="object"?JSON.stringify(Ee):(+Ee).toString(he);let Ce=parseInt(k),Ie=k&&k[0]+""=="0"?"0":" ";for(;Ee.length<Ce;)Ee=C!==void 0?Ee+Ie:Ie+Ee;return Ee}let w=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return r.replace(w,m)}format(r,...c){this.buffer+=Sr.form(r,c)}toString(){return this.buffer}}class pr{constructor(r){this.boundingBox=new Hr(r),this.codewords=new Array(r.getMaxY()-r.getMinY()+1)}getCodewordNearby(r){let c=this.getCodeword(r);if(c!=null)return c;for(let u=1;u<pr.MAX_NEARBY_DISTANCE;u++){let m=this.imageRowToCodewordIndex(r)-u;if(m>=0&&(c=this.codewords[m],c!=null)||(m=this.imageRowToCodewordIndex(r)+u,m<this.codewords.length&&(c=this.codewords[m],c!=null)))return c}return null}imageRowToCodewordIndex(r){return r-this.boundingBox.getMinY()}setCodeword(r,c){this.codewords[this.imageRowToCodewordIndex(r)]=c}getCodeword(r){return this.codewords[this.imageRowToCodewordIndex(r)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const r=new Sr;let c=0;for(const u of this.codewords){if(u==null){r.format("%3d:    |   %n",c++);continue}r.format("%3d: %3d|%3d%n",c++,u.getRowNumber(),u.getValue())}return r.toString()}}pr.MAX_NEARBY_DISTANCE=5;class Pr{constructor(){this.values=new Map}setValue(r){r=Math.trunc(r);let c=this.values.get(r);c==null&&(c=0),c++,this.values.set(r,c)}getValue(){let r=-1,c=new Array;for(const[u,m]of this.values.entries()){const w={getKey:()=>u,getValue:()=>m};w.getValue()>r?(r=w.getValue(),c=[],c.push(w.getKey())):w.getValue()===r&&c.push(w.getKey())}return xt.toIntArray(c)}getConfidence(r){return this.values.get(r)}}class Lo extends pr{constructor(r,c){super(r),this._isLeft=c}setRowNumbers(){for(let r of this.getCodewords())r!=null&&r.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(r){let c=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(c,r);let u=this.getBoundingBox(),m=this._isLeft?u.getTopLeft():u.getTopRight(),w=this._isLeft?u.getBottomLeft():u.getBottomRight(),v=this.imageRowToCodewordIndex(Math.trunc(m.getY())),C=this.imageRowToCodewordIndex(Math.trunc(w.getY())),k=-1,O=1,Z=0;for(let le=v;le<C;le++){if(c[le]==null)continue;let he=c[le],Ee=he.getRowNumber()-k;if(Ee===0)Z++;else if(Ee===1)O=Math.max(O,Z),Z=1,k=he.getRowNumber();else if(Ee<0||he.getRowNumber()>=r.getRowCount()||Ee>le)c[le]=null;else{let Ce;O>2?Ce=(O-2)*Ee:Ce=Ee;let Ie=Ce>=le;for(let Re=1;Re<=Ce&&!Ie;Re++)Ie=c[le-Re]!=null;Ie?c[le]=null:(k=he.getRowNumber(),Z=1)}}}getRowHeights(){let r=this.getBarcodeMetadata();if(r==null)return null;this.adjustIncompleteIndicatorColumnRowNumbers(r);let c=new Int32Array(r.getRowCount());for(let u of this.getCodewords())if(u!=null){let m=u.getRowNumber();if(m>=c.length)continue;c[m]++}return c}adjustIncompleteIndicatorColumnRowNumbers(r){let c=this.getBoundingBox(),u=this._isLeft?c.getTopLeft():c.getTopRight(),m=this._isLeft?c.getBottomLeft():c.getBottomRight(),w=this.imageRowToCodewordIndex(Math.trunc(u.getY())),v=this.imageRowToCodewordIndex(Math.trunc(m.getY())),C=this.getCodewords(),k=-1;for(let O=w;O<v;O++){if(C[O]==null)continue;let Z=C[O];Z.setRowNumberAsRowIndicatorColumn();let le=Z.getRowNumber()-k;le===0||(le===1?k=Z.getRowNumber():Z.getRowNumber()>=r.getRowCount()?C[O]=null:k=Z.getRowNumber())}}getBarcodeMetadata(){let r=this.getCodewords(),c=new Pr,u=new Pr,m=new Pr,w=new Pr;for(let C of r){if(C==null)continue;C.setRowNumberAsRowIndicatorColumn();let k=C.getValue()%30,O=C.getRowNumber();switch(this._isLeft||(O+=2),O%3){case 0:u.setValue(k*3+1);break;case 1:w.setValue(k/3),m.setValue(k%3);break;case 2:c.setValue(k+1);break}}if(c.getValue().length===0||u.getValue().length===0||m.getValue().length===0||w.getValue().length===0||c.getValue()[0]<1||u.getValue()[0]+m.getValue()[0]<xt.MIN_ROWS_IN_BARCODE||u.getValue()[0]+m.getValue()[0]>xt.MAX_ROWS_IN_BARCODE)return null;let v=new ji(c.getValue()[0],u.getValue()[0],m.getValue()[0],w.getValue()[0]);return this.removeIncorrectCodewords(r,v),v}removeIncorrectCodewords(r,c){for(let u=0;u<r.length;u++){let m=r[u];if(r[u]==null)continue;let w=m.getValue()%30,v=m.getRowNumber();if(v>c.getRowCount()){r[u]=null;continue}switch(this._isLeft||(v+=2),v%3){case 0:w*3+1!==c.getRowCountUpperPart()&&(r[u]=null);break;case 1:(Math.trunc(w/3)!==c.getErrorCorrectionLevel()||w%3!==c.getRowCountLowerPart())&&(r[u]=null);break;case 2:w+1!==c.getColumnCount()&&(r[u]=null);break}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+`
`+super.toString()}}class Vi{constructor(r,c){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=r,this.barcodeColumnCount=r.getColumnCount(),this.boundingBox=c,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let r=xt.MAX_CODEWORDS_IN_BARCODE,c;do c=r,r=this.adjustRowNumbersAndGetCount();while(r>0&&r<c);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(r){r!=null&&r.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let r=this.adjustRowNumbersByRow();if(r===0)return 0;for(let c=1;c<this.barcodeColumnCount+1;c++){let u=this.detectionResultColumns[c].getCodewords();for(let m=0;m<u.length;m++)u[m]!=null&&(u[m].hasValidRowNumber()||this.adjustRowNumbers(c,m,u))}return r}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(this.detectionResultColumns[0]==null||this.detectionResultColumns[this.barcodeColumnCount+1]==null)return;let r=this.detectionResultColumns[0].getCodewords(),c=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let u=0;u<r.length;u++)if(r[u]!=null&&c[u]!=null&&r[u].getRowNumber()===c[u].getRowNumber())for(let m=1;m<=this.barcodeColumnCount;m++){let w=this.detectionResultColumns[m].getCodewords()[u];w!=null&&(w.setRowNumber(r[u].getRowNumber()),w.hasValidRowNumber()||(this.detectionResultColumns[m].getCodewords()[u]=null))}}adjustRowNumbersFromRRI(){if(this.detectionResultColumns[this.barcodeColumnCount+1]==null)return 0;let r=0,c=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let u=0;u<c.length;u++){if(c[u]==null)continue;let m=c[u].getRowNumber(),w=0;for(let v=this.barcodeColumnCount+1;v>0&&w<this.ADJUST_ROW_NUMBER_SKIP;v--){let C=this.detectionResultColumns[v].getCodewords()[u];C!=null&&(w=Vi.adjustRowNumberIfValid(m,w,C),C.hasValidRowNumber()||r++)}}return r}adjustRowNumbersFromLRI(){if(this.detectionResultColumns[0]==null)return 0;let r=0,c=this.detectionResultColumns[0].getCodewords();for(let u=0;u<c.length;u++){if(c[u]==null)continue;let m=c[u].getRowNumber(),w=0;for(let v=1;v<this.barcodeColumnCount+1&&w<this.ADJUST_ROW_NUMBER_SKIP;v++){let C=this.detectionResultColumns[v].getCodewords()[u];C!=null&&(w=Vi.adjustRowNumberIfValid(m,w,C),C.hasValidRowNumber()||r++)}}return r}static adjustRowNumberIfValid(r,c,u){return u==null||u.hasValidRowNumber()||(u.isValidRowNumber(r)?(u.setRowNumber(r),c=0):++c),c}adjustRowNumbers(r,c,u){if(!this.detectionResultColumns[r-1])return;let m=u[c],w=this.detectionResultColumns[r-1].getCodewords(),v=w;this.detectionResultColumns[r+1]!=null&&(v=this.detectionResultColumns[r+1].getCodewords());let C=new Array(14);C[2]=w[c],C[3]=v[c],c>0&&(C[0]=u[c-1],C[4]=w[c-1],C[5]=v[c-1]),c>1&&(C[8]=u[c-2],C[10]=w[c-2],C[11]=v[c-2]),c<u.length-1&&(C[1]=u[c+1],C[6]=w[c+1],C[7]=v[c+1]),c<u.length-2&&(C[9]=u[c+2],C[12]=w[c+2],C[13]=v[c+2]);for(let k of C)if(Vi.adjustRowNumber(m,k))return}static adjustRowNumber(r,c){return c==null?!1:c.hasValidRowNumber()&&c.getBucket()===r.getBucket()?(r.setRowNumber(c.getRowNumber()),!0):!1}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(r){this.boundingBox=r}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(r,c){this.detectionResultColumns[r]=c}getDetectionResultColumn(r){return this.detectionResultColumns[r]}toString(){let r=this.detectionResultColumns[0];r==null&&(r=this.detectionResultColumns[this.barcodeColumnCount+1]);let c=new Sr;for(let u=0;u<r.getCodewords().length;u++){c.format("CW %3d:",u);for(let m=0;m<this.barcodeColumnCount+2;m++){if(this.detectionResultColumns[m]==null){c.format("    |   ");continue}let w=this.detectionResultColumns[m].getCodewords()[u];if(w==null){c.format("    |   ");continue}c.format(" %3d|%3d",w.getRowNumber(),w.getValue())}c.format("%n")}return c.toString()}}class $r{constructor(r,c,u,m){this.rowNumber=$r.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(r),this.endX=Math.trunc(c),this.bucket=Math.trunc(u),this.value=Math.trunc(m)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(r){return r!==$r.BARCODE_ROW_UNKNOWN&&this.bucket===r%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(Math.trunc(this.value/30)*3+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(r){this.rowNumber=r}toString(){return this.rowNumber+"|"+this.value}}$r.BARCODE_ROW_UNKNOWN=-1;class vn{static initialize(){for(let r=0;r<xt.SYMBOL_TABLE.length;r++){let c=xt.SYMBOL_TABLE[r],u=c&1;for(let m=0;m<xt.BARS_IN_MODULE;m++){let w=0;for(;(c&1)===u;)w+=1,c>>=1;u=c&1,vn.RATIOS_TABLE[r]||(vn.RATIOS_TABLE[r]=new Array(xt.BARS_IN_MODULE)),vn.RATIOS_TABLE[r][xt.BARS_IN_MODULE-m-1]=Math.fround(w/xt.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(r){let c=vn.getDecodedCodewordValue(vn.sampleBitCounts(r));return c!==-1?c:vn.getClosestDecodedValue(r)}static sampleBitCounts(r){let c=tt.sum(r),u=new Int32Array(xt.BARS_IN_MODULE),m=0,w=0;for(let v=0;v<xt.MODULES_IN_CODEWORD;v++){let C=c/(2*xt.MODULES_IN_CODEWORD)+v*c/xt.MODULES_IN_CODEWORD;w+r[m]<=C&&(w+=r[m],m++),u[m]++}return u}static getDecodedCodewordValue(r){let c=vn.getBitValue(r);return xt.getCodeword(c)===-1?-1:c}static getBitValue(r){let c=0;for(let u=0;u<r.length;u++)for(let m=0;m<r[u];m++)c=c<<1|(u%2===0?1:0);return Math.trunc(c)}static getClosestDecodedValue(r){let c=tt.sum(r),u=new Array(xt.BARS_IN_MODULE);if(c>1)for(let v=0;v<u.length;v++)u[v]=Math.fround(r[v]/c);let m=bt.MAX_VALUE,w=-1;this.bSymbolTableReady||vn.initialize();for(let v=0;v<vn.RATIOS_TABLE.length;v++){let C=0,k=vn.RATIOS_TABLE[v];for(let O=0;O<xt.BARS_IN_MODULE;O++){let Z=Math.fround(k[O]-u[O]);if(C+=Math.fround(Z*Z),C>=m)break}C<m&&(m=C,w=xt.SYMBOL_TABLE[v])}return w}}vn.bSymbolTableReady=!1,vn.RATIOS_TABLE=new Array(xt.SYMBOL_TABLE.length).map(oe=>new Array(xt.BARS_IN_MODULE));class xs{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(r){this.segmentIndex=r}getFileId(){return this.fileId}setFileId(r){this.fileId=r}getOptionalData(){return this.optionalData}setOptionalData(r){this.optionalData=r}isLastSegment(){return this.lastSegment}setLastSegment(r){this.lastSegment=r}getSegmentCount(){return this.segmentCount}setSegmentCount(r){this.segmentCount=r}getSender(){return this.sender||null}setSender(r){this.sender=r}getAddressee(){return this.addressee||null}setAddressee(r){this.addressee=r}getFileName(){return this.fileName}setFileName(r){this.fileName=r}getFileSize(){return this.fileSize}setFileSize(r){this.fileSize=r}getChecksum(){return this.checksum}setChecksum(r){this.checksum=r}getTimestamp(){return this.timestamp}setTimestamp(r){this.timestamp=r}}class Js{static parseLong(r,c=void 0){return parseInt(r,c)}}class Ar extends g{}Ar.kind="NullPointerException";class eo{writeBytes(r){this.writeBytesOffset(r,0,r.length)}writeBytesOffset(r,c,u){if(r==null)throw new Ar;if(c<0||c>r.length||u<0||c+u>r.length||c+u<0)throw new R;if(u===0)return;for(let m=0;m<u;m++)this.write(r[c+m])}flush(){}close(){}}class Es extends g{}class Uo extends eo{constructor(r=32){if(super(),this.count=0,r<0)throw new E("Negative initial size: "+r);this.buf=new Uint8Array(r)}ensureCapacity(r){r-this.buf.length>0&&this.grow(r)}grow(r){let u=this.buf.length<<1;if(u-r<0&&(u=r),u<0){if(r<0)throw new Es;u=M.MAX_VALUE}this.buf=D.copyOfUint8Array(this.buf,u)}write(r){this.ensureCapacity(this.count+1),this.buf[this.count]=r,this.count+=1}writeBytesOffset(r,c,u){if(c<0||c>r.length||u<0||c+u-r.length>0)throw new R;this.ensureCapacity(this.count+u),_.arraycopy(r,c,this.buf,this.count,u),this.count+=u}writeTo(r){r.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return D.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(r){return r?typeof r=="string"?this.toString_string(r):this.toString_number(r):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(r){return new String(this.buf).toString()}toString_number(r){return new String(this.buf).toString()}close(){}}var Ut;(function(oe){oe[oe.ALPHA=0]="ALPHA",oe[oe.LOWER=1]="LOWER",oe[oe.MIXED=2]="MIXED",oe[oe.PUNCT=3]="PUNCT",oe[oe.ALPHA_SHIFT=4]="ALPHA_SHIFT",oe[oe.PUNCT_SHIFT=5]="PUNCT_SHIFT"})(Ut||(Ut={}));function zi(){if(typeof window<"u")return window.BigInt||null;if(typeof commonjsGlobal<"u")return commonjsGlobal.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let Wi;function cn(oe){if(typeof Wi>"u"&&(Wi=zi()),Wi===null)throw new Error("BigInt is not supported!");return Wi(oe)}function oi(){let oe=[];oe[0]=cn(1);let r=cn(900);oe[1]=r;for(let c=2;c<16;c++)oe[c]=oe[c-1]*r;return oe}class He{static decode(r,c){let u=new G(""),m=j.ISO8859_1;u.enableDecoding(m);let w=1,v=r[w++],C=new xs;for(;w<r[0];){switch(v){case He.TEXT_COMPACTION_MODE_LATCH:w=He.textCompaction(r,w,u);break;case He.BYTE_COMPACTION_MODE_LATCH:case He.BYTE_COMPACTION_MODE_LATCH_6:w=He.byteCompaction(v,r,m,w,u);break;case He.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:u.append(r[w++]);break;case He.NUMERIC_COMPACTION_MODE_LATCH:w=He.numericCompaction(r,w,u);break;case He.ECI_CHARSET:j.getCharacterSetECIByValue(r[w++]);break;case He.ECI_GENERAL_PURPOSE:w+=2;break;case He.ECI_USER_DEFINED:w++;break;case He.BEGIN_MACRO_PDF417_CONTROL_BLOCK:w=He.decodeMacroBlock(r,w,C);break;case He.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case He.MACRO_PDF417_TERMINATOR:throw new P;default:w--,w=He.textCompaction(r,w,u);break}if(w<r.length)v=r[w++];else throw P.getFormatInstance()}if(u.length()===0)throw P.getFormatInstance();let k=new Me(null,u.toString(),null,c);return k.setOther(C),k}static decodeMacroBlock(r,c,u){if(c+He.NUMBER_OF_SEQUENCE_CODEWORDS>r[0])throw P.getFormatInstance();let m=new Int32Array(He.NUMBER_OF_SEQUENCE_CODEWORDS);for(let C=0;C<He.NUMBER_OF_SEQUENCE_CODEWORDS;C++,c++)m[C]=r[c];u.setSegmentIndex(M.parseInt(He.decodeBase900toBase10(m,He.NUMBER_OF_SEQUENCE_CODEWORDS)));let w=new G;c=He.textCompaction(r,c,w),u.setFileId(w.toString());let v=-1;for(r[c]===He.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(v=c+1);c<r[0];)switch(r[c]){case He.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(c++,r[c]){case He.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let C=new G;c=He.textCompaction(r,c+1,C),u.setFileName(C.toString());break;case He.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let k=new G;c=He.textCompaction(r,c+1,k),u.setSender(k.toString());break;case He.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let O=new G;c=He.textCompaction(r,c+1,O),u.setAddressee(O.toString());break;case He.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let Z=new G;c=He.numericCompaction(r,c+1,Z),u.setSegmentCount(M.parseInt(Z.toString()));break;case He.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let le=new G;c=He.numericCompaction(r,c+1,le),u.setTimestamp(Js.parseLong(le.toString()));break;case He.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let he=new G;c=He.numericCompaction(r,c+1,he),u.setChecksum(M.parseInt(he.toString()));break;case He.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let Ee=new G;c=He.numericCompaction(r,c+1,Ee),u.setFileSize(Js.parseLong(Ee.toString()));break;default:throw P.getFormatInstance()}break;case He.MACRO_PDF417_TERMINATOR:c++,u.setLastSegment(!0);break;default:throw P.getFormatInstance()}if(v!==-1){let C=c-v;u.isLastSegment()&&C--,u.setOptionalData(D.copyOfRange(r,v,v+C))}return c}static textCompaction(r,c,u){let m=new Int32Array((r[0]-c)*2),w=new Int32Array((r[0]-c)*2),v=0,C=!1;for(;c<r[0]&&!C;){let k=r[c++];if(k<He.TEXT_COMPACTION_MODE_LATCH)m[v]=k/30,m[v+1]=k%30,v+=2;else switch(k){case He.TEXT_COMPACTION_MODE_LATCH:m[v++]=He.TEXT_COMPACTION_MODE_LATCH;break;case He.BYTE_COMPACTION_MODE_LATCH:case He.BYTE_COMPACTION_MODE_LATCH_6:case He.NUMERIC_COMPACTION_MODE_LATCH:case He.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case He.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case He.MACRO_PDF417_TERMINATOR:c--,C=!0;break;case He.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:m[v]=He.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,k=r[c++],w[v]=k,v++;break}}return He.decodeTextCompaction(m,w,v,u),c}static decodeTextCompaction(r,c,u,m){let w=Ut.ALPHA,v=Ut.ALPHA,C=0;for(;C<u;){let k=r[C],O="";switch(w){case Ut.ALPHA:if(k<26)O=String.fromCharCode(65+k);else switch(k){case 26:O=" ";break;case He.LL:w=Ut.LOWER;break;case He.ML:w=Ut.MIXED;break;case He.PS:v=w,w=Ut.PUNCT_SHIFT;break;case He.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:m.append(c[C]);break;case He.TEXT_COMPACTION_MODE_LATCH:w=Ut.ALPHA;break}break;case Ut.LOWER:if(k<26)O=String.fromCharCode(97+k);else switch(k){case 26:O=" ";break;case He.AS:v=w,w=Ut.ALPHA_SHIFT;break;case He.ML:w=Ut.MIXED;break;case He.PS:v=w,w=Ut.PUNCT_SHIFT;break;case He.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:m.append(c[C]);break;case He.TEXT_COMPACTION_MODE_LATCH:w=Ut.ALPHA;break}break;case Ut.MIXED:if(k<He.PL)O=He.MIXED_CHARS[k];else switch(k){case He.PL:w=Ut.PUNCT;break;case 26:O=" ";break;case He.LL:w=Ut.LOWER;break;case He.AL:w=Ut.ALPHA;break;case He.PS:v=w,w=Ut.PUNCT_SHIFT;break;case He.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:m.append(c[C]);break;case He.TEXT_COMPACTION_MODE_LATCH:w=Ut.ALPHA;break}break;case Ut.PUNCT:if(k<He.PAL)O=He.PUNCT_CHARS[k];else switch(k){case He.PAL:w=Ut.ALPHA;break;case He.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:m.append(c[C]);break;case He.TEXT_COMPACTION_MODE_LATCH:w=Ut.ALPHA;break}break;case Ut.ALPHA_SHIFT:if(w=v,k<26)O=String.fromCharCode(65+k);else switch(k){case 26:O=" ";break;case He.TEXT_COMPACTION_MODE_LATCH:w=Ut.ALPHA;break}break;case Ut.PUNCT_SHIFT:if(w=v,k<He.PAL)O=He.PUNCT_CHARS[k];else switch(k){case He.PAL:w=Ut.ALPHA;break;case He.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:m.append(c[C]);break;case He.TEXT_COMPACTION_MODE_LATCH:w=Ut.ALPHA;break}break}O!==""&&m.append(O),C++}}static byteCompaction(r,c,u,m,w){let v=new Uo,C=0,k=0,O=!1;switch(r){case He.BYTE_COMPACTION_MODE_LATCH:let Z=new Int32Array(6),le=c[m++];for(;m<c[0]&&!O;)switch(Z[C++]=le,k=900*k+le,le=c[m++],le){case He.TEXT_COMPACTION_MODE_LATCH:case He.BYTE_COMPACTION_MODE_LATCH:case He.NUMERIC_COMPACTION_MODE_LATCH:case He.BYTE_COMPACTION_MODE_LATCH_6:case He.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case He.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case He.MACRO_PDF417_TERMINATOR:m--,O=!0;break;default:if(C%5===0&&C>0){for(let he=0;he<6;++he)v.write(Number(cn(k)>>cn(8*(5-he))));k=0,C=0}break}m===c[0]&&le<He.TEXT_COMPACTION_MODE_LATCH&&(Z[C++]=le);for(let he=0;he<C;he++)v.write(Z[he]);break;case He.BYTE_COMPACTION_MODE_LATCH_6:for(;m<c[0]&&!O;){let he=c[m++];if(he<He.TEXT_COMPACTION_MODE_LATCH)C++,k=900*k+he;else switch(he){case He.TEXT_COMPACTION_MODE_LATCH:case He.BYTE_COMPACTION_MODE_LATCH:case He.NUMERIC_COMPACTION_MODE_LATCH:case He.BYTE_COMPACTION_MODE_LATCH_6:case He.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case He.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case He.MACRO_PDF417_TERMINATOR:m--,O=!0;break}if(C%5===0&&C>0){for(let Ee=0;Ee<6;++Ee)v.write(Number(cn(k)>>cn(8*(5-Ee))));k=0,C=0}}break}return w.append($.decode(v.toByteArray(),u)),m}static numericCompaction(r,c,u){let m=0,w=!1,v=new Int32Array(He.MAX_NUMERIC_CODEWORDS);for(;c<r[0]&&!w;){let C=r[c++];if(c===r[0]&&(w=!0),C<He.TEXT_COMPACTION_MODE_LATCH)v[m]=C,m++;else switch(C){case He.TEXT_COMPACTION_MODE_LATCH:case He.BYTE_COMPACTION_MODE_LATCH:case He.BYTE_COMPACTION_MODE_LATCH_6:case He.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case He.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case He.MACRO_PDF417_TERMINATOR:c--,w=!0;break}(m%He.MAX_NUMERIC_CODEWORDS===0||C===He.NUMERIC_COMPACTION_MODE_LATCH||w)&&m>0&&(u.append(He.decodeBase900toBase10(v,m)),m=0)}return c}static decodeBase900toBase10(r,c){let u=cn(0);for(let w=0;w<c;w++)u+=He.EXP900[c-w-1]*cn(r[w]);let m=u.toString();if(m.charAt(0)!=="1")throw new P;return m.substring(1)}}He.TEXT_COMPACTION_MODE_LATCH=900,He.BYTE_COMPACTION_MODE_LATCH=901,He.NUMERIC_COMPACTION_MODE_LATCH=902,He.BYTE_COMPACTION_MODE_LATCH_6=924,He.ECI_USER_DEFINED=925,He.ECI_GENERAL_PURPOSE=926,He.ECI_CHARSET=927,He.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,He.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,He.MACRO_PDF417_TERMINATOR=922,He.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,He.MAX_NUMERIC_CODEWORDS=15,He.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,He.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,He.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,He.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,He.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,He.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,He.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,He.PL=25,He.LL=27,He.AS=27,He.ML=28,He.AL=28,He.PS=29,He.PAL=29,He.PUNCT_CHARS=`;<>@[\\]_\`~!\r	,:
-.$/"|*()?{}'`,He.MIXED_CHARS="0123456789&\r	,:#-.$/+%*=^",He.EXP900=zi()?oi():[],He.NUMBER_OF_SEQUENCE_CODEWORDS=2;class _t{constructor(){}static decode(r,c,u,m,w,v,C){let k=new Hr(r,c,u,m,w),O=null,Z=null,le;for(let Ce=!0;;Ce=!1){if(c!=null&&(O=_t.getRowIndicatorColumn(r,k,c,!0,v,C)),m!=null&&(Z=_t.getRowIndicatorColumn(r,k,m,!1,v,C)),le=_t.merge(O,Z),le==null)throw H.getNotFoundInstance();let Ie=le.getBoundingBox();if(Ce&&Ie!=null&&(Ie.getMinY()<k.getMinY()||Ie.getMaxY()>k.getMaxY()))k=Ie;else break}le.setBoundingBox(k);let he=le.getBarcodeColumnCount()+1;le.setDetectionResultColumn(0,O),le.setDetectionResultColumn(he,Z);let Ee=O!=null;for(let Ce=1;Ce<=he;Ce++){let Ie=Ee?Ce:he-Ce;if(le.getDetectionResultColumn(Ie)!==void 0)continue;let Re;Ie===0||Ie===he?Re=new Lo(k,Ie===0):Re=new pr(k),le.setDetectionResultColumn(Ie,Re);let Fe=-1,Xe=Fe;for(let Je=k.getMinY();Je<=k.getMaxY();Je++){if(Fe=_t.getStartColumn(le,Ie,Je,Ee),Fe<0||Fe>k.getMaxX()){if(Xe===-1)continue;Fe=Xe}let Ye=_t.detectCodeword(r,k.getMinX(),k.getMaxX(),Ee,Fe,Je,v,C);Ye!=null&&(Re.setCodeword(Je,Ye),Xe=Fe,v=Math.min(v,Ye.getWidth()),C=Math.max(C,Ye.getWidth()))}}return _t.createDecoderResult(le)}static merge(r,c){if(r==null&&c==null)return null;let u=_t.getBarcodeMetadata(r,c);if(u==null)return null;let m=Hr.merge(_t.adjustBoundingBox(r),_t.adjustBoundingBox(c));return new Vi(u,m)}static adjustBoundingBox(r){if(r==null)return null;let c=r.getRowHeights();if(c==null)return null;let u=_t.getMax(c),m=0;for(let C of c)if(m+=u-C,C>0)break;let w=r.getCodewords();for(let C=0;m>0&&w[C]==null;C++)m--;let v=0;for(let C=c.length-1;C>=0&&(v+=u-c[C],!(c[C]>0));C--);for(let C=w.length-1;v>0&&w[C]==null;C--)v--;return r.getBoundingBox().addMissingRows(m,v,r.isLeft())}static getMax(r){let c=-1;for(let u of r)c=Math.max(c,u);return c}static getBarcodeMetadata(r,c){let u;if(r==null||(u=r.getBarcodeMetadata())==null)return c==null?null:c.getBarcodeMetadata();let m;return c==null||(m=c.getBarcodeMetadata())==null?u:u.getColumnCount()!==m.getColumnCount()&&u.getErrorCorrectionLevel()!==m.getErrorCorrectionLevel()&&u.getRowCount()!==m.getRowCount()?null:u}static getRowIndicatorColumn(r,c,u,m,w,v){let C=new Lo(c,m);for(let k=0;k<2;k++){let O=k===0?1:-1,Z=Math.trunc(Math.trunc(u.getX()));for(let le=Math.trunc(Math.trunc(u.getY()));le<=c.getMaxY()&&le>=c.getMinY();le+=O){let he=_t.detectCodeword(r,0,r.getWidth(),m,Z,le,w,v);he!=null&&(C.setCodeword(le,he),m?Z=he.getStartX():Z=he.getEndX())}}return C}static adjustCodewordCount(r,c){let u=c[0][1],m=u.getValue(),w=r.getBarcodeColumnCount()*r.getBarcodeRowCount()-_t.getNumberOfECCodeWords(r.getBarcodeECLevel());if(m.length===0){if(w<1||w>xt.MAX_CODEWORDS_IN_BARCODE)throw H.getNotFoundInstance();u.setValue(w)}else m[0]!==w&&u.setValue(w)}static createDecoderResult(r){let c=_t.createBarcodeMatrix(r);_t.adjustCodewordCount(r,c);let u=new Array,m=new Int32Array(r.getBarcodeRowCount()*r.getBarcodeColumnCount()),w=[],v=new Array;for(let k=0;k<r.getBarcodeRowCount();k++)for(let O=0;O<r.getBarcodeColumnCount();O++){let Z=c[k][O+1].getValue(),le=k*r.getBarcodeColumnCount()+O;Z.length===0?u.push(le):Z.length===1?m[le]=Z[0]:(v.push(le),w.push(Z))}let C=new Array(w.length);for(let k=0;k<C.length;k++)C[k]=w[k];return _t.createDecoderResultFromAmbiguousValues(r.getBarcodeECLevel(),m,xt.toIntArray(u),xt.toIntArray(v),C)}static createDecoderResultFromAmbiguousValues(r,c,u,m,w){let v=new Int32Array(m.length),C=100;for(;C-- >0;){for(let k=0;k<v.length;k++)c[m[k]]=w[k][v[k]];try{return _t.decodeCodewords(c,r,u)}catch(k){if(!(k instanceof S))throw k}if(v.length===0)throw S.getChecksumInstance();for(let k=0;k<v.length;k++)if(v[k]<w[k].length-1){v[k]++;break}else if(v[k]=0,k===v.length-1)throw S.getChecksumInstance()}throw S.getChecksumInstance()}static createBarcodeMatrix(r){let c=Array.from({length:r.getBarcodeRowCount()},()=>new Array(r.getBarcodeColumnCount()+2));for(let m=0;m<c.length;m++)for(let w=0;w<c[m].length;w++)c[m][w]=new Pr;let u=0;for(let m of r.getDetectionResultColumns()){if(m!=null){for(let w of m.getCodewords())if(w!=null){let v=w.getRowNumber();if(v>=0){if(v>=c.length)continue;c[v][u].setValue(w.getValue())}}}u++}return c}static isValidBarcodeColumn(r,c){return c>=0&&c<=r.getBarcodeColumnCount()+1}static getStartColumn(r,c,u,m){let w=m?1:-1,v=null;if(_t.isValidBarcodeColumn(r,c-w)&&(v=r.getDetectionResultColumn(c-w).getCodeword(u)),v!=null)return m?v.getEndX():v.getStartX();if(v=r.getDetectionResultColumn(c).getCodewordNearby(u),v!=null)return m?v.getStartX():v.getEndX();if(_t.isValidBarcodeColumn(r,c-w)&&(v=r.getDetectionResultColumn(c-w).getCodewordNearby(u)),v!=null)return m?v.getEndX():v.getStartX();let C=0;for(;_t.isValidBarcodeColumn(r,c-w);){c-=w;for(let k of r.getDetectionResultColumn(c).getCodewords())if(k!=null)return(m?k.getEndX():k.getStartX())+w*C*(k.getEndX()-k.getStartX());C++}return m?r.getBoundingBox().getMinX():r.getBoundingBox().getMaxX()}static detectCodeword(r,c,u,m,w,v,C,k){w=_t.adjustCodewordStartColumn(r,c,u,m,w,v);let O=_t.getModuleBitCount(r,c,u,m,w,v);if(O==null)return null;let Z,le=tt.sum(O);if(m)Z=w+le;else{for(let Ce=0;Ce<O.length/2;Ce++){let Ie=O[Ce];O[Ce]=O[O.length-1-Ce],O[O.length-1-Ce]=Ie}Z=w,w=Z-le}if(!_t.checkCodewordSkew(le,C,k))return null;let he=vn.getDecodedValue(O),Ee=xt.getCodeword(he);return Ee===-1?null:new $r(w,Z,_t.getCodewordBucketNumber(he),Ee)}static getModuleBitCount(r,c,u,m,w,v){let C=w,k=new Int32Array(8),O=0,Z=m?1:-1,le=m;for(;(m?C<u:C>=c)&&O<k.length;)r.get(C,v)===le?(k[O]++,C+=Z):(O++,le=!le);return O===k.length||C===(m?u:c)&&O===k.length-1?k:null}static getNumberOfECCodeWords(r){return 2<<r}static adjustCodewordStartColumn(r,c,u,m,w,v){let C=w,k=m?-1:1;for(let O=0;O<2;O++){for(;(m?C>=c:C<u)&&m===r.get(C,v);){if(Math.abs(w-C)>_t.CODEWORD_SKEW_SIZE)return w;C+=k}k=-k,m=!m}return C}static checkCodewordSkew(r,c,u){return c-_t.CODEWORD_SKEW_SIZE<=r&&r<=u+_t.CODEWORD_SKEW_SIZE}static decodeCodewords(r,c,u){if(r.length===0)throw P.getFormatInstance();let m=1<<c+1,w=_t.correctErrors(r,u,m);_t.verifyCodewordCount(r,m);let v=He.decode(r,""+c);return v.setErrorsCorrected(w),v.setErasures(u.length),v}static correctErrors(r,c,u){if(c!=null&&c.length>u/2+_t.MAX_ERRORS||u<0||u>_t.MAX_EC_CODEWORDS)throw S.getChecksumInstance();return _t.errorCorrection.decode(r,u,c)}static verifyCodewordCount(r,c){if(r.length<4)throw P.getFormatInstance();let u=r[0];if(u>r.length)throw P.getFormatInstance();if(u===0)if(c<r.length)r[0]=r.length-c;else throw P.getFormatInstance()}static getBitCountForCodeword(r){let c=new Int32Array(8),u=0,m=c.length-1;for(;!((r&1)!==u&&(u=r&1,m--,m<0));)c[m]++,r>>=1;return c}static getCodewordBucketNumber(r){return r instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(r):this.getCodewordBucketNumber_number(r)}static getCodewordBucketNumber_number(r){return _t.getCodewordBucketNumber(_t.getBitCountForCodeword(r))}static getCodewordBucketNumber_Int32Array(r){return(r[0]-r[2]+r[4]-r[6]+9)%9}static toString(r){let c=new Sr;for(let u=0;u<r.length;u++){c.format("Row %2d: ",u);for(let m=0;m<r[u].length;m++){let w=r[u][m];w.getValue().length===0?c.format("        ",null):c.format("%4d(%2d)",w.getValue()[0],w.getConfidence(w.getValue()[0]))}c.format("%n")}return c.toString()}}_t.CODEWORD_SKEW_SIZE=2,_t.MAX_ERRORS=3,_t.MAX_EC_CODEWORDS=512,_t.errorCorrection=new Zs;class bn{decode(r,c=null){let u=bn.decode(r,c,!1);if(u==null||u.length===0||u[0]==null)throw H.getNotFoundInstance();return u[0]}decodeMultiple(r,c=null){try{return bn.decode(r,c,!0)}catch(u){throw u instanceof P||u instanceof S?H.getNotFoundInstance():u}}static decode(r,c,u){const m=new Array,w=At.detectMultiple(r,c,u);for(const v of w.getPoints()){const C=_t.decode(w.getBits(),v[4],v[5],v[6],v[7],bn.getMinCodewordWidth(v),bn.getMaxCodewordWidth(v)),k=new ce(C.getText(),C.getRawBytes(),void 0,v,me.PDF_417);k.putMetadata(be.ERROR_CORRECTION_LEVEL,C.getECLevel());const O=C.getOther();O!=null&&k.putMetadata(be.PDF417_EXTRA_METADATA,O),m.push(k)}return m.map(v=>v)}static getMaxWidth(r,c){return r==null||c==null?0:Math.trunc(Math.abs(r.getX()-c.getX()))}static getMinWidth(r,c){return r==null||c==null?M.MAX_VALUE:Math.trunc(Math.abs(r.getX()-c.getX()))}static getMaxCodewordWidth(r){return Math.floor(Math.max(Math.max(bn.getMaxWidth(r[0],r[4]),bn.getMaxWidth(r[6],r[2])*xt.MODULES_IN_CODEWORD/xt.MODULES_IN_STOP_PATTERN),Math.max(bn.getMaxWidth(r[1],r[5]),bn.getMaxWidth(r[7],r[3])*xt.MODULES_IN_CODEWORD/xt.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(r){return Math.floor(Math.min(Math.min(bn.getMinWidth(r[0],r[4]),bn.getMinWidth(r[6],r[2])*xt.MODULES_IN_CODEWORD/xt.MODULES_IN_STOP_PATTERN),Math.min(bn.getMinWidth(r[1],r[5]),bn.getMinWidth(r[7],r[3])*xt.MODULES_IN_CODEWORD/xt.MODULES_IN_STOP_PATTERN)))}reset(){}}class ai extends g{}ai.kind="ReaderException";class vs{constructor(r,c){this.verbose=r===!0,c&&this.setHints(c)}decode(r,c){return c&&this.setHints(c),this.decodeInternal(r)}decodeWithState(r){return(this.readers===null||this.readers===void 0)&&this.setHints(null),this.decodeInternal(r)}setHints(r){this.hints=r;const c=!s(r)&&r.get(U.TRY_HARDER)===!0,u=s(r)?null:r.get(U.POSSIBLE_FORMATS),m=new Array;if(!s(u)){const w=u.some(v=>v===me.UPC_A||v===me.UPC_E||v===me.EAN_13||v===me.EAN_8||v===me.CODABAR||v===me.CODE_39||v===me.CODE_93||v===me.CODE_128||v===me.ITF||v===me.RSS_14||v===me.RSS_EXPANDED);w&&!c&&m.push(new ni(r,this.verbose)),u.includes(me.QR_CODE)&&m.push(new kn),u.includes(me.DATA_MATRIX)&&m.push(new ir),u.includes(me.AZTEC)&&m.push(new Ae),u.includes(me.PDF_417)&&m.push(new bn),w&&c&&m.push(new ni(r,this.verbose))}m.length===0&&(c||m.push(new ni(r,this.verbose)),m.push(new kn),m.push(new ir),m.push(new Ae),m.push(new bn),c&&m.push(new ni(r,this.verbose))),this.readers=m}reset(){if(this.readers!==null)for(const r of this.readers)r.reset()}decodeInternal(r){if(this.readers===null)throw new ai("No readers where selected, nothing can be read.");for(const c of this.readers)try{return c.decode(r,this.hints)}catch(u){if(u instanceof ai)continue}throw new H("No MultiFormat Readers were able to detect the code.")}}class qi extends te{constructor(r=null,c=500){const u=new vs;u.setHints(r),super(u,c)}decodeBitmap(r){return this.reader.decodeWithState(r)}}class bs extends te{constructor(r=500){super(new bn,r)}}class Fo extends te{constructor(r=500){super(new kn,r)}}var to;(function(oe){oe[oe.ERROR_CORRECTION=0]="ERROR_CORRECTION",oe[oe.CHARACTER_SET=1]="CHARACTER_SET",oe[oe.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",oe[oe.MIN_SIZE=3]="MIN_SIZE",oe[oe.MAX_SIZE=4]="MAX_SIZE",oe[oe.MARGIN=5]="MARGIN",oe[oe.PDF417_COMPACT=6]="PDF417_COMPACT",oe[oe.PDF417_COMPACTION=7]="PDF417_COMPACTION",oe[oe.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",oe[oe.AZTEC_LAYERS=9]="AZTEC_LAYERS",oe[oe.QR_VERSION=10]="QR_VERSION"})(to||(to={}));var hn=to;class no{constructor(r){this.field=r,this.cachedGenerators=[],this.cachedGenerators.push(new Ue(r,Int32Array.from([1])))}buildGenerator(r){const c=this.cachedGenerators;if(r>=c.length){let u=c[c.length-1];const m=this.field;for(let w=c.length;w<=r;w++){const v=u.multiply(new Ue(m,Int32Array.from([1,m.exp(w-1+m.getGeneratorBase())])));c.push(v),u=v}}return c[r]}encode(r,c){if(c===0)throw new E("No error correction bytes");const u=r.length-c;if(u<=0)throw new E("No data bytes provided");const m=this.buildGenerator(c),w=new Int32Array(u);_.arraycopy(r,0,w,0,u);let v=new Ue(this.field,w);v=v.multiplyByMonomial(c,1);const k=v.divide(m)[1].getCoefficients(),O=c-k.length;for(let Z=0;Z<O;Z++)r[u+Z]=0;_.arraycopy(k,0,r,u+O,k.length)}}class Zt{constructor(){}static applyMaskPenaltyRule1(r){return Zt.applyMaskPenaltyRule1Internal(r,!0)+Zt.applyMaskPenaltyRule1Internal(r,!1)}static applyMaskPenaltyRule2(r){let c=0;const u=r.getArray(),m=r.getWidth(),w=r.getHeight();for(let v=0;v<w-1;v++){const C=u[v];for(let k=0;k<m-1;k++){const O=C[k];O===C[k+1]&&O===u[v+1][k]&&O===u[v+1][k+1]&&c++}}return Zt.N2*c}static applyMaskPenaltyRule3(r){let c=0;const u=r.getArray(),m=r.getWidth(),w=r.getHeight();for(let v=0;v<w;v++)for(let C=0;C<m;C++){const k=u[v];C+6<m&&k[C]===1&&k[C+1]===0&&k[C+2]===1&&k[C+3]===1&&k[C+4]===1&&k[C+5]===0&&k[C+6]===1&&(Zt.isWhiteHorizontal(k,C-4,C)||Zt.isWhiteHorizontal(k,C+7,C+11))&&c++,v+6<w&&u[v][C]===1&&u[v+1][C]===0&&u[v+2][C]===1&&u[v+3][C]===1&&u[v+4][C]===1&&u[v+5][C]===0&&u[v+6][C]===1&&(Zt.isWhiteVertical(u,C,v-4,v)||Zt.isWhiteVertical(u,C,v+7,v+11))&&c++}return c*Zt.N3}static isWhiteHorizontal(r,c,u){c=Math.max(c,0),u=Math.min(u,r.length);for(let m=c;m<u;m++)if(r[m]===1)return!1;return!0}static isWhiteVertical(r,c,u,m){u=Math.max(u,0),m=Math.min(m,r.length);for(let w=u;w<m;w++)if(r[w][c]===1)return!1;return!0}static applyMaskPenaltyRule4(r){let c=0;const u=r.getArray(),m=r.getWidth(),w=r.getHeight();for(let k=0;k<w;k++){const O=u[k];for(let Z=0;Z<m;Z++)O[Z]===1&&c++}const v=r.getHeight()*r.getWidth();return Math.floor(Math.abs(c*2-v)*10/v)*Zt.N4}static getDataMaskBit(r,c,u){let m,w;switch(r){case 0:m=u+c&1;break;case 1:m=u&1;break;case 2:m=c%3;break;case 3:m=(u+c)%3;break;case 4:m=Math.floor(u/2)+Math.floor(c/3)&1;break;case 5:w=u*c,m=(w&1)+w%3;break;case 6:w=u*c,m=(w&1)+w%3&1;break;case 7:w=u*c,m=w%3+(u+c&1)&1;break;default:throw new E("Invalid mask pattern: "+r)}return m===0}static applyMaskPenaltyRule1Internal(r,c){let u=0;const m=c?r.getHeight():r.getWidth(),w=c?r.getWidth():r.getHeight(),v=r.getArray();for(let C=0;C<m;C++){let k=0,O=-1;for(let Z=0;Z<w;Z++){const le=c?v[C][Z]:v[Z][C];le===O?k++:(k>=5&&(u+=Zt.N1+(k-5)),k=1,O=le)}k>=5&&(u+=Zt.N1+(k-5))}return u}}Zt.N1=3,Zt.N2=3,Zt.N3=40,Zt.N4=10;class Ss{constructor(r,c){this.width=r,this.height=c;const u=new Array(c);for(let m=0;m!==c;m++)u[m]=new Uint8Array(r);this.bytes=u}getHeight(){return this.height}getWidth(){return this.width}get(r,c){return this.bytes[c][r]}getArray(){return this.bytes}setNumber(r,c,u){this.bytes[c][r]=u}setBoolean(r,c,u){this.bytes[c][r]=u?1:0}clear(r){for(const c of this.bytes)D.fill(c,r)}equals(r){if(!(r instanceof Ss))return!1;const c=r;if(this.width!==c.width||this.height!==c.height)return!1;for(let u=0,m=this.height;u<m;++u){const w=this.bytes[u],v=c.bytes[u];for(let C=0,k=this.width;C<k;++C)if(w[C]!==v[C])return!1}return!0}toString(){const r=new G;for(let c=0,u=this.height;c<u;++c){const m=this.bytes[c];for(let w=0,v=this.width;w<v;++w)switch(m[w]){case 0:r.append(" 0");break;case 1:r.append(" 1");break;default:r.append("  ");break}r.append(`
`)}return r.toString()}}class jr{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const r=new G;return r.append(`<<
`),r.append(" mode: "),r.append(this.mode?this.mode.toString():"null"),r.append(`
 ecLevel: `),r.append(this.ecLevel?this.ecLevel.toString():"null"),r.append(`
 version: `),r.append(this.version?this.version.toString():"null"),r.append(`
 maskPattern: `),r.append(this.maskPattern.toString()),this.matrix?(r.append(`
 matrix:
`),r.append(this.matrix.toString())):r.append(`
 matrix: null
`),r.append(`>>
`),r.toString()}setMode(r){this.mode=r}setECLevel(r){this.ecLevel=r}setVersion(r){this.version=r}setMaskPattern(r){this.maskPattern=r}setMatrix(r){this.matrix=r}static isValidMaskPattern(r){return r>=0&&r<jr.NUM_MASK_PATTERNS}}jr.NUM_MASK_PATTERNS=8;class qt extends g{}qt.kind="WriterException";class mt{constructor(){}static clearMatrix(r){r.clear(255)}static buildMatrix(r,c,u,m,w){mt.clearMatrix(w),mt.embedBasicPatterns(u,w),mt.embedTypeInfo(c,m,w),mt.maybeEmbedVersionInfo(u,w),mt.embedDataBits(r,m,w)}static embedBasicPatterns(r,c){mt.embedPositionDetectionPatternsAndSeparators(c),mt.embedDarkDotAtLeftBottomCorner(c),mt.maybeEmbedPositionAdjustmentPatterns(r,c),mt.embedTimingPatterns(c)}static embedTypeInfo(r,c,u){const m=new W;mt.makeTypeInfoBits(r,c,m);for(let w=0,v=m.getSize();w<v;++w){const C=m.get(m.getSize()-1-w),k=mt.TYPE_INFO_COORDINATES[w],O=k[0],Z=k[1];if(u.setBoolean(O,Z,C),w<8){const le=u.getWidth()-w-1;u.setBoolean(le,8,C)}else{const he=u.getHeight()-7+(w-8);u.setBoolean(8,he,C)}}}static maybeEmbedVersionInfo(r,c){if(r.getVersionNumber()<7)return;const u=new W;mt.makeVersionInfoBits(r,u);let m=6*3-1;for(let w=0;w<6;++w)for(let v=0;v<3;++v){const C=u.get(m);m--,c.setBoolean(w,c.getHeight()-11+v,C),c.setBoolean(c.getHeight()-11+v,w,C)}}static embedDataBits(r,c,u){let m=0,w=-1,v=u.getWidth()-1,C=u.getHeight()-1;for(;v>0;){for(v===6&&(v-=1);C>=0&&C<u.getHeight();){for(let k=0;k<2;++k){const O=v-k;if(!mt.isEmpty(u.get(O,C)))continue;let Z;m<r.getSize()?(Z=r.get(m),++m):Z=!1,c!==255&&Zt.getDataMaskBit(c,O,C)&&(Z=!Z),u.setBoolean(O,C,Z)}C+=w}w=-w,C+=w,v-=2}if(m!==r.getSize())throw new qt("Not all bits consumed: "+m+"/"+r.getSize())}static findMSBSet(r){return 32-M.numberOfLeadingZeros(r)}static calculateBCHCode(r,c){if(c===0)throw new E("0 polynomial");const u=mt.findMSBSet(c);for(r<<=u-1;mt.findMSBSet(r)>=u;)r^=c<<mt.findMSBSet(r)-u;return r}static makeTypeInfoBits(r,c,u){if(!jr.isValidMaskPattern(c))throw new qt("Invalid mask pattern");const m=r.getBits()<<3|c;u.appendBits(m,5);const w=mt.calculateBCHCode(m,mt.TYPE_INFO_POLY);u.appendBits(w,10);const v=new W;if(v.appendBits(mt.TYPE_INFO_MASK_PATTERN,15),u.xor(v),u.getSize()!==15)throw new qt("should not happen but we got: "+u.getSize())}static makeVersionInfoBits(r,c){c.appendBits(r.getVersionNumber(),6);const u=mt.calculateBCHCode(r.getVersionNumber(),mt.VERSION_INFO_POLY);if(c.appendBits(u,12),c.getSize()!==18)throw new qt("should not happen but we got: "+c.getSize())}static isEmpty(r){return r===255}static embedTimingPatterns(r){for(let c=8;c<r.getWidth()-8;++c){const u=(c+1)%2;mt.isEmpty(r.get(c,6))&&r.setNumber(c,6,u),mt.isEmpty(r.get(6,c))&&r.setNumber(6,c,u)}}static embedDarkDotAtLeftBottomCorner(r){if(r.get(8,r.getHeight()-8)===0)throw new qt;r.setNumber(8,r.getHeight()-8,1)}static embedHorizontalSeparationPattern(r,c,u){for(let m=0;m<8;++m){if(!mt.isEmpty(u.get(r+m,c)))throw new qt;u.setNumber(r+m,c,0)}}static embedVerticalSeparationPattern(r,c,u){for(let m=0;m<7;++m){if(!mt.isEmpty(u.get(r,c+m)))throw new qt;u.setNumber(r,c+m,0)}}static embedPositionAdjustmentPattern(r,c,u){for(let m=0;m<5;++m){const w=mt.POSITION_ADJUSTMENT_PATTERN[m];for(let v=0;v<5;++v)u.setNumber(r+v,c+m,w[v])}}static embedPositionDetectionPattern(r,c,u){for(let m=0;m<7;++m){const w=mt.POSITION_DETECTION_PATTERN[m];for(let v=0;v<7;++v)u.setNumber(r+v,c+m,w[v])}}static embedPositionDetectionPatternsAndSeparators(r){const c=mt.POSITION_DETECTION_PATTERN[0].length;mt.embedPositionDetectionPattern(0,0,r),mt.embedPositionDetectionPattern(r.getWidth()-c,0,r),mt.embedPositionDetectionPattern(0,r.getWidth()-c,r);const u=8;mt.embedHorizontalSeparationPattern(0,u-1,r),mt.embedHorizontalSeparationPattern(r.getWidth()-u,u-1,r),mt.embedHorizontalSeparationPattern(0,r.getWidth()-u,r);const m=7;mt.embedVerticalSeparationPattern(m,0,r),mt.embedVerticalSeparationPattern(r.getHeight()-m-1,0,r),mt.embedVerticalSeparationPattern(m,r.getHeight()-m,r)}static maybeEmbedPositionAdjustmentPatterns(r,c){if(r.getVersionNumber()<2)return;const u=r.getVersionNumber()-1,m=mt.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[u];for(let w=0,v=m.length;w!==v;w++){const C=m[w];if(C>=0)for(let k=0;k!==v;k++){const O=m[k];O>=0&&mt.isEmpty(c.get(O,C))&&mt.embedPositionAdjustmentPattern(O-2,C-2,c)}}}}mt.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),mt.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),mt.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),mt.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),mt.VERSION_INFO_POLY=7973,mt.TYPE_INFO_POLY=1335,mt.TYPE_INFO_MASK_PATTERN=21522;class Ua{constructor(r,c){this.dataBytes=r,this.errorCorrectionBytes=c}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class Gt{constructor(){}static calculateMaskPenalty(r){return Zt.applyMaskPenaltyRule1(r)+Zt.applyMaskPenaltyRule2(r)+Zt.applyMaskPenaltyRule3(r)+Zt.applyMaskPenaltyRule4(r)}static encode(r,c,u=null){let m=Gt.DEFAULT_BYTE_MODE_ENCODING;const w=u!==null&&u.get(hn.CHARACTER_SET)!==void 0;w&&(m=u.get(hn.CHARACTER_SET).toString());const v=this.chooseMode(r,m),C=new W;if(v===pt.BYTE&&(w||Gt.DEFAULT_BYTE_MODE_ENCODING!==m)){const Je=j.getCharacterSetECIByName(m);Je!==void 0&&this.appendECI(Je,C)}this.appendModeInfo(v,C);const k=new W;this.appendBytes(r,v,k,m);let O;if(u!==null&&u.get(hn.QR_VERSION)!==void 0){const Je=Number.parseInt(u.get(hn.QR_VERSION).toString(),10);O=ht.getVersionForNumber(Je);const Ye=this.calculateBitsNeeded(v,C,k,O);if(!this.willFit(Ye,O,c))throw new qt("Data too big for requested version")}else O=this.recommendVersion(c,v,C,k);const Z=new W;Z.appendBitArray(C);const le=v===pt.BYTE?k.getSizeInBytes():r.length;this.appendLengthInfo(le,O,v,Z),Z.appendBitArray(k);const he=O.getECBlocksForLevel(c),Ee=O.getTotalCodewords()-he.getTotalECCodewords();this.terminateBits(Ee,Z);const Ce=this.interleaveWithECBytes(Z,O.getTotalCodewords(),Ee,he.getNumBlocks()),Ie=new jr;Ie.setECLevel(c),Ie.setMode(v),Ie.setVersion(O);const Re=O.getDimensionForVersion(),Fe=new Ss(Re,Re),Xe=this.chooseMaskPattern(Ce,c,O,Fe);return Ie.setMaskPattern(Xe),mt.buildMatrix(Ce,c,O,Xe,Fe),Ie.setMatrix(Fe),Ie}static recommendVersion(r,c,u,m){const w=this.calculateBitsNeeded(c,u,m,ht.getVersionForNumber(1)),v=this.chooseVersion(w,r),C=this.calculateBitsNeeded(c,u,m,v);return this.chooseVersion(C,r)}static calculateBitsNeeded(r,c,u,m){return c.getSize()+r.getCharacterCountBits(m)+u.getSize()}static getAlphanumericCode(r){return r<Gt.ALPHANUMERIC_TABLE.length?Gt.ALPHANUMERIC_TABLE[r]:-1}static chooseMode(r,c=null){if(j.SJIS.getName()===c&&this.isOnlyDoubleByteKanji(r))return pt.KANJI;let u=!1,m=!1;for(let w=0,v=r.length;w<v;++w){const C=r.charAt(w);if(Gt.isDigit(C))u=!0;else if(this.getAlphanumericCode(C.charCodeAt(0))!==-1)m=!0;else return pt.BYTE}return m?pt.ALPHANUMERIC:u?pt.NUMERIC:pt.BYTE}static isOnlyDoubleByteKanji(r){let c;try{c=$.encode(r,j.SJIS)}catch{return!1}const u=c.length;if(u%2!==0)return!1;for(let m=0;m<u;m+=2){const w=c[m]&255;if((w<129||w>159)&&(w<224||w>235))return!1}return!0}static chooseMaskPattern(r,c,u,m){let w=Number.MAX_SAFE_INTEGER,v=-1;for(let C=0;C<jr.NUM_MASK_PATTERNS;C++){mt.buildMatrix(r,c,u,C,m);let k=this.calculateMaskPenalty(m);k<w&&(w=k,v=C)}return v}static chooseVersion(r,c){for(let u=1;u<=40;u++){const m=ht.getVersionForNumber(u);if(Gt.willFit(r,m,c))return m}throw new qt("Data too big")}static willFit(r,c,u){const m=c.getTotalCodewords(),v=c.getECBlocksForLevel(u).getTotalECCodewords(),C=m-v,k=(r+7)/8;return C>=k}static terminateBits(r,c){const u=r*8;if(c.getSize()>u)throw new qt("data bits cannot fit in the QR Code"+c.getSize()+" > "+u);for(let v=0;v<4&&c.getSize()<u;++v)c.appendBit(!1);const m=c.getSize()&7;if(m>0)for(let v=m;v<8;v++)c.appendBit(!1);const w=r-c.getSizeInBytes();for(let v=0;v<w;++v)c.appendBits((v&1)===0?236:17,8);if(c.getSize()!==u)throw new qt("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(r,c,u,m,w,v){if(m>=u)throw new qt("Block ID too large");const C=r%u,k=u-C,O=Math.floor(r/u),Z=O+1,le=Math.floor(c/u),he=le+1,Ee=O-le,Ce=Z-he;if(Ee!==Ce)throw new qt("EC bytes mismatch");if(u!==k+C)throw new qt("RS blocks mismatch");if(r!==(le+Ee)*k+(he+Ce)*C)throw new qt("Total bytes mismatch");m<k?(w[0]=le,v[0]=Ee):(w[0]=he,v[0]=Ce)}static interleaveWithECBytes(r,c,u,m){if(r.getSizeInBytes()!==u)throw new qt("Number of bits and data bytes does not match");let w=0,v=0,C=0;const k=new Array;for(let Z=0;Z<m;++Z){const le=new Int32Array(1),he=new Int32Array(1);Gt.getNumDataBytesAndNumECBytesForBlockID(c,u,m,Z,le,he);const Ee=le[0],Ce=new Uint8Array(Ee);r.toBytes(8*w,Ce,0,Ee);const Ie=Gt.generateECBytes(Ce,he[0]);k.push(new Ua(Ce,Ie)),v=Math.max(v,Ee),C=Math.max(C,Ie.length),w+=le[0]}if(u!==w)throw new qt("Data bytes does not match offset");const O=new W;for(let Z=0;Z<v;++Z)for(const le of k){const he=le.getDataBytes();Z<he.length&&O.appendBits(he[Z],8)}for(let Z=0;Z<C;++Z)for(const le of k){const he=le.getErrorCorrectionBytes();Z<he.length&&O.appendBits(he[Z],8)}if(c!==O.getSizeInBytes())throw new qt("Interleaving error: "+c+" and "+O.getSizeInBytes()+" differ.");return O}static generateECBytes(r,c){const u=r.length,m=new Int32Array(u+c);for(let v=0;v<u;v++)m[v]=r[v]&255;new no(Pe.QR_CODE_FIELD_256).encode(m,c);const w=new Uint8Array(c);for(let v=0;v<c;v++)w[v]=m[u+v];return w}static appendModeInfo(r,c){c.appendBits(r.getBits(),4)}static appendLengthInfo(r,c,u,m){const w=u.getCharacterCountBits(c);if(r>=1<<w)throw new qt(r+" is bigger than "+((1<<w)-1));m.appendBits(r,w)}static appendBytes(r,c,u,m){switch(c){case pt.NUMERIC:Gt.appendNumericBytes(r,u);break;case pt.ALPHANUMERIC:Gt.appendAlphanumericBytes(r,u);break;case pt.BYTE:Gt.append8BitBytes(r,u,m);break;case pt.KANJI:Gt.appendKanjiBytes(r,u);break;default:throw new qt("Invalid mode: "+c)}}static getDigit(r){return r.charCodeAt(0)-48}static isDigit(r){const c=Gt.getDigit(r);return c>=0&&c<=9}static appendNumericBytes(r,c){const u=r.length;let m=0;for(;m<u;){const w=Gt.getDigit(r.charAt(m));if(m+2<u){const v=Gt.getDigit(r.charAt(m+1)),C=Gt.getDigit(r.charAt(m+2));c.appendBits(w*100+v*10+C,10),m+=3}else if(m+1<u){const v=Gt.getDigit(r.charAt(m+1));c.appendBits(w*10+v,7),m+=2}else c.appendBits(w,4),m++}}static appendAlphanumericBytes(r,c){const u=r.length;let m=0;for(;m<u;){const w=Gt.getAlphanumericCode(r.charCodeAt(m));if(w===-1)throw new qt;if(m+1<u){const v=Gt.getAlphanumericCode(r.charCodeAt(m+1));if(v===-1)throw new qt;c.appendBits(w*45+v,11),m+=2}else c.appendBits(w,6),m++}}static append8BitBytes(r,c,u){let m;try{m=$.encode(r,u)}catch(w){throw new qt(w)}for(let w=0,v=m.length;w!==v;w++){const C=m[w];c.appendBits(C,8)}}static appendKanjiBytes(r,c){let u;try{u=$.encode(r,j.SJIS)}catch(w){throw new qt(w)}const m=u.length;for(let w=0;w<m;w+=2){const v=u[w]&255,C=u[w+1]&255,k=v<<8&4294967295|C;let O=-1;if(k>=33088&&k<=40956?O=k-33088:k>=57408&&k<=60351&&(O=k-49472),O===-1)throw new qt("Invalid byte sequence");const Z=(O>>8)*192+(O&255);c.appendBits(Z,13)}}static appendECI(r,c){c.appendBits(pt.ECI.getBits(),4),c.appendBits(r.getValue(),8)}}Gt.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),Gt.DEFAULT_BYTE_MODE_ENCODING=j.UTF8.getName();class Vr{write(r,c,u,m=null){if(r.length===0)throw new E("Found empty contents");if(c<0||u<0)throw new E("Requested dimensions are too small: "+c+"x"+u);let w=Wt.L,v=Vr.QUIET_ZONE_SIZE;m!==null&&(m.get(hn.ERROR_CORRECTION)!==void 0&&(w=Wt.fromString(m.get(hn.ERROR_CORRECTION).toString())),m.get(hn.MARGIN)!==void 0&&(v=Number.parseInt(m.get(hn.MARGIN).toString(),10)));const C=Gt.encode(r,w,m);return this.renderResult(C,c,u,v)}writeToDom(r,c,u,m,w=null){typeof r=="string"&&(r=document.querySelector(r));const v=this.write(c,u,m,w);r&&r.appendChild(v)}renderResult(r,c,u,m){const w=r.getMatrix();if(w===null)throw new Ze;const v=w.getWidth(),C=w.getHeight(),k=v+m*2,O=C+m*2,Z=Math.max(c,k),le=Math.max(u,O),he=Math.min(Math.floor(Z/k),Math.floor(le/O)),Ee=Math.floor((Z-v*he)/2),Ce=Math.floor((le-C*he)/2),Ie=this.createSVGElement(Z,le);for(let Re=0,Fe=Ce;Re<C;Re++,Fe+=he)for(let Xe=0,Je=Ee;Xe<v;Xe++,Je+=he)if(w.get(Xe,Re)===1){const Ye=this.createSvgRectElement(Je,Fe,he,he);Ie.appendChild(Ye)}return Ie}createSVGElement(r,c){const u=document.createElementNS(Vr.SVG_NS,"svg");return u.setAttributeNS(null,"height",r.toString()),u.setAttributeNS(null,"width",c.toString()),u}createSvgRectElement(r,c,u,m){const w=document.createElementNS(Vr.SVG_NS,"rect");return w.setAttributeNS(null,"x",r.toString()),w.setAttributeNS(null,"y",c.toString()),w.setAttributeNS(null,"height",u.toString()),w.setAttributeNS(null,"width",m.toString()),w.setAttributeNS(null,"fill","#000000"),w}}Vr.QUIET_ZONE_SIZE=4,Vr.SVG_NS="http://www.w3.org/2000/svg";class li{encode(r,c,u,m,w){if(r.length===0)throw new E("Found empty contents");if(c!==me.QR_CODE)throw new E("Can only encode QR_CODE, but got "+c);if(u<0||m<0)throw new E(`Requested dimensions are too small: ${u}x${m}`);let v=Wt.L,C=li.QUIET_ZONE_SIZE;w!==null&&(w.get(hn.ERROR_CORRECTION)!==void 0&&(v=Wt.fromString(w.get(hn.ERROR_CORRECTION).toString())),w.get(hn.MARGIN)!==void 0&&(C=Number.parseInt(w.get(hn.MARGIN).toString(),10)));const k=Gt.encode(r,v,w);return li.renderResult(k,u,m,C)}static renderResult(r,c,u,m){const w=r.getMatrix();if(w===null)throw new Ze;const v=w.getWidth(),C=w.getHeight(),k=v+m*2,O=C+m*2,Z=Math.max(c,k),le=Math.max(u,O),he=Math.min(Math.floor(Z/k),Math.floor(le/O)),Ee=Math.floor((Z-v*he)/2),Ce=Math.floor((le-C*he)/2),Ie=new se(Z,le);for(let Re=0,Fe=Ce;Re<C;Re++,Fe+=he)for(let Xe=0,Je=Ee;Xe<v;Xe++,Je+=he)w.get(Xe,Re)===1&&Ie.setRegion(Je,Fe,he,he);return Ie}}li.QUIET_ZONE_SIZE=4;class Fa{encode(r,c,u,m,w){let v;switch(c){case me.QR_CODE:v=new li;break;default:throw new E("No encoder available for format "+c)}return v.encode(r,c,u,m,w)}}class gr extends ie{constructor(r,c,u,m,w,v,C,k){if(super(v,C),this.yuvData=r,this.dataWidth=c,this.dataHeight=u,this.left=m,this.top=w,m+v>c||w+C>u)throw new E("Crop rectangle does not fit within image data.");k&&this.reverseHorizontal(v,C)}getRow(r,c){if(r<0||r>=this.getHeight())throw new E("Requested row is outside the image: "+r);const u=this.getWidth();(c==null||c.length<u)&&(c=new Uint8ClampedArray(u));const m=(r+this.top)*this.dataWidth+this.left;return _.arraycopy(this.yuvData,m,c,0,u),c}getMatrix(){const r=this.getWidth(),c=this.getHeight();if(r===this.dataWidth&&c===this.dataHeight)return this.yuvData;const u=r*c,m=new Uint8ClampedArray(u);let w=this.top*this.dataWidth+this.left;if(r===this.dataWidth)return _.arraycopy(this.yuvData,w,m,0,u),m;for(let v=0;v<c;v++){const C=v*r;_.arraycopy(this.yuvData,w,m,C,r),w+=this.dataWidth}return m}isCropSupported(){return!0}crop(r,c,u,m){return new gr(this.yuvData,this.dataWidth,this.dataHeight,this.left+r,this.top+c,u,m,!1)}renderThumbnail(){const r=this.getWidth()/gr.THUMBNAIL_SCALE_FACTOR,c=this.getHeight()/gr.THUMBNAIL_SCALE_FACTOR,u=new Int32Array(r*c),m=this.yuvData;let w=this.top*this.dataWidth+this.left;for(let v=0;v<c;v++){const C=v*r;for(let k=0;k<r;k++){const O=m[w+k*gr.THUMBNAIL_SCALE_FACTOR]&255;u[C+k]=4278190080|O*65793}w+=this.dataWidth*gr.THUMBNAIL_SCALE_FACTOR}return u}getThumbnailWidth(){return this.getWidth()/gr.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/gr.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(r,c){const u=this.yuvData;for(let m=0,w=this.top*this.dataWidth+this.left;m<c;m++,w+=this.dataWidth){const v=w+r/2;for(let C=w,k=w+r-1;C<v;C++,k--){const O=u[C];u[C]=u[k],u[k]=O}}}invert(){return new ne(this)}}gr.THUMBNAIL_SCALE_FACTOR=2;class Gi extends ie{constructor(r,c,u,m,w,v,C){if(super(c,u),this.dataWidth=m,this.dataHeight=w,this.left=v,this.top=C,r.BYTES_PER_ELEMENT===4){const k=c*u,O=new Uint8ClampedArray(k);for(let Z=0;Z<k;Z++){const le=r[Z],he=le>>16&255,Ee=le>>7&510,Ce=le&255;O[Z]=(he+Ee+Ce)/4&255}this.luminances=O}else this.luminances=r;if(m===void 0&&(this.dataWidth=c),w===void 0&&(this.dataHeight=u),v===void 0&&(this.left=0),C===void 0&&(this.top=0),this.left+c>this.dataWidth||this.top+u>this.dataHeight)throw new E("Crop rectangle does not fit within image data.")}getRow(r,c){if(r<0||r>=this.getHeight())throw new E("Requested row is outside the image: "+r);const u=this.getWidth();(c==null||c.length<u)&&(c=new Uint8ClampedArray(u));const m=(r+this.top)*this.dataWidth+this.left;return _.arraycopy(this.luminances,m,c,0,u),c}getMatrix(){const r=this.getWidth(),c=this.getHeight();if(r===this.dataWidth&&c===this.dataHeight)return this.luminances;const u=r*c,m=new Uint8ClampedArray(u);let w=this.top*this.dataWidth+this.left;if(r===this.dataWidth)return _.arraycopy(this.luminances,w,m,0,u),m;for(let v=0;v<c;v++){const C=v*r;_.arraycopy(this.luminances,w,m,C,r),w+=this.dataWidth}return m}isCropSupported(){return!0}crop(r,c,u,m){return new Gi(this.luminances,u,m,this.dataWidth,this.dataHeight,this.left+r,this.top+c)}invert(){return new ne(this)}}class Ho extends j{static forName(r){return this.getCharacterSetECIByName(r)}}class ro{}ro.ISO_8859_1=j.ISO8859_1;class $o{isCompact(){return this.compact}setCompact(r){this.compact=r}getSize(){return this.size}setSize(r){this.size=r}getLayers(){return this.layers}setLayers(r){this.layers=r}getCodeWords(){return this.codeWords}setCodeWords(r){this.codeWords=r}getMatrix(){return this.matrix}setMatrix(r){this.matrix=r}}class io{static singletonList(r){return[r]}static min(r,c){return r.sort(c)[0]}}class Ha{constructor(r){this.previous=r}getPrevious(){return this.previous}}class ci extends Ha{constructor(r,c,u){super(r),this.value=c,this.bitCount=u}appendTo(r,c){r.appendBits(this.value,this.bitCount)}add(r,c){return new ci(this,r,c)}addBinaryShift(r,c){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new ci(this,r,c)}toString(){let r=this.value&(1<<this.bitCount)-1;return r|=1<<this.bitCount,"<"+M.toBinaryString(r|1<<this.bitCount).substring(1)+">"}}class so extends ci{constructor(r,c,u){super(r,0,0),this.binaryShiftStart=c,this.binaryShiftByteCount=u}appendTo(r,c){for(let u=0;u<this.binaryShiftByteCount;u++)(u===0||u===31&&this.binaryShiftByteCount<=62)&&(r.appendBits(31,5),this.binaryShiftByteCount>62?r.appendBits(this.binaryShiftByteCount-31,16):u===0?r.appendBits(Math.min(this.binaryShiftByteCount,31),5):r.appendBits(this.binaryShiftByteCount-31,5)),r.appendBits(c[this.binaryShiftStart+u],8)}addBinaryShift(r,c){return new so(this,r,c)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function $a(oe,r,c){return new so(oe,r,c)}function Yi(oe,r,c){return new ci(oe,r,c)}const ja=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],Dr=0,ui=1,_n=2,jo=3,or=4,Vo=new ci(null,0,0),As=[Int32Array.from([0,(5<<16)+28,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(9<<16)+480+14,0,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(4<<16)+14,(9<<16)+448+28,0,(9<<16)+448+29,932798]),Int32Array.from([(5<<16)+29,(5<<16)+28,656318,0,(5<<16)+30]),Int32Array.from([(5<<16)+31,656380,656382,656381,0])];function zo(oe){for(let r of oe)D.fill(r,-1);return oe[Dr][or]=0,oe[ui][or]=0,oe[ui][Dr]=28,oe[jo][or]=0,oe[_n][or]=0,oe[_n][Dr]=15,oe}const oo=zo(D.createInt32Array(6,6));class Mn{constructor(r,c,u,m){this.token=r,this.mode=c,this.binaryShiftByteCount=u,this.bitCount=m}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(r,c){let u=this.bitCount,m=this.token;if(r!==this.mode){let v=As[this.mode][r];m=Yi(m,v&65535,v>>16),u+=v>>16}let w=r===_n?4:5;return m=Yi(m,c,w),new Mn(m,r,0,u+w)}shiftAndAppend(r,c){let u=this.token,m=this.mode===_n?4:5;return u=Yi(u,oo[this.mode][r],m),u=Yi(u,c,5),new Mn(u,this.mode,0,this.bitCount+m+5)}addBinaryShiftChar(r){let c=this.token,u=this.mode,m=this.bitCount;if(this.mode===or||this.mode===_n){let C=As[u][Dr];c=Yi(c,C&65535,C>>16),m+=C>>16,u=Dr}let w=this.binaryShiftByteCount===0||this.binaryShiftByteCount===31?18:this.binaryShiftByteCount===62?9:8,v=new Mn(c,u,this.binaryShiftByteCount+1,m+w);return v.binaryShiftByteCount===2078&&(v=v.endBinaryShift(r+1)),v}endBinaryShift(r){if(this.binaryShiftByteCount===0)return this;let c=this.token;return c=$a(c,r-this.binaryShiftByteCount,this.binaryShiftByteCount),new Mn(c,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(r){let c=this.bitCount+(As[this.mode][r.mode]>>16);return this.binaryShiftByteCount<r.binaryShiftByteCount?c+=Mn.calculateBinaryShiftCost(r)-Mn.calculateBinaryShiftCost(this):this.binaryShiftByteCount>r.binaryShiftByteCount&&r.binaryShiftByteCount>0&&(c+=10),c<=r.bitCount}toBitArray(r){let c=[];for(let m=this.endBinaryShift(r.length).token;m!==null;m=m.getPrevious())c.unshift(m);let u=new W;for(const m of c)m.appendTo(u,r);return u}toString(){return V.format("%s bits=%d bytes=%d",ja[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(r){return r.binaryShiftByteCount>62?21:r.binaryShiftByteCount>31?20:r.binaryShiftByteCount>0?10:0}}Mn.INITIAL_STATE=new Mn(Vo,Dr,0,0);function Va(oe){const r=V.getCharCode(" "),c=V.getCharCode("."),u=V.getCharCode(",");oe[Dr][r]=1;const m=V.getCharCode("Z"),w=V.getCharCode("A");for(let he=w;he<=m;he++)oe[Dr][he]=he-w+2;oe[ui][r]=1;const v=V.getCharCode("z"),C=V.getCharCode("a");for(let he=C;he<=v;he++)oe[ui][he]=he-C+2;oe[_n][r]=1;const k=V.getCharCode("9"),O=V.getCharCode("0");for(let he=O;he<=k;he++)oe[_n][he]=he-O+2;oe[_n][u]=12,oe[_n][c]=13;const Z=["\0"," ","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","\x1B","","","","","@","\\","^","_","`","|","~",""];for(let he=0;he<Z.length;he++)oe[jo][V.getCharCode(Z[he])]=he;const le=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let he=0;he<le.length;he++)V.getCharCode(le[he])>0&&(oe[or][V.getCharCode(le[he])]=he);return oe}const ao=Va(D.createInt32Array(5,256));class Qi{constructor(r){this.text=r}encode(){const r=V.getCharCode(" "),c=V.getCharCode(`
`);let u=io.singletonList(Mn.INITIAL_STATE);for(let w=0;w<this.text.length;w++){let v,C=w+1<this.text.length?this.text[w+1]:0;switch(this.text[w]){case V.getCharCode("\r"):v=C===c?2:0;break;case V.getCharCode("."):v=C===r?3:0;break;case V.getCharCode(","):v=C===r?4:0;break;case V.getCharCode(":"):v=C===r?5:0;break;default:v=0}v>0?(u=Qi.updateStateListForPair(u,w,v),w++):u=this.updateStateListForChar(u,w)}return io.min(u,(w,v)=>w.getBitCount()-v.getBitCount()).toBitArray(this.text)}updateStateListForChar(r,c){const u=[];for(let m of r)this.updateStateForChar(m,c,u);return Qi.simplifyStates(u)}updateStateForChar(r,c,u){let m=this.text[c]&255,w=ao[r.getMode()][m]>0,v=null;for(let C=0;C<=or;C++){let k=ao[C][m];if(k>0){if(v==null&&(v=r.endBinaryShift(c)),!w||C===r.getMode()||C===_n){const O=v.latchAndAppend(C,k);u.push(O)}if(!w&&oo[r.getMode()][C]>=0){const O=v.shiftAndAppend(C,k);u.push(O)}}}if(r.getBinaryShiftByteCount()>0||ao[r.getMode()][m]===0){let C=r.addBinaryShiftChar(c);u.push(C)}}static updateStateListForPair(r,c,u){const m=[];for(let w of r)this.updateStateForPair(w,c,u,m);return this.simplifyStates(m)}static updateStateForPair(r,c,u,m){let w=r.endBinaryShift(c);if(m.push(w.latchAndAppend(or,u)),r.getMode()!==or&&m.push(w.shiftAndAppend(or,u)),u===3||u===4){let v=w.latchAndAppend(_n,16-u).latchAndAppend(_n,1);m.push(v)}if(r.getBinaryShiftByteCount()>0){let v=r.addBinaryShiftChar(c).addBinaryShiftChar(c+1);m.push(v)}}static simplifyStates(r){let c=[];for(const u of r){let m=!0;for(const w of c){if(w.isBetterThanOrEqualTo(u)){m=!1;break}u.isBetterThanOrEqualTo(w)&&(c=c.filter(v=>v!==w))}m&&c.push(u)}return c}}class Pt{constructor(){}static encodeBytes(r){return Pt.encode(r,Pt.DEFAULT_EC_PERCENT,Pt.DEFAULT_AZTEC_LAYERS)}static encode(r,c,u){let m=new Qi(r).encode(),w=M.truncDivision(m.getSize()*c,100)+11,v=m.getSize()+w,C,k,O,Z,le;if(u!==Pt.DEFAULT_AZTEC_LAYERS){if(C=u<0,k=Math.abs(u),k>(C?Pt.MAX_NB_BITS_COMPACT:Pt.MAX_NB_BITS))throw new E(V.format("Illegal value %s for layers",u));O=Pt.totalBitsInLayer(k,C),Z=Pt.WORD_SIZE[k];let Ye=O-O%Z;if(le=Pt.stuffBits(m,Z),le.getSize()+w>Ye)throw new E("Data to large for user specified layer");if(C&&le.getSize()>Z*64)throw new E("Data to large for user specified layer")}else{Z=0,le=null;for(let Ye=0;;Ye++){if(Ye>Pt.MAX_NB_BITS)throw new E("Data too large for an Aztec code");if(C=Ye<=3,k=C?Ye+1:Ye,O=Pt.totalBitsInLayer(k,C),v>O)continue;(le==null||Z!==Pt.WORD_SIZE[k])&&(Z=Pt.WORD_SIZE[k],le=Pt.stuffBits(m,Z));let Nt=O-O%Z;if(!(C&&le.getSize()>Z*64)&&le.getSize()+w<=Nt)break}}let he=Pt.generateCheckWords(le,O,Z),Ee=le.getSize()/Z,Ce=Pt.generateModeMessage(C,k,Ee),Ie=(C?11:14)+k*4,Re=new Int32Array(Ie),Fe;if(C){Fe=Ie;for(let Ye=0;Ye<Re.length;Ye++)Re[Ye]=Ye}else{Fe=Ie+1+2*M.truncDivision(M.truncDivision(Ie,2)-1,15);let Ye=M.truncDivision(Ie,2),Nt=M.truncDivision(Fe,2);for(let Ct=0;Ct<Ye;Ct++){let Fn=Ct+M.truncDivision(Ct,15);Re[Ye-Ct-1]=Nt-Fn-1,Re[Ye+Ct]=Nt+Fn+1}}let Xe=new se(Fe);for(let Ye=0,Nt=0;Ye<k;Ye++){let Ct=(k-Ye)*4+(C?9:12);for(let Fn=0;Fn<Ct;Fn++){let ar=Fn*2;for(let pn=0;pn<2;pn++)he.get(Nt+ar+pn)&&Xe.set(Re[Ye*2+pn],Re[Ye*2+Fn]),he.get(Nt+Ct*2+ar+pn)&&Xe.set(Re[Ye*2+Fn],Re[Ie-1-Ye*2-pn]),he.get(Nt+Ct*4+ar+pn)&&Xe.set(Re[Ie-1-Ye*2-pn],Re[Ie-1-Ye*2-Fn]),he.get(Nt+Ct*6+ar+pn)&&Xe.set(Re[Ie-1-Ye*2-Fn],Re[Ye*2+pn])}Nt+=Ct*8}if(Pt.drawModeMessage(Xe,C,Fe,Ce),C)Pt.drawBullsEye(Xe,M.truncDivision(Fe,2),5);else{Pt.drawBullsEye(Xe,M.truncDivision(Fe,2),7);for(let Ye=0,Nt=0;Ye<M.truncDivision(Ie,2)-1;Ye+=15,Nt+=16)for(let Ct=M.truncDivision(Fe,2)&1;Ct<Fe;Ct+=2)Xe.set(M.truncDivision(Fe,2)-Nt,Ct),Xe.set(M.truncDivision(Fe,2)+Nt,Ct),Xe.set(Ct,M.truncDivision(Fe,2)-Nt),Xe.set(Ct,M.truncDivision(Fe,2)+Nt)}let Je=new $o;return Je.setCompact(C),Je.setSize(Fe),Je.setLayers(k),Je.setCodeWords(Ee),Je.setMatrix(Xe),Je}static drawBullsEye(r,c,u){for(let m=0;m<u;m+=2)for(let w=c-m;w<=c+m;w++)r.set(w,c-m),r.set(w,c+m),r.set(c-m,w),r.set(c+m,w);r.set(c-u,c-u),r.set(c-u+1,c-u),r.set(c-u,c-u+1),r.set(c+u,c-u),r.set(c+u,c-u+1),r.set(c+u,c+u-1)}static generateModeMessage(r,c,u){let m=new W;return r?(m.appendBits(c-1,2),m.appendBits(u-1,6),m=Pt.generateCheckWords(m,28,4)):(m.appendBits(c-1,5),m.appendBits(u-1,11),m=Pt.generateCheckWords(m,40,4)),m}static drawModeMessage(r,c,u,m){let w=M.truncDivision(u,2);if(c)for(let v=0;v<7;v++){let C=w-3+v;m.get(v)&&r.set(C,w-5),m.get(v+7)&&r.set(w+5,C),m.get(20-v)&&r.set(C,w+5),m.get(27-v)&&r.set(w-5,C)}else for(let v=0;v<10;v++){let C=w-5+v+M.truncDivision(v,5);m.get(v)&&r.set(C,w-7),m.get(v+10)&&r.set(w+7,C),m.get(29-v)&&r.set(C,w+7),m.get(39-v)&&r.set(w-7,C)}}static generateCheckWords(r,c,u){let m=r.getSize()/u,w=new no(Pt.getGF(u)),v=M.truncDivision(c,u),C=Pt.bitsToWords(r,u,v);w.encode(C,v-m);let k=c%u,O=new W;O.appendBits(0,k);for(const Z of Array.from(C))O.appendBits(Z,u);return O}static bitsToWords(r,c,u){let m=new Int32Array(u),w,v;for(w=0,v=r.getSize()/c;w<v;w++){let C=0;for(let k=0;k<c;k++)C|=r.get(w*c+k)?1<<c-k-1:0;m[w]=C}return m}static getGF(r){switch(r){case 4:return Pe.AZTEC_PARAM;case 6:return Pe.AZTEC_DATA_6;case 8:return Pe.AZTEC_DATA_8;case 10:return Pe.AZTEC_DATA_10;case 12:return Pe.AZTEC_DATA_12;default:throw new E("Unsupported word size "+r)}}static stuffBits(r,c){let u=new W,m=r.getSize(),w=(1<<c)-2;for(let v=0;v<m;v+=c){let C=0;for(let k=0;k<c;k++)(v+k>=m||r.get(v+k))&&(C|=1<<c-1-k);(C&w)===w?(u.appendBits(C&w,c),v--):(C&w)===0?(u.appendBits(C|1,c),v--):u.appendBits(C,c)}return u}static totalBitsInLayer(r,c){return((c?88:112)+16*r)*r}}Pt.DEFAULT_EC_PERCENT=33,Pt.DEFAULT_AZTEC_LAYERS=0,Pt.MAX_NB_BITS=32,Pt.MAX_NB_BITS_COMPACT=4,Pt.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class Ki{encode(r,c,u,m){return this.encodeWithHints(r,c,u,m,null)}encodeWithHints(r,c,u,m,w){let v=ro.ISO_8859_1,C=Pt.DEFAULT_EC_PERCENT,k=Pt.DEFAULT_AZTEC_LAYERS;return w!=null&&(w.has(hn.CHARACTER_SET)&&(v=Ho.forName(w.get(hn.CHARACTER_SET).toString())),w.has(hn.ERROR_CORRECTION)&&(C=M.parseInt(w.get(hn.ERROR_CORRECTION).toString())),w.has(hn.AZTEC_LAYERS)&&(k=M.parseInt(w.get(hn.AZTEC_LAYERS).toString()))),Ki.encodeLayers(r,c,u,m,v,C,k)}static encodeLayers(r,c,u,m,w,v,C){if(c!==me.AZTEC)throw new E("Can only encode AZTEC, but got "+c);let k=Pt.encode(V.getBytes(r,w),v,C);return Ki.renderResult(k,u,m)}static renderResult(r,c,u){let m=r.getMatrix();if(m==null)throw new Ze;let w=m.getWidth(),v=m.getHeight(),C=Math.max(c,w),k=Math.max(u,v),O=Math.min(C/w,k/v),Z=(C-w*O)/2,le=(k-v*O)/2,he=new se(C,k);for(let Ee=0,Ce=le;Ee<v;Ee++,Ce+=O)for(let Ie=0,Re=Z;Ie<w;Ie++,Re+=O)m.get(Ie,Ee)&&he.setRegion(Re,Ce,O,O);return he}}e.AbstractExpandedDecoder=qs,e.ArgumentException=x,e.ArithmeticException=je,e.AztecCode=$o,e.AztecCodeReader=Ae,e.AztecCodeWriter=Ki,e.AztecDecoder=nt,e.AztecDetector=ye,e.AztecDetectorResult=$t,e.AztecEncoder=Pt,e.AztecHighLevelEncoder=Qi,e.AztecPoint=Y,e.BarcodeFormat=me,e.Binarizer=I,e.BinaryBitmap=A,e.BitArray=W,e.BitMatrix=se,e.BitSource=Qs,e.BrowserAztecCodeReader=Be,e.BrowserBarcodeReader=Bo,e.BrowserCodeReader=te,e.BrowserDatamatrixCodeReader=La,e.BrowserMultiFormatReader=qi,e.BrowserPDF417Reader=bs,e.BrowserQRCodeReader=Fo,e.BrowserQRCodeSvgWriter=Vr,e.CharacterSetECI=j,e.ChecksumException=S,e.Code128Reader=Ve,e.Code39Reader=vt,e.DataMatrixDecodedBitStreamParser=rr,e.DataMatrixReader=ir,e.DecodeHintType=U,e.DecoderResult=Me,e.DefaultGridSampler=de,e.DetectorResult=Et,e.EAN13Reader=Gn,e.EncodeHintType=hn,e.Exception=g,e.FormatException=P,e.GenericGF=Pe,e.GenericGFPoly=Ue,e.GlobalHistogramBinarizer=J,e.GridSampler=Dt,e.GridSamplerInstance=z,e.HTMLCanvasElementLuminanceSource=re,e.HybridBinarizer=K,e.ITFReader=ft,e.IllegalArgumentException=E,e.IllegalStateException=Ze,e.InvertedLuminanceSource=ne,e.LuminanceSource=ie,e.MathUtils=tt,e.MultiFormatOneDReader=ni,e.MultiFormatReader=vs,e.MultiFormatWriter=Fa,e.NotFoundException=H,e.OneDReader=Le,e.PDF417DecodedBitStreamParser=He,e.PDF417DecoderErrorCorrection=Zs,e.PDF417Reader=bn,e.PDF417ResultMetadata=xs,e.PerspectiveTransform=Lt,e.PlanarYUVLuminanceSource=gr,e.QRCodeByteMatrix=Ss,e.QRCodeDataMask=Tt,e.QRCodeDecodedBitStreamParser=Xt,e.QRCodeDecoderErrorCorrectionLevel=Wt,e.QRCodeDecoderFormatInformation=xn,e.QRCodeEncoder=Gt,e.QRCodeEncoderQRCode=jr,e.QRCodeMaskUtil=Zt,e.QRCodeMatrixUtil=mt,e.QRCodeMode=pt,e.QRCodeReader=kn,e.QRCodeVersion=ht,e.QRCodeWriter=li,e.RGBLuminanceSource=Gi,e.RSS14Reader=Yt,e.RSSExpandedReader=ze,e.ReaderException=ai,e.ReedSolomonDecoder=ot,e.ReedSolomonEncoder=no,e.ReedSolomonException=We,e.Result=ce,e.ResultMetadataType=be,e.ResultPoint=qe,e.StringUtils=V,e.UnsupportedOperationException=Q,e.VideoInputDevice=X,e.WhiteRectangleDetector=Vt,e.WriterException=qt,e.ZXingArrays=D,e.ZXingCharset=Ho,e.ZXingInteger=M,e.ZXingStandardCharsets=ro,e.ZXingStringBuilder=G,e.ZXingStringEncoding=$,e.ZXingSystem=_,e.createAbstractExpandedDecoder=ko,Object.defineProperty(e,"__esModule",{value:!0})})}(zxingJs_umd$2,zxingJs_umd$2.exports)),zxingJs_umd$2.exports}var zxingJs_umdExports=requireZxingJs_umd();const zxingJs_umd=getDefaultExportFromCjs(zxingJs_umdExports),ZXing=_mergeNamespaces({__proto__:null,default:zxingJs_umd},[zxingJs_umdExports]);var ZXingHtml5QrcodeDecoder=function(){function n(t,e,s){if(this.formatMap=new Map([[Html5QrcodeSupportedFormats.QR_CODE,zxingJs_umdExports.BarcodeFormat.QR_CODE],[Html5QrcodeSupportedFormats.AZTEC,zxingJs_umdExports.BarcodeFormat.AZTEC],[Html5QrcodeSupportedFormats.CODABAR,zxingJs_umdExports.BarcodeFormat.CODABAR],[Html5QrcodeSupportedFormats.CODE_39,zxingJs_umdExports.BarcodeFormat.CODE_39],[Html5QrcodeSupportedFormats.CODE_93,zxingJs_umdExports.BarcodeFormat.CODE_93],[Html5QrcodeSupportedFormats.CODE_128,zxingJs_umdExports.BarcodeFormat.CODE_128],[Html5QrcodeSupportedFormats.DATA_MATRIX,zxingJs_umdExports.BarcodeFormat.DATA_MATRIX],[Html5QrcodeSupportedFormats.MAXICODE,zxingJs_umdExports.BarcodeFormat.MAXICODE],[Html5QrcodeSupportedFormats.ITF,zxingJs_umdExports.BarcodeFormat.ITF],[Html5QrcodeSupportedFormats.EAN_13,zxingJs_umdExports.BarcodeFormat.EAN_13],[Html5QrcodeSupportedFormats.EAN_8,zxingJs_umdExports.BarcodeFormat.EAN_8],[Html5QrcodeSupportedFormats.PDF_417,zxingJs_umdExports.BarcodeFormat.PDF_417],[Html5QrcodeSupportedFormats.RSS_14,zxingJs_umdExports.BarcodeFormat.RSS_14],[Html5QrcodeSupportedFormats.RSS_EXPANDED,zxingJs_umdExports.BarcodeFormat.RSS_EXPANDED],[Html5QrcodeSupportedFormats.UPC_A,zxingJs_umdExports.BarcodeFormat.UPC_A],[Html5QrcodeSupportedFormats.UPC_E,zxingJs_umdExports.BarcodeFormat.UPC_E],[Html5QrcodeSupportedFormats.UPC_EAN_EXTENSION,zxingJs_umdExports.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!ZXing)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=e,this.logger=s;var a=this.createZXingFormats(t),o=new Map;o.set(zxingJs_umdExports.DecodeHintType.POSSIBLE_FORMATS,a),o.set(zxingJs_umdExports.DecodeHintType.TRY_HARDER,!1),this.hints=o}return n.prototype.decodeAsync=function(t){var e=this;return new Promise(function(s,a){try{s(e.decode(t))}catch(o){a(o)}})},n.prototype.decode=function(t){var e=new zxingJs_umdExports.MultiFormatReader(this.verbose,this.hints),s=new zxingJs_umdExports.HTMLCanvasElementLuminanceSource(t),a=new zxingJs_umdExports.BinaryBitmap(new zxingJs_umdExports.HybridBinarizer(s)),o=e.decode(a);return{text:o.text,format:QrcodeResultFormat.create(this.toHtml5QrcodeSupportedFormats(o.format)),debugData:this.createDebugData()}},n.prototype.createReverseFormatMap=function(){var t=new Map;return this.formatMap.forEach(function(e,s,a){t.set(e,s)}),t},n.prototype.toHtml5QrcodeSupportedFormats=function(t){if(!this.reverseFormatMap.has(t))throw"reverseFormatMap doesn't have ".concat(t);return this.reverseFormatMap.get(t)},n.prototype.createZXingFormats=function(t){for(var e=[],s=0,a=t;s<a.length;s++){var o=a[s];this.formatMap.has(o)?e.push(this.formatMap.get(o)):this.logger.logError("".concat(o," is not supported by")+"ZXingHtml5QrcodeShim")}return e},n.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},n}(),__awaiter$6=function(n,t,e,s){function a(o){return o instanceof e?o:new e(function(f){f(o)})}return new(e||(e=Promise))(function(o,f){function p(x){try{g(s.next(x))}catch(E){f(E)}}function y(x){try{g(s.throw(x))}catch(E){f(E)}}function g(x){x.done?o(x.value):a(x.value).then(p,y)}g((s=s.apply(n,t||[])).next())})},__generator$6=function(n,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,a,o,f;return f={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function p(g){return function(x){return y([g,x])}}function y(g){if(s)throw new TypeError("Generator is already executing.");for(;f&&(f=0,g[0]&&(e=0)),e;)try{if(s=1,a&&(o=g[0]&2?a.return:g[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,g[1])).done)return o;switch(a=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return e.label++,{value:g[1],done:!1};case 5:e.label++,a=g[1],g=[0];continue;case 7:g=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){e=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){e.label=g[1];break}if(g[0]===6&&e.label<o[1]){e.label=o[1],o=g;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(g);break}o[2]&&e.ops.pop(),e.trys.pop();continue}g=t.call(n,e)}catch(x){g=[6,x],a=0}finally{s=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},BarcodeDetectorDelegate=function(){function n(t,e,s){if(this.formatMap=new Map([[Html5QrcodeSupportedFormats.QR_CODE,"qr_code"],[Html5QrcodeSupportedFormats.AZTEC,"aztec"],[Html5QrcodeSupportedFormats.CODABAR,"codabar"],[Html5QrcodeSupportedFormats.CODE_39,"code_39"],[Html5QrcodeSupportedFormats.CODE_93,"code_93"],[Html5QrcodeSupportedFormats.CODE_128,"code_128"],[Html5QrcodeSupportedFormats.DATA_MATRIX,"data_matrix"],[Html5QrcodeSupportedFormats.ITF,"itf"],[Html5QrcodeSupportedFormats.EAN_13,"ean_13"],[Html5QrcodeSupportedFormats.EAN_8,"ean_8"],[Html5QrcodeSupportedFormats.PDF_417,"pdf417"],[Html5QrcodeSupportedFormats.UPC_A,"upc_a"],[Html5QrcodeSupportedFormats.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!n.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=e,this.logger=s;var a=this.createBarcodeDetectorFormats(t);if(this.detector=new BarcodeDetector(a),!this.detector)throw"BarcodeDetector detector not supported"}return n.isSupported=function(){if(!("BarcodeDetector"in window))return!1;var t=new BarcodeDetector({formats:["qr_code"]});return typeof t<"u"},n.prototype.decodeAsync=function(t){return __awaiter$6(this,void 0,void 0,function(){var e,s;return __generator$6(this,function(a){switch(a.label){case 0:return[4,this.detector.detect(t)];case 1:if(e=a.sent(),!e||e.length===0)throw"No barcode or QR code detected.";return s=this.selectLargestBarcode(e),[2,{text:s.rawValue,format:QrcodeResultFormat.create(this.toHtml5QrcodeSupportedFormats(s.format)),debugData:this.createDebugData()}]}})})},n.prototype.selectLargestBarcode=function(t){for(var e=null,s=0,a=0,o=t;a<o.length;a++){var f=o[a],p=f.boundingBox.width*f.boundingBox.height;p>s&&(s=p,e=f)}if(!e)throw"No largest barcode found";return e},n.prototype.createBarcodeDetectorFormats=function(t){for(var e=[],s=0,a=t;s<a.length;s++){var o=a[s];this.formatMap.has(o)?e.push(this.formatMap.get(o)):this.logger.warn("".concat(o," is not supported by")+"BarcodeDetectorDelegate")}return{formats:e}},n.prototype.toHtml5QrcodeSupportedFormats=function(t){if(!this.reverseFormatMap.has(t))throw"reverseFormatMap doesn't have ".concat(t);return this.reverseFormatMap.get(t)},n.prototype.createReverseFormatMap=function(){var t=new Map;return this.formatMap.forEach(function(e,s,a){t.set(e,s)}),t},n.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},n}(),__awaiter$5=function(n,t,e,s){function a(o){return o instanceof e?o:new e(function(f){f(o)})}return new(e||(e=Promise))(function(o,f){function p(x){try{g(s.next(x))}catch(E){f(E)}}function y(x){try{g(s.throw(x))}catch(E){f(E)}}function g(x){x.done?o(x.value):a(x.value).then(p,y)}g((s=s.apply(n,t||[])).next())})},__generator$5=function(n,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,a,o,f;return f={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function p(g){return function(x){return y([g,x])}}function y(g){if(s)throw new TypeError("Generator is already executing.");for(;f&&(f=0,g[0]&&(e=0)),e;)try{if(s=1,a&&(o=g[0]&2?a.return:g[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,g[1])).done)return o;switch(a=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return e.label++,{value:g[1],done:!1};case 5:e.label++,a=g[1],g=[0];continue;case 7:g=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){e=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){e.label=g[1];break}if(g[0]===6&&e.label<o[1]){e.label=o[1],o=g;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(g);break}o[2]&&e.ops.pop(),e.trys.pop();continue}g=t.call(n,e)}catch(x){g=[6,x],a=0}finally{s=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},Html5QrcodeShim=function(){function n(t,e,s,a){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=s,e&&BarcodeDetectorDelegate.isSupported()?(this.primaryDecoder=new BarcodeDetectorDelegate(t,s,a),this.secondaryDecoder=new ZXingHtml5QrcodeDecoder(t,s,a)):this.primaryDecoder=new ZXingHtml5QrcodeDecoder(t,s,a)}return n.prototype.decodeAsync=function(t){return __awaiter$5(this,void 0,void 0,function(){var e;return __generator$5(this,function(s){switch(s.label){case 0:e=performance.now(),s.label=1;case 1:return s.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(t)];case 2:return[2,s.sent()];case 3:return this.possiblyLogPerformance(e),[7];case 4:return[2]}})})},n.prototype.decodeRobustlyAsync=function(t){return __awaiter$5(this,void 0,void 0,function(){var e,s;return __generator$5(this,function(a){switch(a.label){case 0:e=performance.now(),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(t)];case 2:return[2,a.sent()];case 3:if(s=a.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(t)];throw s;case 4:return this.possiblyLogPerformance(e),[7];case 5:return[2]}})})},n.prototype.getDecoder=function(){return this.secondaryDecoder?this.wasPrimaryDecoderUsedInLastDecode===!1?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},n.prototype.possiblyLogPerformance=function(t){if(this.verbose){var e=performance.now()-t;this.executionResults.push(e),this.executions++,this.possiblyFlushPerformanceReport()}},n.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var t=0,e=0,s=this.executionResults;e<s.length;e++){var a=s[e];t+=a}var o=t/this.executionResults.length;console.log("".concat(o," ms for ").concat(this.executionResults.length," last runs.")),this.executions=0,this.executionResults=[]}},n}(),__extends$1=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,a){s.__proto__=a}||function(s,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(s[o]=a[o])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function s(){this.constructor=t}t.prototype=e===null?Object.create(e):(s.prototype=e.prototype,new s)}}(),__awaiter$4=function(n,t,e,s){function a(o){return o instanceof e?o:new e(function(f){f(o)})}return new(e||(e=Promise))(function(o,f){function p(x){try{g(s.next(x))}catch(E){f(E)}}function y(x){try{g(s.throw(x))}catch(E){f(E)}}function g(x){x.done?o(x.value):a(x.value).then(p,y)}g((s=s.apply(n,t||[])).next())})},__generator$4=function(n,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,a,o,f;return f={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function p(g){return function(x){return y([g,x])}}function y(g){if(s)throw new TypeError("Generator is already executing.");for(;f&&(f=0,g[0]&&(e=0)),e;)try{if(s=1,a&&(o=g[0]&2?a.return:g[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,g[1])).done)return o;switch(a=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return e.label++,{value:g[1],done:!1};case 5:e.label++,a=g[1],g=[0];continue;case 7:g=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){e=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){e.label=g[1];break}if(g[0]===6&&e.label<o[1]){e.label=o[1],o=g;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(g);break}o[2]&&e.ops.pop(),e.trys.pop();continue}g=t.call(n,e)}catch(x){g=[6,x],a=0}finally{s=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},AbstractCameraCapability=function(){function n(t,e){this.name=t,this.track=e}return n.prototype.isSupported=function(){return this.track.getCapabilities?this.name in this.track.getCapabilities():!1},n.prototype.apply=function(t){var e={};e[this.name]=t;var s={advanced:[e]};return this.track.applyConstraints(s)},n.prototype.value=function(){var t=this.track.getSettings();if(this.name in t){var e=t[this.name];return e}return null},n}(),AbstractRangeCameraCapability=function(n){__extends$1(t,n);function t(e,s){return n.call(this,e,s)||this}return t.prototype.min=function(){return this.getCapabilities().min},t.prototype.max=function(){return this.getCapabilities().max},t.prototype.step=function(){return this.getCapabilities().step},t.prototype.apply=function(e){var s={};s[this.name]=e;var a={advanced:[s]};return this.track.applyConstraints(a)},t.prototype.getCapabilities=function(){this.failIfNotSupported();var e=this.track.getCapabilities(),s=e[this.name];return{min:s.min,max:s.max,step:s.step}},t.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},t}(AbstractCameraCapability),ZoomFeatureImpl=function(n){__extends$1(t,n);function t(e){return n.call(this,"zoom",e)||this}return t}(AbstractRangeCameraCapability),TorchFeatureImpl=function(n){__extends$1(t,n);function t(e){return n.call(this,"torch",e)||this}return t}(AbstractCameraCapability),CameraCapabilitiesImpl=function(){function n(t){this.track=t}return n.prototype.zoomFeature=function(){return new ZoomFeatureImpl(this.track)},n.prototype.torchFeature=function(){return new TorchFeatureImpl(this.track)},n}(),RenderedCameraImpl=function(){function n(t,e,s){this.isClosed=!1,this.parentElement=t,this.mediaStream=e,this.callbacks=s,this.surface=this.createVideoElement(this.parentElement.clientWidth),t.append(this.surface)}return n.prototype.createVideoElement=function(t){var e=document.createElement("video");return e.style.width="".concat(t,"px"),e.style.display="block",e.muted=!0,e.setAttribute("muted","true"),e.playsInline=!0,e},n.prototype.setupSurface=function(){var t=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var e=function(){var s=t.surface.clientWidth,a=t.surface.clientHeight;t.callbacks.onRenderSurfaceReady(s,a),t.surface.removeEventListener("playing",e)};this.surface.addEventListener("playing",e),this.surface.srcObject=this.mediaStream,this.surface.play()},n.create=function(t,e,s,a){return __awaiter$4(this,void 0,void 0,function(){var o,f;return __generator$4(this,function(p){switch(p.label){case 0:return o=new n(t,e,a),s.aspectRatio?(f={aspectRatio:s.aspectRatio},[4,o.getFirstTrackOrFail().applyConstraints(f)]):[3,2];case 1:p.sent(),p.label=2;case 2:return o.setupSurface(),[2,o]}})})},n.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},n.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),this.mediaStream.getVideoTracks().length===0)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},n.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},n.prototype.resume=function(t){this.failIfClosed();var e=this,s=function(){setTimeout(t,200),e.surface.removeEventListener("playing",s)};this.surface.addEventListener("playing",s),this.surface.play()},n.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},n.prototype.getSurface=function(){return this.failIfClosed(),this.surface},n.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},n.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},n.prototype.applyVideoConstraints=function(t){return __awaiter$4(this,void 0,void 0,function(){return __generator$4(this,function(e){if("aspectRatio"in t)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(t)]})})},n.prototype.close=function(){if(this.isClosed)return Promise.resolve();var t=this;return new Promise(function(e,s){var a=t.mediaStream.getVideoTracks(),o=a.length,f=0;t.mediaStream.getVideoTracks().forEach(function(p){t.mediaStream.removeTrack(p),p.stop(),++f,f>=o&&(t.isClosed=!0,t.parentElement.removeChild(t.surface),e())})})},n.prototype.getCapabilities=function(){return new CameraCapabilitiesImpl(this.getFirstTrackOrFail())},n}(),CameraImpl=function(){function n(t){this.mediaStream=t}return n.prototype.render=function(t,e,s){return __awaiter$4(this,void 0,void 0,function(){return __generator$4(this,function(a){return[2,RenderedCameraImpl.create(t,this.mediaStream,e,s)]})})},n.create=function(t){return __awaiter$4(this,void 0,void 0,function(){var e,s;return __generator$4(this,function(a){switch(a.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return e={audio:!1,video:t},[4,navigator.mediaDevices.getUserMedia(e)];case 1:return s=a.sent(),[2,new n(s)]}})})},n}(),__awaiter$3=function(n,t,e,s){function a(o){return o instanceof e?o:new e(function(f){f(o)})}return new(e||(e=Promise))(function(o,f){function p(x){try{g(s.next(x))}catch(E){f(E)}}function y(x){try{g(s.throw(x))}catch(E){f(E)}}function g(x){x.done?o(x.value):a(x.value).then(p,y)}g((s=s.apply(n,t||[])).next())})},__generator$3=function(n,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,a,o,f;return f={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function p(g){return function(x){return y([g,x])}}function y(g){if(s)throw new TypeError("Generator is already executing.");for(;f&&(f=0,g[0]&&(e=0)),e;)try{if(s=1,a&&(o=g[0]&2?a.return:g[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,g[1])).done)return o;switch(a=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return e.label++,{value:g[1],done:!1};case 5:e.label++,a=g[1],g=[0];continue;case 7:g=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){e=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){e.label=g[1];break}if(g[0]===6&&e.label<o[1]){e.label=o[1],o=g;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(g);break}o[2]&&e.ops.pop(),e.trys.pop();continue}g=t.call(n,e)}catch(x){g=[6,x],a=0}finally{s=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},CameraFactory=function(){function n(){}return n.failIfNotSupported=function(){return __awaiter$3(this,void 0,void 0,function(){return __generator$3(this,function(t){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new n]})})},n.prototype.create=function(t){return __awaiter$3(this,void 0,void 0,function(){return __generator$3(this,function(e){return[2,CameraImpl.create(t)]})})},n}(),__awaiter$2=function(n,t,e,s){function a(o){return o instanceof e?o:new e(function(f){f(o)})}return new(e||(e=Promise))(function(o,f){function p(x){try{g(s.next(x))}catch(E){f(E)}}function y(x){try{g(s.throw(x))}catch(E){f(E)}}function g(x){x.done?o(x.value):a(x.value).then(p,y)}g((s=s.apply(n,t||[])).next())})},__generator$2=function(n,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,a,o,f;return f={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function p(g){return function(x){return y([g,x])}}function y(g){if(s)throw new TypeError("Generator is already executing.");for(;f&&(f=0,g[0]&&(e=0)),e;)try{if(s=1,a&&(o=g[0]&2?a.return:g[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,g[1])).done)return o;switch(a=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return e.label++,{value:g[1],done:!1};case 5:e.label++,a=g[1],g=[0];continue;case 7:g=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){e=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){e.label=g[1];break}if(g[0]===6&&e.label<o[1]){e.label=o[1],o=g;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(g);break}o[2]&&e.ops.pop(),e.trys.pop();continue}g=t.call(n,e)}catch(x){g=[6,x],a=0}finally{s=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},CameraRetriever=function(){function n(){}return n.retrieve=function(){if(navigator.mediaDevices)return n.getCamerasFromMediaDevices();var t=MediaStreamTrack;return MediaStreamTrack&&t.getSources?n.getCamerasFromMediaStreamTrack():n.rejectWithError()},n.rejectWithError=function(){var t=Html5QrcodeStrings.unableToQuerySupportedDevices();return n.isHttpsOrLocalhost()||(t=Html5QrcodeStrings.insecureContextCameraQueryError()),Promise.reject(t)},n.isHttpsOrLocalhost=function(){if(location.protocol==="https:")return!0;var t=location.host.split(":")[0];return t==="127.0.0.1"||t==="localhost"},n.getCamerasFromMediaDevices=function(){return __awaiter$2(this,void 0,void 0,function(){var t,e,s,a,o,f,p;return __generator$2(this,function(y){switch(y.label){case 0:return t=function(g){for(var x=g.getVideoTracks(),E=0,A=x;E<A.length;E++){var S=A[E];S.enabled=!1,S.stop(),g.removeTrack(S)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return e=y.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(s=y.sent(),a=[],o=0,f=s;o<f.length;o++)p=f[o],p.kind==="videoinput"&&a.push({id:p.deviceId,label:p.label});return t(e),[2,a]}})})},n.getCamerasFromMediaStreamTrack=function(){return new Promise(function(t,e){var s=function(o){for(var f=[],p=0,y=o;p<y.length;p++){var g=y[p];g.kind==="video"&&f.push({id:g.id,label:g.label})}t(f)},a=MediaStreamTrack;a.getSources(s)})},n}(),Html5QrcodeScannerState;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.NOT_STARTED=1]="NOT_STARTED",n[n.SCANNING=2]="SCANNING",n[n.PAUSED=3]="PAUSED"})(Html5QrcodeScannerState||(Html5QrcodeScannerState={}));var StateManagerImpl=function(){function n(){this.state=Html5QrcodeScannerState.NOT_STARTED,this.onGoingTransactionNewState=Html5QrcodeScannerState.UNKNOWN}return n.prototype.directTransition=function(t){this.failIfTransitionOngoing(),this.validateTransition(t),this.state=t},n.prototype.startTransition=function(t){return this.failIfTransitionOngoing(),this.validateTransition(t),this.onGoingTransactionNewState=t,this},n.prototype.execute=function(){if(this.onGoingTransactionNewState===Html5QrcodeScannerState.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var t=this.onGoingTransactionNewState;this.onGoingTransactionNewState=Html5QrcodeScannerState.UNKNOWN,this.directTransition(t)},n.prototype.cancel=function(){if(this.onGoingTransactionNewState===Html5QrcodeScannerState.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=Html5QrcodeScannerState.UNKNOWN},n.prototype.getState=function(){return this.state},n.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==Html5QrcodeScannerState.UNKNOWN)throw"Cannot transition to a new state, already under transition"},n.prototype.validateTransition=function(t){switch(this.state){case Html5QrcodeScannerState.UNKNOWN:throw"Transition from unknown is not allowed";case Html5QrcodeScannerState.NOT_STARTED:this.failIfNewStateIs(t,[Html5QrcodeScannerState.PAUSED]);break;case Html5QrcodeScannerState.SCANNING:break;case Html5QrcodeScannerState.PAUSED:break}},n.prototype.failIfNewStateIs=function(t,e){for(var s=0,a=e;s<a.length;s++){var o=a[s];if(t===o)throw"Cannot transition from ".concat(this.state," to ").concat(t)}},n}(),StateManagerProxy=function(){function n(t){this.stateManager=t}return n.prototype.startTransition=function(t){return this.stateManager.startTransition(t)},n.prototype.directTransition=function(t){this.stateManager.directTransition(t)},n.prototype.getState=function(){return this.stateManager.getState()},n.prototype.canScanFile=function(){return this.stateManager.getState()===Html5QrcodeScannerState.NOT_STARTED},n.prototype.isScanning=function(){return this.stateManager.getState()!==Html5QrcodeScannerState.NOT_STARTED},n.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===Html5QrcodeScannerState.SCANNING},n.prototype.isPaused=function(){return this.stateManager.getState()===Html5QrcodeScannerState.PAUSED},n}(),StateManagerFactory=function(){function n(){}return n.create=function(){return new StateManagerProxy(new StateManagerImpl)},n}(),__extends=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,a){s.__proto__=a}||function(s,a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(s[o]=a[o])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");n(t,e);function s(){this.constructor=t}t.prototype=e===null?Object.create(e):(s.prototype=e.prototype,new s)}}(),Constants=function(n){__extends(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.DEFAULT_WIDTH=300,t.DEFAULT_WIDTH_OFFSET=2,t.FILE_SCAN_MIN_HEIGHT=300,t.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,t.MIN_QR_BOX_SIZE=50,t.SHADED_LEFT=1,t.SHADED_RIGHT=2,t.SHADED_TOP=3,t.SHADED_BOTTOM=4,t.SHADED_REGION_ELEMENT_ID="qr-shaded-region",t.VERBOSE=!1,t.BORDER_SHADER_DEFAULT_COLOR="#ffffff",t.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",t}(Html5QrcodeConstants),InternalHtml5QrcodeConfig=function(){function n(t,e){this.logger=e,this.fps=Constants.SCAN_DEFAULT_FPS,t?(t.fps&&(this.fps=t.fps),this.disableFlip=t.disableFlip===!0,this.qrbox=t.qrbox,this.aspectRatio=t.aspectRatio,this.videoConstraints=t.videoConstraints):this.disableFlip=Constants.DEFAULT_DISABLE_FLIP}return n.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?VideoConstraintsUtil.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},n.prototype.isShadedBoxEnabled=function(){return!isNullOrUndefined(this.qrbox)},n.create=function(t,e){return new n(t,e)},n}(),Html5Qrcode=function(){function n(t,e){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(t))throw"HTML Element with id=".concat(t," not found");this.elementId=t,this.verbose=!1;var s;typeof e=="boolean"?this.verbose=e===!0:e&&(s=e,this.verbose=s.verbose===!0,s.experimentalFeatures),this.logger=new BaseLoggger(this.verbose),this.qrcode=new Html5QrcodeShim(this.getSupportedFormats(e),this.getUseBarCodeDetectorIfSupported(s),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=StateManagerFactory.create()}return n.prototype.start=function(t,e,s,a){var o=this;if(!t)throw"cameraIdOrConfig is required";if(!s||typeof s!="function")throw"qrCodeSuccessCallback is required and should be a function.";var f;a?f=a:f=this.verbose?this.logger.log:function(){};var p=InternalHtml5QrcodeConfig.create(e,this.logger);this.clearElement();var y=!1;p.videoConstraints&&(p.isMediaStreamConstraintsValid()?y=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var g=y,x=document.getElementById(this.elementId);x.clientWidth?x.clientWidth:Constants.DEFAULT_WIDTH,x.style.position="relative",this.shouldScan=!0,this.element=x;var E=this,A=this.stateManagerProxy.startTransition(Html5QrcodeScannerState.SCANNING);return new Promise(function(S,I){var _=g?p.videoConstraints:E.createVideoConstraints(t);if(!_){A.cancel(),I("videoConstraints should be defined");return}var R={};(!g||p.aspectRatio)&&(R.aspectRatio=p.aspectRatio);var N={onRenderSurfaceReady:function(D,M){E.setupUi(D,M,p),E.isScanning=!0,E.foreverScan(p,s,f)}};CameraFactory.failIfNotSupported().then(function(D){D.create(_).then(function(M){return M.render(o.element,R,N).then(function(W){E.renderedCamera=W,A.execute(),S(null)}).catch(function(W){A.cancel(),I(W)})}).catch(function(M){A.cancel(),I(Html5QrcodeStrings.errorGettingUserMedia(M))})}).catch(function(D){A.cancel(),I(Html5QrcodeStrings.cameraStreamingNotSupported())})})},n.prototype.pause=function(t){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(Html5QrcodeScannerState.PAUSED),this.showPausedState(),(isNullOrUndefined(t)||t!==!0)&&(t=!1),t&&this.renderedCamera&&this.renderedCamera.pause()},n.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var t=this,e=function(){t.stateManagerProxy.directTransition(Html5QrcodeScannerState.SCANNING),t.hidePausedState()};if(!this.renderedCamera.isPaused()){e();return}this.renderedCamera.resume(function(){e()})},n.prototype.getState=function(){return this.stateManagerProxy.getState()},n.prototype.stop=function(){var t=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var e=this.stateManagerProxy.startTransition(Html5QrcodeScannerState.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var s=function(){if(t.element){var o=document.getElementById(Constants.SHADED_REGION_ELEMENT_ID);o&&t.element.removeChild(o)}},a=this;return this.renderedCamera.close().then(function(){return a.renderedCamera=null,a.element&&(a.element.removeChild(a.canvasElement),a.canvasElement=null),s(),a.qrRegion&&(a.qrRegion=null),a.context&&(a.context=null),e.execute(),a.hidePausedState(),a.isScanning=!1,Promise.resolve()})},n.prototype.scanFile=function(t,e){return this.scanFileV2(t,e).then(function(s){return s.decodedText})},n.prototype.scanFileV2=function(t,e){var s=this;if(!t||!(t instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(isNullOrUndefined(e)&&(e=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(a,o){s.possiblyCloseLastScanImageFile(),s.clearElement(),s.lastScanImageFile=URL.createObjectURL(t);var f=new Image;f.onload=function(){var p=f.width,y=f.height,g=document.getElementById(s.elementId),x=g.clientWidth?g.clientWidth:Constants.DEFAULT_WIDTH,E=Math.max(g.clientHeight?g.clientHeight:y,Constants.FILE_SCAN_MIN_HEIGHT),A=s.computeCanvasDrawConfig(p,y,x,E);if(e){var S=s.createCanvasElement(x,E,"qr-canvas-visible");S.style.display="inline-block",g.appendChild(S);var I=S.getContext("2d");if(!I)throw"Unable to get 2d context from canvas";I.canvas.width=x,I.canvas.height=E,I.drawImage(f,0,0,p,y,A.x,A.y,A.width,A.height)}var _=Constants.FILE_SCAN_HIDDEN_CANVAS_PADDING,R=Math.max(f.width,A.width),N=Math.max(f.height,A.height),D=R+2*_,M=N+2*_,W=s.createCanvasElement(D,M);g.appendChild(W);var B=W.getContext("2d");if(!B)throw"Unable to get 2d context from canvas";B.canvas.width=D,B.canvas.height=M,B.drawImage(f,0,0,p,y,_,_,R,N);try{s.qrcode.decodeRobustlyAsync(W).then(function(U){a(Html5QrcodeResultFactory.createFromQrcodeResult(U))}).catch(o)}catch(U){o("QR code parse error, error = ".concat(U))}},f.onerror=o,f.onabort=o,f.onstalled=o,f.onsuspend=o,f.src=URL.createObjectURL(t)})},n.prototype.clear=function(){this.clearElement()},n.getCameras=function(){return CameraRetriever.retrieve()},n.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},n.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},n.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},n.prototype.applyVideoConstraints=function(t){if(t){if(!VideoConstraintsUtil.isMediaStreamConstraintsValid(t,this.logger))throw"invalid videoConstaints passed, check logs for more details"}else throw"videoConstaints is required argument.";return this.getRenderedCameraOrFail().applyVideoConstraints(t)},n.prototype.getRenderedCameraOrFail=function(){if(this.renderedCamera==null)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},n.prototype.getSupportedFormats=function(t){var e=[Html5QrcodeSupportedFormats.QR_CODE,Html5QrcodeSupportedFormats.AZTEC,Html5QrcodeSupportedFormats.CODABAR,Html5QrcodeSupportedFormats.CODE_39,Html5QrcodeSupportedFormats.CODE_93,Html5QrcodeSupportedFormats.CODE_128,Html5QrcodeSupportedFormats.DATA_MATRIX,Html5QrcodeSupportedFormats.MAXICODE,Html5QrcodeSupportedFormats.ITF,Html5QrcodeSupportedFormats.EAN_13,Html5QrcodeSupportedFormats.EAN_8,Html5QrcodeSupportedFormats.PDF_417,Html5QrcodeSupportedFormats.RSS_14,Html5QrcodeSupportedFormats.RSS_EXPANDED,Html5QrcodeSupportedFormats.UPC_A,Html5QrcodeSupportedFormats.UPC_E,Html5QrcodeSupportedFormats.UPC_EAN_EXTENSION];if(!t||typeof t=="boolean"||!t.formatsToSupport)return e;if(!Array.isArray(t.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(t.formatsToSupport.length===0)throw"Atleast 1 formatsToSupport is needed.";for(var s=[],a=0,o=t.formatsToSupport;a<o.length;a++){var f=o[a];isValidHtml5QrcodeSupportedFormats(f)?s.push(f):this.logger.warn("Invalid format: ".concat(f," passed in config, ignoring."))}if(s.length===0)throw"None of formatsToSupport match supported values.";return s},n.prototype.getUseBarCodeDetectorIfSupported=function(t){if(isNullOrUndefined(t))return!0;if(!isNullOrUndefined(t.useBarCodeDetectorIfSupported))return t.useBarCodeDetectorIfSupported!==!1;if(isNullOrUndefined(t.experimentalFeatures))return!0;var e=t.experimentalFeatures;return isNullOrUndefined(e.useBarCodeDetectorIfSupported)?!0:e.useBarCodeDetectorIfSupported!==!1},n.prototype.validateQrboxSize=function(t,e,s){var a=this,o=s.qrbox;this.validateQrboxConfig(o);var f=this.toQrdimensions(t,e,o),p=function(g){if(g<Constants.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(Constants.MIN_QR_BOX_SIZE,"px.")},y=function(g){return g>t&&(a.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),g=t),g};p(f.width),p(f.height),f.width=y(f.width)},n.prototype.validateQrboxConfig=function(t){if(typeof t!="number"&&typeof t!="function"&&(t.width===void 0||t.height===void 0))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},n.prototype.toQrdimensions=function(t,e,s){if(typeof s=="number")return{width:s,height:s};if(typeof s=="function")try{return s(t,e)}catch(a){throw new Error("qrbox config was passed as a function but it failed with unknown error"+a)}return s},n.prototype.setupUi=function(t,e,s){s.isShadedBoxEnabled()&&this.validateQrboxSize(t,e,s);var a=isNullOrUndefined(s.qrbox)?{width:t,height:e}:s.qrbox;this.validateQrboxConfig(a);var o=this.toQrdimensions(t,e,a);o.height>e&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var f=s.isShadedBoxEnabled()&&o.height<=e,p={x:0,y:0,width:t,height:e},y=f?this.getShadedRegionBounds(t,e,o):p,g=this.createCanvasElement(y.width,y.height),x={willReadFrequently:!0},E=g.getContext("2d",x);E.canvas.width=y.width,E.canvas.height=y.height,this.element.append(g),f&&this.possiblyInsertShadingElement(this.element,t,e,o),this.createScannerPausedUiElement(this.element),this.qrRegion=y,this.context=E,this.canvasElement=g},n.prototype.createScannerPausedUiElement=function(t){var e=document.createElement("div");e.innerText=Html5QrcodeStrings.scannerPaused(),e.style.display="none",e.style.position="absolute",e.style.top="0px",e.style.zIndex="1",e.style.background="rgba(9, 9, 9, 0.46)",e.style.color="#FFECEC",e.style.textAlign="center",e.style.width="100%",t.appendChild(e),this.scannerPausedUiElement=e},n.prototype.scanContext=function(t,e){var s=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(a){return t(a.text,Html5QrcodeResultFactory.createFromQrcodeResult(a)),s.possiblyUpdateShaders(!0),!0}).catch(function(a){s.possiblyUpdateShaders(!1);var o=Html5QrcodeStrings.codeParseError(a);return e(o,Html5QrcodeErrorFactory.createFrom(o)),!1})},n.prototype.foreverScan=function(t,e,s){var a=this;if(this.shouldScan&&this.renderedCamera){var o=this.renderedCamera.getSurface(),f=o.videoWidth/o.clientWidth,p=o.videoHeight/o.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var y=this.qrRegion.width*f,g=this.qrRegion.height*p,x=this.qrRegion.x*f,E=this.qrRegion.y*p;this.context.drawImage(o,x,E,y,g,0,0,this.qrRegion.width,this.qrRegion.height);var A=function(){a.foreverScanTimeout=setTimeout(function(){a.foreverScan(t,e,s)},a.getTimeoutFps(t.fps))};this.scanContext(e,s).then(function(S){!S&&t.disableFlip!==!0?(a.context.translate(a.context.canvas.width,0),a.context.scale(-1,1),a.scanContext(e,s).finally(function(){A()})):A()}).catch(function(S){a.logger.logError("Error happend while scanning context",S),A()})}},n.prototype.createVideoConstraints=function(t){if(typeof t=="string")return{deviceId:{exact:t}};if(typeof t=="object"){var e="facingMode",s="deviceId",a={user:!0,environment:!0},o="exact",f=function(I){if(I in a)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(I,"'")},p=Object.keys(t);if(p.length!==1)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(p.length," keys");var y=Object.keys(t)[0];if(y!==e&&y!==s)throw"Only '".concat(e,"' and '").concat(s,"' ")+" are supported for 'cameraIdOrConfig'";if(y===e){var g=t.facingMode;if(typeof g=="string"){if(f(g))return{facingMode:g}}else if(typeof g=="object")if(o in g){if(f(g["".concat(o)]))return{facingMode:{exact:g["".concat(o)]}}}else throw"'facingMode' should be string or object with"+" ".concat(o," as key.");else{var x=typeof g;throw"Invalid type of 'facingMode' = ".concat(x)}}else{var E=t.deviceId;if(typeof E=="string")return{deviceId:E};if(typeof E=="object"){if(o in E)return{deviceId:{exact:E["".concat(o)]}};throw"'deviceId' should be string or object with"+" ".concat(o," as key.")}else{var A=typeof E;throw"Invalid type of 'deviceId' = ".concat(A)}}}var S=typeof t;throw"Invalid type of 'cameraIdOrConfig' = ".concat(S)},n.prototype.computeCanvasDrawConfig=function(t,e,s,a){if(t<=s&&e<=a){var o=(s-t)/2,f=(a-e)/2;return{x:o,y:f,width:t,height:e}}else{var p=t,y=e;return t>s&&(e=s/t*e,t=s),e>a&&(t=a/e*t,e=a),this.logger.log("Image downsampled from "+"".concat(p,"X").concat(y)+" to ".concat(t,"X").concat(e,".")),this.computeCanvasDrawConfig(t,e,s,a)}},n.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var t=document.getElementById(this.elementId);t&&(t.innerHTML="")},n.prototype.possiblyUpdateShaders=function(t){this.qrMatch!==t&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(e){e.style.backgroundColor=t?Constants.BORDER_SHADER_MATCH_COLOR:Constants.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=t)},n.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},n.prototype.createCanvasElement=function(t,e,s){var a=t,o=e,f=document.createElement("canvas");return f.style.width="".concat(a,"px"),f.style.height="".concat(o,"px"),f.style.display="none",f.id=isNullOrUndefined(s)?"qr-canvas":s,f},n.prototype.getShadedRegionBounds=function(t,e,s){if(s.width>t||s.height>e)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(t-s.width)/2,y:(e-s.height)/2,width:s.width,height:s.height}},n.prototype.possiblyInsertShadingElement=function(t,e,s,a){if(!(e-a.width<1||s-a.height<1)){var o=document.createElement("div");o.style.position="absolute";var f=(e-a.width)/2,p=(s-a.height)/2;if(o.style.borderLeft="".concat(f,"px solid rgba(0, 0, 0, 0.48)"),o.style.borderRight="".concat(f,"px solid rgba(0, 0, 0, 0.48)"),o.style.borderTop="".concat(p,"px solid rgba(0, 0, 0, 0.48)"),o.style.borderBottom="".concat(p,"px solid rgba(0, 0, 0, 0.48)"),o.style.boxSizing="border-box",o.style.top="0px",o.style.bottom="0px",o.style.left="0px",o.style.right="0px",o.id="".concat(Constants.SHADED_REGION_ELEMENT_ID),e-a.width<11||s-a.height<11)this.hasBorderShaders=!1;else{var y=5,g=40;this.insertShaderBorders(o,g,y,-y,null,0,!0),this.insertShaderBorders(o,g,y,-y,null,0,!1),this.insertShaderBorders(o,g,y,null,-y,0,!0),this.insertShaderBorders(o,g,y,null,-y,0,!1),this.insertShaderBorders(o,y,g+y,-y,null,-y,!0),this.insertShaderBorders(o,y,g+y,null,-y,-y,!0),this.insertShaderBorders(o,y,g+y,-y,null,-y,!1),this.insertShaderBorders(o,y,g+y,null,-y,-y,!1),this.hasBorderShaders=!0}t.append(o)}},n.prototype.insertShaderBorders=function(t,e,s,a,o,f,p){var y=document.createElement("div");y.style.position="absolute",y.style.backgroundColor=Constants.BORDER_SHADER_DEFAULT_COLOR,y.style.width="".concat(e,"px"),y.style.height="".concat(s,"px"),a!==null&&(y.style.top="".concat(a,"px")),o!==null&&(y.style.bottom="".concat(o,"px")),p?y.style.left="".concat(f,"px"):y.style.right="".concat(f,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(y),t.appendChild(y)},n.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},n.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},n.prototype.getTimeoutFps=function(t){return 1e3/t},n}(),SVG_XML_PREFIX="data:image/svg+xml;base64,",ASSET_CAMERA_SCAN=SVG_XML_PREFIX+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzNzEuNjQzIDM3MS42NDMiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDM3MS42NDMgMzcxLjY0MyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHBhdGggZD0iTTEwNS4wODQgMzguMjcxaDE2My43Njh2MjBIMTA1LjA4NHoiLz48cGF0aCBkPSJNMzExLjU5NiAxOTAuMTg5Yy03LjQ0MS05LjM0Ny0xOC40MDMtMTYuMjA2LTMyLjc0My0yMC41MjJWMzBjMC0xNi41NDItMTMuNDU4LTMwLTMwLTMwSDEyNS4wODRjLTE2LjU0MiAwLTMwIDEzLjQ1OC0zMCAzMHYxMjAuMTQzaC04LjI5NmMtMTYuNTQyIDAtMzAgMTMuNDU4LTMwIDMwdjEuMzMzYTI5LjgwNCAyOS44MDQgMCAwIDAgNC42MDMgMTUuOTM5Yy03LjM0IDUuNDc0LTEyLjEwMyAxNC4yMjEtMTIuMTAzIDI0LjA2MXYxLjMzM2MwIDkuODQgNC43NjMgMTguNTg3IDEyLjEwMyAyNC4wNjJhMjkuODEgMjkuODEgMCAwIDAtNC42MDMgMTUuOTM4djEuMzMzYzAgMTYuNTQyIDEzLjQ1OCAzMCAzMCAzMGg4LjMyNGMuNDI3IDExLjYzMSA3LjUwMyAyMS41ODcgMTcuNTM0IDI2LjE3Ny45MzEgMTAuNTAzIDQuMDg0IDMwLjE4NyAxNC43NjggNDUuNTM3YTkuOTg4IDkuOTg4IDAgMCAwIDguMjE2IDQuMjg4IDkuOTU4IDkuOTU4IDAgMCAwIDUuNzA0LTEuNzkzYzQuNTMzLTMuMTU1IDUuNjUtOS4zODggMi40OTUtMTMuOTIxLTYuNzk4LTkuNzY3LTkuNjAyLTIyLjYwOC0xMC43Ni0zMS40aDgyLjY4NWMuMjcyLjQxNC41NDUuODE4LjgxNSAxLjIxIDMuMTQyIDQuNTQxIDkuMzcyIDUuNjc5IDEzLjkxMyAyLjUzNCA0LjU0Mi0zLjE0MiA1LjY3Ny05LjM3MSAyLjUzNS0xMy45MTMtMTEuOTE5LTE3LjIyOS04Ljc4Ny0zNS44ODQgOS41ODEtNTcuMDEyIDMuMDY3LTIuNjUyIDEyLjMwNy0xMS43MzIgMTEuMjE3LTI0LjAzMy0uODI4LTkuMzQzLTcuMTA5LTE3LjE5NC0xOC42NjktMjMuMzM3YTkuODU3IDkuODU3IDAgMCAwLTEuMDYxLS40ODZjLS40NjYtLjE4Mi0xMS40MDMtNC41NzktOS43NDEtMTUuNzA2IDEuMDA3LTYuNzM3IDE0Ljc2OC04LjI3MyAyMy43NjYtNy42NjYgMjMuMTU2IDEuNTY5IDM5LjY5OCA3LjgwMyA0Ny44MzYgMTguMDI2IDUuNzUyIDcuMjI1IDcuNjA3IDE2LjYyMyA1LjY3MyAyOC43MzMtLjQxMyAyLjU4NS0uODI0IDUuMjQxLTEuMjQ1IDcuOTU5LTUuNzU2IDM3LjE5NC0xMi45MTkgODMuNDgzLTQ5Ljg3IDExNC42NjEtNC4yMjEgMy41NjEtNC43NTYgOS44Ny0xLjE5NCAxNC4wOTJhOS45OCA5Ljk4IDAgMCAwIDcuNjQ4IDMuNTUxIDkuOTU1IDkuOTU1IDAgMCAwIDYuNDQ0LTIuMzU4YzQyLjY3Mi0zNi4wMDUgNTAuODAyLTg4LjUzMyA1Ni43MzctMTI2Ljg4OC40MTUtMi42ODQuODIxLTUuMzA5IDEuMjI5LTcuODYzIDIuODM0LTE3LjcyMS0uNDU1LTMyLjY0MS05Ljc3Mi00NC4zNDV6bS0yMzIuMzA4IDQyLjYyYy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM2MwLTUuNTE0IDQuNDg2LTEwIDEwLTEwaDE1djIxLjMzM2gtMTV6bS0yLjUtNTIuNjY2YzAtNS41MTQgNC40ODYtMTAgMTAtMTBoNy41djIxLjMzM2gtNy41Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM3ptMTcuNSA5My45OTloLTcuNWMtNS41MTQgMC0xMC00LjQ4Ni0xMC0xMHYtMS4zMzNjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGg3LjV2MjEuMzMzem0zMC43OTYgMjguODg3Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi04LjI3MWg5MS40NTdjLS44NTEgNi42NjgtLjQzNyAxMi43ODcuNzMxIDE4LjI3MWgtODIuMTg4em03OS40ODItMTEzLjY5OGMtMy4xMjQgMjAuOTA2IDEyLjQyNyAzMy4xODQgMjEuNjI1IDM3LjA0IDUuNDQxIDIuOTY4IDcuNTUxIDUuNjQ3IDcuNzAxIDcuMTg4LjIxIDIuMTUtMi41NTMgNS42ODQtNC40NzcgNy4yNTEtLjQ4Mi4zNzgtLjkyOS44LTEuMzM1IDEuMjYxLTYuOTg3IDcuOTM2LTExLjk4MiAxNS41Mi0xNS40MzIgMjIuNjg4aC05Ny41NjRWMzBjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGgxMjMuNzY5YzUuNTE0IDAgMTAgNC40ODYgMTAgMTB2MTM1LjU3OWMtMy4wMzItLjM4MS02LjE1LS42OTQtOS4zODktLjkxNC0yNS4xNTktMS42OTQtNDIuMzcgNy43NDgtNDQuODk4IDI0LjY2NnoiLz48cGF0aCBkPSJNMTc5LjEyOSA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXpNMTcyLjYyOSAxNDIuODZoLTEyLjU2VjEzMC44YTUgNSAwIDEgMC0xMCAwdjE3LjA2MWE1IDUgMCAwIDAgNSA1aDE3LjU2YTUgNSAwIDEgMCAwLTEwLjAwMXpNMjE2LjU2OCA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXptLTUgMjQuMDYxaC0xNC4wNlY5My4xNjdoMTQuMDZ2MTQuMDYxek0yMTEuNjY5IDEyNS45MzZIMTk3LjQxYTUgNSAwIDAgMC01IDV2MTQuMjU3YTUgNSAwIDAgMCA1IDVoMTQuMjU5YTUgNSAwIDAgMCA1LTV2LTE0LjI1N2E1IDUgMCAwIDAtNS01eiIvPjwvc3ZnPg==",ASSET_FILE_SCAN=SVG_XML_PREFIX+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1OS4wMTggNTkuMDE4IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1OS4wMTggNTkuMDE4IiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJtNTguNzQxIDU0LjgwOS01Ljk2OS02LjI0NGExMC43NCAxMC43NCAwIDAgMCAyLjgyLTcuMjVjMC01Ljk1My00Ljg0My0xMC43OTYtMTAuNzk2LTEwLjc5NlMzNCAzNS4zNjEgMzQgNDEuMzE0IDM4Ljg0MyA1Mi4xMSA0NC43OTYgNTIuMTFjMi40NDEgMCA0LjY4OC0uODI0IDYuNDk5LTIuMTk2bDYuMDAxIDYuMjc3YS45OTguOTk4IDAgMCAwIDEuNDE0LjAzMiAxIDEgMCAwIDAgLjAzMS0xLjQxNHpNMzYgNDEuMzE0YzAtNC44NSAzLjk0Ni04Ljc5NiA4Ljc5Ni04Ljc5NnM4Ljc5NiAzLjk0NiA4Ljc5NiA4Ljc5Ni0zLjk0NiA4Ljc5Ni04Ljc5NiA4Ljc5NlMzNiA0Ni4xNjQgMzYgNDEuMzE0ek0xMC40MzEgMTYuMDg4YzAgMy4wNyAyLjQ5OCA1LjU2OCA1LjU2OSA1LjU2OHM1LjU2OS0yLjQ5OCA1LjU2OS01LjU2OGMwLTMuMDcxLTIuNDk4LTUuNTY5LTUuNTY5LTUuNTY5cy01LjU2OSAyLjQ5OC01LjU2OSA1LjU2OXptOS4xMzggMGMwIDEuOTY4LTEuNjAyIDMuNTY4LTMuNTY5IDMuNTY4cy0zLjU2OS0xLjYwMS0zLjU2OS0zLjU2OCAxLjYwMi0zLjU2OSAzLjU2OS0zLjU2OSAzLjU2OSAxLjYwMSAzLjU2OSAzLjU2OXoiLz48cGF0aCBkPSJtMzAuODgyIDI4Ljk4NyA5LjE4LTEwLjA1NCAxMS4yNjIgMTAuMzIzYTEgMSAwIDAgMCAxLjM1MS0xLjQ3NWwtMTItMTFhMSAxIDAgMCAwLTEuNDE0LjA2M2wtOS43OTQgMTAuNzI3LTQuNzQzLTQuNzQzYTEuMDAzIDEuMDAzIDAgMCAwLTEuMzY4LS4wNDRMNi4zMzkgMzcuNzY4YTEgMSAwIDEgMCAxLjMyMiAxLjUwMWwxNi4zMTMtMTQuMzYyIDcuMzE5IDcuMzE4YS45OTkuOTk5IDAgMSAwIDEuNDE0LTEuNDE0bC0xLjgyNS0xLjgyNHoiLz48cGF0aCBkPSJNMzAgNDYuNTE4SDJ2LTQyaDU0djI4YTEgMSAwIDEgMCAyIDB2LTI5YTEgMSAwIDAgMC0xLTFIMWExIDEgMCAwIDAtMSAxdjQ0YTEgMSAwIDAgMCAxIDFoMjlhMSAxIDAgMSAwIDAtMnoiLz48L3N2Zz4=",ASSET_INFO_ICON_16PX=SVG_XML_PREFIX+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NjAgNDYwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NjAgNDYwIiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJNMjMwIDBDMTAyLjk3NSAwIDAgMTAyLjk3NSAwIDIzMHMxMDIuOTc1IDIzMCAyMzAgMjMwIDIzMC0xMDIuOTc0IDIzMC0yMzBTMzU3LjAyNSAwIDIzMCAwem0zOC4zMzMgMzc3LjM2YzAgOC42NzYtNy4wMzQgMTUuNzEtMTUuNzEgMTUuNzFoLTQzLjEwMWMtOC42NzYgMC0xNS43MS03LjAzNC0xNS43MS0xNS43MVYyMDIuNDc3YzAtOC42NzYgNy4wMzMtMTUuNzEgMTUuNzEtMTUuNzFoNDMuMTAxYzguNjc2IDAgMTUuNzEgNy4wMzMgMTUuNzEgMTUuNzFWMzc3LjM2ek0yMzAgMTU3Yy0yMS41MzkgMC0zOS0xNy40NjEtMzktMzlzMTcuNDYxLTM5IDM5LTM5IDM5IDE3LjQ2MSAzOSAzOS0xNy40NjEgMzktMzkgMzl6Ii8+PC9zdmc+",ASSET_CLOSE_ICON_16PX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAQgAAAEIBarqQRAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAE1SURBVDiNfdI7S0NBEAXgLya1otFgpbYSbISAgpXYi6CmiH9KCAiChaVga6OiWPgfRDQ+0itaGVNosXtluWwcuMzePfM4M3sq8lbHBubwg1dc4m1E/J/N4ghDPOIsfk/4xiEao5KX0McFljN4C9d4QTPXuY99jP3DsIoDPGM6BY5i5yI5R7O4q+ImFkJY2DCh3cAH2klyB+9J1xUMMAG7eCh1a+Mr+k48b5diXrFVwwLuS+BJ9MfR7+G0FHOHhTHhnXNWS87VDF4pcnfQK4Ep7XScNLmPTZgURNKKYENYWDpzW1BhscS1WHS8CDgURFJQrWcoF3c13KKbgg1BYQfy8xZWEzTTw1QZbAoKu8FqJnktdu5hcVSHmchiILzzuaDQvjBzV2m8yohCE1jHfPx/xhU+y4G/D75ELlRJsSYAAAAASUVORK5CYII=",PersistedDataFactory=function(){function n(){}return n.createDefault=function(){return{hasPermission:!1,lastUsedCameraId:null}},n}(),PersistedDataManager=function(){function n(){this.data=PersistedDataFactory.createDefault();var t=localStorage.getItem(n.LOCAL_STORAGE_KEY);t?this.data=JSON.parse(t):this.reset()}return n.prototype.hasCameraPermissions=function(){return this.data.hasPermission},n.prototype.getLastUsedCameraId=function(){return this.data.lastUsedCameraId},n.prototype.setHasPermission=function(t){this.data.hasPermission=t,this.flush()},n.prototype.setLastUsedCameraId=function(t){this.data.lastUsedCameraId=t,this.flush()},n.prototype.resetLastUsedCameraId=function(){this.data.lastUsedCameraId=null,this.flush()},n.prototype.reset=function(){this.data=PersistedDataFactory.createDefault(),this.flush()},n.prototype.flush=function(){localStorage.setItem(n.LOCAL_STORAGE_KEY,JSON.stringify(this.data))},n.LOCAL_STORAGE_KEY="HTML5_QRCODE_DATA",n}(),LibraryInfoDiv=function(){function n(){this.infoDiv=document.createElement("div")}return n.prototype.renderInto=function(t){this.infoDiv.style.position="absolute",this.infoDiv.style.top="10px",this.infoDiv.style.right="10px",this.infoDiv.style.zIndex="2",this.infoDiv.style.display="none",this.infoDiv.style.padding="5pt",this.infoDiv.style.border="1px solid #171717",this.infoDiv.style.fontSize="10pt",this.infoDiv.style.background="rgb(0 0 0 / 69%)",this.infoDiv.style.borderRadius="5px",this.infoDiv.style.textAlign="center",this.infoDiv.style.fontWeight="400",this.infoDiv.style.color="white",this.infoDiv.innerText=LibraryInfoStrings.poweredBy();var e=document.createElement("a");e.innerText="ScanApp",e.href="https://scanapp.org",e.target="new",e.style.color="white",this.infoDiv.appendChild(e);var s=document.createElement("br"),a=document.createElement("br");this.infoDiv.appendChild(s),this.infoDiv.appendChild(a);var o=document.createElement("a");o.innerText=LibraryInfoStrings.reportIssues(),o.href="https://github.com/mebjas/html5-qrcode/issues",o.target="new",o.style.color="white",this.infoDiv.appendChild(o),t.appendChild(this.infoDiv)},n.prototype.show=function(){this.infoDiv.style.display="block"},n.prototype.hide=function(){this.infoDiv.style.display="none"},n}(),LibraryInfoIcon=function(){function n(t,e){this.isShowingInfoIcon=!0,this.onTapIn=t,this.onTapOut=e,this.infoIcon=document.createElement("img")}return n.prototype.renderInto=function(t){var e=this;this.infoIcon.alt="Info icon",this.infoIcon.src=ASSET_INFO_ICON_16PX,this.infoIcon.style.position="absolute",this.infoIcon.style.top="4px",this.infoIcon.style.right="4px",this.infoIcon.style.opacity="0.6",this.infoIcon.style.cursor="pointer",this.infoIcon.style.zIndex="2",this.infoIcon.style.width="16px",this.infoIcon.style.height="16px",this.infoIcon.onmouseover=function(s){return e.onHoverIn()},this.infoIcon.onmouseout=function(s){return e.onHoverOut()},this.infoIcon.onclick=function(s){return e.onClick()},t.appendChild(this.infoIcon)},n.prototype.onHoverIn=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="1")},n.prototype.onHoverOut=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="0.6")},n.prototype.onClick=function(){this.isShowingInfoIcon?(this.isShowingInfoIcon=!1,this.onTapIn(),this.infoIcon.src=ASSET_CLOSE_ICON_16PX,this.infoIcon.style.opacity="1"):(this.isShowingInfoIcon=!0,this.onTapOut(),this.infoIcon.src=ASSET_INFO_ICON_16PX,this.infoIcon.style.opacity="0.6")},n}(),LibraryInfoContainer=function(){function n(){var t=this;this.infoDiv=new LibraryInfoDiv,this.infoIcon=new LibraryInfoIcon(function(){t.infoDiv.show()},function(){t.infoDiv.hide()})}return n.prototype.renderInto=function(t){this.infoDiv.renderInto(t),this.infoIcon.renderInto(t)},n}(),__awaiter$1=function(n,t,e,s){function a(o){return o instanceof e?o:new e(function(f){f(o)})}return new(e||(e=Promise))(function(o,f){function p(x){try{g(s.next(x))}catch(E){f(E)}}function y(x){try{g(s.throw(x))}catch(E){f(E)}}function g(x){x.done?o(x.value):a(x.value).then(p,y)}g((s=s.apply(n,t||[])).next())})},__generator$1=function(n,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,a,o,f;return f={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function p(g){return function(x){return y([g,x])}}function y(g){if(s)throw new TypeError("Generator is already executing.");for(;f&&(f=0,g[0]&&(e=0)),e;)try{if(s=1,a&&(o=g[0]&2?a.return:g[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,g[1])).done)return o;switch(a=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return e.label++,{value:g[1],done:!1};case 5:e.label++,a=g[1],g=[0];continue;case 7:g=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){e=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){e.label=g[1];break}if(g[0]===6&&e.label<o[1]){e.label=o[1],o=g;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(g);break}o[2]&&e.ops.pop(),e.trys.pop();continue}g=t.call(n,e)}catch(x){g=[6,x],a=0}finally{s=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},CameraPermissions=function(){function n(){}return n.hasPermissions=function(){return __awaiter$1(this,void 0,void 0,function(){var t,e,s,a;return __generator$1(this,function(o){switch(o.label){case 0:return[4,navigator.mediaDevices.enumerateDevices()];case 1:for(t=o.sent(),e=0,s=t;e<s.length;e++)if(a=s[e],a.kind==="videoinput"&&a.label)return[2,!0];return[2,!1]}})})},n}(),ScanTypeSelector=function(){function n(t){this.supportedScanTypes=this.validateAndReturnScanTypes(t)}return n.prototype.getDefaultScanType=function(){return this.supportedScanTypes[0]},n.prototype.hasMoreThanOneScanType=function(){return this.supportedScanTypes.length>1},n.prototype.isCameraScanRequired=function(){for(var t=0,e=this.supportedScanTypes;t<e.length;t++){var s=e[t];if(n.isCameraScanType(s))return!0}return!1},n.isCameraScanType=function(t){return t===Html5QrcodeScanType.SCAN_TYPE_CAMERA},n.isFileScanType=function(t){return t===Html5QrcodeScanType.SCAN_TYPE_FILE},n.prototype.validateAndReturnScanTypes=function(t){if(!t||t.length===0)return Html5QrcodeConstants.DEFAULT_SUPPORTED_SCAN_TYPE;var e=Html5QrcodeConstants.DEFAULT_SUPPORTED_SCAN_TYPE.length;if(t.length>e)throw"Max ".concat(e," values expected for ")+"supportedScanTypes";for(var s=0,a=t;s<a.length;s++){var o=a[s];if(!Html5QrcodeConstants.DEFAULT_SUPPORTED_SCAN_TYPE.includes(o))throw"Unsupported scan type ".concat(o)}return t},n}(),PublicUiElementIdAndClasses=function(){function n(){}return n.ALL_ELEMENT_CLASS="html5-qrcode-element",n.CAMERA_PERMISSION_BUTTON_ID="html5-qrcode-button-camera-permission",n.CAMERA_START_BUTTON_ID="html5-qrcode-button-camera-start",n.CAMERA_STOP_BUTTON_ID="html5-qrcode-button-camera-stop",n.TORCH_BUTTON_ID="html5-qrcode-button-torch",n.CAMERA_SELECTION_SELECT_ID="html5-qrcode-select-camera",n.FILE_SELECTION_BUTTON_ID="html5-qrcode-button-file-selection",n.ZOOM_SLIDER_ID="html5-qrcode-input-range-zoom",n.SCAN_TYPE_CHANGE_ANCHOR_ID="html5-qrcode-anchor-scan-type-change",n.TORCH_BUTTON_CLASS_TORCH_ON="html5-qrcode-button-torch-on",n.TORCH_BUTTON_CLASS_TORCH_OFF="html5-qrcode-button-torch-off",n}(),BaseUiElementFactory=function(){function n(){}return n.createElement=function(t,e){var s=document.createElement(t);return s.id=e,s.classList.add(PublicUiElementIdAndClasses.ALL_ELEMENT_CLASS),t==="button"&&s.setAttribute("type","button"),s},n}(),__awaiter=function(n,t,e,s){function a(o){return o instanceof e?o:new e(function(f){f(o)})}return new(e||(e=Promise))(function(o,f){function p(x){try{g(s.next(x))}catch(E){f(E)}}function y(x){try{g(s.throw(x))}catch(E){f(E)}}function g(x){x.done?o(x.value):a(x.value).then(p,y)}g((s=s.apply(n,t||[])).next())})},__generator=function(n,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,a,o,f;return f={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function p(g){return function(x){return y([g,x])}}function y(g){if(s)throw new TypeError("Generator is already executing.");for(;f&&(f=0,g[0]&&(e=0)),e;)try{if(s=1,a&&(o=g[0]&2?a.return:g[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,g[1])).done)return o;switch(a=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return e.label++,{value:g[1],done:!1};case 5:e.label++,a=g[1],g=[0];continue;case 7:g=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){e=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){e.label=g[1];break}if(g[0]===6&&e.label<o[1]){e.label=o[1],o=g;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(g);break}o[2]&&e.ops.pop(),e.trys.pop();continue}g=t.call(n,e)}catch(x){g=[6,x],a=0}finally{s=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},TorchController=function(){function n(t,e,s){this.isTorchOn=!1,this.torchCapability=t,this.buttonController=e,this.onTorchActionFailureCallback=s}return n.prototype.isTorchEnabled=function(){return this.isTorchOn},n.prototype.flipState=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(s){switch(s.label){case 0:this.buttonController.disable(),t=!this.isTorchOn,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.torchCapability.apply(t)];case 2:return s.sent(),this.updateUiBasedOnLatestSettings(this.torchCapability.value(),t),[3,4];case 3:return e=s.sent(),this.propagateFailure(t,e),this.buttonController.enable(),[3,4];case 4:return[2]}})})},n.prototype.updateUiBasedOnLatestSettings=function(t,e){t===e?(this.buttonController.setText(e?Html5QrcodeScannerStrings.torchOffButton():Html5QrcodeScannerStrings.torchOnButton()),this.isTorchOn=e):this.propagateFailure(e),this.buttonController.enable()},n.prototype.propagateFailure=function(t,e){var s=t?Html5QrcodeScannerStrings.torchOnFailedMessage():Html5QrcodeScannerStrings.torchOffFailedMessage();e&&(s+="; Error = "+e),this.onTorchActionFailureCallback(s)},n.prototype.reset=function(){this.isTorchOn=!1},n}(),TorchButton=function(){function n(t,e){this.onTorchActionFailureCallback=e,this.torchButton=BaseUiElementFactory.createElement("button",PublicUiElementIdAndClasses.TORCH_BUTTON_ID),this.torchController=new TorchController(t,this,e)}return n.prototype.render=function(t,e){var s=this;this.torchButton.innerText=Html5QrcodeScannerStrings.torchOnButton(),this.torchButton.style.display=e.display,this.torchButton.style.marginLeft=e.marginLeft;var a=this;this.torchButton.addEventListener("click",function(o){return __awaiter(s,void 0,void 0,function(){return __generator(this,function(f){switch(f.label){case 0:return[4,a.torchController.flipState()];case 1:return f.sent(),a.torchController.isTorchEnabled()?(a.torchButton.classList.remove(PublicUiElementIdAndClasses.TORCH_BUTTON_CLASS_TORCH_OFF),a.torchButton.classList.add(PublicUiElementIdAndClasses.TORCH_BUTTON_CLASS_TORCH_ON)):(a.torchButton.classList.remove(PublicUiElementIdAndClasses.TORCH_BUTTON_CLASS_TORCH_ON),a.torchButton.classList.add(PublicUiElementIdAndClasses.TORCH_BUTTON_CLASS_TORCH_OFF)),[2]}})})}),t.appendChild(this.torchButton)},n.prototype.updateTorchCapability=function(t){this.torchController=new TorchController(t,this,this.onTorchActionFailureCallback)},n.prototype.getTorchButton=function(){return this.torchButton},n.prototype.hide=function(){this.torchButton.style.display="none"},n.prototype.show=function(){this.torchButton.style.display="inline-block"},n.prototype.disable=function(){this.torchButton.disabled=!0},n.prototype.enable=function(){this.torchButton.disabled=!1},n.prototype.setText=function(t){this.torchButton.innerText=t},n.prototype.reset=function(){this.torchButton.innerText=Html5QrcodeScannerStrings.torchOnButton(),this.torchController.reset()},n.create=function(t,e,s,a){var o=new n(e,a);return o.render(t,s),o},n}(),FileSelectionUi=function(){function n(t,e,s){this.fileBasedScanRegion=this.createFileBasedScanRegion(),this.fileBasedScanRegion.style.display=e?"block":"none",t.appendChild(this.fileBasedScanRegion);var a=document.createElement("label");a.setAttribute("for",this.getFileScanInputId()),a.style.display="inline-block",this.fileBasedScanRegion.appendChild(a),this.fileSelectionButton=BaseUiElementFactory.createElement("button",PublicUiElementIdAndClasses.FILE_SELECTION_BUTTON_ID),this.setInitialValueToButton(),this.fileSelectionButton.addEventListener("click",function(p){a.click()}),a.append(this.fileSelectionButton),this.fileScanInput=BaseUiElementFactory.createElement("input",this.getFileScanInputId()),this.fileScanInput.type="file",this.fileScanInput.accept="image/*",this.fileScanInput.style.display="none",a.appendChild(this.fileScanInput);var o=this;this.fileScanInput.addEventListener("change",function(p){if(!(p==null||p.target==null)){var y=p.target;if(!(y.files&&y.files.length===0)){var g=y.files,x=g[0],E=x.name;o.setImageNameToButton(E),s(x)}}});var f=this.createDragAndDropMessage();this.fileBasedScanRegion.appendChild(f),this.fileBasedScanRegion.addEventListener("dragenter",function(p){o.fileBasedScanRegion.style.border=o.fileBasedScanRegionActiveBorder(),p.stopPropagation(),p.preventDefault()}),this.fileBasedScanRegion.addEventListener("dragleave",function(p){o.fileBasedScanRegion.style.border=o.fileBasedScanRegionDefaultBorder(),p.stopPropagation(),p.preventDefault()}),this.fileBasedScanRegion.addEventListener("dragover",function(p){o.fileBasedScanRegion.style.border=o.fileBasedScanRegionActiveBorder(),p.stopPropagation(),p.preventDefault()}),this.fileBasedScanRegion.addEventListener("drop",function(p){p.stopPropagation(),p.preventDefault(),o.fileBasedScanRegion.style.border=o.fileBasedScanRegionDefaultBorder();var y=p.dataTransfer;if(y){var g=y.files;if(!g||g.length===0)return;for(var x=!1,E=0;E<g.length;++E){var A=g.item(E);if(A){var S=/image.*/;if(A.type.match(S)){x=!0;var I=A.name;o.setImageNameToButton(I),s(A),f.innerText=Html5QrcodeScannerStrings.dragAndDropMessage();break}}}x||(f.innerText=Html5QrcodeScannerStrings.dragAndDropMessageOnlyImages())}})}return n.prototype.hide=function(){this.fileBasedScanRegion.style.display="none",this.fileScanInput.disabled=!0},n.prototype.show=function(){this.fileBasedScanRegion.style.display="block",this.fileScanInput.disabled=!1},n.prototype.isShowing=function(){return this.fileBasedScanRegion.style.display==="block"},n.prototype.resetValue=function(){this.fileScanInput.value="",this.setInitialValueToButton()},n.prototype.createFileBasedScanRegion=function(){var t=document.createElement("div");return t.style.textAlign="center",t.style.margin="auto",t.style.width="80%",t.style.maxWidth="600px",t.style.border=this.fileBasedScanRegionDefaultBorder(),t.style.padding="10px",t.style.marginBottom="10px",t},n.prototype.fileBasedScanRegionDefaultBorder=function(){return"6px dashed #ebebeb"},n.prototype.fileBasedScanRegionActiveBorder=function(){return"6px dashed rgb(153 151 151)"},n.prototype.createDragAndDropMessage=function(){var t=document.createElement("div");return t.innerText=Html5QrcodeScannerStrings.dragAndDropMessage(),t.style.fontWeight="400",t},n.prototype.setImageNameToButton=function(t){var e=20;if(t.length>e){var s=t.substring(0,8),a=t.length,o=t.substring(a-8,a);t="".concat(s,"....").concat(o)}var f=Html5QrcodeScannerStrings.fileSelectionChooseAnother()+" - "+t;this.fileSelectionButton.innerText=f},n.prototype.setInitialValueToButton=function(){var t=Html5QrcodeScannerStrings.fileSelectionChooseImage()+" - "+Html5QrcodeScannerStrings.fileSelectionNoImageSelected();this.fileSelectionButton.innerText=t},n.prototype.getFileScanInputId=function(){return"html5-qrcode-private-filescan-input"},n.create=function(t,e,s){var a=new n(t,e,s);return a},n}(),CameraSelectionUi=function(){function n(t){this.selectElement=BaseUiElementFactory.createElement("select",PublicUiElementIdAndClasses.CAMERA_SELECTION_SELECT_ID),this.cameras=t,this.options=[]}return n.prototype.render=function(t){var e=document.createElement("span");e.style.marginRight="10px";var s=this.cameras.length;if(s===0)throw new Error("No cameras found");if(s===1)e.style.display="none";else{var a=Html5QrcodeScannerStrings.selectCamera();e.innerText="".concat(a," (").concat(this.cameras.length,")  ")}for(var o=1,f=0,p=this.cameras;f<p.length;f++){var y=p[f],g=y.id,x=y.label==null?g:y.label;(!x||x==="")&&(x=[Html5QrcodeScannerStrings.anonymousCameraPrefix(),o++].join(" "));var E=document.createElement("option");E.value=g,E.innerText=x,this.options.push(E),this.selectElement.appendChild(E)}e.appendChild(this.selectElement),t.appendChild(e)},n.prototype.disable=function(){this.selectElement.disabled=!0},n.prototype.isDisabled=function(){return this.selectElement.disabled===!0},n.prototype.enable=function(){this.selectElement.disabled=!1},n.prototype.getValue=function(){return this.selectElement.value},n.prototype.hasValue=function(t){for(var e=0,s=this.options;e<s.length;e++){var a=s[e];if(a.value===t)return!0}return!1},n.prototype.setValue=function(t){if(!this.hasValue(t))throw new Error("".concat(t," is not present in the camera list."));this.selectElement.value=t},n.prototype.hasSingleItem=function(){return this.cameras.length===1},n.prototype.numCameras=function(){return this.cameras.length},n.create=function(t,e){var s=new n(e);return s.render(t),s},n}(),CameraZoomUi=function(){function n(){this.onChangeCallback=null,this.zoomElementContainer=document.createElement("div"),this.rangeInput=BaseUiElementFactory.createElement("input",PublicUiElementIdAndClasses.ZOOM_SLIDER_ID),this.rangeInput.type="range",this.rangeText=document.createElement("span"),this.rangeInput.min="1",this.rangeInput.max="5",this.rangeInput.value="1",this.rangeInput.step="0.1"}return n.prototype.render=function(t,e){this.zoomElementContainer.style.display=e?"block":"none",this.zoomElementContainer.style.padding="5px 10px",this.zoomElementContainer.style.textAlign="center",t.appendChild(this.zoomElementContainer),this.rangeInput.style.display="inline-block",this.rangeInput.style.width="50%",this.rangeInput.style.height="5px",this.rangeInput.style.background="#d3d3d3",this.rangeInput.style.outline="none",this.rangeInput.style.opacity="0.7";var s=Html5QrcodeScannerStrings.zoom();this.rangeText.innerText="".concat(this.rangeInput.value,"x ").concat(s),this.rangeText.style.marginRight="10px";var a=this;this.rangeInput.addEventListener("input",function(){return a.onValueChange()}),this.rangeInput.addEventListener("change",function(){return a.onValueChange()}),this.zoomElementContainer.appendChild(this.rangeInput),this.zoomElementContainer.appendChild(this.rangeText)},n.prototype.onValueChange=function(){var t=Html5QrcodeScannerStrings.zoom();this.rangeText.innerText="".concat(this.rangeInput.value,"x ").concat(t),this.onChangeCallback&&this.onChangeCallback(parseFloat(this.rangeInput.value))},n.prototype.setValues=function(t,e,s,a){this.rangeInput.min=t.toString(),this.rangeInput.max=e.toString(),this.rangeInput.step=a.toString(),this.rangeInput.value=s.toString(),this.onValueChange()},n.prototype.show=function(){this.zoomElementContainer.style.display="block"},n.prototype.hide=function(){this.zoomElementContainer.style.display="none"},n.prototype.setOnCameraZoomValueChangeCallback=function(t){this.onChangeCallback=t},n.prototype.removeOnCameraZoomValueChangeCallback=function(){this.onChangeCallback=null},n.create=function(t,e){var s=new n;return s.render(t,e),s},n}(),Html5QrcodeScannerStatus;(function(n){n[n.STATUS_DEFAULT=0]="STATUS_DEFAULT",n[n.STATUS_SUCCESS=1]="STATUS_SUCCESS",n[n.STATUS_WARNING=2]="STATUS_WARNING",n[n.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"})(Html5QrcodeScannerStatus||(Html5QrcodeScannerStatus={}));function toHtml5QrcodeCameraScanConfig(n){return{fps:n.fps,qrbox:n.qrbox,aspectRatio:n.aspectRatio,disableFlip:n.disableFlip,videoConstraints:n.videoConstraints}}function toHtml5QrcodeFullConfig(n,t){return{formatsToSupport:n.formatsToSupport,useBarCodeDetectorIfSupported:n.useBarCodeDetectorIfSupported,experimentalFeatures:n.experimentalFeatures,verbose:t}}var Html5QrcodeScanner=function(){function n(t,e,s){if(this.lastMatchFound=null,this.cameraScanImage=null,this.fileScanImage=null,this.fileSelectionUi=null,this.elementId=t,this.config=this.createConfig(e),this.verbose=s===!0,!document.getElementById(t))throw"HTML Element with id=".concat(t," not found");this.scanTypeSelector=new ScanTypeSelector(this.config.supportedScanTypes),this.currentScanType=this.scanTypeSelector.getDefaultScanType(),this.sectionSwapAllowed=!0,this.logger=new BaseLoggger(this.verbose),this.persistedDataManager=new PersistedDataManager,e.rememberLastUsedCamera!==!0&&this.persistedDataManager.reset()}return n.prototype.render=function(t,e){var s=this;this.lastMatchFound=null,this.qrCodeSuccessCallback=function(o,f){if(t)t(o,f);else{if(s.lastMatchFound===o)return;s.lastMatchFound=o,s.setHeaderMessage(Html5QrcodeScannerStrings.lastMatch(o),Html5QrcodeScannerStatus.STATUS_SUCCESS)}},this.qrCodeErrorCallback=function(o,f){e&&e(o,f)};var a=document.getElementById(this.elementId);if(!a)throw"HTML Element with id=".concat(this.elementId," not found");a.innerHTML="",this.createBasicLayout(a),this.html5Qrcode=new Html5Qrcode(this.getScanRegionId(),toHtml5QrcodeFullConfig(this.config,this.verbose))},n.prototype.pause=function(t){(isNullOrUndefined(t)||t!==!0)&&(t=!1),this.getHtml5QrcodeOrFail().pause(t)},n.prototype.resume=function(){this.getHtml5QrcodeOrFail().resume()},n.prototype.getState=function(){return this.getHtml5QrcodeOrFail().getState()},n.prototype.clear=function(){var t=this,e=function(){var s=document.getElementById(t.elementId);s&&(s.innerHTML="",t.resetBasicLayout(s))};return this.html5Qrcode?new Promise(function(s,a){if(!t.html5Qrcode){s();return}t.html5Qrcode.isScanning?t.html5Qrcode.stop().then(function(o){if(!t.html5Qrcode){s();return}t.html5Qrcode.clear(),e(),s()}).catch(function(o){t.verbose&&t.logger.logError("Unable to stop qrcode scanner",o),a(o)}):(t.html5Qrcode.clear(),e(),s())}):Promise.resolve()},n.prototype.getRunningTrackCapabilities=function(){return this.getHtml5QrcodeOrFail().getRunningTrackCapabilities()},n.prototype.getRunningTrackSettings=function(){return this.getHtml5QrcodeOrFail().getRunningTrackSettings()},n.prototype.applyVideoConstraints=function(t){return this.getHtml5QrcodeOrFail().applyVideoConstraints(t)},n.prototype.getHtml5QrcodeOrFail=function(){if(!this.html5Qrcode)throw"Code scanner not initialized.";return this.html5Qrcode},n.prototype.createConfig=function(t){return t?(t.fps||(t.fps=Html5QrcodeConstants.SCAN_DEFAULT_FPS),t.rememberLastUsedCamera!==!Html5QrcodeConstants.DEFAULT_REMEMBER_LAST_CAMERA_USED&&(t.rememberLastUsedCamera=Html5QrcodeConstants.DEFAULT_REMEMBER_LAST_CAMERA_USED),t.supportedScanTypes||(t.supportedScanTypes=Html5QrcodeConstants.DEFAULT_SUPPORTED_SCAN_TYPE),t):{fps:Html5QrcodeConstants.SCAN_DEFAULT_FPS,rememberLastUsedCamera:Html5QrcodeConstants.DEFAULT_REMEMBER_LAST_CAMERA_USED,supportedScanTypes:Html5QrcodeConstants.DEFAULT_SUPPORTED_SCAN_TYPE}},n.prototype.createBasicLayout=function(t){t.style.position="relative",t.style.padding="0px",t.style.border="1px solid silver",this.createHeader(t);var e=document.createElement("div"),s=this.getScanRegionId();e.id=s,e.style.width="100%",e.style.minHeight="100px",e.style.textAlign="center",t.appendChild(e),ScanTypeSelector.isCameraScanType(this.currentScanType)?this.insertCameraScanImageToScanRegion():this.insertFileScanImageToScanRegion();var a=document.createElement("div"),o=this.getDashboardId();a.id=o,a.style.width="100%",t.appendChild(a),this.setupInitialDashboard(a)},n.prototype.resetBasicLayout=function(t){t.style.border="none"},n.prototype.setupInitialDashboard=function(t){this.createSection(t),this.createSectionControlPanel(),this.scanTypeSelector.hasMoreThanOneScanType()&&this.createSectionSwap()},n.prototype.createHeader=function(t){var e=document.createElement("div");e.style.textAlign="left",e.style.margin="0px",t.appendChild(e);var s=new LibraryInfoContainer;s.renderInto(e);var a=document.createElement("div");a.id=this.getHeaderMessageContainerId(),a.style.display="none",a.style.textAlign="center",a.style.fontSize="14px",a.style.padding="2px 10px",a.style.margin="4px",a.style.borderTop="1px solid #f6f6f6",e.appendChild(a)},n.prototype.createSection=function(t){var e=document.createElement("div");e.id=this.getDashboardSectionId(),e.style.width="100%",e.style.padding="10px 0px 10px 0px",e.style.textAlign="left",t.appendChild(e)},n.prototype.createCameraListUi=function(t,e,s){var a=this;a.showHideScanTypeSwapLink(!1),a.setHeaderMessage(Html5QrcodeScannerStrings.cameraPermissionRequesting());var o=function(){s||a.createPermissionButton(t,e)};Html5Qrcode.getCameras().then(function(f){a.persistedDataManager.setHasPermission(!0),a.showHideScanTypeSwapLink(!0),a.resetHeaderMessage(),f&&f.length>0?(t.removeChild(e),a.renderCameraSelection(f)):(a.setHeaderMessage(Html5QrcodeScannerStrings.noCameraFound(),Html5QrcodeScannerStatus.STATUS_WARNING),o())}).catch(function(f){a.persistedDataManager.setHasPermission(!1),s?s.disabled=!1:o(),a.setHeaderMessage(f,Html5QrcodeScannerStatus.STATUS_WARNING),a.showHideScanTypeSwapLink(!0)})},n.prototype.createPermissionButton=function(t,e){var s=this,a=BaseUiElementFactory.createElement("button",this.getCameraPermissionButtonId());a.innerText=Html5QrcodeScannerStrings.cameraPermissionTitle(),a.addEventListener("click",function(){a.disabled=!0,s.createCameraListUi(t,e,a)}),e.appendChild(a)},n.prototype.createPermissionsUi=function(t,e){var s=this;if(ScanTypeSelector.isCameraScanType(this.currentScanType)&&this.persistedDataManager.hasCameraPermissions()){CameraPermissions.hasPermissions().then(function(a){a?s.createCameraListUi(t,e):(s.persistedDataManager.setHasPermission(!1),s.createPermissionButton(t,e))}).catch(function(a){s.persistedDataManager.setHasPermission(!1),s.createPermissionButton(t,e)});return}this.createPermissionButton(t,e)},n.prototype.createSectionControlPanel=function(){var t=document.getElementById(this.getDashboardSectionId()),e=document.createElement("div");t.appendChild(e);var s=document.createElement("div");s.id=this.getDashboardSectionCameraScanRegionId(),s.style.display=ScanTypeSelector.isCameraScanType(this.currentScanType)?"block":"none",e.appendChild(s);var a=document.createElement("div");a.style.textAlign="center",s.appendChild(a),this.scanTypeSelector.isCameraScanRequired()&&this.createPermissionsUi(s,a),this.renderFileScanUi(e)},n.prototype.renderFileScanUi=function(t){var e=ScanTypeSelector.isFileScanType(this.currentScanType),s=this,a=function(o){if(!s.html5Qrcode)throw"html5Qrcode not defined";ScanTypeSelector.isFileScanType(s.currentScanType)&&(s.setHeaderMessage(Html5QrcodeScannerStrings.loadingImage()),s.html5Qrcode.scanFileV2(o,!0).then(function(f){s.resetHeaderMessage(),s.qrCodeSuccessCallback(f.decodedText,f)}).catch(function(f){s.setHeaderMessage(f,Html5QrcodeScannerStatus.STATUS_WARNING),s.qrCodeErrorCallback(f,Html5QrcodeErrorFactory.createFrom(f))}))};this.fileSelectionUi=FileSelectionUi.create(t,e,a)},n.prototype.renderCameraSelection=function(t){var e=this,s=this,a=document.getElementById(this.getDashboardSectionCameraScanRegionId());a.style.textAlign="center";var o=CameraZoomUi.create(a,!1),f=function(_){var R=_.zoomFeature();if(R.isSupported()){o.setOnCameraZoomValueChangeCallback(function(D){R.apply(D)});var N=1;e.config.defaultZoomValueIfSupported&&(N=e.config.defaultZoomValueIfSupported),N=clip(N,R.min(),R.max()),o.setValues(R.min(),R.max(),N,R.step()),o.show()}},p=CameraSelectionUi.create(a,t),y=document.createElement("span"),g=BaseUiElementFactory.createElement("button",PublicUiElementIdAndClasses.CAMERA_START_BUTTON_ID);g.innerText=Html5QrcodeScannerStrings.scanButtonStartScanningText(),y.appendChild(g);var x=BaseUiElementFactory.createElement("button",PublicUiElementIdAndClasses.CAMERA_STOP_BUTTON_ID);x.innerText=Html5QrcodeScannerStrings.scanButtonStopScanningText(),x.style.display="none",x.disabled=!0,y.appendChild(x);var E,A=function(_){if(!_.torchFeature().isSupported()){E&&E.hide();return}E?E.updateTorchCapability(_.torchFeature()):E=TorchButton.create(y,_.torchFeature(),{display:"none",marginLeft:"5px"},function(R){s.setHeaderMessage(R,Html5QrcodeScannerStatus.STATUS_WARNING)}),E.show()};a.appendChild(y);var S=function(_){_||(g.style.display="none"),g.innerText=Html5QrcodeScannerStrings.scanButtonStartScanningText(),g.style.opacity="1",g.disabled=!1,_&&(g.style.display="inline-block")};if(g.addEventListener("click",function(_){g.innerText=Html5QrcodeScannerStrings.scanButtonScanningStarting(),p.disable(),g.disabled=!0,g.style.opacity="0.5",e.scanTypeSelector.hasMoreThanOneScanType()&&s.showHideScanTypeSwapLink(!1),s.resetHeaderMessage();var R=p.getValue();s.persistedDataManager.setLastUsedCameraId(R),s.html5Qrcode.start(R,toHtml5QrcodeCameraScanConfig(s.config),s.qrCodeSuccessCallback,s.qrCodeErrorCallback).then(function(N){x.disabled=!1,x.style.display="inline-block",S(!1);var D=s.html5Qrcode.getRunningTrackCameraCapabilities();e.config.showTorchButtonIfSupported===!0&&A(D),e.config.showZoomSliderIfSupported===!0&&f(D)}).catch(function(N){s.showHideScanTypeSwapLink(!0),p.enable(),S(!0),s.setHeaderMessage(N,Html5QrcodeScannerStatus.STATUS_WARNING)})}),p.hasSingleItem()&&g.click(),x.addEventListener("click",function(_){if(!s.html5Qrcode)throw"html5Qrcode not defined";x.disabled=!0,s.html5Qrcode.stop().then(function(R){e.scanTypeSelector.hasMoreThanOneScanType()&&s.showHideScanTypeSwapLink(!0),p.enable(),g.disabled=!1,x.style.display="none",g.style.display="inline-block",E&&(E.reset(),E.hide()),o.removeOnCameraZoomValueChangeCallback(),o.hide(),s.insertCameraScanImageToScanRegion()}).catch(function(R){x.disabled=!1,s.setHeaderMessage(R,Html5QrcodeScannerStatus.STATUS_WARNING)})}),s.persistedDataManager.getLastUsedCameraId()){var I=s.persistedDataManager.getLastUsedCameraId();p.hasValue(I)?(p.setValue(I),g.click()):s.persistedDataManager.resetLastUsedCameraId()}},n.prototype.createSectionSwap=function(){var t=this,e=Html5QrcodeScannerStrings.textIfCameraScanSelected(),s=Html5QrcodeScannerStrings.textIfFileScanSelected(),a=document.getElementById(this.getDashboardSectionId()),o=document.createElement("div");o.style.textAlign="center";var f=BaseUiElementFactory.createElement("span",this.getDashboardSectionSwapLinkId());f.style.textDecoration="underline",f.style.cursor="pointer",f.innerText=ScanTypeSelector.isCameraScanType(this.currentScanType)?e:s,f.addEventListener("click",function(){if(!t.sectionSwapAllowed){t.verbose&&t.logger.logError("Section swap called when not allowed");return}t.resetHeaderMessage(),t.fileSelectionUi.resetValue(),t.sectionSwapAllowed=!1,ScanTypeSelector.isCameraScanType(t.currentScanType)?(t.clearScanRegion(),t.getCameraScanRegion().style.display="none",t.fileSelectionUi.show(),f.innerText=s,t.currentScanType=Html5QrcodeScanType.SCAN_TYPE_FILE,t.insertFileScanImageToScanRegion()):(t.clearScanRegion(),t.getCameraScanRegion().style.display="block",t.fileSelectionUi.hide(),f.innerText=e,t.currentScanType=Html5QrcodeScanType.SCAN_TYPE_CAMERA,t.insertCameraScanImageToScanRegion(),t.startCameraScanIfPermissionExistsOnSwap()),t.sectionSwapAllowed=!0}),o.appendChild(f),a.appendChild(o)},n.prototype.startCameraScanIfPermissionExistsOnSwap=function(){var t=this,e=this;if(this.persistedDataManager.hasCameraPermissions()){CameraPermissions.hasPermissions().then(function(s){if(s){var a=document.getElementById(e.getCameraPermissionButtonId());if(!a)throw t.logger.logError("Permission button not found, fail;"),"Permission button not found";a.click()}else e.persistedDataManager.setHasPermission(!1)}).catch(function(s){e.persistedDataManager.setHasPermission(!1)});return}},n.prototype.resetHeaderMessage=function(){var t=document.getElementById(this.getHeaderMessageContainerId());t.style.display="none"},n.prototype.setHeaderMessage=function(t,e){e||(e=Html5QrcodeScannerStatus.STATUS_DEFAULT);var s=this.getHeaderMessageDiv();switch(s.innerText=t,s.style.display="block",e){case Html5QrcodeScannerStatus.STATUS_SUCCESS:s.style.background="rgba(106, 175, 80, 0.26)",s.style.color="#477735";break;case Html5QrcodeScannerStatus.STATUS_WARNING:s.style.background="rgba(203, 36, 49, 0.14)",s.style.color="#cb2431";break;case Html5QrcodeScannerStatus.STATUS_DEFAULT:default:s.style.background="rgba(0, 0, 0, 0)",s.style.color="rgb(17, 17, 17)";break}},n.prototype.showHideScanTypeSwapLink=function(t){this.scanTypeSelector.hasMoreThanOneScanType()&&(t!==!0&&(t=!1),this.sectionSwapAllowed=t,this.getDashboardSectionSwapLink().style.display=t?"inline-block":"none")},n.prototype.insertCameraScanImageToScanRegion=function(){var t=this,e=document.getElementById(this.getScanRegionId());if(this.cameraScanImage){e.innerHTML="<br>",e.appendChild(this.cameraScanImage);return}this.cameraScanImage=new Image,this.cameraScanImage.onload=function(s){e.innerHTML="<br>",e.appendChild(t.cameraScanImage)},this.cameraScanImage.width=64,this.cameraScanImage.style.opacity="0.8",this.cameraScanImage.src=ASSET_CAMERA_SCAN,this.cameraScanImage.alt=Html5QrcodeScannerStrings.cameraScanAltText()},n.prototype.insertFileScanImageToScanRegion=function(){var t=this,e=document.getElementById(this.getScanRegionId());if(this.fileScanImage){e.innerHTML="<br>",e.appendChild(this.fileScanImage);return}this.fileScanImage=new Image,this.fileScanImage.onload=function(s){e.innerHTML="<br>",e.appendChild(t.fileScanImage)},this.fileScanImage.width=64,this.fileScanImage.style.opacity="0.8",this.fileScanImage.src=ASSET_FILE_SCAN,this.fileScanImage.alt=Html5QrcodeScannerStrings.fileScanAltText()},n.prototype.clearScanRegion=function(){var t=document.getElementById(this.getScanRegionId());t.innerHTML=""},n.prototype.getDashboardSectionId=function(){return"".concat(this.elementId,"__dashboard_section")},n.prototype.getDashboardSectionCameraScanRegionId=function(){return"".concat(this.elementId,"__dashboard_section_csr")},n.prototype.getDashboardSectionSwapLinkId=function(){return PublicUiElementIdAndClasses.SCAN_TYPE_CHANGE_ANCHOR_ID},n.prototype.getScanRegionId=function(){return"".concat(this.elementId,"__scan_region")},n.prototype.getDashboardId=function(){return"".concat(this.elementId,"__dashboard")},n.prototype.getHeaderMessageContainerId=function(){return"".concat(this.elementId,"__header_message")},n.prototype.getCameraPermissionButtonId=function(){return PublicUiElementIdAndClasses.CAMERA_PERMISSION_BUTTON_ID},n.prototype.getCameraScanRegion=function(){return document.getElementById(this.getDashboardSectionCameraScanRegionId())},n.prototype.getDashboardSectionSwapLink=function(){return document.getElementById(this.getDashboardSectionSwapLinkId())},n.prototype.getHeaderMessageDiv=function(){return document.getElementById(this.getHeaderMessageContainerId())},n}();const QRCodeReader=({onScanSuccess:n,onScanError:t})=>{const e=reactExports.useRef(null);return reactExports.useEffect(()=>(e.current||(e.current=new Html5QrcodeScanner("qr-reader",{fps:10,qrbox:{width:250,height:250},aspectRatio:1},!1),e.current.render(s=>{n(s)},s=>{t&&t(s)})),()=>{e.current&&e.current.clear()}),[n,t]),jsxRuntimeExports.jsx("div",{id:"qr-reader",className:"w-full max-w-md mx-auto"})},LobbyScreen=({ndk:n,currentUser:t,onChallengeAccepted:e,onBackToMenu:s})=>{const a=t.npub,o=a?`nostr:${a}`:"",[f,p]=reactExports.useState(""),[y,g]=reactExports.useState(!1),[x,E]=reactExports.useState(!1),A=(R,N)=>{e(R,N)},S=R=>{if(console.log("Scanned QR Code:",R),R&&R.startsWith("nostr:npub1")){const N=R.substring(6);try{nip19_exports.decode(N),p(N),g(!1),console.log("Successfully parsed and set npub:",N)}catch(D){console.error("Scanned text is not a valid npub:",R,D),alert("Scanned QR code does not contain a valid Nostr npub URI (nostr:npub1...). Try again.")}}else console.warn("Scanned text is not in the expected format (nostr:npub1...):",R),alert("Scanned QR code does not contain a valid Nostr npub URI (nostr:npub1...). Try again.")},I=R=>{g(!1),console.error("QR Scanner Error:",R);let N=`QR Scan Error: ${R}`;R.includes("NotAllowedError")?N="Camera access was denied. Please grant permission in your browser settings and try again.":R.includes("NotFoundError")?N="No camera found on this device.":R.includes("NotReadableError")?N="Could not access the camera. Another app or browser tab might be using it.":R.includes("secure context")&&(N="Camera access requires a secure connection (HTTPS). Please ensure the app is served over HTTPS."),alert(N)},_=()=>{if(window.location.protocol!=="https:"){alert("Camera access requires a secure connection (HTTPS). Please ensure the app is served over HTTPS.");return}E(!0),setTimeout(()=>{g(!0),E(!1)},500)};return jsxRuntimeExports.jsxs("div",{className:"relative w-full h-dvh bg-black text-white overflow-hidden flex flex-col",children:[y&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex flex-col items-center justify-center z-50 p-4",onClick:()=>g(!1),children:jsxRuntimeExports.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-md w-full relative",onClick:R=>R.stopPropagation(),children:[jsxRuntimeExports.jsx("h3",{className:"text-xl font-semibold mb-4 text-gray-800 text-center",children:"Scan Opponent's QR Code"}),jsxRuntimeExports.jsx(QRCodeReader,{onScanSuccess:S,onScanError:I}),jsxRuntimeExports.jsx("button",{onClick:()=>g(!1),className:"mt-4 w-full px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50",children:"Cancel Scan"})]})}),jsxRuntimeExports.jsx("div",{className:"w-full flex justify-start mb-4",children:jsxRuntimeExports.jsx("button",{onClick:s,className:"px-4 py-2 rounded font-semibold text-white bg-gray-600 hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 shadow-md",children:" Back to Menu"})}),jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Multiplayer Lobby"}),jsxRuntimeExports.jsxs("div",{className:"mb-6 p-4 bg-gray-700 rounded-lg shadow-md w-full max-w-md text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-lg text-gray-300 mb-2",children:"Your Nostr ID (Share this!)"}),jsxRuntimeExports.jsx("p",{className:"text-sm font-mono text-purple-300 break-all mb-4 select-all",title:"Click to select",children:a||"Could not get npub"}),jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsx("div",{className:"bg-white p-2 rounded-md inline-block",children:o?jsxRuntimeExports.jsx(QRCodeCanvas,{value:o,size:128}):jsxRuntimeExports.jsx("p",{className:"text-red-500 text-xs",children:"Could not generate QR code"})})})]}),jsxRuntimeExports.jsxs("div",{className:"w-full max-w-lg p-4 bg-gray-700 rounded-lg shadow-md",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-2",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold",children:"Challenge Players"}),jsxRuntimeExports.jsx("button",{onClick:_,className:"px-3 py-1 bg-purple-600 rounded hover:bg-purple-700 text-sm disabled:opacity-50",children:"Scan QR"})]}),x&&jsxRuntimeExports.jsx("p",{className:"text-xs text-yellow-300 mb-2 text-center",children:"Your browser will ask for camera permission to scan the code."}),jsxRuntimeExports.jsx(ChallengeHandler,{ndk:n,loggedInPubkey:t.pubkey,onChallengeAccepted:A,recipientNpubOrHex:f,setRecipientNpubOrHex:p})]})]})},OPPONENT_NPUB="npub180cvv07tjdrrgpa0j7j7tmnyl2yr6yr7l8j4s3evf6u64th6gkwsyjh6w6",PracticeScreen=({ndk:n,currentUser:t,onBackToMenu:e})=>{let s;try{if(s=new NDKUser({npub:OPPONENT_NPUB}).pubkey,!s)throw new Error("Failed to derive pubkey from NDKUser")}catch(M){console.error("Error getting opponent pubkey:",M),s=t.pubkey}const a=reactExports.useCallback(M=>{let W="Game Over!";const B=`Score: ${M.finalScore[0]} - ${M.finalScore[1]}`;M.winnerIndex===0?W=`Blue Wins! (${M.reason})`:M.winnerIndex===1?W=`Red Wins! (${M.reason})`:W=`Draw! (${M.reason})`,alert(`${W}
${B}`),e()},[e]),{playerStates:o,currentPlayerIndex:f,aimStates:p,selectedAbility:y,score:g,currentRound:x,handleAimChange:E,handleFire:A,handleSelectAbility:S,physicsHandles:I,shotTracerHandlers:_,settings:R}=useGameLogic({settings:practiceSettings,mode:"practice",localPlayerPubkey:t.pubkey,opponentPubkey:s,onGameEnd:a}),N=o[f],D=p[f];return useKeyboardControls({isActive:!0,currentAngle:D.angle,currentPower:D.power,handleAimChange:E,handleFire:A,handleSelectAbility:S}),jsxRuntimeExports.jsxs("div",{className:"relative w-full h-dvh bg-black text-white overflow-hidden flex flex-col",children:[jsxRuntimeExports.jsx("button",{onClick:e,className:"absolute top-2 right-2 z-20 px-2 py-0.5 rounded text-sm font-semibold text-white","aria-label":"Back to Menu",children:"X"}),jsxRuntimeExports.jsxs("div",{className:"absolute top-2 left-1/2 transform -translate-x-1/2 z-20 flex items-center space-x-4 px-3 py-1 bg-black/30 rounded",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm font-semibold text-yellow-300",children:["Round: ",x," / ",R.MAX_ROUNDS]}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-semibold text-yellow-300",children:["Score: ",g[0]," - ",g[1]]})]}),jsxRuntimeExports.jsxs("div",{className:"relative flex-grow w-full h-full",children:[jsxRuntimeExports.jsxs("div",{className:"absolute top-8 left-2 z-10 pointer-events-auto",children:[" ",jsxRuntimeExports.jsx(PlayerHUD,{pubkey:t.pubkey,currentHp:o[0].hp,maxHp:practiceSettings.MAX_HP,isPlayer1:!0,ndk:n})]}),jsxRuntimeExports.jsxs("div",{className:"absolute top-8 right-2 z-10 pointer-events-auto",children:[" ",jsxRuntimeExports.jsx(PlayerHUD,{pubkey:s,currentHp:o[1].hp,maxHp:practiceSettings.MAX_HP,isPlayer1:!1,ndk:n})]}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 z-0 w-full h-full",children:jsxRuntimeExports.jsx(GameRenderer,{physicsHandles:I,shotTracerHandlers:_,settings:R,aimStates:p})}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-4 left-4 z-10 pointer-events-auto flex flex-col items-start max-w-xs",children:jsxRuntimeExports.jsx(AimingInterface,{currentAngle:D.angle,currentPower:D.power,onAimChange:E})}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-4 right-4 z-10 pointer-events-auto flex flex-col items-end",children:jsxRuntimeExports.jsx(ActionButtons,{selectedAbility:y,usedAbilities:N.usedAbilities,currentHp:N.hp,abilityCost:practiceSettings.ABILITY_COST_HP,maxAbilityUsesTotal:practiceSettings.MAX_ABILITIES_TOTAL,maxAbilityUsesPerType:practiceSettings.MAX_ABILITIES_PER_TYPE,onAbilitySelect:S,onFire:A,disabled:!1,availableAbilities:R.AVAILABLE_ABILITIES})})]})]})};function isMobileDevice(){if(typeof window>"u")return!1;const n=navigator.userAgent||navigator.vendor||"";return/android|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(n.toLowerCase())}const DeveloperSandboxScreen=({onBackToMenu:n,localPlayerPubkey:t="sandbox-player"})=>{const e=reactExports.useCallback(_=>{console.log("[Sandbox] Game Over:",_),alert(`[Sandbox] Game Over! Winner: ${_.winnerIndex===0?"Player 0":_.winnerIndex===1?"Player 1":"Draw"}. Final Score: ${_.finalScore[0]}-${_.finalScore[1]}. Reason: ${_.reason}`)},[]),{playerStates:s,aimStates:a,selectedAbility:o,levelData:f,score:p,currentRound:y,handleAimChange:g,handleFire:x,handleSelectAbility:E,physicsHandles:A,shotTracerHandlers:S,settings:I}=useGameLogic({settings:sandboxSettings,mode:"practice",localPlayerPubkey:t,onGameEnd:e});return useKeyboardControls({isActive:!0,currentAngle:a[0].angle,currentPower:a[0].power,handleAimChange:g,handleFire:x,handleSelectAbility:E}),jsxRuntimeExports.jsxs("div",{className:"relative w-full h-dvh bg-gray-900 text-white overflow-hidden flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex-shrink-0 w-full flex justify-between items-center p-2 bg-gray-800 shadow-md z-20",children:[jsxRuntimeExports.jsx("button",{onClick:n,className:"px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-white font-semibold transition-colors duration-150",children:" Back to Menu"}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold text-yellow-300",children:"Developer Sandbox"}),jsxRuntimeExports.jsxs("div",{className:"text-lg font-semibold text-blue-300 flex items-center space-x-4 pr-4",children:[jsxRuntimeExports.jsxs("span",{children:["Round: ",y," / ",I.MAX_ROUNDS]}),jsxRuntimeExports.jsxs("span",{children:["Score: ",p[0]," - ",p[1]]}),jsxRuntimeExports.jsxs("span",{children:["P1 HP: ",s[0].hp]}),jsxRuntimeExports.jsxs("span",{children:["P2 HP: ",s[1].hp]})]})]}),jsxRuntimeExports.jsxs("div",{className:"relative flex-grow w-full h-full",children:[jsxRuntimeExports.jsxs("div",{className:"absolute inset-0 z-0 w-full h-full",children:[f&&A&&S&&a&&I&&jsxRuntimeExports.jsx(GameRenderer,{physicsHandles:A,shotTracerHandlers:S,settings:I,aimStates:a}),(!f||!A)&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-2xl font-bold text-gray-500",children:"Initializing Sandbox..."})]}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-4 left-4 z-10 pointer-events-auto flex flex-col items-start max-w-xs",children:jsxRuntimeExports.jsx(AimingInterface,{currentAngle:a[0].angle,currentPower:a[0].power,onAimChange:g})}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-4 right-4 z-10 pointer-events-auto flex flex-col items-end",children:jsxRuntimeExports.jsx(ActionButtons,{onFire:x,onAbilitySelect:E,selectedAbility:o,usedAbilities:s[0].usedAbilities,currentHp:s[0].hp,abilityCost:I.ABILITY_COST_HP,maxAbilityUsesTotal:I.MAX_ABILITIES_TOTAL,maxAbilityUsesPerType:I.MAX_ABILITIES_PER_TYPE,disabled:!1,availableAbilities:I.AVAILABLE_ABILITIES})})]})]})},DEV_NPUB="npub10nxjs7e4vh7a05a0qz8u7x4kdtlq6nk5lugeczddk5l40x5kdysqt2e96x";let DEV_PUBKEY=null;try{DEV_PUBKEY=new NDKUser({npub:DEV_NPUB}).pubkey,DEV_PUBKEY||console.error("CRITICAL ERROR: Failed to derive developer pubkey from npub.")}catch(n){console.error("CRITICAL ERROR: Failed to instantiate NDKUser for developer npub:",n)}function App(){const{ndk:n,isNdkReady:t,ndkConnectionError:e,currentUser:s,isLoggedIn:a,nip46AuthUrl:o,nip46Status:f,authError:p,loginWithNip07:y,initiateNip46QrCodeLogin:g,initiateNip46MobileDeepLinkLogin:x,cancelNip46LoginAttempt:E}=useAuth(),[A,S]=reactExports.useState("connecting_ndk"),[I,_]=reactExports.useState(null),[R,N]=reactExports.useState(null),D=()=>{const $=document.documentElement;$.requestFullscreen?$.requestFullscreen():$.webkitRequestFullscreen?$.webkitRequestFullscreen():console.warn("Fullscreen API not supported by this browser.")};reactExports.useEffect(()=>{if(console.log(`[View Effect Check] NDK Ready: ${t}, Logged In: ${a}, Current View: ${A}`),!t)A!=="connecting_ndk"&&(console.log("[View Effect] NDK not ready, setting view to connecting_ndk"),S("connecting_ndk"));else if(!a)A!=="login"&&(console.log("[View Effect] NDK ready, not logged in, setting view to login"),S("login"));else{const $=(s==null?void 0:s.pubkey)===DEV_PUBKEY;A==="connecting_ndk"||A==="login"?(console.log(`[View Effect] Logged in and NDK ready (from ${A}), setting view to menu`),S("menu")):A==="dev_sandbox"&&!$?(console.warn("[View Effect] Non-developer attempting to access dev_sandbox. Redirecting to menu."),S("menu")):console.log(`[View Effect] Logged in and NDK ready, staying in current view: ${A}`)}},[t,a,A,s==null?void 0:s.pubkey]);const M=()=>{a&&S("practice")},W=()=>{a&&S("lobby")},B=()=>{a&&(s==null?void 0:s.pubkey)===DEV_PUBKEY?S("dev_sandbox"):(console.warn("Attempted to navigate to dev sandbox without required permissions."),S("menu"))},U=()=>{S("menu"),_(null),N(null)},P=($,V)=>{console.log(`[App] Starting multiplayer game against: ${$}, Match ID: ${V}`),_($),N(V),S("game")},F=()=>{console.log("[App] Multiplayer game ended, returning to menu."),_(null),N(null),S("menu")},j=()=>{isMobileDevice()?(console.log("[App] Mobile device detected, initiating NIP-46 deeplink flow."),x()):(console.log("[App] Desktop device detected, initiating NIP-46 QR code flow."),g())},Q=()=>{var $,V;if(console.log(`[App Render] View: ${A}, NDK Ready: ${t}, Logged In: ${a}, NIP46 Status: ${f}, IsDev: ${(s==null?void 0:s.pubkey)===DEV_PUBKEY}`),A==="connecting_ndk")return jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-full w-full",children:e?`Error connecting to Nostr relays: ${e.message}`:"Connecting to Nostr relays..."});if(A==="login")return f==="waiting_for_scan"&&o&&!isMobileDevice()?jsxRuntimeExports.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-4 sm:p-6 text-center",children:[jsxRuntimeExports.jsx("p",{className:"mb-4 text-lg",children:"Scan with your Nostr mobile app (like Amber, Nostore, etc.):"}),jsxRuntimeExports.jsxs("div",{className:"bg-white p-3 sm:p-4 rounded-lg mb-4 inline-block",children:[jsxRuntimeExports.jsx(QRCodeCanvas,{value:o,size:200,className:"sm:w-64 sm:h-64 w-48 h-48"})," "]}),jsxRuntimeExports.jsx("input",{type:"text",readOnly:!0,value:o,className:"w-full max-w-xs sm:max-w-md p-2 border border-gray-600 rounded bg-gray-800 text-white text-[10px] sm:text-xs mb-2 break-all",onClick:G=>G.target.select(),title:"Click to select URI"}),jsxRuntimeExports.jsx("button",{onClick:()=>navigator.clipboard.writeText(o),className:"px-4 py-2 rounded font-semibold text-white transition-colors bg-blue-600 hover:bg-blue-700 mb-4 text-sm sm:text-base",children:"Copy URI"}),jsxRuntimeExports.jsx("p",{className:"text-gray-400 text-sm",children:"Waiting for connection..."}),p&&jsxRuntimeExports.jsx("p",{className:"text-red-500 text-xs mt-2",children:p.message})]}):f==="waiting_for_mobile_approval"?jsxRuntimeExports.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-4 sm:p-6 text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-lg mb-4",children:"Check your Nostr mobile app"}),jsxRuntimeExports.jsx("p",{className:"text-gray-400 mb-4",children:"Approve the connection request from Zapslingers in your signer (e.g., Amber, Damus)."}),jsxRuntimeExports.jsx("button",{onClick:E,className:"px-4 py-2 rounded font-semibold text-white transition-colors bg-red-600 hover:bg-red-700 text-sm sm:text-base",children:"Cancel"}),p&&jsxRuntimeExports.jsx("p",{className:"text-red-500 text-xs mt-4",children:p.message})]}):jsxRuntimeExports.jsxs("div",{className:"w-full min-h-screen flex flex-col sm:flex-row items-center justify-center p-4",children:[" ",jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center p-6 sm:p-8 bg-gray-800 rounded-lg shadow-xl space-y-4 sm:space-y-6 w-full max-w-md",children:[" ",jsxRuntimeExports.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-purple-400 mb-4 text-center",children:"Zapslingers Login"}),window.nostr?jsxRuntimeExports.jsx("button",{onClick:y,className:"w-full px-6 py-3 rounded font-semibold text-white transition-colors bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50",children:"Login with Browser Extension (NIP-07)"}):jsxRuntimeExports.jsxs("div",{className:"text-center w-full p-3 bg-gray-700 rounded",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-400",children:"Nostr Browser Extension (NIP-07) not detected."}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"(Mobile browsers usually don't support extensions. Use NIP-46 below.)"})]}),jsxRuntimeExports.jsx("div",{className:"w-full border-t border-gray-600 my-2"}),jsxRuntimeExports.jsx("p",{className:"text-center text-gray-300 text-sm sm:text-base",children:"Connect using a mobile signing app:"}),jsxRuntimeExports.jsx("button",{onClick:j,disabled:f==="waiting_for_scan"||f==="waiting_for_mobile_approval",className:"w-full px-4 sm:px-6 py-2 sm:py-3 rounded font-semibold text-white transition-colors bg-blue-600 hover:bg-blue-700 disabled:bg-gray-500 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 text-sm sm:text-base",children:"Connect with Mobile App (NIP-46)"}),p&&jsxRuntimeExports.jsxs("p",{className:"text-red-500 text-xs sm:text-sm mt-4 text-center",children:["Login Failed: ",p.message]})," "]})]});if(a&&s&&n)switch(A){case"menu":return jsxRuntimeExports.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center space-y-4 p-4",children:[jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold mb-6 text-purple-300",children:"Zapslingers Menu"}),jsxRuntimeExports.jsxs("p",{className:"text-gray-400",children:["Logged in as: ",(($=s.profile)==null?void 0:$.displayName)||((V=s.profile)==null?void 0:V.name)||s.pubkey.slice(0,10),"..."]}),jsxRuntimeExports.jsx("button",{onClick:M,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded text-white font-semibold",children:"Practice Mode"}),jsxRuntimeExports.jsx("button",{onClick:W,className:"px-6 py-3 bg-green-600 hover:bg-green-700 rounded text-white font-semibold",children:"Multiplayer Lobby"}),s.pubkey===DEV_PUBKEY&&jsxRuntimeExports.jsx("button",{onClick:B,className:"px-6 py-3 bg-yellow-600 hover:bg-yellow-700 rounded text-black font-semibold",children:"Developer Sandbox"}),jsxRuntimeExports.jsx("button",{onClick:D,className:"px-6 py-3 bg-purple-600 hover:bg-purple-700 rounded text-white font-semibold",children:"Enter Fullscreen"})]});case"practice":return jsxRuntimeExports.jsx(PracticeScreen,{ndk:n,currentUser:s,onBackToMenu:U});case"lobby":return jsxRuntimeExports.jsx(LobbyScreen,{ndk:n,currentUser:s,onChallengeAccepted:P,onBackToMenu:U});case"game":return I&&R?jsxRuntimeExports.jsx(GameScreen,{ndk:n,localPlayerPubkey:s.pubkey,opponentPubkey:I,matchId:R,onGameEnd:F,onBackToMenu:U}):(console.warn("[App Render] Trying to render game but opponentPubkey or matchId is undefined"),jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-full w-full",children:"Redirecting to menu..."}));case"dev_sandbox":return s&&n&&s.pubkey===DEV_PUBKEY?jsxRuntimeExports.jsx(DeveloperSandboxScreen,{ndk:n,currentUser:s,onBackToMenu:U}):(console.warn("Render attempt for dev_sandbox blocked for non-developer."),S("menu"),null);default:return console.error(`[App Render] Reached unexpected state: View=${A}, LoggedIn=${a}`),jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-full w-full",children:"Unexpected application state."})}return console.error(`[App Render] Reached unexpected state: View=${A}, LoggedIn=${a}`),jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-full w-full",children:"Unexpected application state."})};return jsxRuntimeExports.jsx("div",{className:"flex flex-col min-h-screen bg-black text-white",children:Q()})}ReactDOM.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(n=>{console.log("SW registered: ",n)}).catch(n=>{console.log("SW registration failed: ",n)})});
